import{a as Ne}from"../chunks/B5LTcAhG.js";import{P as Te}from"../chunks/njcIKE7L.js";import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{o as Le}from"../chunks/DUiJaq3B.js";import{p as Se,ai as le,w as ke,d as e,aj as Me,t as q,c as s,s as o,a as je,E as w,D as a,R as ze,r,ap as Ae,i as Qe,f as he,u as ne,aq as He,ar as Re}from"../chunks/DkHtKwEy.js";import{p as we,b as J,i as L,e as de,a as Be,s as S}from"../chunks/DJ88wS1R.js";import{e as xe,i as $e}from"../chunks/CKczAFpg.js";import{f,a as c,c as Oe}from"../chunks/B190dNFg.js";import{b as Ge,r as ce}from"../chunks/CaNs3-ti.js";import{b as V}from"../chunks/Cf6qqcEk.js";import{i as qe}from"../chunks/CrhaOPk_.js";import{P as Je}from"../chunks/DK-EGX4l.js";import{D as Ve}from"../chunks/CJye0tFo.js";import{c as We,u as Xe,a as Ye,p as Ze,i as et,b as tt,l as at,d as rt,e as st}from"../chunks/C_4rdQjt.js";const ot=!1,it=async()=>(Ne(Te.ManageUsers,"Manage Users"),{}),Ft=Object.freeze(Object.defineProperty({__proto__:null,load:it,ssr:ot},Symbol.toStringTag,{value:"Module"}));var nt=f('<div class="alert alert-danger" role="alert"> </div>'),lt=f('<div class="form-text">Key cannot be changed after creation</div>'),dt=f("<option> </option>"),ct=f('<input type="text" class="form-control mt-2" placeholder="Enter custom category"/>'),vt=f('<div class="form-text">Category cannot be changed after creation</div>'),mt=f('<div class="form-text">Used for grouping permissions</div>'),pt=f('<span class="spinner-border spinner-border-sm me-2" role="status"></span>'),ft=f('<form><!> <div class="mb-3"><label for="permission-key" class="form-label">Key <span class="text-danger">*</span></label> <input type="text" class="form-control" id="permission-key" required placeholder="e.g., manage-events"/> <!></div> <div class="mb-3"><label for="permission-name" class="form-label">Name <span class="text-danger">*</span></label> <input type="text" class="form-control" id="permission-name" required placeholder="e.g., Manage Events"/></div> <div class="mb-3"><label for="permission-description" class="form-label">Description</label> <textarea class="form-control" id="permission-description" rows="3" placeholder="Describe what this permission allows..."></textarea></div> <div class="mb-3"><label for="permission-category" class="form-label">Category</label> <select class="form-select" id="permission-category"><option>Select a category...</option><!><option>Other (custom)...</option></select> <!> <!></div> <div class="d-flex gap-2"><button type="submit" class="btn btn-primary"><!> </button> <button type="button" class="btn btn-secondary" data-bs-dismiss="offcanvas">Cancel</button></div></form>');function ut(ve,U){Se(U,!1);const M=()=>J(We,"$categories",W),[W,me]=Be(),u=w();let D=we(U,"id",8,"permission-form-drawer"),_=we(U,"permission",8,null),z=we(U,"onSave",8,null),C=w(""),b=w(""),k=w(""),F=w(""),m=w(""),E=w(""),l=w(!1),p=w("");async function g(v){v.preventDefault(),a(l,!0),a(p,"");try{e(u)&&_()?await Xe(_().id,{name:e(b),description:e(k)||null,category:e(F)||null}):await Ye({key:e(C),name:e(b),description:e(k)||null,category:e(F)||null});const y=document.getElementById(D());if(y){const $=window.bootstrap?.Offcanvas?.getInstance(y);$&&$.hide()}x(),z()&&z()()}catch(y){a(p,y instanceof Error?y.message:"Failed to save permission")}finally{a(l,!1)}}function x(){a(C,""),a(b,""),a(k,""),a(F,""),a(m,""),a(E,""),a(p,"")}function I(){x()}Le(()=>{const v=document.getElementById(D());if(v)return v.addEventListener("hidden.bs.offcanvas",I),()=>{v.removeEventListener("hidden.bs.offcanvas",I)}}),le(()=>ke(_()),()=>{a(u,_()!==null)}),le(()=>(ke(_()),M()),()=>{if(_()){a(C,_().key),a(b,_().name),a(k,_().description||"");const v=_().category||"",y=M();v&&y.includes(v)?(a(m,v),a(E,"")):v?(a(m,"__other__"),a(E,v)):(a(m,""),a(E,""))}}),le(()=>(e(m),e(E)),()=>{a(F,e(m)==="__other__"?e(E):e(m))}),Me(),qe();{let v=ze(()=>e(u)?"Edit Permission":"Create Permission");Ve(ve,{get title(){return e(v)},get id(){return D()},children:(y,pe)=>{var $=ft(),A=s($);{var X=t=>{var i=nt(),n=s(i,!0);r(i),q(()=>S(n,e(p))),c(t,i)};L(A,t=>{e(p)&&t(X)})}var Q=o(A,2),K=o(s(Q),2);ce(K);var fe=o(K,2);{var ue=t=>{var i=lt();c(t,i)};L(fe,t=>{e(u)&&t(ue)})}r(Q);var d=o(Q,2),P=o(s(d),2);ce(P),r(d);var j=o(d,2),Y=o(s(j),2);Ae(Y),r(j);var H=o(j,2),h=o(s(H),2);q(()=>{e(m),Qe(()=>{e(u),M()})});var O=s(h);O.value=O.__value="";var Z=o(O);xe(Z,1,M,$e,(t,i)=>{var n=dt(),G=s(n,!0);r(n);var T={};q(()=>{S(G,e(i)),T!==(T=e(i))&&(n.value=(n.__value=e(i))??"")}),c(t,n)});var ee=o(Z);ee.value=ee.__value="__other__",r(h);var te=o(h,2);{var ae=t=>{var i=ct();ce(i),V(i,()=>e(E),n=>a(E,n)),c(t,i)};L(te,t=>{e(m)==="__other__"&&!e(u)&&t(ae)})}var _e=o(te,2);{var be=t=>{var i=vt();c(t,i)},R=t=>{var i=mt();c(t,i)};L(_e,t=>{e(u)?t(be):t(R,!1)})}r(H);var N=o(H,2),B=s(N),re=s(B);{var se=t=>{var i=pt();c(t,i)};L(re,t=>{e(l)&&t(se)})}var oe=o(re);r(B);var ie=o(B,2);r(N),r($),q(()=>{K.disabled=e(u),h.disabled=e(u),B.disabled=e(l),S(oe,` ${e(u)?"Update":"Create"} Permission`),ie.disabled=e(l)}),V(K,()=>e(C),t=>a(C,t)),V(P,()=>e(b),t=>a(b,t)),V(Y,()=>e(k),t=>a(k,t)),Ge(h,()=>e(m),t=>a(m,t)),de("submit",$,g),c(y,$)},$$slots:{default:!0}})}je(),me()}var _t=f('<div class="alert alert-danger" role="alert"><i class="bi bi-exclamation-triangle me-2"></i> </div>'),bt=f('<div class="d-flex justify-content-center align-items-center py-5"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></div>'),gt=f('<div class="alert alert-info">No permissions found. Create your first permission to get started.</div>'),yt=f('<tr><td><strong> </strong></td><td><code> </code></td><td> </td><td><button type="button" class="btn btn-sm btn-outline-primary me-1" title="Edit"><i class="bi bi-pencil"></i></button> <button type="button" class="btn btn-sm btn-outline-danger" title="Delete"><i class="bi bi-trash"></i></button></td></tr>'),ht=f('<div class="card mb-3"><div class="card-header"><h5 class="mb-0 text-uppercase"> </h5></div> <div class="card-body"><div class="table-responsive"><table class="table table-hover mb-0"><thead><tr><th>Name</th><th>Key</th><th>Description</th><th style="width: 150px;">Actions</th></tr></thead><tbody></tbody></table></div></div></div>'),wt=f('<div class="container-fluid py-4"><div class="d-flex justify-content-between align-items-center mb-4"><h2>Permissions</h2> <button type="button" class="btn btn-primary"><i class="bi bi-plus-lg me-1"></i> Create Permission</button></div> <!> <div class="card mb-4"><div class="card-body"><input type="text" class="form-control" placeholder="Search permissions..."/></div></div> <!></div> <!>',1);function It(ve,U){Se(U,!1);const M=()=>J(Ze,"$permissionsByCategory",D),W=()=>J(tt,"$permissionsError",D),me=()=>J(at,"$loadingPermissions",D),u=()=>J(rt,"$permissions",D),[D,_]=Be(),z=w();let C=w(null),b=w("");Le(async()=>{await et()});function k(){a(C,null),m("permission-form-drawer")}function F(l){a(C,l),m("permission-form-drawer")}function m(l){const p=document.getElementById(l);if(p){const g=window.bootstrap;g?.Offcanvas&&new g.Offcanvas(p).show()}}async function E(l){if(confirm(`Are you sure you want to delete the permission "${l.name}"? This will remove it from all roles.`))try{await st(l.id)}catch(p){alert(`Failed to delete permission: ${p instanceof Error?p.message:"Unknown error"}`)}}le(()=>(M(),e(b)),()=>{a(z,Object.entries(M()).filter(([l,p])=>{if(!e(b))return!0;const g=e(b).toLowerCase();return l.toLowerCase().includes(g)||p.some(x=>x.name.toLowerCase().includes(g)||x.key.toLowerCase().includes(g)||x.description?.toLowerCase().includes(g))}))}),Me(),qe(),Je(ve,{pageTitle:"Manage Permissions",children:(l,p)=>{var g=wt(),x=he(g),I=s(x),v=o(s(I),2);r(I);var y=o(I,2);{var pe=d=>{var P=_t(),j=o(s(P));r(P),q(()=>S(j,` ${W()??""}`)),c(d,P)};L(y,d=>{W()&&d(pe)})}var $=o(y,2),A=s($),X=s(A);ce(X),r(A),r($);var Q=o($,2);{var K=d=>{var P=bt();c(d,P)},fe=d=>{var P=Oe(),j=he(P);{var Y=h=>{var O=gt();c(h,O)},H=h=>{var O=Oe(),Z=he(O);xe(Z,1,()=>e(z),$e,(ee,te)=>{var ae=He(()=>Re(e(te),2));let _e=()=>e(ae)[0],be=()=>e(ae)[1];var R=ht(),N=s(R),B=s(N),re=s(B,!0);r(B),r(N);var se=o(N,2),oe=s(se),ie=s(oe),t=o(s(ie));xe(t,5,be,$e,(i,n)=>{var G=yt(),T=s(G),Pe=s(T),Ue=s(Pe,!0);r(Pe),r(T);var ge=o(T),Ce=s(ge),Fe=s(Ce,!0);r(Ce),r(ge);var ye=o(ge),Ie=s(ye,!0);r(ye);var Ee=o(ye),De=s(Ee),Ke=o(De,2);r(Ee),r(G),q(()=>{S(Ue,(e(n),ne(()=>e(n).name))),S(Fe,(e(n),ne(()=>e(n).key))),S(Ie,(e(n),ne(()=>e(n).description||"-")))}),de("click",De,()=>F(e(n))),de("click",Ke,()=>E(e(n))),c(i,G)}),r(t),r(ie),r(oe),r(se),r(R),q(()=>S(re,_e())),c(ee,R)}),c(h,O)};L(j,h=>{u(),ne(()=>u().length===0)?h(Y):h(H,!1)},!0)}c(d,P)};L(Q,d=>{me()?d(K):d(fe,!1)})}r(x);var ue=o(x,2);ut(ue,{id:"permission-form-drawer",get permission(){return e(C)},onSave:()=>{a(C,null)}}),de("click",v,k),V(X,()=>e(b),d=>a(b,d)),c(l,g)},$$slots:{default:!0}}),je(),_()}export{It as component,Ft as universal};
