import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{w as de,g as Ue,d as ie,o as Re}from"../chunks/DNltCNNq.js";import{p as ge,aj as K,D as p,E as A,g as r,ak as xe,s as l,c as a,r as t,F as W,t as V,a as ue,f as le,w as Y,u as F,am as Ge,an as Ye}from"../chunks/CPcjNedw.js";import{f as $,a as _,t as We,c as _e}from"../chunks/BYls_3XS.js";import{b as Q,i as J,s as M,a as ke,p as Ee,e as Ce}from"../chunks/BafKDQNK.js";import{i as fe}from"../chunks/DPzVpBhB.js";import{P as Ke}from"../chunks/BVO3u3vQ.js";import{d as Ve,s as qe,r as Oe}from"../chunks/Ce_KR8LI.js";import{e as me,b as we,f as ze,g as He}from"../chunks/BMpSpro-.js";import{e as $e,i as Be}from"../chunks/B-ARnQOI.js";import{b as Qe,a as Xe}from"../chunks/DSiQ23iJ.js";import{b as Ze}from"../chunks/GyUl0P7I.js";import{p as er}from"../chunks/Bf83MOgU.js";const Te=de([]),De=de([]);let he=!1,ye=!1;async function rr(){if(he)return Ue(Te);he=!0;try{const{data:s,error:e}=await me.from("bom_reading_schedule").select("*").order("day_number",{ascending:!0});if(e)throw console.error("[API] Get BOM reading schedule failed:",e),new Error(`Failed to load reading schedule: ${e.message}`);const o=s||[];return Te.set(o),setTimeout(()=>he=!1,800),o}catch(s){throw he=!1,console.error("[API] Unexpected error fetching BOM reading schedule:",s),s}}async function Se(){if(ye)return Ue(De);ye=!0;try{const{data:s,error:e}=await me.from("bom_reading_entries").select("*").order("created_at",{ascending:!1});if(e)throw console.error("[API] Get BOM reading entries failed:",e),new Error(`Failed to load reading entries: ${e.message}`);const o=s||[];return De.set(o),setTimeout(()=>ye=!1,800),o}catch(s){throw ye=!1,console.error("[API] Unexpected error fetching BOM reading entries:",s),s}}async function ar(s){try{const{data:e,error:o}=await me.from("bom_reading_entries").insert([s]).select();if(o)throw console.error("[API] Create BOM reading entry failed:",o),o.message.includes("JWT")?new Error("Authentication error - please try reloading the page"):o.code==="42501"?new Error("Permission denied - please check your authentication"):o.code==="23505"?new Error("This entry already exists"):o.code==="23503"?new Error("Invalid chapter reference"):o.message.includes("fetch")||o.message.includes("Failed to fetch")?new Error("Network error - please check your connection and try again"):new Error(`Failed to save entry: ${o.message}`);return await Se(),console.log("[API] BOM reading entry created successfully"),e?e[0]:void 0}catch(e){throw console.error("[API] Unexpected error creating BOM reading entry:",e),e}}async function tr(s,e){try{const{data:o,error:w}=await me.from("bom_reading_entries").update(e).eq("id",s).select();if(w)throw console.error("[API] Update BOM reading entry failed:",w),new Error(`Failed to update entry: ${w.message}`);return await Se(),console.log("[API] BOM reading entry updated successfully"),o?o[0]:void 0}catch(o){throw console.error("[API] Unexpected error updating BOM reading entry:",o),o}}async function sr(s){try{const{error:e}=await me.from("bom_reading_entries").delete().eq("id",s);if(e)throw console.error("[API] Delete BOM reading entry failed:",e),new Error(`Failed to delete entry: ${e.message}`);await Se(),console.log("[API] BOM reading entry deleted successfully")}catch(e){throw console.error("[API] Unexpected error deleting BOM reading entry:",e),e}}function or(s){const e=new Map;return s.forEach(o=>{const w=e.get(o.chapter_ref)||0;e.set(o.chapter_ref,w+1)}),e}let ve=null;const nr=()=>{const s=de(!1),e=de(!1),o=de([]),w=de([]),R=ie(w,i=>or(i)),n=ie(o,i=>{const b=new Date().toISOString().split("T")[0];return i.find(c=>c.date===b)||null}),f=ie([o,R],([i,b])=>{const c=new Date().toISOString().split("T")[0];return i.map(h=>({chapter_ref:h.chapter_ref,day_number:h.day_number,date:h.date,book_name:h.book_name,chapter_number:h.chapter_number,read_count:b.get(h.chapter_ref)||0,is_today:h.date===c,is_past:h.date<c,is_future:h.date>c}))}),P=ie(o,i=>i.length),O=ie(R,i=>{let b=0;return i.forEach(c=>{c>0&&b++}),b}),S=ie([P,O],([i,b])=>i>0?Math.round(b/i*100):0),m=async()=>{e.set(!0);try{const[i,b]=await Promise.all([rr(),Se()]);o.set(i),w.set(b),s.set(!0)}catch(i){console.error("[State] Failed to reload BOM reading data:",i),s.set(!0)}finally{e.set(!1)}};return ve={stores:{ready:s,loading:e,schedule:o,entries:w,progressByChapter:R,todaysReading:n,chapterProgress:f,totalChapters:P,chaptersReadByAnyone:O,overallProgress:S},actions:{reload:m,apiCreate:async i=>{const b=await ar(i);return await m(),b},apiUpdate:async(i,b)=>{await tr(i,b),await m()},apiDelete:async i=>{await sr(i),await m()}}},ve},pe=()=>ve?.stores&&Object.keys(ve.stores).length>0?ve:nr();var ir=$(`<div class="card bom-reading-progress svelte-1yqd1va"><div class="card-header bg-primary text-white"><h4 class="mb-0"><i class="bi bi-graph-up me-2"></i> Ward Progress</h4></div> <div class="card-body"><div class="mb-4"><div class="d-flex justify-content-between align-items-center mb-2"><span class="fw-bold">Overall Completion</span> <span class="badge bg-primary fs-6"> </span></div> <div class="progress svelte-1yqd1va" style="height: 30px;"><div class="progress-bar bg-success progress-bar-striped progress-bar-animated svelte-1yqd1va" role="progressbar" aria-valuemin="0" aria-valuemax="100"><!></div></div> <small class="text-muted mt-1 d-block"> </small></div> <div class="row text-center g-3"><div class="col-6 col-md-3"><div class="stat-card p-3 border rounded svelte-1yqd1va"><i class="bi bi-calendar3 text-primary fs-2 d-block mb-2"></i> <div class="fs-4 fw-bold"> </div> <small class="text-muted">Total Days</small></div></div> <div class="col-6 col-md-3"><div class="stat-card p-3 border rounded svelte-1yqd1va"><i class="bi bi-book text-info fs-2 d-block mb-2"></i> <div class="fs-4 fw-bold"> </div> <small class="text-muted">BOM Chapters</small></div></div> <div class="col-6 col-md-3"><div class="stat-card p-3 border rounded svelte-1yqd1va"><i class="bi bi-check-circle text-success fs-2 d-block mb-2"></i> <div class="fs-4 fw-bold"> </div> <small class="text-muted">Chapters Read</small></div></div> <div class="col-6 col-md-3"><div class="stat-card p-3 border rounded svelte-1yqd1va"><i class="bi bi-people-fill text-warning fs-2 d-block mb-2"></i> <div class="fs-4 fw-bold"> </div> <small class="text-muted">Total Readings</small></div></div></div> <div class="alert alert-info mt-4 mb-0" role="alert"><i class="bi bi-info-circle me-2"></i> <small>This progress shows how many chapters have been read by <strong>anyone</strong> in the ward. Each
				person can mark chapters as read anonymously.</small></div></div></div>`);function dr(s,e){ge(e,!1);const o=()=>Q(i,"$entries",f),w=()=>Q(b,"$schedule",f),R=()=>Q(x,"$totalChapters",f),n=()=>Q(I,"$chaptersReadByAnyone",f),[f,P]=ke(),O=A(),S=A(),m=A(),g=A(),{stores:{totalChapters:x,chaptersReadByAnyone:I,entries:i,schedule:b}}=pe();K(()=>o(),()=>{p(O,o().length)}),K(()=>w(),()=>{p(S,w().filter(j=>j.book_name!=="Review").length)}),K(()=>(w(),o()),()=>{p(m,w().filter(j=>j.book_name!=="Review").filter(j=>o().some(ae=>ae.chapter_ref===j.chapter_ref)).length)}),K(()=>(r(S),r(m)),()=>{p(g,r(S)>0?Math.round(r(m)/r(S)*100):0)}),xe(),fe();var c=ir(),h=l(a(c),2),k=a(h),T=a(k),U=l(a(T),2),q=a(U);t(U),t(T);var D=l(T,2),C=a(D),N=a(C);{var Z=j=>{var ae=We();V(()=>M(ae,`${r(g)??""}%`)),_(j,ae)};J(N,j=>{r(g)>10&&j(Z)})}t(C),t(D);var v=l(D,2),y=a(v);t(v),t(k);var L=l(k,2),B=a(L),d=a(B),u=l(a(d),2),E=a(u,!0);t(u),W(2),t(d),t(B);var G=l(B,2),be=a(G),z=l(a(be),2),ee=a(z,!0);t(z),W(2),t(be),t(G);var re=l(G,2),te=a(re),X=l(a(te),2),H=a(X,!0);t(X),W(2),t(te),t(re);var se=l(re,2),oe=a(se),ne=l(a(oe),2),ce=a(ne,!0);t(ne),W(2),t(oe),t(se),t(L),W(2),t(h),t(c),V(()=>{M(q,`${r(g)??""}%`),Ve(C,`width: ${r(g)??""}%`),qe(C,"aria-valuenow",r(g)),M(y,`${r(m)??""} of ${r(S)??""} chapters read by at least one person`),M(E,R()),M(ee,r(S)),M(H,n()),M(ce,r(O))}),_(s,c),ue(),P()}const Ie="bom_reading_submissions",Pe="bom_reading_entry_ids";function Me(){if(typeof localStorage>"u")return new Set;try{const s=localStorage.getItem(Ie);if(!s)return new Set;const e=JSON.parse(s);return new Set(Array.isArray(e)?e:[])}catch(s){return console.error("[ReadingTracker] Error reading from localStorage:",s),new Set}}function lr(s){return Me().has(s)}function cr(s){if(typeof localStorage>"u"){console.warn("[ReadingTracker] localStorage not available");return}try{const e=Me();e.add(s),localStorage.setItem(Ie,JSON.stringify([...e]))}catch(e){console.error("[ReadingTracker] Error writing to localStorage:",e)}}function Ae(){if(typeof localStorage>"u")return{};try{const s=localStorage.getItem(Pe);if(!s)return{};const e=JSON.parse(s);return typeof e=="object"&&e!==null?e:{}}catch(s){return console.error("[ReadingTracker] Error reading entry IDs from localStorage:",s),{}}}function vr(s){return Ae()[s]??null}function gr(s,e){if(typeof localStorage>"u"){console.warn("[ReadingTracker] localStorage not available");return}try{const o=Ae();o[s]=e,localStorage.setItem(Pe,JSON.stringify(o))}catch(o){console.error("[ReadingTracker] Error storing entry ID:",o)}}function ur(s){if(typeof localStorage>"u"){console.warn("[ReadingTracker] localStorage not available");return}try{const e=Me();e.delete(s),localStorage.setItem(Ie,JSON.stringify([...e]));const o=Ae();delete o[s],localStorage.setItem(Pe,JSON.stringify(o))}catch(e){console.error("[ReadingTracker] Error writing to localStorage:",e)}}var fr=$('<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span> Updating...',1),mr=$('<i class="bi bi-check-circle-fill me-1"></i> Already Marked',1),pr=$('<i class="bi bi-check-circle me-1"></i> Mark as Read',1),br=$('<button class="btn btn-sm btn-link text-danger p-0 svelte-18cjesl" type="button" title="Undo marking this chapter as read"><i class="bi bi-arrow-counterclockwise me-1"></i> Undo</button>'),hr=$('<div class="alert alert-danger alert-sm mt-2 mb-0 svelte-18cjesl" role="alert"><i class="bi bi-exclamation-triangle-fill me-1"></i> </div>'),yr=$('<div class="bom-reading-entry-form svelte-18cjesl"><div class="d-flex align-items-center gap-2 gap-md-3"><button type="button"><!></button> <!></div> <!></div>');function _r(s,e){ge(e,!1);const o=()=>Q(P,"$loading",w),[w,R]=ke();let n=Ee(e,"chapterRef",8),f=Ee(e,"onSuccess",8,void 0);const{stores:{loading:P},actions:{apiCreate:O,apiDelete:S}}=pe();let m=A(!1),g=A(""),x=A(!1),I=A(null);Re(()=>{p(x,lr(n()))});async function i(){if(r(x)){p(g,"You have already marked this chapter as read");return}try{p(m,!0),p(g,"");const v={date:new Date().toISOString().split("T")[0],chapter_ref:n()},y=await O(v);y&&y.id&&(cr(n()),gr(n(),y.id),p(x,!0),f()&&f()())}catch(v){p(g,v instanceof Error?v.message:"Failed to save reading"),console.error("[BomReadingEntryForm] Error:",v)}finally{p(m,!1)}}async function b(){const v=vr(n());if(!v){p(g,"Cannot undo - entry ID not found");return}try{p(m,!0),p(g,""),await S(v),ur(n()),p(x,!1),f()&&f()()}catch(y){p(g,y instanceof Error?y.message:"Failed to undo"),console.error("[BomReadingEntryForm] Undo error:",y)}finally{p(m,!1)}}K(()=>(r(g),r(I)),()=>{r(g)&&(r(I)&&clearTimeout(r(I)),p(I,setTimeout(()=>{p(g,""),p(I,null)},1e3)))}),xe(),fe();var c=yr(),h=a(c),k=a(h),T=a(k);{var U=v=>{var y=fr();W(),_(v,y)},q=v=>{var y=_e(),L=le(y);{var B=u=>{var E=mr();W(),_(u,E)},d=u=>{var E=pr();W(),_(u,E)};J(L,u=>{r(x)?u(B):u(d,!1)},!0)}_(v,y)};J(T,v=>{r(m)?v(U):v(q,!1)})}t(k);var D=l(k,2);{var C=v=>{var y=br();V(()=>y.disabled=r(m)),Ce("click",y,b),_(v,y)};J(D,v=>{r(x)&&v(C)})}t(h);var N=l(h,2);{var Z=v=>{var y=hr(),L=l(a(y));t(y),V(()=>M(L,` ${r(g)??""}`)),_(v,y)};J(N,v=>{r(g)&&v(Z)})}t(c),V(()=>{we(k,1,`btn btn-sm ${r(x)?"btn-secondary":"btn-primary"}`,"svelte-18cjesl"),k.disabled=r(m)||o()||r(x)}),Ce("click",k,i),_(s,c),ue(),R()}var wr=$('<span class="badge bg-info text-dark svelte-x251hv"><i class="bi bi-calendar-day"></i> Today</span>'),xr=$('<i class="bi bi-check-circle"></i> ',1),kr=$('<i class="bi bi-circle"></i> 0',1),Sr=$('<div><div class="card-body p-2"><div class="d-flex align-items-center justify-content-between gap-2 flex-wrap"><div class="flex-grow-1"><div class="d-flex align-items-baseline gap-2 flex-wrap"><small class="text-muted"> </small> <span> </span> <!></div> <div class="d-flex align-items-center gap-2 mt-1"><small class="text-muted"> </small></div></div> <div class="d-flex align-items-center gap-2"><span><!></span> <!></div></div></div></div>');function Fe(s,e){ge(e,!1);const o=A(),w=A(),R=A();let n=Ee(e,"progress",8);const f=!1,{actions:{reload:P}}=pe();K(()=>Y(n()),()=>{p(o,ze(er(n().date,"yyyy-MM-dd",new Date),"MMM d, yyyy (EEE)"))}),K(()=>Y(n()),()=>{p(w,n().is_today?"border-primary border-2":n().is_past?"past-reading":"")}),K(()=>Y(n()),()=>{p(R,n().read_count>0?"bg-success":"bg-secondary")}),xe();var O={compact:f};fe();var S=Sr(),m=a(S),g=a(m),x=a(g),I=a(x),i=a(I),b=a(i);t(i);var c=l(i,2),h=a(c,!0);t(c);var k=l(c,2);{var T=B=>{var d=wr();_(B,d)};J(k,B=>{Y(n()),F(()=>n().is_today)&&B(T)})}t(I);var U=l(I,2),q=a(U),D=a(q,!0);t(q),t(U),t(x);var C=l(x,2),N=a(C),Z=a(N);{var v=B=>{var d=xr(),u=l(le(d));V(()=>M(u,` ${Y(n()),F(()=>n().read_count)??""}`)),_(B,d)},y=B=>{var d=kr();W(),_(B,d)};J(Z,B=>{Y(n()),F(()=>n().read_count>0)?B(v):B(y,!1)})}t(N);var L=l(N,2);return _r(L,{get chapterRef(){return Y(n()),F(()=>n().chapter_ref)},onSuccess:()=>P()}),t(C),t(g),t(m),t(S),V(()=>{we(S,1,`card bom-day-card ${r(w)??""} mb-2`,"svelte-x251hv"),M(b,`Day ${Y(n()),F(()=>n().day_number)??""}`),we(c,1,`fw-semibold ${Y(n()),F(()=>n().is_today?"text-primary":"")??""}`,"svelte-x251hv"),M(h,(Y(n()),F(()=>n().chapter_ref))),M(D,r(o)),we(N,1,`badge ${r(R)??""}`,"svelte-x251hv")}),_(s,S),Ze(e,"compact",f),ue(O)}var $r=$('<div class="alert alert-warning" role="alert"><i class="bi bi-exclamation-triangle me-2"></i> No readings found for the selected filter.</div>'),Br=$('<div class="book-group mb-4 svelte-nbte28"><h4 class="border-bottom pb-2 mb-3 svelte-nbte28"><i class="bi bi-book me-2"></i> <span class="badge bg-secondary ms-2"> </span></h4> <!></div>'),Er=$("<div><!></div>"),Rr=$('<div class="text-center mt-4"><p class="text-muted"><i class="bi bi-info-circle me-1"></i> </p></div>'),Ir=$('<div class="bom-reading-schedule svelte-nbte28"><div class="card mb-3"><div class="card-body"><div class="row g-3 align-items-end"><div class="col-md-8"><label for="search" class="form-label fw-bold">Search</label> <div class="input-group"><span class="input-group-text"><i class="bi bi-search"></i></span> <input type="text" class="form-control" id="search" placeholder="Search chapters or books..."/></div></div> <div class="col-md-4"><div class="form-check"><input class="form-check-input" type="checkbox" id="groupByBook"/> <label class="form-check-label" for="groupByBook">Group by Book</label></div></div></div></div></div> <div class="reading-list svelte-nbte28"><!></div> <!></div>');function Pr(s,e){ge(e,!1);const o=()=>Q(O,"$chapterProgress",R),w=()=>Q(S,"$todaysReading",R),[R,n]=ke(),f=A(),P=A(),{stores:{chapterProgress:O,todaysReading:S}}=pe();let m=A(""),g=A(!1);function x(d,u){if(!u)return d;const E=u.toLowerCase();return d.filter(G=>G.chapter_ref.toLowerCase().includes(E)||G.book_name.toLowerCase().includes(E))}function I(d){const u={};return d.forEach(E=>{u[E.book_name]||(u[E.book_name]=[]),u[E.book_name].push(E)}),u}Re(()=>{w()&&setTimeout(()=>{const d=document.getElementById("today-reading");d&&d.scrollIntoView({behavior:"smooth",block:"center"})},500)}),K(()=>(o(),r(m)),()=>{p(f,x(o(),r(m)))}),K(()=>(r(g),r(f)),()=>{p(P,r(g)?I(r(f)):null)}),xe(),fe();var i=Ir(),b=a(i),c=a(b),h=a(c),k=a(h),T=l(a(k),2),U=l(a(T),2);Oe(U),t(T),t(k);var q=l(k,2),D=a(q),C=a(D);Oe(C),W(2),t(D),t(q),t(h),t(c),t(b);var N=l(b,2),Z=a(N);{var v=d=>{var u=$r();_(d,u)},y=d=>{var u=_e(),E=le(u);{var G=z=>{var ee=_e(),re=le(ee);$e(re,1,()=>(r(P),F(()=>Object.entries(r(P)))),Be,(te,X)=>{var H=Ge(()=>Ye(r(X),2));let se=()=>r(H)[0],oe=()=>r(H)[1];var ne=Br(),ce=a(ne),j=l(a(ce)),ae=l(j),Ne=a(ae);t(ae),t(ce);var je=l(ce,2);$e(je,1,oe,Be,(Je,Le)=>{Fe(Je,{get progress(){return r(Le)},compact:!0})}),t(ne),V(()=>{M(j,` ${se()??""} `),M(Ne,`${oe(),F(()=>oe().length)??""} days`)}),_(te,ne)}),_(z,ee)},be=z=>{var ee=_e(),re=le(ee);$e(re,1,()=>r(f),Be,(te,X)=>{var H=Er(),se=a(H);Fe(se,{get progress(){return r(X)}}),t(H),V(()=>qe(H,"id",(r(X),F(()=>r(X).is_today?"today-reading":void 0)))),_(te,H)}),_(z,ee)};J(E,z=>{r(P)?z(G):z(be,!1)},!0)}_(d,u)};J(Z,d=>{r(f),F(()=>r(f).length===0)?d(v):d(y,!1)})}t(N);var L=l(N,2);{var B=d=>{var u=Rr(),E=a(u),G=l(a(E));t(E),t(u),V(()=>M(G,` Showing ${r(f),F(()=>r(f).length)??""} reading days`)),_(d,u)};J(L,d=>{r(f),F(()=>r(f).length>20)&&d(B)})}t(i),Qe(U,()=>r(m),d=>p(m,d)),Xe(C,()=>r(g),d=>p(g,d)),_(s,i),ue(),n()}var Mr=$('<div class="text-center py-5"><div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"><span class="visually-hidden">Loading...</span></div> <p class="text-muted mt-3">Loading reading schedule...</p></div>'),Ar=$('<div class="row mb-4"><div class="col-12"><!></div></div> <div class="row"><div class="col-12"><!></div></div>',1),Cr=$(`<div class="container py-4 svelte-q48pc2"><div class="row mb-4"><div class="col-12"><h2 class="display-6 svelte-q48pc2"><i class="bi bi-book me-2"></i> Ward Reading Progress</h2> <p class="lead">Join our ward in reading the Book of Mormon in 2026. Mark the chapters you've read and see
					how our ward is progressing together!</p> <p class="text-muted"><i class="bi bi-info-circle me-1"></i> This tracker is completely anonymous - your readings are counted toward the ward total without
					identifying who read what.</p></div></div> <!></div>`);function Vr(s,e){ge(e,!1);const o=()=>Q(O,"$loading",R),w=()=>Q(P,"$ready",R),[R,n]=ke(),{stores:{pageName:f}}=He(),{stores:{ready:P,loading:O},actions:{reload:S}}=pe();f.set("Book of Mormon Reading 2026"),Re(async()=>{await S()}),fe(),Ke(s,{pageTitle:"Book of Mormon Reading Challenge 2026",children:(m,g)=>{var x=Cr(),I=l(a(x),2);{var i=c=>{var h=Mr();_(c,h)},b=c=>{var h=Ar(),k=le(h),T=a(k),U=a(T);dr(U,{}),t(T),t(k);var q=l(k,2),D=a(q),C=a(D);Pr(C,{}),t(D),t(q),_(c,h)};J(I,c=>{o()&&!w()?c(i):c(b,!1)})}t(x),_(m,x)},$$slots:{default:!0}}),ue(),n()}export{Vr as component};
