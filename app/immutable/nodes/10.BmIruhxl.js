import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{p as ae,c as s,s as i,r as a,a as se,f as Q,t as j,aa as Se,ay as X,az as ia,g as t,U as u,a8 as o,u as v,I as dt,aB as da,E as J,aC as va}from"../chunks/D6GkHfO-.js";import{f as d,a as n,c as Zt,t as Me}from"../chunks/D8wZRsgK.js";import{P as ca}from"../chunks/BhSu20_V.js";import{d as De,s as Pe,A as ua,E as fa}from"../chunks/BgPbR6u9.js";import{d as $e,o as ma,g as _a}from"../chunks/B8gJkoMb.js";import{i as g,e as C,s as q}from"../chunks/DYmw-k_K.js";import{e as St}from"../chunks/COMoFu8N.js";import{s as Gt}from"../chunks/BzM8VPE5.js";import{g as pa,p as H,f as S,P as te,k as ba,c as ee}from"../chunks/vFKQls-f.js";import{i as re}from"../chunks/XlJfi8GN.js";import{p as vt,s as ga,a as gt}from"../chunks/C8uFvBRH.js";import{c as ya,g as ha,A as ka,e as Ct,d as Ea,E as xa}from"../chunks/B7fABcZ1.js";import{S as wa}from"../chunks/CCPPWneG.js";import{v as Ma,D as Da}from"../chunks/-fuaGe5u.js";import{s as At}from"../chunks/CCU9tsZe.js";function Pa(F,p){return ya(F,-p)}const $a=!0,bs=Object.freeze(Object.defineProperty({__proto__:null,prerender:$a},Symbol.toStringTag,{value:"Module"}));var Sa=d('<p class="mb-0">No past events to delete.</p>'),Ca=d('<p class="mb-2"><strong> </strong></p>'),Aa=d(`<div class="alert alert-warning mb-0" role="alert"><p class="mb-2"><strong> </strong></p> <p class="mb-0 small">These recurring events have active future instances and cannot be deleted until all
								future occurrences have passed.</p></div>`),Ia=d("<!> <!>",1),Oa=d('<div class="modal svelte-1u875uh" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-primary text-white"><h5 class="modal-title">Delete Past Events - Results</h5> <button type="button" class="btn-close btn-close-white" aria-label="Close"></button></div> <div class="modal-body"><!></div> <div class="modal-footer"><button type="button" class="btn btn-primary">OK</button></div></div></div></div>');function Ta(F,p){ae(p,!1);let A=vt(p,"deleted",8),f=vt(p,"skipped",8),I=vt(p,"callback",8);function M(){I()()}re();var D=Oa(),P=s(D),Y=s(P),O=s(Y),Z=i(s(O),2);a(O);var c=i(O,2),G=s(c);{var m=T=>{var at=Sa();n(T,at)},tt=T=>{var at=Ia(),yt=Q(at);{var It=B=>{var E=Ca(),K=s(E),R=s(K);a(K),a(E),j(()=>q(R,`✓ Deleted ${A()??""} past event${A()===1?"":"s"}.`)),n(B,E)};g(yt,B=>{A()>0&&B(It)})}var Ot=i(yt,2);{var ht=B=>{var E=Aa(),K=s(E),R=s(K),kt=s(R);a(R),a(K),Se(2),a(E),j(()=>q(kt,`⚠ Skipped ${f()??""} recurring event${f()===1?"":"s"}`)),n(B,E)};g(Ot,B=>{f()>0&&B(ht)})}n(T,at)};g(G,T=>{A()===0&&f()===0?T(m):T(tt,!1)})}a(c);var U=i(c,2),et=s(U);a(U),a(Y),a(P),a(D),C("click",Z,M),C("click",et,M),n(F,D),se()}var Ra=d(`<div class="modal svelte-dmsnaa" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-danger text-white"><h5 class="modal-title">Delete Past Events</h5> <button type="button" class="btn-close btn-close-white" aria-label="Close"></button></div> <div class="modal-body"><p class="mb-3"><strong> </strong></p> <p class="mb-0 text-muted small">This action cannot be undone. Recurring events with future instances will be skipped
					automatically.</p></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-danger">Delete</button></div></div></div></div>`);function Wa(F,p){ae(p,!1);let A=vt(p,"cutoffDate",8),f=vt(p,"callback",8);function I(){f()(!0)}function M(){f()(!1)}re();var D=Ra(),P=s(D),Y=s(P),O=s(Y),Z=i(s(O),2);a(O);var c=i(O,2),G=s(c),m=s(G),tt=s(m);a(m),a(G),Se(2),a(c);var U=i(c,2),et=s(U),T=i(et,2);a(U),a(Y),a(P),a(D),j(()=>q(tt,`Are you sure you want to delete all events that occurred before ${A()??""}?`)),C("click",Z,M),C("click",et,M),C("click",T,I),n(F,D),se()}var Na=d('<button class="btn btn-sm btn-outline-danger" type="button"><!></button>'),La=d('<div class="event-actions svelte-1ofdc1q"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit past event"><i class="bi bi-pencil-square"></i></button></div>'),ja=d('<div class="daily-event-row svelte-1ofdc1q"><div class="event-content svelte-1ofdc1q"><!></div> <!></div>'),qa=d('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-1ofdc1q"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),Fa=d('<li class="list-group-item py-3 text-muted">No events scheduled this week.</li>'),Ua=d('<li class="list-group-item list-group-item-light text-uppercase small fw-lighter p-0"><button><span class="d-flex align-items-center gap-2"><i></i> <span class="text-muted"> </span></span> <span> </span></button></li> <!>',1),Ba=d('<li class="list-group-item bg-secondary text-white fw-semibold"> </li> <!>',1),Ka=d('<button class="btn btn-outline-secondary btn-sm">Reset</button>'),Ha=d('<div class="d-flex gap-2"><button class="btn btn-primary btn-sm">More</button> <button class="btn btn-outline-primary btn-sm">All</button></div>'),za=d('<div class="card-footer d-flex align-items-center justify-content-between"><small> </small> <!></div>'),Va=d('<ul class="list-group list-group-flush border-top-0"></ul> <!>',1),Xa=d('<div class="card-body text-muted small">No past events available.</div>'),Ja=d('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center gap-3 flex-wrap fw-lighter d-flex justify-content-end"><span>Past Events</span> <!></div></div> <!></div>'),Qa=d('<div class="d-flex flex-column gap-4"><!></div>'),Ya=d("<!> <!> <!> <!>",1);function Za(F,p){ae(p,!1);const A=()=>gt(Ot,"$weeksExpanded",P),f=()=>gt(Oe,"$allPastEvents",P),I=()=>gt(T,"$currentUserHasPermission",P),M=()=>gt(ve,"$userIsRoot",P),D=()=>gt(yt,"$ready",P),[P,Y]=ga(),O=u(),Z=u(),c=u(),G=u(),m=u(),tt=u(),U=u(),et=u(),{stores:{currentUserHasPermission:T,currentUser:at}}=pa(),{stores:{ready:yt,dbData:It,weeksExpanded:Ot},actions:{reload:ht}}=ha(),B={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0};let E=vt(p,"formId",24,Ma),K=u(!1),R=u(!1),kt=u(""),ne=u({...B}),Tt=u(!1),le=u(""),Rt=u(!1),ct=u({deleted:0,skipped:0});const oe=4,Ce=4;let st=u(oe),Et=u(!1);const ie=At();let rt=u({});function de(e){return t(O).includes(e)}function Ae(e){const l=t(rt)[e]??de(e);o(rt,{...t(rt),[e]:!l})}const Ie=e=>{o(kt,"Event Item"),o(ne,{...e,category:e?.meta_data?.category})},Oe=$e(It,e=>{const l=At();return(e??[]).filter(r=>!(r.event_type!=="calendar_event"||!r.start_time||H(r.start_time)>=l||r.recurrence_rule&&(!r.recurrence_end_date||r.recurrence_end_date&&H(r.recurrence_end_date)>=l)))}),ve=$e(at,e=>e.roles?.includes("system-root")??!1);function Te(){o(st,t(st)+Ce)}function Re(){o(st,520),o(Et,!0)}function We(){o(st,oe),o(Et,!1)}const Ne=()=>{if(!t(K)||t(R)||!_a(ve)||!t(U))return;const e=At();o(le,S(e,"MMM d, yyyy")),o(Tt,!0)};async function Le(e){if(o(Tt,!1),!e)return;const l=At();o(R,!0);try{const r=await Ea(l);await ht(),o(ct,r),o(Rt,!0)}catch(r){console.error("Failed to delete past events",r),alert("Failed to delete past events. Please try again.")}finally{o(R,!1)}}function je(){o(Rt,!1)}ma(async()=>{o(K,I()(te.CreateEvents)||I()(te.EditOwnOrgEvents)||I()(te.EditAllEvents)),await ht()}),X(()=>(f(),t(st)),()=>{o(c,(f()??[]).filter(e=>{if(!e.start_time)return!1;const l=H(e.start_time),r=Pa(ie,t(st));return l>=r&&l<ie}))}),X(()=>(t(c),S),()=>{o(m,(()=>{const e=new Map;for(const l of t(c)){if(!l.start_time)continue;const r=H(l.start_time),y=ba(r,{weekStartsOn:1}),x=Ct(r,{weekStartsOn:1}),b=S(y,"yyyy-MM-dd"),w=`${S(y,"MMM d")} – ${S(x,"MMM d")}`;let k=e.get(b);k||(k={key:b,label:w,days:new Map},e.set(b,k));const z=S(r,"yyyy-MM-dd");let nt=k.days.get(z);nt||(nt={key:z,displayDay:S(r,"EEE"),displayDate:S(r,"MMM d"),events:[]},k.days.set(z,nt)),nt.events.push(l)}return Array.from(e.values()).sort((l,r)=>l.key<r.key?1:-1).map(l=>({key:l.key,label:l.label,days:Array.from(l.days.values()).sort((r,y)=>r.key<y.key?1:-1).map(r=>({...r,events:r.events.slice().sort((y,x)=>{const b=y.is_all_day?0:1,w=x.is_all_day?0:1;if(b!==w)return b-w;const k=y.start_time?H(y.start_time).getTime():Number.MAX_SAFE_INTEGER,z=x.start_time?H(x.start_time).getTime():Number.MAX_SAFE_INTEGER;return k-z})}))}))})())}),X(()=>t(m),()=>{o(O,(()=>{if(t(m).length===0)return[];const e=[];return t(m)[0]&&e.push(t(m)[0].key),t(m)[1]&&e.push(t(m)[1].key),e})())}),X(()=>(A(),t(rt)),()=>{o(Z,e=>A()?!0:t(rt)[e]!==void 0?t(rt)[e]:de(e))}),X(()=>t(c),()=>{o(G,t(c).length)}),X(()=>(t(m),S),()=>{o(tt,t(m).reduce((e,l)=>{const r=H(l.key),y=Ct(r,{weekStartsOn:1}),x=S(y,"yyyy-MM"),b=S(y,"MMMM yyyy");return e[x]||(e[x]={label:b,weeks:[]}),e[x].weeks.push(l),e},{}))}),X(()=>t(c),()=>{o(U,t(c).length>0)}),X(()=>(f(),t(c)),()=>{o(et,f().length>t(c).length)}),ia(),re();var ce=Ya(),ue=Q(ce);Da(ue,{get title(){return t(kt)},get id(){return E()},children:(e,l)=>{ka(e,{get eventItem(){return t(ne)},get drawerId(){return E()},name:"past-event-item-form"})},$$slots:{default:!0}});var fe=i(ue,2);{var qe=e=>{var l=Zt(),r=Q(l);{var y=b=>{var w=Ja(),k=s(w),z=s(k),nt=i(s(z),2);{var Ke=W=>{var N=Na(),ut=s(N);{var Wt=h=>{var $=Me("Deleting…");n(h,$)},Nt=h=>{var $=Me();j(()=>q($,`Delete Past Events (${t(G)??""})`)),n(h,$)};g(ut,h=>{t(R)?h(Wt):h(Nt,!1)})}a(N),j(()=>N.disabled=t(R)),C("click",N,Ne),n(W,N)};g(nt,W=>{M()&&t(U)&&W(Ke)})}a(z),a(k);var He=i(k,2);{var ze=W=>{var N=Va(),ut=Q(N);St(ut,5,()=>(t(tt),v(()=>Object.entries(t(tt)))),([h,$])=>h,(h,$)=>{var ft=da(()=>va(t($),2));let lt=()=>t(ft)[1];var xt=Ba(),mt=Q(xt),Lt=s(mt,!0);a(mt);var V=i(mt,2);St(V,1,()=>(lt(),v(()=>lt().weeks)),L=>L.key,(L,_)=>{const wt=dt(()=>(J(H),t(_),v(()=>H(t(_).key)))),Mt=dt(()=>(J(Ct),J(t(wt)),v(()=>Ct(t(wt),{weekStartsOn:1})))),_e=dt(()=>(J(Pe),J(t(Mt)),v(()=>Pe(t(Mt))))),Xe=dt(()=>(J(De),J(t(Mt)),J(t(_e)),v(()=>De(t(Mt),t(_e),{weekStartsOn:1})+1))),jt=dt(()=>(t(Z),t(_),v(()=>t(Z)(t(_).key)))),Dt=dt(()=>(t(_),v(()=>t(_).days.reduce((pt,Pt)=>pt+Pt.events.length,0))));var pe=Ua(),qt=Q(pe),_t=s(qt);let be;var Ft=s(_t),ge=s(Ft),ye=i(ge,2),Je=s(ye);a(ye),a(Ft);var Ut=i(Ft,2);let he;var Qe=s(Ut,!0);a(Ut),a(_t),a(qt);var Ye=i(qt,2);{var Ze=pt=>{var Pt=Zt(),Ge=Q(Pt);{var ta=ot=>{var $t=Zt(),aa=Q($t);St(aa,1,()=>(t(_),v(()=>t(_).days)),Bt=>Bt.key,(Bt,it)=>{var Kt=qa(),ke=s(Kt),Ht=s(ke),zt=s(Ht),sa=s(zt,!0);a(zt);var Ee=i(zt,2),ra=s(Ee,!0);a(Ee),a(Ht);var xe=i(Ht,2);St(xe,5,()=>(t(it),v(()=>t(it).events)),bt=>bt.id??`${bt.start_time}-${bt.meta_data?.recurring_instance_index??0}`,(bt,we)=>{var Vt=ja(),Xt=s(Vt),na=s(Xt);xa(na,{get item(){return t(we)},showDate:!1}),a(Xt);var la=i(Xt,2);{var oa=Jt=>{var Qt=La(),Yt=s(Qt);a(Qt),j(()=>{Gt(Yt,"data-bs-target",`#${E()??""}`),Gt(Yt,"aria-controls",E())}),C("click",Yt,()=>Ie(t(we))),n(Jt,Qt)};g(la,Jt=>{t(K)&&Jt(oa)})}a(Vt),n(bt,Vt)}),a(xe),a(ke),a(Kt),j(()=>{q(sa,(t(it),v(()=>t(it).displayDay))),q(ra,(t(it),v(()=>t(it).displayDate)))}),n(Bt,Kt)}),n(ot,$t)},ea=ot=>{var $t=Fa();n(ot,$t)};g(Ge,ot=>{t(_),v(()=>t(_).days.length)?ot(ta):ot(ea,!1)})}n(pt,Pt)};g(Ye,pt=>{t(jt)&&pt(Ze)})}j(()=>{be=ee(_t,1,"week-header w-100 d-flex justify-content-between align-items-center border-0 bg-transparent p-2 text-start svelte-1ofdc1q",null,be,{"text-muted":t(Dt)===0}),Gt(_t,"title",t(jt)?"Click to collapse week":"Click to expand week"),ee(ge,1,`bi ${t(jt)?"bi-chevron-up":"bi-chevron-down"}`),q(Je,`Week ${t(Xe)??""} [${t(Dt)??""} Event${t(Dt)===1?"":"s"}]`),he=ee(Ut,1,"",null,he,{"opacity-50":t(Dt)===0}),q(Qe,(t(_),v(()=>t(_).label)))}),C("click",_t,()=>Ae(t(_).key)),n(L,pe)}),j(()=>q(Lt,(lt(),v(()=>lt().label)))),n(h,xt)}),a(ut);var Wt=i(ut,2);{var Nt=h=>{var $=za(),ft=s($),lt=s(ft);a(ft);var xt=i(ft,2);{var mt=V=>{var L=Ka();C("click",L,We),n(V,L)},Lt=V=>{var L=Ha(),_=s(L),wt=i(_,2);a(L),C("click",_,Te),C("click",wt,Re),n(V,L)};g(xt,V=>{t(Et)?V(mt):V(Lt,!1)})}a($),j(()=>q(lt,`Showing ${t(c),v(()=>t(c)?.length??0)??""} of ${f(),v(()=>f()?.length??0)??""}`)),n(h,$)};g(Wt,h=>{(t(et)||t(Et))&&h(Nt)})}n(W,N)},Ve=W=>{var N=Xa();n(W,N)};g(He,W=>{t(m),v(()=>t(m).length)?W(ze):W(Ve,!1)})}a(w),n(b,w)},x=b=>{var w=Qa(),k=s(w);wa(k,{}),a(w),n(b,w)};g(r,b=>{D()?b(y):b(x,!1)})}n(e,l)};g(fe,e=>{M()&&e(qe)})}var me=i(fe,2);{var Fe=e=>{Wa(e,{get cutoffDate(){return t(le)},callback:Le})};g(me,e=>{t(Tt)&&e(Fe)})}var Ue=i(me,2);{var Be=e=>{Ta(e,{get deleted(){return t(ct),v(()=>t(ct).deleted)},get skipped(){return t(ct),v(()=>t(ct).skipped)},callback:je})};g(Ue,e=>{t(Rt)&&e(Be)})}n(F,ce),se(),Y()}var Ga=d('<div class="d-flex flex-column gap-4"><!> <!> <!></div>');function gs(F){ca(F,{pageTitle:"Announcements & Events",children:(p,A)=>{var f=Ga(),I=s(f);ua(I,{});var M=i(I,2);fa(M,{});var D=i(M,2);Za(D,{}),a(f),n(p,f)},$$slots:{default:!0}})}export{gs as component,bs as universal};
