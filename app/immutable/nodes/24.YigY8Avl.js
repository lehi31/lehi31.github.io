import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{P as he}from"../chunks/BhSu20_V.js";import{p as me,ay as we,az as De,s as b,a as fe,c as n,a8 as te,U as re,g as e,r as s,f as K,u as d,t as k,aa as Ee,E as Q,i as ae,aF as se,I as Ae}from"../chunks/D6GkHfO-.js";import{i as _e}from"../chunks/XlJfi8GN.js";import{p as G,s as xe,a as oe}from"../chunks/C8uFvBRH.js";import{i as z,e as ne,s as U}from"../chunks/DYmw-k_K.js";import{f as B,a as g,c as Me}from"../chunks/D8wZRsgK.js";import{e as le,i as de}from"../chunks/COMoFu8N.js";import{e as ie,b as be,c as ce,h as ue,f as h,g as Oe}from"../chunks/vFKQls-f.js";import{b as Re}from"../chunks/BzM8VPE5.js";import{R as V}from"../chunks/DLGhLBXI.js";import{w as Te}from"../chunks/B8gJkoMb.js";const $e=!0,Ne=$e;function ve(a,r){const l=ie(a),o=ie(r);return+l==+o}const Ce=!0,ct=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ce},Symbol.toStringTag,{value:"Module"})),Ie={SacramentBreadAssignments:"Sacrament Bread Assignments"},Ue=["Folau Kaveinga","Tipi Kofe","Clenn Leituala","Vili Mapu","Keanu Naluai","Manase Soifua","Alex Tauteoli","Tray Teriipaia","Manoa Tuifua"],Be=[{date:new Date(2026,3,5),event:"General Conference"},{date:new Date(2026,9,4),event:"General Conference"}],Le={Sundays:({start_date:a,until:r})=>new V({freq:V.WEEKLY,dtstart:a,until:r,byweekday:[V.SU]})},ke=(a,r)=>a(r).all(),Pe=a=>{const r=a.getMonth(),l=a.getFullYear();let o=0;for(let i=1;i<=31;i++){const w=new Date(l,r,i);if(w.getMonth()!==r)break;if(w.getDay()===0&&(o++,w.getDate()===a.getDate())){const D=["st","nd","rd","th"],p=o<=3?D[o-1]:D[3];return`${o}${p}`}}return""},Fe=Te([]);async function pe(a){const{data:r,error:l}=await be.from("assignments").select("*").eq("list_name",a).order("date");if(l)throw l;const o=r||[];return Fe.set(o),o}async function je(a,r,l){const{error:o}=await be.from("assignments").upsert([{list_name:a,date:r,overridden_member:l,updated_at:new Date().toISOString()}],{onConflict:"list_name, date"});if(o)throw o;await pe(a)}var qe=B('<td> <small class="fw-lighter"> </small></td> <td> <br/> <small class="fw-lighter">No Sacrament Services</small></td>',1),Ke=B('<i class="bi bi-pencil-square"></i>'),Qe=B('<td> <small class="fw-lighter"> </small></td> <td><div class="d-flex justify-content-between"><span> </span> <!></div></td>',1),Ge=B("<option> </option>"),ze=B('<tr><td colspan="2"><div class="d-flex flex-column gap-2 p-2"><div>Change assignment to:</div> <select class="form-select form-control-sm"><option>Default</option><!></select> <div class="d-flex justify-content-end"><button class="btn btn-sm btn-primary">Save</button></div></div></td></tr>'),He=B("<tr><!></tr> <!>",1),We=B('<div class="table-responsive"><table class="table"><thead class="table-dark"><tr><td class="small">Date</td><td class="small">Bread Assignment</td></tr></thead><tbody></tbody></table></div>');function Ye(a,r){me(r,!1);let l=G(r,"editable",8,!1),o=G(r,"listName",8,"Some List"),i=G(r,"names",24,()=>[]),w=G(r,"excludedDates",24,()=>[]),D=[],p=re([]);const j=async(c=new Date(2026,0,1,0,0,0),t=new Date(2026,11,31,0,0,0))=>{const E={start_date:c,until:t};D=ke(Le.Sundays,E);const A=new Date;A.setHours(0,0,0,0);const x=D.map((u,L)=>{const M=w().find(Y=>ve(u,Y.date));return{member:M?null:i()[L%i().length],date:u,sundayNumber:Pe(u),event:M?M.event:void 0,overridden_member:null}}).filter(u=>u.date>=A),W=await pe(o());return x.map(u=>{const L=W.find(M=>ve(new Date(M.date),u.date));return{...u,overridden_member:L?L.overridden_member:null}})},ye=c=>{l()&&se(y,e(y)[`row-${c}`]=!e(y)[`row-${c}`])},Se=async(c,t)=>{const E=c.overridden_member||null;await je(o(),c.date.toISOString(),E),se(y,e(y)[t]=!e(y)[t]),j().then(A=>{te(p,A)})},y=re({});we(()=>Ne,()=>{j().then(c=>{te(p,c)})}),De(),_e();var H=We(),X=n(H),Z=b(n(X));le(Z,5,()=>e(p),de,(c,t,E)=>{var A=He(),x=K(A),W=n(x);{var u=v=>{var m=qe(),f=K(m),S=n(f),_=b(S),O=n(_);s(_),s(f);var R=b(f,2),T=n(R);Ee(3),s(R),k(($,N)=>{U(S,`${$??""} `),U(O,`${e(t),d(()=>e(t).sundayNumber)??""}
								${N??""}`),U(T,`${e(t),d(()=>e(t).event??"")??""} `)},[()=>(Q(h),e(t),d(()=>h(e(t).date,"MMM dd"))),()=>(Q(h),e(t),d(()=>h(e(t).date,"EEEE")))]),g(v,m)},L=v=>{var m=Qe(),f=K(m),S=n(f),_=b(S),O=n(_);s(_),s(f);var R=b(f,2),T=n(R),$=n(T),N=n($);s($);var C=b($,2);{var q=I=>{var P=Ke();g(I,P)};z(C,I=>{l()&&I(q)})}s(T),s(R),k((I,P)=>{U(S,`${I??""} `),U(O,`${e(t),d(()=>e(t).sundayNumber)??""}
								${P??""}`),U(N,`${e(t),d(()=>e(t).overridden_member?e(t).overridden_member:e(t).member)??""}
									${e(t),d(()=>e(t).overridden_member?"*":"")??""}`)},[()=>(Q(h),e(t),d(()=>h(e(t).date,"MMM dd"))),()=>(Q(h),e(t),d(()=>h(e(t).date,"EEEE")))]),g(v,m)};z(W,v=>{e(t),d(()=>e(t)?.event)?v(u):v(L,!1)})}s(x);var M=b(x,2);{var Y=v=>{var m=ze(),f=n(m),S=n(f),_=b(n(S),2);k(()=>{e(t),ae(()=>{i()})});var O=n(_);O.value=O.__value="";var R=b(O);le(R,1,i,de,(N,C)=>{var q=Me(),I=K(q);{var P=J=>{var F=Ge(),ge=n(F,!0);s(F);var ee={};k(()=>{U(ge,e(C)),ee!==(ee=e(C))&&(F.value=(F.__value=e(C))??"")}),g(J,F)};z(I,J=>{e(C),e(t),d(()=>e(C)!==e(t).member)&&J(P)})}g(N,q)}),s(_);var T=b(_,2),$=n(T);s(T),s(S),s(f),s(m),k(()=>ce(m,1,ue((e(y),d(()=>e(y)[`row-${E}`]?"table-light":"d-none"))))),Re(_,()=>e(t).overridden_member,N=>(e(t).overridden_member=N,ae(()=>e(p)))),ne("click",$,()=>Se(e(t),`row-${E}`)),g(v,m)};z(M,v=>{l()&&v(Y)})}k(()=>ce(x,1,ue((e(t),d(()=>e(t).member===null?"table-secondary":""))))),ne("click",x,()=>ye(E)),g(c,A)}),s(Z),s(X),s(H),g(a,H),fe()}function Je(a,r){me(r,!1);const l=()=>oe(D,"$currentUserIsRootOrAdmin",i),o=()=>oe(p,"$currentUserIsTeachersQuorum",i),[i,w]=xe(),{stores:{currentUserIsRootOrAdmin:D,currentUserIsTeachersQuorum:p}}=Oe();_e();{let j=Ae(()=>l()||o());Ye(a,{get editable(){return e(j)},get listName(){return Ie.SacramentBreadAssignments},get names(){return Ue},get excludedDates(){return Be}})}fe(),w()}function ut(a){he(a,{pageTitle:"Assignments",children:(r,l)=>{Je(r,{})},$$slots:{default:!0}})}export{ut as component,ct as universal};
