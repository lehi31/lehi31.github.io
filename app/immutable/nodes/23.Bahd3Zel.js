import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{P as ye}from"../chunks/MlCcgw1z.js";import{p as ve,ah as ge,ai as we,s as b,a as me,c as o,D as te,E as re,m as e,r as s,f as K,u as d,B as k,F as De,n as Q,C as ae,as as se,R as Ee}from"../chunks/DimshypG.js";import{i as _e}from"../chunks/PCWoV1YN.js";import{p as G,i as H,e as oe,s as I,b as Ae,a as ne}from"../chunks/BxPd6b7X.js";import{f as U,a as y,c as xe}from"../chunks/BpMnIePG.js";import{e as le,i as de}from"../chunks/DQUjufRY.js";import{a as fe,e as ie,i as ce,h as g,d as Me}from"../chunks/BJEhGyNp.js";import{b as Re}from"../chunks/CM5fKw4-.js";import{R as V}from"../chunks/3eSYmCoD.js";import{w as Te}from"../chunks/Bxf54LvK.js";import{i as ue}from"../chunks/DX2Bi54r.js";const $e=!0,Oe=$e,Ce=!0,it=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ce},Symbol.toStringTag,{value:"Module"})),Ne={SacramentBreadAssignments:"Sacrament Bread Assignments"},Be=["Folau Kaveinga","Tipi Kofe","Clenn Leituala","Vili Mapu","Keanu Naluai","Manase Soifua","Alex Tauteoli","Tray Teriipaia","Manoa Tuifua"],Ie=[{date:new Date(2026,3,5),event:"General Conference"},{date:new Date(2026,9,4),event:"General Conference"}],Ue={Sundays:({start_date:a,until:r})=>new V({freq:V.WEEKLY,dtstart:a,until:r,byweekday:[V.SU]})},Le=(a,r)=>a(r).all(),ke=a=>{const r=a.getMonth(),l=a.getFullYear();let n=0;for(let i=1;i<=31;i++){const w=new Date(l,r,i);if(w.getMonth()!==r)break;if(w.getDay()===0&&(n++,w.getDate()===a.getDate())){const D=["st","nd","rd","th"],p=n<=3?D[n-1]:D[3];return`${n}${p}`}}return""},Pe=Te([]);async function be(a){const{data:r,error:l}=await fe.from("assignments").select("*").eq("list_name",a).order("date");if(l)throw l;const n=r||[];return Pe.set(n),n}async function Fe(a,r,l){const{error:n}=await fe.from("assignments").upsert([{list_name:a,date:r,overridden_member:l,updated_at:new Date().toISOString()}],{onConflict:"list_name, date"});if(n)throw n;await be(a)}var je=U('<td> <small class="fw-lighter"> </small></td> <td> <br/> <small class="fw-lighter">No Sacrament Services</small></td>',1),qe=U('<i class="bi bi-pencil-square"></i>'),Ke=U('<td> <small class="fw-lighter"> </small></td> <td><div class="d-flex justify-content-between"><span> </span> <!></div></td>',1),Qe=U("<option> </option>"),Ge=U('<tr><td colspan="2"><div class="d-flex flex-column gap-2 p-2"><div>Change assignment to:</div> <select class="form-select form-control-sm"><option>Default</option><!></select> <div class="d-flex justify-content-end"><button class="btn btn-sm btn-primary">Save</button></div></div></td></tr>'),He=U("<tr><!></tr> <!>",1),We=U('<div class="table-responsive"><table class="table"><thead class="table-dark"><tr><td class="small">Date</td><td class="small">Bread Assignment</td></tr></thead><tbody></tbody></table></div>');function Ye(a,r){ve(r,!1);let l=G(r,"editable",8,!1),n=G(r,"listName",8,"Some List"),i=G(r,"names",24,()=>[]),w=G(r,"excludedDates",24,()=>[]),D=[],p=re([]);const j=async(c=new Date(2026,0,1,0,0,0),t=new Date(2026,11,31,0,0,0))=>{const E={start_date:c,until:t};D=Le(Ue.Sundays,E);const A=new Date;A.setHours(0,0,0,0);const x=D.map((u,L)=>{const M=w().find(z=>ue(u,z.date));return{member:M?null:i()[L%i().length],date:u,sundayNumber:ke(u),event:M?M.event:void 0,overridden_member:null}}).filter(u=>u.date>=A),Y=await be(n());return x.map(u=>{const L=Y.find(M=>ue(new Date(M.date),u.date));return{...u,overridden_member:L?L.overridden_member:null}})},pe=c=>{l()&&se(S,e(S)[`row-${c}`]=!e(S)[`row-${c}`])},Se=async(c,t)=>{const E=c.overridden_member||null;await Fe(n(),c.date.toISOString(),E),se(S,e(S)[t]=!e(S)[t]),j().then(A=>{te(p,A)})},S=re({});ge(()=>Oe,()=>{j().then(c=>{te(p,c)})}),we(),_e();var W=We(),X=o(W),Z=b(o(X));le(Z,5,()=>e(p),de,(c,t,E)=>{var A=He(),x=K(A),Y=o(x);{var u=v=>{var m=je(),_=K(m),h=o(_),f=b(h),R=o(f);s(f),s(_);var T=b(_,2),$=o(T);De(3),s(T),k((O,C)=>{I(h,`${O??""} `),I(R,`${e(t),d(()=>e(t).sundayNumber)??""}
								${C??""}`),I($,`${e(t),d(()=>e(t).event??"")??""} `)},[()=>(Q(g),e(t),d(()=>g(e(t).date,"MMM dd"))),()=>(Q(g),e(t),d(()=>g(e(t).date,"EEEE")))]),y(v,m)},L=v=>{var m=Ke(),_=K(m),h=o(_),f=b(h),R=o(f);s(f),s(_);var T=b(_,2),$=o(T),O=o($),C=o(O);s(O);var N=b(O,2);{var q=B=>{var P=qe();y(B,P)};H(N,B=>{l()&&B(q)})}s($),s(T),k((B,P)=>{I(h,`${B??""} `),I(R,`${e(t),d(()=>e(t).sundayNumber)??""}
								${P??""}`),I(C,`${e(t),d(()=>e(t).overridden_member?e(t).overridden_member:e(t).member)??""}
									${e(t),d(()=>e(t).overridden_member?"*":"")??""}`)},[()=>(Q(g),e(t),d(()=>g(e(t).date,"MMM dd"))),()=>(Q(g),e(t),d(()=>g(e(t).date,"EEEE")))]),y(v,m)};H(Y,v=>{e(t),d(()=>e(t)?.event)?v(u):v(L,!1)})}s(x);var M=b(x,2);{var z=v=>{var m=Ge(),_=o(m),h=o(_),f=b(o(h),2);k(()=>{e(t),ae(()=>{i()})});var R=o(f);R.value=R.__value="";var T=b(R);le(T,1,i,de,(C,N)=>{var q=xe(),B=K(q);{var P=J=>{var F=Qe(),he=o(F,!0);s(F);var ee={};k(()=>{I(he,e(N)),ee!==(ee=e(N))&&(F.value=(F.__value=e(N))??"")}),y(J,F)};H(B,J=>{e(N),e(t),d(()=>e(N)!==e(t).member)&&J(P)})}y(C,q)}),s(f);var $=b(f,2),O=o($);s($),s(h),s(_),s(m),k(()=>ie(m,1,ce((e(S),d(()=>e(S)[`row-${E}`]?"table-light":"d-none"))))),Re(f,()=>e(t).overridden_member,C=>(e(t).overridden_member=C,ae(()=>e(p)))),oe("click",O,()=>Se(e(t),`row-${E}`)),y(v,m)};H(M,v=>{l()&&v(z)})}k(()=>ie(x,1,ce((e(t),d(()=>e(t).member===null?"table-secondary":""))))),oe("click",x,()=>pe(E)),y(c,A)}),s(Z),s(X),s(W),y(a,W),me()}function ze(a,r){ve(r,!1);const l=()=>ne(D,"$currentUserIsRootOrAdmin",i),n=()=>ne(p,"$currentUserIsTeachersQuorum",i),[i,w]=Ae(),{stores:{currentUserIsRootOrAdmin:D,currentUserIsTeachersQuorum:p}}=Me();_e();{let j=Ee(()=>l()||n());Ye(a,{get editable(){return e(j)},get listName(){return Ne.SacramentBreadAssignments},get names(){return Be},get excludedDates(){return Ie}})}me(),w()}function ct(a){ye(a,{pageTitle:"Assignments",children:(r,l)=>{ze(r,{})},$$slots:{default:!0}})}export{ct as component,it as universal};
