import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{p as ae,c as s,s as i,r as a,a as se,f as Q,t as F,F as Se,aj as z,ak as ia,g as t,E as u,D as o,u as v,R as dt,am as da,w as J,an as va}from"../chunks/CPcjNedw.js";import{f as d,a as n,c as Zt,t as De}from"../chunks/BYls_3XS.js";import{P as ca}from"../chunks/Z5N9TKfN.js";import{d as Me,s as Pe,A as ua,E as fa}from"../chunks/BfUIKW58.js";import{d as $e,o as ma,g as _a}from"../chunks/DNltCNNq.js";import{p as vt,i as g,e as C,s as L,a as pa,b as gt}from"../chunks/BafKDQNK.js";import{e as St}from"../chunks/B-ARnQOI.js";import{s as Gt}from"../chunks/CItJ2AZn.js";import{g as ba,p as H,f as S,P as te,k as ga,b as ee}from"../chunks/CITyhBy4.js";import{i as re}from"../chunks/DPzVpBhB.js";import{c as ya,g as ha,A as ka,e as Ct,d as Ea,E as xa}from"../chunks/Cx3gg4yJ.js";import{S as wa}from"../chunks/WZ0Xb_pu.js";import{v as Da,D as Ma}from"../chunks/QYX6Luei.js";import{s as At}from"../chunks/BWqcFLWY.js";function Pa(q,p){return ya(q,-p)}const $a=!0,ps=Object.freeze(Object.defineProperty({__proto__:null,prerender:$a},Symbol.toStringTag,{value:"Module"}));var Sa=d('<p class="mb-0">No past events to delete.</p>'),Ca=d('<p class="mb-2"><strong> </strong></p>'),Aa=d(`<div class="alert alert-warning mb-0" role="alert"><p class="mb-2"><strong> </strong></p> <p class="mb-0 small">These recurring events have active future instances and cannot be deleted until all
								future occurrences have passed.</p></div>`),Oa=d("<!> <!>",1),Ia=d('<div class="modal svelte-1u875uh" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-primary text-white"><h5 class="modal-title">Delete Past Events - Results</h5> <button type="button" class="btn-close btn-close-white" aria-label="Close"></button></div> <div class="modal-body"><!></div> <div class="modal-footer"><button type="button" class="btn btn-primary">OK</button></div></div></div></div>');function Ta(q,p){ae(p,!1);let A=vt(p,"deleted",8),f=vt(p,"skipped",8),O=vt(p,"callback",8);function D(){O()()}re();var M=Ia(),P=s(M),Y=s(P),I=s(Y),Z=i(s(I),2);a(I);var c=i(I,2),G=s(c);{var m=T=>{var at=Sa();n(T,at)},tt=T=>{var at=Oa(),yt=Q(at);{var Ot=U=>{var E=Ca(),B=s(E),R=s(B);a(B),a(E),F(()=>L(R,`✓ Deleted ${A()??""} past event${A()===1?"":"s"}.`)),n(U,E)};g(yt,U=>{A()>0&&U(Ot)})}var It=i(yt,2);{var ht=U=>{var E=Aa(),B=s(E),R=s(B),kt=s(R);a(R),a(B),Se(2),a(E),F(()=>L(kt,`⚠ Skipped ${f()??""} recurring event${f()===1?"":"s"}`)),n(U,E)};g(It,U=>{f()>0&&U(ht)})}n(T,at)};g(G,T=>{A()===0&&f()===0?T(m):T(tt,!1)})}a(c);var K=i(c,2),et=s(K);a(K),a(Y),a(P),a(M),C("click",Z,D),C("click",et,D),n(q,M),se()}var Ra=d(`<div class="modal svelte-dmsnaa" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-danger text-white"><h5 class="modal-title">Delete Past Events</h5> <button type="button" class="btn-close btn-close-white" aria-label="Close"></button></div> <div class="modal-body"><p class="mb-3"><strong> </strong></p> <p class="mb-0 text-muted small">This action cannot be undone. Recurring events with future instances will be skipped
					automatically.</p></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-danger">Delete</button></div></div></div></div>`);function Wa(q,p){ae(p,!1);let A=vt(p,"cutoffDate",8),f=vt(p,"callback",8);function O(){f()(!0)}function D(){f()(!1)}re();var M=Ra(),P=s(M),Y=s(P),I=s(Y),Z=i(s(I),2);a(I);var c=i(I,2),G=s(c),m=s(G),tt=s(m);a(m),a(G),Se(2),a(c);var K=i(c,2),et=s(K),T=i(et,2);a(K),a(Y),a(P),a(M),F(()=>L(tt,`Are you sure you want to delete all events that occurred before ${A()??""}?`)),C("click",Z,D),C("click",et,D),C("click",T,O),n(q,M),se()}var Na=d('<button class="btn btn-sm btn-outline-danger" type="button"><!></button>'),ja=d('<div class="event-actions svelte-1ofdc1q"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit past event"><i class="bi bi-pencil-square"></i></button></div>'),Fa=d('<div class="daily-event-row svelte-1ofdc1q"><div class="event-content svelte-1ofdc1q"><!></div> <!></div>'),La=d('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-1ofdc1q"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),qa=d('<li class="list-group-item py-3 text-muted">No events scheduled this week.</li>'),Ka=d('<li class="list-group-item list-group-item-light text-uppercase small fw-lighter p-0"><button><span class="d-flex align-items-center gap-2"><i></i> <span class="text-muted"> </span></span> <span> </span></button></li> <!>',1),Ua=d('<li class="list-group-item bg-secondary text-white fw-semibold"> </li> <!>',1),Ba=d('<button class="btn btn-outline-secondary btn-sm">Reset</button>'),Ha=d('<div class="d-flex gap-2"><button class="btn btn-primary btn-sm">More</button> <button class="btn btn-outline-primary btn-sm">All</button></div>'),Va=d('<div class="card-footer d-flex align-items-center justify-content-between"><small> </small> <!></div>'),Xa=d('<ul class="list-group list-group-flush border-top-0"></ul> <!>',1),za=d('<div class="card-body text-muted small">No past events available.</div>'),Ja=d('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center gap-3 flex-wrap fw-lighter d-flex justify-content-end"><span>Past Events</span> <!></div></div> <!></div>'),Qa=d('<div class="d-flex flex-column gap-4"><!></div>'),Ya=d("<!> <!> <!> <!>",1);function Za(q,p){ae(p,!1);const A=()=>gt(It,"$weeksExpanded",P),f=()=>gt(Ie,"$allPastEvents",P),O=()=>gt(T,"$currentUserHasPermission",P),D=()=>gt(ve,"$userIsRoot",P),M=()=>gt(yt,"$ready",P),[P,Y]=pa(),I=u(),Z=u(),c=u(),G=u(),m=u(),tt=u(),K=u(),et=u(),{stores:{currentUserHasPermission:T,currentUser:at}}=ba(),{stores:{ready:yt,dbData:Ot,weeksExpanded:It},actions:{reload:ht}}=ha(),U={title:"Event",description:"",location:"",event_type:"calendar_event"};let E=vt(p,"formId",24,Da),B=u(!1),R=u(!1),kt=u(""),ne=u({...U}),Tt=u(!1),le=u(""),Rt=u(!1),ct=u({deleted:0,skipped:0});const oe=4,Ce=4;let st=u(oe),Et=u(!1);const ie=At();let rt=u({});function de(e){return t(I).includes(e)}function Ae(e){const l=t(rt)[e]??de(e);o(rt,{...t(rt),[e]:!l})}const Oe=e=>{o(kt,"Event Item"),o(ne,{...e,category:e?.meta_data?.category})},Ie=$e(Ot,e=>{const l=At();return(e??[]).filter(r=>!(r.event_type!=="calendar_event"||!r.start_time||H(r.start_time)>=l||r.recurrence_rule&&(!r.recurrence_end_date||r.recurrence_end_date&&H(r.recurrence_end_date)>=l)))}),ve=$e(at,e=>e.roles?.includes("system-root")??!1);function Te(){o(st,t(st)+Ce)}function Re(){o(st,520),o(Et,!0)}function We(){o(st,oe),o(Et,!1)}const Ne=()=>{if(!t(B)||t(R)||!_a(ve)||!t(K))return;const e=At();o(le,S(e,"MMM d, yyyy")),o(Tt,!0)};async function je(e){if(o(Tt,!1),!e)return;const l=At();o(R,!0);try{const r=await Ea(l);await ht(),o(ct,r),o(Rt,!0)}catch(r){console.error("Failed to delete past events",r),alert("Failed to delete past events. Please try again.")}finally{o(R,!1)}}function Fe(){o(Rt,!1)}ma(async()=>{o(B,O()(te.CreateEvents)||O()(te.EditOwnOrgEvents)||O()(te.EditAllEvents)),await ht()}),z(()=>(f(),t(st)),()=>{o(c,(f()??[]).filter(e=>{if(!e.start_time)return!1;const l=H(e.start_time),r=Pa(ie,t(st));return l>=r&&l<ie}))}),z(()=>(t(c),S),()=>{o(m,(()=>{const e=new Map;for(const l of t(c)){if(!l.start_time)continue;const r=H(l.start_time),y=ga(r,{weekStartsOn:1}),x=Ct(r,{weekStartsOn:1}),b=S(y,"yyyy-MM-dd"),w=`${S(y,"MMM d")} – ${S(x,"MMM d")}`;let k=e.get(b);k||(k={key:b,label:w,days:new Map},e.set(b,k));const V=S(r,"yyyy-MM-dd");let nt=k.days.get(V);nt||(nt={key:V,displayDay:S(r,"EEE"),displayDate:S(r,"MMM d"),events:[]},k.days.set(V,nt)),nt.events.push(l)}return Array.from(e.values()).sort((l,r)=>l.key<r.key?1:-1).map(l=>({key:l.key,label:l.label,days:Array.from(l.days.values()).sort((r,y)=>r.key<y.key?1:-1).map(r=>({...r,events:r.events.slice().sort((y,x)=>{const b=y.is_all_day?0:1,w=x.is_all_day?0:1;if(b!==w)return b-w;const k=y.start_time?H(y.start_time).getTime():Number.MAX_SAFE_INTEGER,V=x.start_time?H(x.start_time).getTime():Number.MAX_SAFE_INTEGER;return k-V})}))}))})())}),z(()=>t(m),()=>{o(I,(()=>{if(t(m).length===0)return[];const e=[];return t(m)[0]&&e.push(t(m)[0].key),t(m)[1]&&e.push(t(m)[1].key),e})())}),z(()=>(A(),t(rt)),()=>{o(Z,e=>A()?!0:t(rt)[e]!==void 0?t(rt)[e]:de(e))}),z(()=>t(c),()=>{o(G,t(c).length)}),z(()=>(t(m),S),()=>{o(tt,t(m).reduce((e,l)=>{const r=H(l.key),y=Ct(r,{weekStartsOn:1}),x=S(y,"yyyy-MM"),b=S(y,"MMMM yyyy");return e[x]||(e[x]={label:b,weeks:[]}),e[x].weeks.push(l),e},{}))}),z(()=>t(c),()=>{o(K,t(c).length>0)}),z(()=>(f(),t(c)),()=>{o(et,f().length>t(c).length)}),ia(),re();var ce=Ya(),ue=Q(ce);Ma(ue,{get title(){return t(kt)},get id(){return E()},children:(e,l)=>{ka(e,{get eventItem(){return t(ne)},get drawerId(){return E()},name:"past-event-item-form"})},$$slots:{default:!0}});var fe=i(ue,2);{var Le=e=>{var l=Zt(),r=Q(l);{var y=b=>{var w=Ja(),k=s(w),V=s(k),nt=i(s(V),2);{var Be=W=>{var N=Na(),ut=s(N);{var Wt=h=>{var $=De("Deleting…");n(h,$)},Nt=h=>{var $=De();F(()=>L($,`Delete Past Events (${t(G)??""})`)),n(h,$)};g(ut,h=>{t(R)?h(Wt):h(Nt,!1)})}a(N),F(()=>N.disabled=t(R)),C("click",N,Ne),n(W,N)};g(nt,W=>{D()&&t(K)&&W(Be)})}a(V),a(k);var He=i(k,2);{var Ve=W=>{var N=Xa(),ut=Q(N);St(ut,5,()=>(t(tt),v(()=>Object.entries(t(tt)))),([h,$])=>h,(h,$)=>{var ft=da(()=>va(t($),2));let lt=()=>t(ft)[1];var xt=Ua(),mt=Q(xt),jt=s(mt,!0);a(mt);var X=i(mt,2);St(X,1,()=>(lt(),v(()=>lt().weeks)),j=>j.key,(j,_)=>{const wt=dt(()=>(J(H),t(_),v(()=>H(t(_).key)))),Dt=dt(()=>(J(Ct),J(t(wt)),v(()=>Ct(t(wt),{weekStartsOn:1})))),_e=dt(()=>(J(Pe),J(t(Dt)),v(()=>Pe(t(Dt))))),ze=dt(()=>(J(Me),J(t(Dt)),J(t(_e)),v(()=>Me(t(Dt),t(_e),{weekStartsOn:1})+1))),Ft=dt(()=>(t(Z),t(_),v(()=>t(Z)(t(_).key)))),Mt=dt(()=>(t(_),v(()=>t(_).days.reduce((pt,Pt)=>pt+Pt.events.length,0))));var pe=Ka(),Lt=Q(pe),_t=s(Lt);let be;var qt=s(_t),ge=s(qt),ye=i(ge,2),Je=s(ye);a(ye),a(qt);var Kt=i(qt,2);let he;var Qe=s(Kt,!0);a(Kt),a(_t),a(Lt);var Ye=i(Lt,2);{var Ze=pt=>{var Pt=Zt(),Ge=Q(Pt);{var ta=ot=>{var $t=Zt(),aa=Q($t);St(aa,1,()=>(t(_),v(()=>t(_).days)),Ut=>Ut.key,(Ut,it)=>{var Bt=La(),ke=s(Bt),Ht=s(ke),Vt=s(Ht),sa=s(Vt,!0);a(Vt);var Ee=i(Vt,2),ra=s(Ee,!0);a(Ee),a(Ht);var xe=i(Ht,2);St(xe,5,()=>(t(it),v(()=>t(it).events)),bt=>bt.id??`${bt.start_time}-${bt.meta_data?.recurring_instance_index??0}`,(bt,we)=>{var Xt=Fa(),zt=s(Xt),na=s(zt);xa(na,{get item(){return t(we)},showDate:!1}),a(zt);var la=i(zt,2);{var oa=Jt=>{var Qt=ja(),Yt=s(Qt);a(Qt),F(()=>{Gt(Yt,"data-bs-target",`#${E()??""}`),Gt(Yt,"aria-controls",E())}),C("click",Yt,()=>Oe(t(we))),n(Jt,Qt)};g(la,Jt=>{t(B)&&Jt(oa)})}a(Xt),n(bt,Xt)}),a(xe),a(ke),a(Bt),F(()=>{L(sa,(t(it),v(()=>t(it).displayDay))),L(ra,(t(it),v(()=>t(it).displayDate)))}),n(Ut,Bt)}),n(ot,$t)},ea=ot=>{var $t=qa();n(ot,$t)};g(Ge,ot=>{t(_),v(()=>t(_).days.length)?ot(ta):ot(ea,!1)})}n(pt,Pt)};g(Ye,pt=>{t(Ft)&&pt(Ze)})}F(()=>{be=ee(_t,1,"week-header w-100 d-flex justify-content-between align-items-center border-0 bg-transparent p-2 text-start svelte-1ofdc1q",null,be,{"text-muted":t(Mt)===0}),Gt(_t,"title",t(Ft)?"Click to collapse week":"Click to expand week"),ee(ge,1,`bi ${t(Ft)?"bi-chevron-up":"bi-chevron-down"}`),L(Je,`Week ${t(ze)??""} [${t(Mt)??""} Event${t(Mt)===1?"":"s"}]`),he=ee(Kt,1,"",null,he,{"opacity-50":t(Mt)===0}),L(Qe,(t(_),v(()=>t(_).label)))}),C("click",_t,()=>Ae(t(_).key)),n(j,pe)}),F(()=>L(jt,(lt(),v(()=>lt().label)))),n(h,xt)}),a(ut);var Wt=i(ut,2);{var Nt=h=>{var $=Va(),ft=s($),lt=s(ft);a(ft);var xt=i(ft,2);{var mt=X=>{var j=Ba();C("click",j,We),n(X,j)},jt=X=>{var j=Ha(),_=s(j),wt=i(_,2);a(j),C("click",_,Te),C("click",wt,Re),n(X,j)};g(xt,X=>{t(Et)?X(mt):X(jt,!1)})}a($),F(()=>L(lt,`Showing ${t(c),v(()=>t(c)?.length??0)??""} of ${f(),v(()=>f()?.length??0)??""}`)),n(h,$)};g(Wt,h=>{(t(et)||t(Et))&&h(Nt)})}n(W,N)},Xe=W=>{var N=za();n(W,N)};g(He,W=>{t(m),v(()=>t(m).length)?W(Ve):W(Xe,!1)})}a(w),n(b,w)},x=b=>{var w=Qa(),k=s(w);wa(k,{}),a(w),n(b,w)};g(r,b=>{M()?b(y):b(x,!1)})}n(e,l)};g(fe,e=>{D()&&e(Le)})}var me=i(fe,2);{var qe=e=>{Wa(e,{get cutoffDate(){return t(le)},callback:je})};g(me,e=>{t(Tt)&&e(qe)})}var Ke=i(me,2);{var Ue=e=>{Ta(e,{get deleted(){return t(ct),v(()=>t(ct).deleted)},get skipped(){return t(ct),v(()=>t(ct).skipped)},callback:Fe})};g(Ke,e=>{t(Rt)&&e(Ue)})}n(q,ce),se(),Y()}var Ga=d('<div class="d-flex flex-column gap-4"><!> <!> <!></div>');function bs(q){ca(q,{pageTitle:"Announcements & Events",children:(p,A)=>{var f=Ga(),O=s(f);ua(O,{});var D=i(O,2);fa(D,{});var M=i(D,2);Za(M,{}),a(f),n(p,f)},$$slots:{default:!0}})}export{bs as component,ps as universal};
