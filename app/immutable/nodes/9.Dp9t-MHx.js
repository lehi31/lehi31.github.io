import{s as Ge,d as u,x as Je,y as re,a as ee,i as G,b as s,z as le,p as a,c as i,e as b,w as R,g as w,f as Q,h as c,j as T,t as X,k as _e,r as Ke,A as Re,n as ge,B as tt}from"../chunks/D1pHg4Vz.js";import{S as We,i as Ze,d as ye,t as ke,a as Ee,m as De,c as Ce,b as we}from"../chunks/C8yGzMhi.js";import{P as lt}from"../chunks/DqiX326p.js";import{e as je,u as st,d as at}from"../chunks/CCzKB2IW.js";import{D as nt}from"../chunks/Dg3vZxfg.js";import{u as rt}from"../chunks/B1_8Nz0B.js";import{g as ot,P as it}from"../chunks/D_mJOOgI.js";import{g as ct}from"../chunks/lztEcQYo.js";function ze(o,e,l){const t=o.slice();return t[22]=e[l],t}function Fe(o){let e,l,t,n,h,d;return{c(){e=c("div"),l=X(o[4]),t=T(),n=c("button"),this.h()},l(k){e=i(k,"DIV",{class:!0,role:!0});var g=b(e);l=Q(g,o[4]),t=w(g),n=i(g,"BUTTON",{type:!0,class:!0,"aria-label":!0}),b(n).forEach(u),g.forEach(u),this.h()},h(){a(n,"type","button"),a(n,"class","btn-close"),a(n,"aria-label","Close"),a(e,"class","alert alert-danger alert-dismissible fade show"),a(e,"role","alert")},m(k,g){G(k,e,g),s(e,l),s(e,t),s(e,n),h||(d=le(n,"click",o[15]),h=!0)},p(k,g){g&16&&ee(l,k[4])},d(k){k&&u(e),h=!1,d()}}}function ut(o){let e,l,t,n='<tr><th scope="col">Name</th> <th scope="col" class="d-none d-md-table-cell">Email</th> <th scope="col" class="d-none d-lg-table-cell">Status</th> <th scope="col" class="d-none d-lg-table-cell">Created</th> <th scope="col" class="d-none d-xl-table-cell">Last Login</th> <th scope="col" class="text-end">Actions</th></tr>',h,d,k=[],g=new Map,L,D=je(o[3]);const N=m=>m[22].id;for(let m=0;m<D.length;m+=1){let y=ze(o,D,m),p=N(y);g.set(p,k[m]=Qe(p,y))}let r=o[3].length===0&&Xe();return{c(){e=c("div"),l=c("table"),t=c("thead"),t.innerHTML=n,h=T(),d=c("tbody");for(let m=0;m<k.length;m+=1)k[m].c();L=T(),r&&r.c(),this.h()},l(m){e=i(m,"DIV",{class:!0});var y=b(e);l=i(y,"TABLE",{class:!0});var p=b(l);t=i(p,"THEAD",{"data-svelte-h":!0}),R(t)!=="svelte-1ize7n7"&&(t.innerHTML=n),h=w(p),d=i(p,"TBODY",{class:!0});var S=b(d);for(let I=0;I<k.length;I+=1)k[I].l(S);S.forEach(u),p.forEach(u),L=w(y),r&&r.l(y),y.forEach(u),this.h()},h(){a(d,"class","table-group-divider"),a(l,"class","table table-hover align-middle"),a(e,"class","table-responsive")},m(m,y){G(m,e,y),s(e,l),s(l,t),s(l,h),s(l,d);for(let p=0;p<k.length;p+=1)k[p]&&k[p].m(d,null);s(e,L),r&&r.m(e,null)},p(m,y){y&1032&&(D=je(m[3]),k=st(k,y,N,1,m,D,g,d,at,Qe,null,ze)),m[3].length===0?r||(r=Xe(),r.c(),r.m(e,null)):r&&(r.d(1),r=null)},d(m){m&&u(e);for(let y=0;y<k.length;y+=1)k[y].d();r&&r.d()}}}function dt(o){let e,l='<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>';return{c(){e=c("div"),e.innerHTML=l,this.h()},l(t){e=i(t,"DIV",{class:!0,"data-svelte-h":!0}),R(e)!=="svelte-mlx3u2"&&(e.innerHTML=l),this.h()},h(){a(e,"class","text-center py-5")},m(t,n){G(t,e,n)},p:ge,d(t){t&&u(e)}}}function ft(o){let e,l="Never";return{c(){e=c("span"),e.textContent=l,this.h()},l(t){e=i(t,"SPAN",{class:!0,"data-svelte-h":!0}),R(e)!=="svelte-1qml2vo"&&(e.textContent=l),this.h()},h(){a(e,"class","text-muted")},m(t,n){G(t,e,n)},p:ge,d(t){t&&u(e)}}}function _t(o){let e=new Date(o[22].last_login).toLocaleDateString()+"",l;return{c(){l=X(e)},l(t){l=Q(t,e)},m(t,n){G(t,l,n)},p(t,n){n&8&&e!==(e=new Date(t[22].last_login).toLocaleDateString()+"")&&ee(l,e)},d(t){t&&u(l)}}}function Qe(o,e){let l,t,n,h=(e[22].display_name??e[22].email)+"",d,k,g,L=e[22].email+"",D,N,r,m=e[22].email+"",y,p,S,I,P="user",V,q,B,$,x=e[22].is_active?"Active":"Disabled",A,v,J,j,E,K=e[22].is_active?"Active":"Disabled",z,U,f,_,M,O=new Date(e[22].created_at).toLocaleDateString()+"",Y,W,H,ae,me,ne,F,oe,pe,se,Te="Edit",ve,ie,be,Le;function $e(te,C){return te[22].last_login?_t:ft}let ce=$e(e),Z=ce(e);function et(){return e[17](e[22])}return{key:o,first:null,c(){l=c("tr"),t=c("td"),n=c("div"),d=X(h),k=T(),g=c("small"),D=X(L),N=T(),r=c("td"),y=X(m),p=T(),S=c("td"),I=c("span"),V=X(P),q=T(),B=c("div"),$=c("span"),A=X(x),J=T(),j=c("td"),E=c("span"),z=X(K),f=T(),_=c("td"),M=c("small"),Y=X(O),W=T(),H=c("td"),ae=c("small"),Z.c(),me=T(),ne=c("td"),F=c("button"),oe=c("i"),pe=T(),se=c("span"),se.textContent=Te,ve=T(),this.h()},l(te){l=i(te,"TR",{class:!0});var C=b(l);t=i(C,"TD",{});var ue=b(t);n=i(ue,"DIV",{class:!0});var Ae=b(n);d=Q(Ae,h),Ae.forEach(u),k=w(ue),g=i(ue,"SMALL",{class:!0});var Ie=b(g);D=Q(Ie,L),Ie.forEach(u),ue.forEach(u),N=w(C),r=i(C,"TD",{class:!0});var Ne=b(r);y=Q(Ne,m),Ne.forEach(u),p=w(C),S=i(C,"TD",{});var de=b(S);I=i(de,"SPAN",{class:!0});var Se=b(I);V=Q(Se,P),Se.forEach(u),q=w(de),B=i(de,"DIV",{class:!0});var Ue=b(B);$=i(Ue,"SPAN",{class:!0});var Me=b($);A=Q(Me,x),Me.forEach(u),Ue.forEach(u),de.forEach(u),J=w(C),j=i(C,"TD",{class:!0});var Ve=b(j);E=i(Ve,"SPAN",{class:!0});var Pe=b(E);z=Q(Pe,K),Pe.forEach(u),Ve.forEach(u),f=w(C),_=i(C,"TD",{class:!0});var Be=b(_);M=i(Be,"SMALL",{});var He=b(M);Y=Q(He,O),He.forEach(u),Be.forEach(u),W=w(C),H=i(C,"TD",{class:!0});var xe=b(H);ae=i(xe,"SMALL",{});var Oe=b(ae);Z.l(Oe),Oe.forEach(u),xe.forEach(u),me=w(C),ne=i(C,"TD",{class:!0});var qe=b(ne);F=i(qe,"BUTTON",{class:!0,type:!0,"data-bs-toggle":!0,"data-bs-target":!0,"aria-controls":!0});var fe=b(F);oe=i(fe,"I",{class:!0}),b(oe).forEach(u),pe=w(fe),se=i(fe,"SPAN",{class:!0,"data-svelte-h":!0}),R(se)!=="svelte-1davzvv"&&(se.textContent=Te),fe.forEach(u),qe.forEach(u),ve=w(C),C.forEach(u),this.h()},h(){a(n,"class","fw-semibold"),a(g,"class","d-md-none text-muted d-block"),a(r,"class","d-none d-md-table-cell"),a(I,"class",`badge bg-${bt("user")} text-uppercase`),a($,"class",v=`badge ${e[22].is_active?"bg-success":"bg-danger"}`),a(B,"class","d-lg-none mt-1"),a(E,"class",U=`badge ${e[22].is_active?"bg-success":"bg-danger"}`),a(j,"class","d-none d-lg-table-cell"),a(_,"class","d-none d-lg-table-cell"),a(H,"class","d-none d-xl-table-cell"),a(oe,"class","bi bi-pencil"),a(se,"class","d-none d-sm-inline"),a(F,"class","btn btn-sm btn-outline-primary"),a(F,"type","button"),a(F,"data-bs-toggle","offcanvas"),a(F,"data-bs-target",`#${he}`),a(F,"aria-controls",he),a(ne,"class","text-end"),a(l,"class",ie=e[22].is_active?"":"opacity-75"),this.first=l},m(te,C){G(te,l,C),s(l,t),s(t,n),s(n,d),s(t,k),s(t,g),s(g,D),s(l,N),s(l,r),s(r,y),s(l,p),s(l,S),s(S,I),s(I,V),s(S,q),s(S,B),s(B,$),s($,A),s(l,J),s(l,j),s(j,E),s(E,z),s(l,f),s(l,_),s(_,M),s(M,Y),s(l,W),s(l,H),s(H,ae),Z.m(ae,null),s(l,me),s(l,ne),s(ne,F),s(F,oe),s(F,pe),s(F,se),s(l,ve),be||(Le=le(F,"click",et),be=!0)},p(te,C){e=te,C&8&&h!==(h=(e[22].display_name??e[22].email)+"")&&ee(d,h),C&8&&L!==(L=e[22].email+"")&&ee(D,L),C&8&&m!==(m=e[22].email+"")&&ee(y,m),C&8&&x!==(x=e[22].is_active?"Active":"Disabled")&&ee(A,x),C&8&&v!==(v=`badge ${e[22].is_active?"bg-success":"bg-danger"}`)&&a($,"class",v),C&8&&K!==(K=e[22].is_active?"Active":"Disabled")&&ee(z,K),C&8&&U!==(U=`badge ${e[22].is_active?"bg-success":"bg-danger"}`)&&a(E,"class",U),C&8&&O!==(O=new Date(e[22].created_at).toLocaleDateString()+"")&&ee(Y,O),ce===(ce=$e(e))&&Z?Z.p(e,C):(Z.d(1),Z=ce(e),Z&&(Z.c(),Z.m(ae,null))),C&8&&ie!==(ie=e[22].is_active?"":"opacity-75")&&a(l,"class",ie)},d(te){te&&u(l),Z.d(),be=!1,Le()}}}function Xe(o){let e,l="<p>No users found matching your filters.</p>";return{c(){e=c("div"),e.innerHTML=l,this.h()},l(t){e=i(t,"DIV",{class:!0,"data-svelte-h":!0}),R(e)!=="svelte-i4erte"&&(e.innerHTML=l),this.h()},h(){a(e,"class","text-center py-5 text-muted")},m(t,n){G(t,e,n)},d(t){t&&u(e)}}}function ht(o){let e,l="Select a user to edit.";return{c(){e=c("p"),e.textContent=l,this.h()},l(t){e=i(t,"P",{class:!0,"data-svelte-h":!0}),R(e)!=="svelte-l09ef1"&&(e.textContent=l),this.h()},h(){a(e,"class","text-muted mb-0")},m(t,n){G(t,e,n)},p:ge,d(t){t&&u(e)}}}function mt(o){let e,l,t,n="Display Name",h,d,k,g,L,D,N,r,m="Active Account",y,p,S="Disabled accounts cannot login",I,P,V,q="Admin Notes",B,$,x,A,v,J="Cancel",j,E,K="Save Changes",z,U;return{c(){e=c("form"),l=c("div"),t=c("label"),t.textContent=n,h=T(),d=c("input"),k=T(),g=c("div"),L=c("div"),D=c("input"),N=T(),r=c("label"),r.textContent=m,y=T(),p=c("div"),p.textContent=S,I=T(),P=c("div"),V=c("label"),V.textContent=q,B=T(),$=c("textarea"),x=T(),A=c("div"),v=c("button"),v.textContent=J,j=T(),E=c("button"),E.textContent=K,this.h()},l(f){e=i(f,"FORM",{class:!0});var _=b(e);l=i(_,"DIV",{});var M=b(l);t=i(M,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),R(t)!=="svelte-1qww9aa"&&(t.textContent=n),h=w(M),d=i(M,"INPUT",{type:!0,class:!0,id:!0,placeholder:!0}),M.forEach(u),k=w(_),g=i(_,"DIV",{});var O=b(g);L=i(O,"DIV",{class:!0});var Y=b(L);D=i(Y,"INPUT",{class:!0,type:!0,id:!0}),N=w(Y),r=i(Y,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),R(r)!=="svelte-gc2a6c"&&(r.textContent=m),Y.forEach(u),y=w(O),p=i(O,"DIV",{class:!0,"data-svelte-h":!0}),R(p)!=="svelte-ip672x"&&(p.textContent=S),O.forEach(u),I=w(_),P=i(_,"DIV",{});var W=b(P);V=i(W,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),R(V)!=="svelte-17a0zww"&&(V.textContent=q),B=w(W),$=i(W,"TEXTAREA",{class:!0,id:!0,rows:!0,placeholder:!0}),b($).forEach(u),W.forEach(u),x=w(_),A=i(_,"DIV",{class:!0});var H=b(A);v=i(H,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),R(v)!=="svelte-10ov1w5"&&(v.textContent=J),j=w(H),E=i(H,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),R(E)!=="svelte-bcbxuj"&&(E.textContent=K),H.forEach(u),_.forEach(u),this.h()},h(){a(t,"class","form-label"),a(t,"for","displayName"),a(d,"type","text"),a(d,"class","form-control"),a(d,"id","displayName"),a(d,"placeholder","Display name (optional)"),a(D,"class","form-check-input"),a(D,"type","checkbox"),a(D,"id","isActive"),a(r,"class","form-check-label"),a(r,"for","isActive"),a(L,"class","form-check form-switch"),a(p,"class","form-text"),a(V,"class","form-label"),a(V,"for","adminNotes"),a($,"class","form-control"),a($,"id","adminNotes"),a($,"rows","3"),a($,"placeholder","Internal notes about this user..."),a(v,"type","button"),a(v,"class","btn btn-secondary"),a(E,"type","submit"),a(E,"class","btn btn-primary"),a(A,"class","d-flex justify-content-end gap-2"),a(e,"class","d-flex flex-column gap-3")},m(f,_){G(f,e,_),s(e,l),s(l,t),s(l,h),s(l,d),re(d,o[1].display_name),s(e,k),s(e,g),s(g,L),s(L,D),D.checked=o[1].is_active,s(L,N),s(L,r),s(g,y),s(g,p),s(e,I),s(e,P),s(P,V),s(P,B),s(P,$),re($,o[1].notes),s(e,x),s(e,A),s(A,v),s(A,j),s(A,E),z||(U=[le(d,"input",o[18]),le(D,"change",o[19]),le($,"input",o[20]),le(v,"click",o[11]),le(e,"submit",tt(o[12]))],z=!0)},p(f,_){_&2&&d.value!==f[1].display_name&&re(d,f[1].display_name),_&2&&(D.checked=f[1].is_active),_&2&&re($,f[1].notes)},d(f){f&&u(e),z=!1,Je(U)}}}function pt(o){let e;function l(h,d){return h[1]?mt:ht}let t=l(o),n=t(o);return{c(){n.c(),e=Re()},l(h){n.l(h),e=Re()},m(h,d){n.m(h,d),G(h,e,d)},p(h,d){t===(t=l(h))&&n?n.p(h,d):(n.d(1),n=t(h),n&&(n.c(),n.m(e.parentNode,e)))},d(h){h&&u(e),n.d(h)}}}function vt(o){let e,l,t,n="User Management",h,d,k='<i class="bi bi-arrow-clockwise"></i> Refresh',g,L,D,N,r,m,y,p,S,I=o[3].length+"",P,V,q=o[3].length!==1?"s":"",B,$,x,A,v,J,j,E=o[4]&&Fe(o);function K(f,_){return f[5]?dt:ut}let z=K(o),U=z(o);return A=new nt({props:{title:o[2],id:he,$$slots:{default:[pt]},$$scope:{ctx:o}}}),{c(){e=c("div"),l=c("div"),t=c("h2"),t.textContent=n,h=T(),d=c("button"),d.innerHTML=k,g=T(),E&&E.c(),L=T(),D=c("div"),N=c("div"),r=c("input"),m=T(),y=c("div"),p=c("div"),S=X("Total: "),P=X(I),V=X(" user"),B=X(q),$=T(),U.c(),x=T(),we(A.$$.fragment),this.h()},l(f){e=i(f,"DIV",{class:!0});var _=b(e);l=i(_,"DIV",{class:!0});var M=b(l);t=i(M,"H2",{"data-svelte-h":!0}),R(t)!=="svelte-1w9k0u8"&&(t.textContent=n),h=w(M),d=i(M,"BUTTON",{class:!0,"data-svelte-h":!0}),R(d)!=="svelte-1t5isil"&&(d.innerHTML=k),M.forEach(u),g=w(_),E&&E.l(_),L=w(_),D=i(_,"DIV",{class:!0});var O=b(D);N=i(O,"DIV",{class:!0});var Y=b(N);r=i(Y,"INPUT",{type:!0,class:!0,placeholder:!0}),Y.forEach(u),m=w(O),y=i(O,"DIV",{class:!0});var W=b(y);p=i(W,"DIV",{class:!0});var H=b(p);S=Q(H,"Total: "),P=Q(H,I),V=Q(H," user"),B=Q(H,q),H.forEach(u),W.forEach(u),O.forEach(u),$=w(_),U.l(_),_.forEach(u),x=w(f),Ce(A.$$.fragment,f),this.h()},h(){a(d,"class","btn btn-primary"),a(l,"class","d-flex justify-content-between align-items-center mb-4"),a(r,"type","text"),a(r,"class","form-control"),a(r,"placeholder","Search by email or name..."),a(N,"class","col-md-9"),a(p,"class","text-muted mt-2"),a(y,"class","col-md-3"),a(D,"class","row mb-3"),a(e,"class","user-management")},m(f,_){G(f,e,_),s(e,l),s(l,t),s(l,h),s(l,d),s(e,g),E&&E.m(e,null),s(e,L),s(e,D),s(D,N),s(N,r),re(r,o[0]),s(D,m),s(D,y),s(y,p),s(p,S),s(p,P),s(p,V),s(p,B),s(e,$),U.m(e,null),G(f,x,_),De(A,f,_),v=!0,J||(j=[le(d,"click",o[14]),le(r,"input",o[16])],J=!0)},p(f,[_]){f[4]?E?E.p(f,_):(E=Fe(f),E.c(),E.m(e,L)):E&&(E.d(1),E=null),_&1&&r.value!==f[0]&&re(r,f[0]),(!v||_&8)&&I!==(I=f[3].length+"")&&ee(P,I),(!v||_&8)&&q!==(q=f[3].length!==1?"s":"")&&ee(B,q),z===(z=K(f))&&U?U.p(f,_):(U.d(1),U=z(f),U&&(U.c(),U.m(e,null)));const M={};_&4&&(M.title=f[2]),_&33554434&&(M.$$scope={dirty:_,ctx:f}),A.$set(M)},i(f){v||(Ee(A.$$.fragment,f),v=!0)},o(f){ke(A.$$.fragment,f),v=!1},d(f){f&&(u(e),u(x)),E&&E.d(),U.d(),ye(A,f),J=!1,Je(j)}}}function bt(o){switch(o){case"root":return"danger";case"admin":return"primary";case"primary":case"relief-society":case"elders-quorum":case"teachers-quorum":case"young-women":case"sunday-school":return"info";case"authenticated":return"success";case"un-authenticated":return"secondary";default:return"secondary"}}const he="edit-user-drawer";function Ye(){document.querySelector(`[data-bs-target="#${he}"]`)?.click()}function gt(o,e,l){let t,n,h,d;const{stores:k,actions:g}=rt,{users:L,loading:D,error:N}=k;_e(o,L,v=>l(13,n=v)),_e(o,D,v=>l(5,d=v)),_e(o,N,v=>l(4,h=v));let r=null,m="",y="Edit User";Ke(()=>{g.fetchUsers()});function p(v){l(1,r={...v}),l(2,y=`Edit User: ${v.email}`)}function S(){l(1,r=null),Ye()}async function I(){if(!r)return;(await g.updateUser(r.id,{is_active:r.is_active,notes:r.notes,display_name:r.display_name})).success&&(Ye(),l(1,r=null))}const P=()=>g.fetchUsers(),V=()=>N.set(null);function q(){m=this.value,l(0,m)}const B=v=>p(v);function $(){r.display_name=this.value,l(1,r)}function x(){r.is_active=this.checked,l(1,r)}function A(){r.notes=this.value,l(1,r)}return o.$$.update=()=>{o.$$.dirty&8193&&l(3,t=n.filter(v=>m===""||v.email.toLowerCase().includes(m.toLowerCase())||v.display_name?.toLowerCase().includes(m.toLowerCase())))},[m,r,y,t,h,d,g,L,D,N,p,S,I,n,P,V,q,B,$,x,A]}class yt extends We{constructor(e){super(),Ze(this,e,gt,vt,Ge,{})}}function kt(o){let e,l;return e=new yt({}),{c(){we(e.$$.fragment)},l(t){Ce(e.$$.fragment,t)},m(t,n){De(e,t,n),l=!0},i(t){l||(Ee(e.$$.fragment,t),l=!0)},o(t){ke(e.$$.fragment,t),l=!1},d(t){ye(e,t)}}}function Et(o){let e,l;return e=new lt({props:{pageTitle:"Manage Users",$$slots:{default:[kt]},$$scope:{ctx:o}}}),{c(){we(e.$$.fragment)},l(t){Ce(e.$$.fragment,t)},m(t,n){De(e,t,n),l=!0},p(t,[n]){const h={};n&4&&(h.$$scope={dirty:n,ctx:t}),e.$set(h)},i(t){l||(Ee(e.$$.fragment,t),l=!0)},o(t){ke(e.$$.fragment,t),l=!1},d(t){ye(e,t)}}}function Dt(o,e,l){let t;const{stores:{currentUserHasPermission:n}}=ot();return _e(o,n,h=>l(1,t=h)),Ke(()=>{t(it.ManageUsers)||ct("/home")}),[n]}class St extends We{constructor(e){super(),Ze(this,e,Dt,Et,Ge,{})}}export{St as component};
