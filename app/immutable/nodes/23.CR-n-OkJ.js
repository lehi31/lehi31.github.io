import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{P as he}from"../chunks/BC0DqKG5.js";import{p as me,ai as we,aj as De,s as b,a as fe,c as n,D as te,E as re,m as e,r as s,f as K,u as d,B as k,F as Ee,n as Q,C as ae,as as se,R as Ae}from"../chunks/BWCcv1pC.js";import{i as _e}from"../chunks/BeNQ5BU7.js";import{p as G,i as H,e as oe,s as I,a as xe,b as ne}from"../chunks/KiCntiD6.js";import{f as U,a as g,c as Me}from"../chunks/DqgkBxsg.js";import{e as le,i as de}from"../chunks/CvOYN50o.js";import{h as ie,s as be,e as ce,j as ue,i as h,d as Re}from"../chunks/DIMYr76u.js";import{b as Oe}from"../chunks/Cr7RMNF9.js";import{R as V}from"../chunks/x-Ru6a1n.js";import{w as Te}from"../chunks/CuVcyAaV.js";const $e=!0,Ce=$e;function ve(a,r){const l=ie(a),o=ie(r);return+l==+o}const Ne=!0,it=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ne},Symbol.toStringTag,{value:"Module"})),Be={SacramentBreadAssignments:"Sacrament Bread Assignments"},Ie=["Folau Kaveinga","Tipi Kofe","Clenn Leituala","Vili Mapu","Keanu Naluai","Manase Soifua","Alex Tauteoli","Tray Teriipaia","Manoa Tuifua"],Ue=[{date:new Date(2026,3,5),event:"General Conference"},{date:new Date(2026,9,4),event:"General Conference"}],Le={Sundays:({start_date:a,until:r})=>new V({freq:V.WEEKLY,dtstart:a,until:r,byweekday:[V.SU]})},ke=(a,r)=>a(r).all(),Pe=a=>{const r=a.getMonth(),l=a.getFullYear();let o=0;for(let i=1;i<=31;i++){const w=new Date(l,r,i);if(w.getMonth()!==r)break;if(w.getDay()===0&&(o++,w.getDate()===a.getDate())){const D=["st","nd","rd","th"],p=o<=3?D[o-1]:D[3];return`${o}${p}`}}return""},je=Te([]);async function pe(a){const{data:r,error:l}=await be.from("assignments").select("*").eq("list_name",a).order("date");if(l)throw l;const o=r||[];return je.set(o),o}async function Fe(a,r,l){const{error:o}=await be.from("assignments").upsert([{list_name:a,date:r,overridden_member:l,updated_at:new Date().toISOString()}],{onConflict:"list_name, date"});if(o)throw o;await pe(a)}var qe=U('<td> <small class="fw-lighter"> </small></td> <td> <br/> <small class="fw-lighter">No Sacrament Services</small></td>',1),Ke=U('<i class="bi bi-pencil-square"></i>'),Qe=U('<td> <small class="fw-lighter"> </small></td> <td><div class="d-flex justify-content-between"><span> </span> <!></div></td>',1),Ge=U("<option> </option>"),He=U('<tr><td colspan="2"><div class="d-flex flex-column gap-2 p-2"><div>Change assignment to:</div> <select class="form-select form-control-sm"><option>Default</option><!></select> <div class="d-flex justify-content-end"><button class="btn btn-sm btn-primary">Save</button></div></div></td></tr>'),We=U("<tr><!></tr> <!>",1),Ye=U('<div class="table-responsive"><table class="table"><thead class="table-dark"><tr><td class="small">Date</td><td class="small">Bread Assignment</td></tr></thead><tbody></tbody></table></div>');function ze(a,r){me(r,!1);let l=G(r,"editable",8,!1),o=G(r,"listName",8,"Some List"),i=G(r,"names",24,()=>[]),w=G(r,"excludedDates",24,()=>[]),D=[],p=re([]);const F=async(c=new Date(2026,0,1,0,0,0),t=new Date(2026,11,31,0,0,0))=>{const E={start_date:c,until:t};D=ke(Le.Sundays,E);const A=new Date;A.setHours(0,0,0,0);const x=D.map((u,L)=>{const M=w().find(z=>ve(u,z.date));return{member:M?null:i()[L%i().length],date:u,sundayNumber:Pe(u),event:M?M.event:void 0,overridden_member:null}}).filter(u=>u.date>=A),Y=await pe(o());return x.map(u=>{const L=Y.find(M=>ve(new Date(M.date),u.date));return{...u,overridden_member:L?L.overridden_member:null}})},ye=c=>{l()&&se(y,e(y)[`row-${c}`]=!e(y)[`row-${c}`])},Se=async(c,t)=>{const E=c.overridden_member||null;await Fe(o(),c.date.toISOString(),E),se(y,e(y)[t]=!e(y)[t]),F().then(A=>{te(p,A)})},y=re({});we(()=>Ce,()=>{F().then(c=>{te(p,c)})}),De(),_e();var W=Ye(),X=n(W),Z=b(n(X));le(Z,5,()=>e(p),de,(c,t,E)=>{var A=We(),x=K(A),Y=n(x);{var u=v=>{var m=qe(),f=K(m),S=n(f),_=b(S),R=n(_);s(_),s(f);var O=b(f,2),T=n(O);Ee(3),s(O),k(($,C)=>{I(S,`${$??""} `),I(R,`${e(t),d(()=>e(t).sundayNumber)??""}
								${C??""}`),I(T,`${e(t),d(()=>e(t).event??"")??""} `)},[()=>(Q(h),e(t),d(()=>h(e(t).date,"MMM dd"))),()=>(Q(h),e(t),d(()=>h(e(t).date,"EEEE")))]),g(v,m)},L=v=>{var m=Qe(),f=K(m),S=n(f),_=b(S),R=n(_);s(_),s(f);var O=b(f,2),T=n(O),$=n(T),C=n($);s($);var N=b($,2);{var q=B=>{var P=Ke();g(B,P)};H(N,B=>{l()&&B(q)})}s(T),s(O),k((B,P)=>{I(S,`${B??""} `),I(R,`${e(t),d(()=>e(t).sundayNumber)??""}
								${P??""}`),I(C,`${e(t),d(()=>e(t).overridden_member?e(t).overridden_member:e(t).member)??""}
									${e(t),d(()=>e(t).overridden_member?"*":"")??""}`)},[()=>(Q(h),e(t),d(()=>h(e(t).date,"MMM dd"))),()=>(Q(h),e(t),d(()=>h(e(t).date,"EEEE")))]),g(v,m)};H(Y,v=>{e(t),d(()=>e(t)?.event)?v(u):v(L,!1)})}s(x);var M=b(x,2);{var z=v=>{var m=He(),f=n(m),S=n(f),_=b(n(S),2);k(()=>{e(t),ae(()=>{i()})});var R=n(_);R.value=R.__value="";var O=b(R);le(O,1,i,de,(C,N)=>{var q=Me(),B=K(q);{var P=J=>{var j=Ge(),ge=n(j,!0);s(j);var ee={};k(()=>{I(ge,e(N)),ee!==(ee=e(N))&&(j.value=(j.__value=e(N))??"")}),g(J,j)};H(B,J=>{e(N),e(t),d(()=>e(N)!==e(t).member)&&J(P)})}g(C,q)}),s(_);var T=b(_,2),$=n(T);s(T),s(S),s(f),s(m),k(()=>ce(m,1,ue((e(y),d(()=>e(y)[`row-${E}`]?"table-light":"d-none"))))),Oe(_,()=>e(t).overridden_member,C=>(e(t).overridden_member=C,ae(()=>e(p)))),oe("click",$,()=>Se(e(t),`row-${E}`)),g(v,m)};H(M,v=>{l()&&v(z)})}k(()=>ce(x,1,ue((e(t),d(()=>e(t).member===null?"table-secondary":""))))),oe("click",x,()=>ye(E)),g(c,A)}),s(Z),s(X),s(W),g(a,W),fe()}function Je(a,r){me(r,!1);const l=()=>ne(D,"$currentUserIsRootOrAdmin",i),o=()=>ne(p,"$currentUserIsTeachersQuorum",i),[i,w]=xe(),{stores:{currentUserIsRootOrAdmin:D,currentUserIsTeachersQuorum:p}}=Re();_e();{let F=Ae(()=>l()||o());ze(a,{get editable(){return e(F)},get listName(){return Be.SacramentBreadAssignments},get names(){return Ie},get excludedDates(){return Ue}})}fe(),w()}function ct(a){he(a,{pageTitle:"Assignments",children:(r,l)=>{Je(r,{})},$$slots:{default:!0}})}export{ct as component,it as universal};
