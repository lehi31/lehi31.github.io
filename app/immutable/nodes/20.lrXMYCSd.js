import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{P as _e}from"../chunks/BhSu20_V.js";import{w as R,o as se}from"../chunks/B8gJkoMb.js";import{p as B,c as x,t as A,a as G,aF as J,g as e,U as I,s as w,r as _,u as U,a8 as h,ay as O,az as ie,E as L,aa as oe,f as de}from"../chunks/D6GkHfO-.js";import{i as q,e as V,s as P}from"../chunks/DYmw-k_K.js";import{e as be,i as he}from"../chunks/COMoFu8N.js";import{f as M,a as k,t as ye}from"../chunks/D8wZRsgK.js";import{r as X,s as re}from"../chunks/BzM8VPE5.js";import{b as ce,a as xe}from"../chunks/6wL3GoW6.js";import{i as ee}from"../chunks/XlJfi8GN.js";import{p as y,s as Se,a as ne}from"../chunks/C8uFvBRH.js";import{b as we,c as H}from"../chunks/vFKQls-f.js";import{D as Te}from"../chunks/DtiA4st8.js";import{s as $e}from"../chunks/BBkanyvx.js";import{b as Ne}from"../chunks/CUNSJrQ4.js";import{S as Ce}from"../chunks/CCPPWneG.js";import{t as le}from"../chunks/r7-tBYgy.js";import{S as ue}from"../chunks/iFrONd-z.js";import{b as Ie}from"../chunks/RVChvXYJ.js";import{g as ke}from"../chunks/BE3xj6IP.js";const Me=!0,yt=Object.freeze(Object.defineProperty({__proto__:null,prerender:Me},Symbol.toStringTag,{value:"Module"}));async function ze(){const{data:d,error:a}=await we.from("callings").select("*");if(a)throw a;return d?.length?d:[]}const De=()=>{const d=R(!1),a=R(!1),f=R([]);return{stores:{ready:d,loading:a,data:f},actions:{init:async()=>{const m=await ze();m?.length&&f.set(m)}}}},Oe=()=>De();function Pe(d,a,f){var l=f||{},m=l.noTrailing,t=m===void 0?!1:m,s=l.noLeading,c=s===void 0?!1:s,p=l.debounceMode,r=p===void 0?void 0:p,u,v=!1,S=0;function b(){u&&clearTimeout(u)}function g(T){var i=T||{},o=i.upcomingOnly,n=o===void 0?!1:o;b(),v=!n}function C(){for(var T=arguments.length,i=new Array(T),o=0;o<T;o++)i[o]=arguments[o];var n=this,z=Date.now()-S;if(v)return;function D(){S=Date.now(),a.apply(n,i)}function E(){u=void 0}!c&&r&&!u&&D(),b(),r===void 0&&z>d?c?(S=Date.now(),t||(u=setTimeout(r?E:D,d))):D():t!==!0&&(u=setTimeout(r?E:D,r===void 0?d-z:d))}return C.cancel=g,C}function Fe(d,a,f){var l={},m=l.atBegin,t=m===void 0?!1:m;return Pe(d,a,{debounceMode:t!==!1})}var Le=M('<span class="position-absolute top-0 start-100 translate-middle p-2 bg-danger border border-light rounded-circle"><span class="visually-hidden">Item not saved</span></span>'),Ae=M('<div class="d-flex flex-column gap-4"><!> <div class="d-flex justify-content-end align-items-center gap-2 flex-row"><small> </small> <span><!></span> <button class="btn btn-primary position-relative"><span>Save</span> <!></button></div></div>');function qe(d,a){B(a,!1);let f=y(a,"valueChanged",8,!1),l=y(a,"loading",8,!1),m=y(a,"save",8),t=I({message:"",type:"info"});const s=n=>{n.type=n.type?n.type:"info",n.message=n.message?n.message:"",J(t,e(t).message=n.message),J(t,e(t).type=n.type),n.duration&&setTimeout(()=>{J(t,e(t).message="")},n.duration)};var c={setNotice:s},p=Ae(),r=x(p);$e(r,a,"default",{});var u=w(r,2),v=x(u),S=x(v,!0);_(v);var b=w(v,2);let g;var C=x(b);Ce(C,{size:"xs"}),_(b);var T=w(b,2),i=w(x(T),2);{var o=n=>{var z=Le();k(n,z)};q(i,n=>{f()&&n(o)})}return _(T),_(u),_(p),A(()=>{H(v,1,`fw-lighter fst-italic text-${e(t),U(()=>e(t).type)??""}`),P(S,(e(t),U(()=>e(t).message))),g=H(b,1,"",null,g,{"d-none":!l()})}),V("click",T,function(...n){m()?.apply(this,n)}),k(d,p),Ne(a,"setNotice",s),G(c)}function Ee(d,a){let f=y(a,"organization",12),l=y(a,"loading",8),m=y(a,"disabled",8);const s=["Elders Quorum","Primary","Relief Society","Sunday School","Young Men","Young Women"].map(c=>({key:c,value:c}));ue(d,{get options(){return s},get disabled(){return m()},label:"Organization",helperText:"",get loading(){return l()},get value(){return f()},set value(c){f(c)},$$legacy:!0})}var je=M('<small class="fw-lighter fst-italic"> </small>'),Re=M('<div class="d-flex flex-column gap-2"><div> </div> <input type="text"/> <!></div>');function K(d,a){let f=y(a,"label",8,""),l=y(a,"name",8,""),m=y(a,"helperText",8,""),t=y(a,"placeholder",8,""),s=y(a,"value",12),c=y(a,"loading",8),p=y(a,"required",8),r=y(a,"isInvalid",8),u=I();var v=Re(),S=x(v),b=x(S,!0);_(S);var g=w(S,2);X(g);let C;Ie(g,o=>h(u,o),()=>e(u));var T=w(g,2);{var i=o=>{var n=je(),z=x(n,!0);_(n),A(()=>P(z,m())),k(o,n)};q(T,o=>{m()&&o(i)})}_(v),A(()=>{P(b,f()),re(g,"name",l()),C=H(g,1,"form-control",null,C,{"is-invalid":r()}),re(g,"placeholder",t()),g.disabled=c(),g.required=p()}),V("focus",g,()=>e(u).select()),ce(g,s),k(d,v)}var Be=M('<div class="d-flex gap-2"><!> <!></div>'),Ge=M('<div class="d-flex flex-column gap-2"><div>Member</div> <!> <div class="form-check"><input class="form-check-input" type="checkbox" id="is-new-member"/> <label class="form-check-label" for="is-new-member">Member not found in the list, lets create a new record.</label></div> <!></div>');function Qe(d,a){B(a,!1);const f=I(),l=I(),m=I();let t=y(a,"member",12),s=y(a,"loading",8),c=I([]),p=I(""),r=I(),u=I("");se(async()=>{h(c,await ke()),h(u,e(f))}),O(()=>(L(t()),e(p)),()=>{(t().last_name??"")!==e(p)&&h(p,t().last_name??"")}),O(()=>e(p),()=>{t(t().last_name=e(p),!0)}),O(()=>L(t()),()=>{h(f,`${t().first_name||""} ${t().last_name||""}`.trim())}),O(()=>L(t()),()=>{h(l,t().first_name==="")}),O(()=>e(c),()=>{h(m,e(c)?.length?e(c).map(i=>{const o=`${i.first_name} ${i.last_name||""}`.trim();return{key:o,value:o}}):[])}),O(()=>(e(u),e(r)),()=>{if(e(u)&&!e(r)){const i=e(u).split(" ");t(t().first_name=i[0]||"",!0),t(t().last_name=i.slice(1).join(" ")||"",!0)}}),ie(),ee();var v=Ge(),S=w(x(v),2);ue(S,{get options(){return e(m)},get loading(){return s()},get disabled(){return e(r)},helperText:"",get value(){return e(u)},set value(i){h(u,i)},$$legacy:!0});var b=w(S,2),g=x(b);X(g),oe(2),_(b);var C=w(b,2);{var T=i=>{var o=Be(),n=x(o);K(n,{placeholder:"First name",name:"member-first-name",get isInvalid(){return e(l)},get loading(){return s()},helperText:"e.g., Brother John",required:!0,get value(){return t().first_name},set value(D){t(t().first_name=D,!0)},$$legacy:!0});var z=w(n,2);K(z,{placeholder:"Last name",name:"member-last-name",isInvalid:!1,get loading(){return s()},helperText:"e.g., Smith",required:!1,get value(){return e(p)},set value(D){h(p,D)},$$legacy:!0}),_(o),k(i,o)};q(C,i=>{e(r)&&i(T)})}_(v),xe(g,()=>e(r),i=>h(r,i)),k(d,v),G()}var We=M("<!> <!> <!>",1);function Ye(d,a){B(a,!1);const f=I();let l=y(a,"calling",12),m=y(a,"member",8),t=I(!1),s=I(!1),c=I();const p=async()=>{if(!e(t)){e(c)({message:"Sorry nothing has changed, therefore, there is nothing to save.",duration:700});return}try{e(c)({message:"Saving ..."}),h(s,!0),le("set_sacrament_testimony_success","interaction","Set Successful",1),setTimeout(()=>{h(s,!1),e(c)({message:"Saved",duration:3e3,type:"success"})},800)}catch(r){le("set_sacrament_testimony_failed","interaction","Set Failed",1),setTimeout(()=>{h(s,!1),console.error("Sacrament Program update failed",r),e(c)({message:"Save failed, please reload browser and try again.",duration:7e3,type:"danger"})},800)}};O(()=>L(l()),()=>{h(f,l().name!=="")}),ie(),ee(),qe(d,{save:p,get loading(){return e(s)},set loading(r){h(s,r)},get valueChanged(){return e(t)},set valueChanged(r){h(t,r)},get setNotice(){return e(c)},set setNotice(r){h(c,r)},children:(r,u)=>{var v=We(),S=de(v);K(S,{label:"Name",name:"calling-name",placeholder:"Calling Name",get loading(){return e(s)},get isInvalid(){return e(f)},helperText:"Elders Quorum Secretary, Primary Teacher, etc",required:!0,get value(){return l().name},set value(C){l(l().name=C,!0)},$$legacy:!0});var b=w(S,2);Ee(b,{get loading(){return e(s)},get disabled(){return e(s)},get organization(){return L(l()),U(()=>l().organization)}});var g=w(b,2);Qe(g,{get loading(){return e(s)},get member(){return m()}}),k(r,v)},$$slots:{default:!0},$$legacy:!0}),G()}var Ze=M('<i slot="label" class="bi bi-plus"></i>'),Je=M("<tr><td> </td><td> </td><td><!></td><td></td></tr>"),Ue=M('<table class="table"><thead><tr><th scope="col">Organization</th><th scope="col">Calling</th><th scope="col">Member</th><th scope="col">Actions</th></tr></thead><tbody></tbody></table>'),He=M('<div class="p-4 d-block bg-dark-subtle">No Data Found</div>'),Ke=M('<div class="d-flex justify-content-end gap-3"><div class="w-50"><input class="form-control" type="text" placeholder="search"/></div> <!></div> <!>',1);function Ve(d,a){B(a,!1);const f=()=>ne(c,"$data",m),l=()=>ne(u,"$gridData",m),[m,t]=Se(),{stores:{loading:s,data:c},actions:{init:p}}=Oe();let r=I();const u=R([]),v=()=>{let $=f().map(N=>({...N,searchStr:`${N.name}${N.organization}${N.calling_records?.length?`${N.calling_records[0]?.member?.first_name||""} ${N.calling_records[0]?.member?.last_name||""}`:""}`.toLowerCase()}));e(r)?.length&&($=$.filter(N=>N.searchStr.includes(e(r).toLowerCase()))),u.set($)},S=Fe(400,()=>{s.set(!0),v(),s.set(!1)});se(async()=>{await p(),v()});let b={name:"",organization:"",sort_order:1},g={first_name:""};ee();var C=Ke(),T=de(C),i=x(T),o=x(i);X(o),_(i);var n=w(i,2);Te(n,{drawerTitle:"New Calling",id:"new-calling-trigger-button",children:($,N)=>{Ye($,{get member(){return g},get calling(){return b}})},$$slots:{default:!0,label:($,N)=>{var j=Ze();k($,j)}}}),_(T);var z=w(T,2);{var D=$=>{var N=Ue(),j=w(x(N));be(j,5,l,he,(me,F)=>{var Q=Je(),W=x(Q),ge=x(W,!0);_(W);var Y=w(W),fe=x(Y,!0);_(Y);var te=w(Y),ve=x(te);{var pe=Z=>{var ae=ye();A(()=>P(ae,`${e(F).calling_records[0].member.first_name??""}
							${(e(F).calling_records[0].member.last_name||"")??""}`)),k(Z,ae)};q(ve,Z=>{e(F).calling_records?.length&&Z(pe)})}_(te),oe(),_(Q),A(()=>{P(ge,e(F).organization),P(fe,e(F).name)}),k(me,Q)}),_(j),_(N),k($,N)},E=$=>{var N=He();k($,N)};q(z,$=>{l()?.length?$(D):$(E,!1)})}V("keyup",o,S),ce(o,()=>e(r),$=>h(r,$)),k(d,C),G(),t()}function xt(d){_e(d,{pageTitle:"Callings",children:(a,f)=>{Ve(a,{})},$$slots:{default:!0}})}export{xt as component,yt as universal};
