import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{w as ie,g as Je,d as ne,o as Pe}from"../chunks/DNltCNNq.js";import{p as ve,aj as Q,D as f,E as C,g as r,ak as we,s as d,c as a,r as t,F as Z,t as re,a as ue,f as de,w as z,u as L,am as He,an as Ve}from"../chunks/CPcjNedw.js";import{f as $,a as b,t as Re,c as ye}from"../chunks/BYls_3XS.js";import{b as ee,i as W,s as A,a as xe,p as Ie,e as Le}from"../chunks/BafKDQNK.js";import{i as fe}from"../chunks/DPzVpBhB.js";import{P as ze}from"../chunks/DM-E9Ywk.js";import{d as Qe,s as Ce,r as qe}from"../chunks/DaYu9oYu.js";import{e as ge,b as _e,f as Xe,g as Ze}from"../chunks/DcgEMs3z.js";import{e as Be,i as Ee}from"../chunks/B-ARnQOI.js";import{b as er,a as rr}from"../chunks/DSiQ23iJ.js";import{b as ar}from"../chunks/GyUl0P7I.js";import{p as tr}from"../chunks/CuWLd2je.js";const Ne=ie([]),Ue=ie([]);let he=!1,be=!1;async function sr(){if(he)return Je(Ne);he=!0;try{const{data:s,error:e}=await ge.from("bom_reading_schedule").select("*").order("day_number",{ascending:!0});if(e)throw console.error("[API] Get BOM reading schedule failed:",e),new Error(`Failed to load reading schedule: ${e.message}`);const o=s||[];return Ne.set(o),setTimeout(()=>he=!1,800),o}catch(s){throw he=!1,console.error("[API] Unexpected error fetching BOM reading schedule:",s),s}}async function ke(){if(be)return Je(Ue);be=!0;try{const{data:s,error:e}=await ge.from("bom_reading_entries").select("*").order("created_at",{ascending:!1});if(e)throw console.error("[API] Get BOM reading entries failed:",e),new Error(`Failed to load reading entries: ${e.message}`);const o=s||[];return Ue.set(o),setTimeout(()=>be=!1,800),o}catch(s){throw be=!1,console.error("[API] Unexpected error fetching BOM reading entries:",s),s}}async function or(s){try{const{data:e,error:o}=await ge.from("bom_reading_entries").insert([s]).select();if(o)throw console.error("[API] Create BOM reading entry failed:",o),o.message.includes("JWT")?new Error("Authentication error - please try reloading the page"):o.code==="42501"?new Error("Permission denied - please check your authentication"):o.code==="23505"?new Error("This entry already exists"):o.code==="23503"?new Error("Invalid chapter reference"):o.message.includes("fetch")||o.message.includes("Failed to fetch")?new Error("Network error - please check your connection and try again"):new Error(`Failed to save entry: ${o.message}`);return await ke(),console.log("[API] BOM reading entry created successfully"),e?e[0]:void 0}catch(e){throw console.error("[API] Unexpected error creating BOM reading entry:",e),e}}async function nr(s,e){try{const{data:o,error:w}=await ge.from("bom_reading_entries").update(e).eq("id",s).select();if(w)throw console.error("[API] Update BOM reading entry failed:",w),new Error(`Failed to update entry: ${w.message}`);return await ke(),console.log("[API] BOM reading entry updated successfully"),o?o[0]:void 0}catch(o){throw console.error("[API] Unexpected error updating BOM reading entry:",o),o}}async function ir(s){try{const{error:e}=await ge.from("bom_reading_entries").delete().eq("id",s);if(e)throw console.error("[API] Delete BOM reading entry failed:",e),new Error(`Failed to delete entry: ${e.message}`);await ke(),console.log("[API] BOM reading entry deleted successfully")}catch(e){throw console.error("[API] Unexpected error deleting BOM reading entry:",e),e}}function dr(s){const e=new Map;return s.forEach(o=>{const w=e.get(o.chapter_ref)||0;e.set(o.chapter_ref,w+1)}),e}let ce=null;const lr=()=>{const s=ie(!1),e=ie(!1),o=ie([]),w=ie([]),E=ne(w,i=>dr(i)),n=ne(o,i=>{const p=new Date().toISOString().split("T")[0];return i.find(v=>v.date===p)||null}),g=ne([o,E],([i,p])=>{const v=new Date().toISOString().split("T")[0];return i.map(h=>({chapter_ref:h.chapter_ref,day_number:h.day_number,date:h.date,book_name:h.book_name,chapter_number:h.chapter_number,read_count:p.get(h.chapter_ref)||0,is_today:h.date===v,is_past:h.date<v,is_future:h.date>v}))}),M=ne(o,i=>i.length),q=ne(E,i=>{let p=0;return i.forEach(v=>{v>0&&p++}),p}),S=ne([M,q],([i,p])=>i>0?Math.round(p/i*100):0),m=async()=>{e.set(!0);try{const[i,p]=await Promise.all([sr(),ke()]);o.set(i),w.set(p),s.set(!0)}catch(i){console.error("[State] Failed to reload BOM reading data:",i),s.set(!0)}finally{e.set(!1)}};return ce={stores:{ready:s,loading:e,schedule:o,entries:w,progressByChapter:E,todaysReading:n,chapterProgress:g,totalChapters:M,chaptersReadByAnyone:q,overallProgress:S},actions:{reload:m,apiCreate:async i=>{const p=await or(i);return await m(),p},apiUpdate:async(i,p)=>{await nr(i,p),await m()},apiDelete:async i=>{await ir(i),await m()}}},ce},me=()=>ce?.stores&&Object.keys(ce.stores).length>0?ce:lr();var cr=$(`<div class="card bom-reading-progress svelte-1yqd1va"><div class="card-header bg-primary text-white"><h4 class="mb-0"><i class="bi bi-graph-up me-2"></i> Ward Progress</h4></div> <div class="card-body"><div class="mb-4"><div class="d-flex justify-content-between align-items-center mb-2"><span class="fw-bold">Overall Completion</span> <span class="badge bg-primary fs-6"> </span></div> <div class="progress svelte-1yqd1va" style="height: 30px;"><div class="progress-bar bg-success progress-bar-striped progress-bar-animated svelte-1yqd1va" role="progressbar" aria-valuemin="0" aria-valuemax="100"><!></div></div> <small class="text-muted mt-1 d-block"> </small></div> <div class="row text-center g-3"><div class="col-6 col-md-3"><div class="stat-card p-3 border rounded svelte-1yqd1va"><i class="bi bi-calendar3 text-primary fs-2 d-block mb-2"></i> <div class="fs-4 fw-bold"> </div> <small class="text-muted">Total Days</small></div></div> <div class="col-6 col-md-3"><div class="stat-card p-3 border rounded svelte-1yqd1va"><i class="bi bi-book text-info fs-2 d-block mb-2"></i> <div class="fs-4 fw-bold"> </div> <small class="text-muted">BOM Chapters</small></div></div> <div class="col-6 col-md-3"><div class="stat-card p-3 border rounded svelte-1yqd1va"><i class="bi bi-check-circle text-success fs-2 d-block mb-2"></i> <div class="fs-4 fw-bold"> </div> <small class="text-muted">Chapters Read</small></div></div> <div class="col-6 col-md-3"><div class="stat-card p-3 border rounded svelte-1yqd1va"><i class="bi bi-people-fill text-warning fs-2 d-block mb-2"></i> <div class="fs-4 fw-bold"> </div> <small class="text-muted">Total Readings</small></div></div></div> <div class="alert alert-info mt-4 mb-0" role="alert"><i class="bi bi-info-circle me-2"></i> <small>This progress shows how many chapters have been read by <strong>anyone</strong> in the ward. Each
				person can mark chapters as read anonymously.</small></div></div></div>`);function vr(s,e){ve(e,!1);const o=()=>ee(i,"$entries",g),w=()=>ee(p,"$schedule",g),E=()=>ee(y,"$totalChapters",g),n=()=>ee(D,"$chaptersReadByAnyone",g),[g,M]=xe(),q=C(),S=C(),m=C(),l=C(),{stores:{totalChapters:y,chaptersReadByAnyone:D,entries:i,schedule:p}}=me();Q(()=>o(),()=>{f(q,o().length)}),Q(()=>w(),()=>{f(S,w().filter(J=>J.book_name!=="Review").length)}),Q(()=>(w(),o()),()=>{f(m,w().filter(J=>J.book_name!=="Review").filter(J=>o().some(se=>se.chapter_ref===J.chapter_ref)).length)}),Q(()=>(r(S),r(m)),()=>{f(l,r(S)>0?Math.round(r(m)/r(S)*100):0)}),we(),fe();var v=cr(),h=d(a(v),2),k=a(h),R=a(k),K=d(a(R),2),G=a(K);t(K),t(R);var I=d(R,2),N=a(I),u=a(N);{var _=J=>{var se=Re();re(()=>A(se,`${r(l)??""}%`)),b(J,se)};W(u,J=>{r(l)>10&&J(_)})}t(N),t(I);var H=d(I,2),P=a(H);t(H),t(k);var U=d(k,2),O=a(U),ae=a(O),pe=d(a(ae),2),Se=a(pe,!0);t(pe),Z(2),t(ae),t(O);var c=d(O,2),x=a(c),B=d(a(x),2),j=a(B,!0);t(B),Z(2),t(x),t(c);var Y=d(c,2),F=a(Y),T=d(a(F),2),X=a(T,!0);t(T),Z(2),t(F),t(Y);var oe=d(Y,2),te=a(oe),V=d(a(te),2),le=a(V,!0);t(V),Z(2),t(te),t(oe),t(U),Z(2),t(h),t(v),re(()=>{A(G,`${r(l)??""}%`),Qe(N,`width: ${r(l)??""}%`),Ce(N,"aria-valuenow",r(l)),A(P,`${r(m)??""} of ${r(S)??""} chapters read by at least one person`),A(Se,E()),A(j,r(S)),A(X,n()),A(le,r(q))}),b(s,v),ue(),M()}const Me="bom_reading_submissions",Oe="bom_reading_entry_ids";function Te(){if(typeof localStorage>"u")return new Set;try{const s=localStorage.getItem(Me);if(!s)return new Set;const e=JSON.parse(s);return new Set(Array.isArray(e)?e:[])}catch(s){return console.error("[ReadingTracker] Error reading from localStorage:",s),new Set}}function ur(s){return Te().has(s)}function fr(s){if(typeof localStorage>"u"){console.warn("[ReadingTracker] localStorage not available");return}try{const e=Te();e.add(s),localStorage.setItem(Me,JSON.stringify([...e]))}catch(e){console.error("[ReadingTracker] Error writing to localStorage:",e)}}function Ae(){if(typeof localStorage>"u")return{};try{const s=localStorage.getItem(Oe);if(!s)return{};const e=JSON.parse(s);return typeof e=="object"&&e!==null?e:{}}catch(s){return console.error("[ReadingTracker] Error reading entry IDs from localStorage:",s),{}}}function gr(s){return Ae()[s]??null}function mr(s,e){if(typeof localStorage>"u"){console.warn("[ReadingTracker] localStorage not available");return}try{const o=Ae();o[s]=e,localStorage.setItem(Oe,JSON.stringify(o))}catch(o){console.error("[ReadingTracker] Error storing entry ID:",o)}}function pr(s){if(typeof localStorage>"u"){console.warn("[ReadingTracker] localStorage not available");return}try{const e=Te();e.delete(s),localStorage.setItem(Me,JSON.stringify([...e]));const o=Ae();delete o[s],localStorage.setItem(Oe,JSON.stringify(o))}catch(e){console.error("[ReadingTracker] Error writing to localStorage:",e)}}var hr=$('<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>'),br=$('<i class="bi bi-check-circle-fill me-1"></i> Undo',1),yr=$('<i class="bi bi-check-circle me-1"></i> Read',1),_r=$('<div class="alert alert-danger alert-sm mt-2 mb-0 svelte-18cjesl" role="alert"><i class="bi bi-exclamation-triangle-fill me-1"></i> </div>'),wr=$('<div class="bom-reading-entry-form svelte-18cjesl"><div class="d-flex align-items-center gap-2 gap-md-3"><button type="button"><!></button></div> <!></div>');function xr(s,e){ve(e,!1);const o=()=>ee(M,"$loading",w),[w,E]=xe();let n=Ie(e,"chapterRef",8),g=Ie(e,"onSuccess",8,void 0);const{stores:{loading:M},actions:{apiCreate:q,apiDelete:S}}=me();let m=C(!1),l=C(""),y=C(!1),D=C(null);Pe(()=>{f(y,ur(n()))});async function i(){if(r(y)){f(l,"You have already marked this chapter as read");return}try{f(m,!0),f(l,"");const u={date:new Date().toISOString().split("T")[0],chapter_ref:n()},_=await q(u);_&&_.id&&(fr(n()),mr(n(),_.id),f(y,!0),g()&&g()())}catch(u){f(l,u instanceof Error?u.message:"Failed to save reading"),console.error("[BomReadingEntryForm] Error:",u)}finally{f(m,!1)}}async function p(){const u=gr(n());if(!u){f(l,"Cannot undo - entry ID not found");return}try{f(m,!0),f(l,""),await S(u),pr(n()),f(y,!1),g()&&g()()}catch(_){f(l,_ instanceof Error?_.message:"Failed to undo"),console.error("[BomReadingEntryForm] Undo error:",_)}finally{f(m,!1)}}Q(()=>(r(l),r(D)),()=>{r(l)&&(r(D)&&clearTimeout(r(D)),f(D,setTimeout(()=>{f(l,""),f(D,null)},1e3)))}),we(),fe();var v=wr(),h=a(v),k=a(h),R=a(k);{var K=u=>{var _=hr();b(u,_)},G=u=>{var _=ye(),H=de(_);{var P=O=>{var ae=br();Z(),b(O,ae)},U=O=>{var ae=yr();Z(),b(O,ae)};W(H,O=>{r(y)?O(P):O(U,!1)},!0)}b(u,_)};W(R,u=>{r(m)?u(K):u(G,!1)})}t(k),t(h);var I=d(h,2);{var N=u=>{var _=_r(),H=d(a(_));t(_),re(()=>A(H,` ${r(l)??""}`)),b(u,_)};W(I,u=>{r(l)&&u(N)})}t(v),re(()=>{_e(k,1,`btn btn-sm ${r(y)?"btn-outline-danger":"btn-primary"}`,"svelte-18cjesl"),k.disabled=r(m)||o(),Ce(k,"title",r(y)?"Undo marking this chapter as read":"Mark this chapter as read")}),Le("click",k,function(...u){(r(y)?p:i)?.apply(this,u)}),b(s,v),ue(),E()}var kr=$('<span class="badge bg-info text-dark svelte-x251hv"><i class="bi bi-calendar-day"></i> Today</span>'),Sr=$('<i class="bi bi-check-circle"></i> ',1),$r=$('<i class="bi bi-circle"></i> 0',1),Br=$('<div><div class="card-body p-2"><div class="d-flex align-items-baseline gap-2 flex-wrap mb-2"><small class="text-muted"> </small> <span> </span> <!></div> <div class="d-flex align-items-center justify-content-between gap-2"><small class="text-muted"> </small> <div class="d-flex align-items-center gap-2 flex-shrink-0"><span><!></span> <!></div></div></div></div>');function je(s,e){ve(e,!1);const o=C(),w=C(),E=C();let n=Ie(e,"progress",8);const g=!1,{actions:{reload:M}}=me();Q(()=>z(n()),()=>{f(o,Xe(tr(n().date,"yyyy-MM-dd",new Date),"MMM d, yyyy (EEE)"))}),Q(()=>z(n()),()=>{f(w,n().is_today?"border-primary border-2":n().is_past?"past-reading":"")}),Q(()=>z(n()),()=>{f(E,n().read_count>0?"bg-success":"bg-secondary")}),we();var q={compact:g};fe();var S=Br(),m=a(S),l=a(m),y=a(l),D=a(y);t(y);var i=d(y,2),p=a(i,!0);t(i);var v=d(i,2);{var h=P=>{var U=kr();b(P,U)};W(v,P=>{z(n()),L(()=>n().is_today)&&P(h)})}t(l);var k=d(l,2),R=a(k),K=a(R,!0);t(R);var G=d(R,2),I=a(G),N=a(I);{var u=P=>{var U=Sr(),O=d(de(U));re(()=>A(O,` ${z(n()),L(()=>n().read_count)??""}`)),b(P,U)},_=P=>{var U=$r();Z(),b(P,U)};W(N,P=>{z(n()),L(()=>n().read_count>0)?P(u):P(_,!1)})}t(I);var H=d(I,2);return xr(H,{get chapterRef(){return z(n()),L(()=>n().chapter_ref)},onSuccess:()=>M()}),t(G),t(k),t(m),t(S),re(()=>{_e(S,1,`card bom-day-card ${r(w)??""} mb-2`,"svelte-x251hv"),A(D,`Day ${z(n()),L(()=>n().day_number)??""}`),_e(i,1,`fw-semibold ${z(n()),L(()=>n().is_today?"text-primary":"")??""}`,"svelte-x251hv"),A(p,(z(n()),L(()=>n().chapter_ref))),A(K,r(o)),_e(I,1,`badge ${r(E)??""}`,"svelte-x251hv")}),b(s,S),ar(e,"compact",g),ue(q)}var Er=$('<div class="alert alert-warning" role="alert"><i class="bi bi-exclamation-triangle me-2"></i> No readings found for the selected filter.</div>'),Rr=$('<div class="book-group mb-4 svelte-nbte28"><h4 class="border-bottom pb-2 mb-3 svelte-nbte28"><i class="bi bi-book me-2"></i> <span class="badge bg-secondary ms-2"> </span></h4> <!></div>'),Ir=$("<div><!></div>"),Pr=$('<div class="text-center mt-4"><button class="btn btn-outline-primary"><!></button></div>'),Cr=$('<div class="text-center mt-2"><p class="text-muted mb-0"><i class="bi bi-info-circle me-1"></i> </p></div>'),Mr=$('<div class="bom-reading-schedule svelte-nbte28"><div class="card mb-3"><div class="card-body"><div class="row g-3 align-items-end"><div class="col-md-8"><label for="search" class="form-label fw-bold">Search</label> <div class="input-group"><span class="input-group-text"><i class="bi bi-search"></i></span> <input type="text" class="form-control" id="search" placeholder="Search chapters or books..."/></div></div> <div class="col-md-4"><div class="form-check"><input class="form-check-input" type="checkbox" id="groupByBook"/> <label class="form-check-label" for="groupByBook">Group by Book</label></div></div></div></div></div> <div class="reading-list svelte-nbte28"><!></div> <!> <!></div>');function Or(s,e){ve(e,!1);const o=()=>ee(q,"$chapterProgress",E),w=()=>ee(S,"$todaysReading",E),[E,n]=xe(),g=C(),M=C(),{stores:{chapterProgress:q,todaysReading:S}}=me();let m=C(""),l=C(!1),y=C(!1);function D(c,x,B){let j=c;if(B||(j=j.filter(Y=>!Y.is_future)),x){const Y=x.toLowerCase();j=j.filter(F=>F.chapter_ref.toLowerCase().includes(Y)||F.book_name.toLowerCase().includes(Y))}return j}function i(c){const x={};return c.forEach(B=>{x[B.book_name]||(x[B.book_name]=[]),x[B.book_name].push(B)}),x}Pe(()=>{w()&&setTimeout(()=>{const c=document.getElementById("today-reading");c&&c.scrollIntoView({behavior:"smooth",block:"center"})},500)}),Q(()=>(o(),r(m),r(y)),()=>{f(g,D(o(),r(m),r(y)))}),Q(()=>(r(l),r(g)),()=>{f(M,r(l)?i(r(g)):null)}),we(),fe();var p=Mr(),v=a(p),h=a(v),k=a(h),R=a(k),K=d(a(R),2),G=d(a(K),2);qe(G),t(K),t(R);var I=d(R,2),N=a(I),u=a(N);qe(u),Z(2),t(N),t(I),t(k),t(h),t(v);var _=d(v,2),H=a(_);{var P=c=>{var x=Er();b(c,x)},U=c=>{var x=ye(),B=de(x);{var j=F=>{var T=ye(),X=de(T);Be(X,1,()=>(r(M),L(()=>Object.entries(r(M)))),Ee,(oe,te)=>{var V=He(()=>Ve(r(te),2));let le=()=>r(V)[0],J=()=>r(V)[1];var se=Rr(),$e=a(se),De=d(a($e)),Fe=d(De),Ge=a(Fe);t(Fe),t($e);var Ye=d($e,2);Be(Ye,1,J,Ee,(We,Ke)=>{je(We,{get progress(){return r(Ke)},compact:!0})}),t(se),re(()=>{A(De,` ${le()??""} `),A(Ge,`${J(),L(()=>J().length)??""} days`)}),b(oe,se)}),b(F,T)},Y=F=>{var T=ye(),X=de(T);Be(X,1,()=>r(g),Ee,(oe,te)=>{var V=Ir(),le=a(V);je(le,{get progress(){return r(te)}}),t(V),re(()=>Ce(V,"id",(r(te),L(()=>r(te).is_today?"today-reading":void 0)))),b(oe,V)}),b(F,T)};W(B,F=>{r(M)?F(j):F(Y,!1)},!0)}b(c,x)};W(H,c=>{r(g),L(()=>r(g).length===0)?c(P):c(U,!1)})}t(_);var O=d(_,2);{var ae=c=>{var x=Pr(),B=a(x),j=a(B);{var Y=T=>{var X=Re("Hide Future Chapters");b(T,X)},F=T=>{var X=Re("Show Future Chapters");b(T,X)};W(j,T=>{r(y)?T(Y):T(F,!1)})}t(B),t(x),Le("click",B,()=>f(y,!r(y))),b(c,x)};W(O,c=>{r(m)||c(ae)})}var pe=d(O,2);{var Se=c=>{var x=Cr(),B=a(x),j=d(a(B));t(B),t(x),re(()=>A(j,` Showing ${r(g),L(()=>r(g).length)??""} reading days`)),b(c,x)};W(pe,c=>{r(g),L(()=>r(g).length>20)&&c(Se)})}t(p),er(G,()=>r(m),c=>f(m,c)),rr(u,()=>r(l),c=>f(l,c)),b(s,p),ue(),n()}var Tr=$('<div class="text-center py-5"><div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"><span class="visually-hidden">Loading...</span></div> <p class="text-muted mt-3">Loading reading schedule...</p></div>'),Ar=$('<div class="row mb-4"><div class="col-12"><!></div></div> <div class="row"><div class="col-12"><!></div></div>',1),Dr=$(`<div class="container py-4 svelte-q48pc2"><div class="row mb-4"><div class="col-12"><h2 class="display-6 svelte-q48pc2"><i class="bi bi-book me-2"></i> Ward Reading Progress</h2> <p class="lead">Join our ward in reading the Book of Mormon in 2026. Mark the chapters you've read and see
					how our ward is progressing together!</p> <p class="text-muted"><i class="bi bi-info-circle me-1"></i> This tracker is completely anonymous - your readings are counted toward the ward total without
					identifying who read what.</p></div></div> <!></div>`);function Qr(s,e){ve(e,!1);const o=()=>ee(q,"$loading",E),w=()=>ee(M,"$ready",E),[E,n]=xe(),{stores:{pageName:g}}=Ze(),{stores:{ready:M,loading:q},actions:{reload:S}}=me();g.set("Book of Mormon Reading 2026"),Pe(async()=>{await S()}),fe(),ze(s,{pageTitle:"Book of Mormon Reading Challenge 2026",children:(m,l)=>{var y=Dr(),D=d(a(y),2);{var i=v=>{var h=Tr();b(v,h)},p=v=>{var h=Ar(),k=de(h),R=a(k),K=a(R);vr(K,{}),t(R),t(k);var G=d(k,2),I=a(G),N=a(I);Or(N,{}),t(I),t(G),b(v,h)};W(D,v=>{o()&&!w()?v(i):v(p,!1)})}t(y),b(m,y)},$$slots:{default:!0}}),ue(),n()}export{Qr as component};
