import{a as Ae}from"../chunks/B5LTcAhG.js";import{P as Ke}from"../chunks/C_VuHRZi.js";import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{o as Le}from"../chunks/B8gJkoMb.js";import{p as Se,ay as le,az as Be,t as j,c as s,s as o,g as e,a as Me,E as De,U as w,a8 as a,I as Ne,r,aA as Te,i as Qe,f as he,u as ne,aB as He,aC as Ge}from"../chunks/D6GkHfO-.js";import{i as L,e as de,s as S}from"../chunks/DYmw-k_K.js";import{e as xe,i as $e}from"../chunks/COMoFu8N.js";import{f,a as c,c as Oe}from"../chunks/D8wZRsgK.js";import{b as Je,r as ce}from"../chunks/DsJSLd4M.js";import{b as R}from"../chunks/6wL3GoW6.js";import{i as Ue}from"../chunks/XlJfi8GN.js";import{p as we,s as je,a as V}from"../chunks/C8uFvBRH.js";import{P as Re}from"../chunks/CCz_dVc3.js";import{D as Ve}from"../chunks/DH5YToVs.js";import{c as We,u as Xe,a as Ye,i as Ze,p as et,b as tt,l as at,d as rt,e as st}from"../chunks/DqZlTUyO.js";const ot=!1,it=async()=>(Ae(Ke.ManageUsers,"Manage Users"),{}),Ft=Object.freeze(Object.defineProperty({__proto__:null,load:it,ssr:ot},Symbol.toStringTag,{value:"Module"}));var nt=f('<div class="alert alert-danger" role="alert"> </div>'),lt=f('<div class="form-text">Key cannot be changed after creation</div>'),dt=f("<option> </option>"),ct=f('<input type="text" class="form-control mt-2" placeholder="Enter custom category"/>'),vt=f('<div class="form-text">Category cannot be changed after creation</div>'),mt=f('<div class="form-text">Used for grouping permissions</div>'),pt=f('<span class="spinner-border spinner-border-sm me-2" role="status"></span>'),ft=f('<form><!> <div class="mb-3"><label for="permission-key" class="form-label">Key <span class="text-danger">*</span></label> <input type="text" class="form-control" id="permission-key" required placeholder="e.g., manage-events"/> <!></div> <div class="mb-3"><label for="permission-name" class="form-label">Name <span class="text-danger">*</span></label> <input type="text" class="form-control" id="permission-name" required placeholder="e.g., Manage Events"/></div> <div class="mb-3"><label for="permission-description" class="form-label">Description</label> <textarea class="form-control" id="permission-description" rows="3" placeholder="Describe what this permission allows..."></textarea></div> <div class="mb-3"><label for="permission-category" class="form-label">Category</label> <select class="form-select" id="permission-category"><option>Select a category...</option><!><option>Other (custom)...</option></select> <!> <!></div> <div class="d-flex gap-2"><button type="submit" class="btn btn-primary"><!> </button> <button type="button" class="btn btn-secondary" data-bs-dismiss="offcanvas">Cancel</button></div></form>');function ut(ve,I){Se(I,!1);const B=()=>V(We,"$categories",W),[W,me]=je(),u=w();let k=we(I,"id",8,"permission-form-drawer"),_=we(I,"permission",8,null),N=we(I,"onSave",8,null),C=w(""),b=w(""),D=w(""),q=w(""),m=w(""),E=w(""),l=w(!1),p=w("");async function g(v){v.preventDefault(),a(l,!0),a(p,"");try{e(u)&&_()?await Xe(_().id,{name:e(b),description:e(D)||null,category:e(q)||null}):await Ye({key:e(C),name:e(b),description:e(D)||null,category:e(q)||null});const y=document.getElementById(k());if(y){const $=window.bootstrap?.Offcanvas?.getInstance(y);$&&$.hide()}x(),N()&&N()()}catch(y){a(p,y instanceof Error?y.message:"Failed to save permission")}finally{a(l,!1)}}function x(){a(C,""),a(b,""),a(D,""),a(q,""),a(m,""),a(E,""),a(p,"")}function F(){x()}Le(()=>{const v=document.getElementById(k());if(v)return v.addEventListener("hidden.bs.offcanvas",F),()=>{v.removeEventListener("hidden.bs.offcanvas",F)}}),le(()=>De(_()),()=>{a(u,_()!==null)}),le(()=>(De(_()),B()),()=>{if(_()){a(C,_().key),a(b,_().name),a(D,_().description||"");const v=_().category||"",y=B();v&&y.includes(v)?(a(m,v),a(E,"")):v?(a(m,"__other__"),a(E,v)):(a(m,""),a(E,""))}}),le(()=>(e(m),e(E)),()=>{a(q,e(m)==="__other__"?e(E):e(m))}),Be(),Ue();{let v=Ne(()=>e(u)?"Edit Permission":"Create Permission");Ve(ve,{get title(){return e(v)},get id(){return k()},children:(y,pe)=>{var $=ft(),T=s($);{var X=t=>{var i=nt(),n=s(i,!0);r(i),j(()=>S(n,e(p))),c(t,i)};L(T,t=>{e(p)&&t(X)})}var Q=o(T,2),z=o(s(Q),2);ce(z);var fe=o(z,2);{var ue=t=>{var i=lt();c(t,i)};L(fe,t=>{e(u)&&t(ue)})}r(Q);var d=o(Q,2),P=o(s(d),2);ce(P),r(d);var M=o(d,2),Y=o(s(M),2);Te(Y),r(M);var H=o(M,2),h=o(s(H),2);j(()=>{e(m),Qe(()=>{e(u),B()})});var O=s(h);O.value=O.__value="";var Z=o(O);xe(Z,1,B,$e,(t,i)=>{var n=dt(),J=s(n,!0);r(n);var K={};j(()=>{S(J,e(i)),K!==(K=e(i))&&(n.value=(n.__value=e(i))??"")}),c(t,n)});var ee=o(Z);ee.value=ee.__value="__other__",r(h);var te=o(h,2);{var ae=t=>{var i=ct();ce(i),R(i,()=>e(E),n=>a(E,n)),c(t,i)};L(te,t=>{e(m)==="__other__"&&!e(u)&&t(ae)})}var _e=o(te,2);{var be=t=>{var i=vt();c(t,i)},G=t=>{var i=mt();c(t,i)};L(_e,t=>{e(u)?t(be):t(G,!1)})}r(H);var A=o(H,2),U=s(A),re=s(U);{var se=t=>{var i=pt();c(t,i)};L(re,t=>{e(l)&&t(se)})}var oe=o(re);r(U);var ie=o(U,2);r(A),r($),j(()=>{z.disabled=e(u),h.disabled=e(u),U.disabled=e(l),S(oe,` ${e(u)?"Update":"Create"} Permission`),ie.disabled=e(l)}),R(z,()=>e(C),t=>a(C,t)),R(P,()=>e(b),t=>a(b,t)),R(Y,()=>e(D),t=>a(D,t)),Je(h,()=>e(m),t=>a(m,t)),de("submit",$,g),c(y,$)},$$slots:{default:!0}})}Me(),me()}var _t=f('<div class="alert alert-danger" role="alert"><i class="bi bi-exclamation-triangle me-2"></i> </div>'),bt=f('<div class="d-flex justify-content-center align-items-center py-5"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></div>'),gt=f('<div class="alert alert-info">No permissions found. Create your first permission to get started.</div>'),yt=f('<tr><td><strong> </strong></td><td><code> </code></td><td> </td><td><button type="button" class="btn btn-sm btn-outline-primary me-1" title="Edit"><i class="bi bi-pencil"></i></button> <button type="button" class="btn btn-sm btn-outline-danger" title="Delete"><i class="bi bi-trash"></i></button></td></tr>'),ht=f('<div class="card mb-3"><div class="card-header"><h5 class="mb-0 text-uppercase"> </h5></div> <div class="card-body"><div class="table-responsive"><table class="table table-hover mb-0"><thead><tr><th>Name</th><th>Key</th><th>Description</th><th style="width: 150px;">Actions</th></tr></thead><tbody></tbody></table></div></div></div>'),wt=f('<div class="container-fluid py-4"><div class="d-flex justify-content-between align-items-center mb-4"><h2>Permissions</h2> <button type="button" class="btn btn-primary"><i class="bi bi-plus-lg me-1"></i> Create Permission</button></div> <!> <div class="card mb-4"><div class="card-body"><input type="text" class="form-control" placeholder="Search permissions..."/></div></div> <!></div> <!>',1);function zt(ve,I){Se(I,!1);const B=()=>V(et,"$permissionsByCategory",k),W=()=>V(tt,"$permissionsError",k),me=()=>V(at,"$loadingPermissions",k),u=()=>V(rt,"$permissions",k),[k,_]=je(),N=w();let C=w(null),b=w("");Le(async()=>{await Ze()});function D(){a(C,null),m("permission-form-drawer")}function q(l){a(C,l),m("permission-form-drawer")}function m(l){const p=document.getElementById(l);if(p){const g=window.bootstrap;g?.Offcanvas&&new g.Offcanvas(p).show()}}async function E(l){if(confirm(`Are you sure you want to delete the permission "${l.name}"? This will remove it from all roles.`))try{await st(l.id)}catch(p){alert(`Failed to delete permission: ${p instanceof Error?p.message:"Unknown error"}`)}}le(()=>(B(),e(b)),()=>{a(N,Object.entries(B()).filter(([l,p])=>{if(!e(b))return!0;const g=e(b).toLowerCase();return l.toLowerCase().includes(g)||p.some(x=>x.name.toLowerCase().includes(g)||x.key.toLowerCase().includes(g)||x.description?.toLowerCase().includes(g))}))}),Be(),Ue(),Re(ve,{pageTitle:"Manage Permissions",children:(l,p)=>{var g=wt(),x=he(g),F=s(x),v=o(s(F),2);r(F);var y=o(F,2);{var pe=d=>{var P=_t(),M=o(s(P));r(P),j(()=>S(M,` ${W()??""}`)),c(d,P)};L(y,d=>{W()&&d(pe)})}var $=o(y,2),T=s($),X=s(T);ce(X),r(T),r($);var Q=o($,2);{var z=d=>{var P=bt();c(d,P)},fe=d=>{var P=Oe(),M=he(P);{var Y=h=>{var O=gt();c(h,O)},H=h=>{var O=Oe(),Z=he(O);xe(Z,1,()=>e(N),$e,(ee,te)=>{var ae=He(()=>Ge(e(te),2));let _e=()=>e(ae)[0],be=()=>e(ae)[1];var G=ht(),A=s(G),U=s(A),re=s(U,!0);r(U),r(A);var se=o(A,2),oe=s(se),ie=s(oe),t=o(s(ie));xe(t,5,be,$e,(i,n)=>{var J=yt(),K=s(J),Pe=s(K),Ie=s(Pe,!0);r(Pe),r(K);var ge=o(K),Ce=s(ge),qe=s(Ce,!0);r(Ce),r(ge);var ye=o(ge),Fe=s(ye,!0);r(ye);var Ee=o(ye),ke=s(Ee),ze=o(ke,2);r(Ee),r(J),j(()=>{S(Ie,(e(n),ne(()=>e(n).name))),S(qe,(e(n),ne(()=>e(n).key))),S(Fe,(e(n),ne(()=>e(n).description||"-")))}),de("click",ke,()=>q(e(n))),de("click",ze,()=>E(e(n))),c(i,J)}),r(t),r(ie),r(oe),r(se),r(G),j(()=>S(re,_e())),c(ee,G)}),c(h,O)};L(M,h=>{u(),ne(()=>u().length===0)?h(Y):h(H,!1)},!0)}c(d,P)};L(Q,d=>{me()?d(z):d(fe,!1)})}r(x);var ue=o(x,2);ut(ue,{id:"permission-form-drawer",get permission(){return e(C)},onSave:()=>{a(C,null)}}),de("click",v,D),R(X,()=>e(b),d=>a(b,d)),c(l,g)},$$slots:{default:!0}}),Me(),_()}export{zt as component,Ft as universal};
