const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/DO0djbQe.js","../chunks/Cpj98o6Y.js"])))=>i.map(i=>d[i]);
import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{d as Qa,o as ia,g as Ya}from"../chunks/DHXte27T.js";import{p as it,c as a,r as t,s as i,a as vt,t as O,i as Va,g as e,f as _e,F as Da,ai as D,D as d,E as f,aj as va,u as l,R as xe,an as Xa,w as Z,ao as Ja}from"../chunks/CPOcesE7.js";import{f as c,a as o,c as rt,t as nt}from"../chunks/YsHTGu5k.js";import{i as m,b as ne,k as xa,a as da,s as P,p as ot,e as j}from"../chunks/opPvMm1W.js";import{i as dt}from"../chunks/C2Q_9cr2.js";import{P as Za}from"../chunks/BWhuteSA.js";import{e as Ne,i as la}from"../chunks/DAwrR-3T.js";import{r as Sa,b as Ga,s as lt,i as es,c as ts,d as as,e as ss}from"../chunks/DPUpi__n.js";import{b as rs}from"../chunks/QDlYjqxz.js";import{c as ns,g as ca,e as Bt,d as os,a as Nt,b as oa}from"../chunks/DAr-apQ9.js";import{d as ka,s as Ea,A as ls,E as is}from"../chunks/BRxJgQAQ.js";import{g as ua,p as ye,k as vs,f as pe,O as $a,P as Me,c as ze}from"../chunks/BznYGp8U.js";import{A as Ma,E as ds,c as cs}from"../chunks/BJVU5kdW.js";import{S as Ra}from"../chunks/DMwFmiPS.js";import{v as Pa,D as Ta}from"../chunks/gJIqSdzQ.js";import{s as Wt}from"../chunks/DZjIQhDs.js";import{B as us}from"../chunks/Cdxw3Qz2.js";import{_ as fs}from"../chunks/CmsKOCeN.js";import{s as ps}from"../chunks/CdEA5IGF.js";import{R as Et}from"../chunks/BgZi3Dzh.js";function _s(oe,T){return ns(oe,-T)}const bs=!0,Fr=Object.freeze(Object.defineProperty({__proto__:null,prerender:bs},Symbol.toStringTag,{value:"Module"}));var ms=c("<option> </option>"),ys=c('<div class="col-12 col-md-auto"><select class="form-select form-select" aria-label="Filter by category"><option>All Categories</option><!></select></div>'),gs=c('<div class="search-filter sticky-top svelte-1wm3u0q"><div class="row g-2"><div class="col-12 col-md"><input type="search" class="form-control form-control" placeholder="Search..."/></div> <!></div></div>');function hs(oe,T){it(T,!1);const N=()=>ne(F,"$searchQuery",C),w=()=>ne(K,"$currentCategories",C),X=()=>ne(q,"$categoryFilter",C),[C,g]=da(),{stores:{currentCategories:K,categoryFilter:q,searchQuery:F}}=ca();dt();var G=gs(),x=a(G),ee=a(x),U=a(ee);Sa(U),t(ee);var de=i(ee,2);{var S=H=>{var h=ys(),te=a(h);O(()=>{X(),Va(()=>{w()})});var z=a(te);z.value=z.__value="";var J=i(z);Ne(J,1,w,la,(ae,E)=>{var L=ms(),Q=a(L,!0);t(L);var le={};O(()=>{P(Q,e(E).label),le!==(le=e(E).key)&&(L.value=(L.__value=e(E).key)??"")}),o(ae,L)}),t(te),t(h),Ga(te,X,ae=>xa(q,ae)),o(H,h)};m(de,H=>{w().length&&H(S)})}t(x),t(G),rs(U,N,H=>xa(F,H)),o(oe,G),vt(),g()}var ws=c('<p class="mb-0">No past events to delete.</p>'),xs=c('<p class="mb-2"><strong> </strong></p>'),ks=c(`<div class="alert alert-warning mb-0" role="alert"><p class="mb-2"><strong> </strong></p> <p class="mb-0 small">These recurring events have active future instances and cannot be deleted until all
								future occurrences have passed.</p></div>`),Es=c("<!> <!>",1),$s=c('<div class="modal svelte-1u875uh" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-primary text-white"><h5 class="modal-title">Delete Past Events - Results</h5> <button type="button" class="btn-close btn-close-white" aria-label="Close"></button></div> <div class="modal-body"><!></div> <div class="modal-footer"><button type="button" class="btn btn-primary">OK</button></div></div></div></div>');function As(oe,T){it(T,!1);let N=ot(T,"deleted",8),w=ot(T,"skipped",8),X=ot(T,"callback",8);function C(){X()()}dt();var g=$s(),K=a(g),q=a(K),F=a(q),G=i(a(F),2);t(F);var x=i(F,2),ee=a(x);{var U=h=>{var te=ws();o(h,te)},de=h=>{var te=Es(),z=_e(te);{var J=L=>{var Q=xs(),le=a(Q),ke=a(le);t(le),t(Q),O(()=>P(ke,`✓ Deleted ${N()??""} past event${N()===1?"":"s"}.`)),o(L,Q)};m(z,L=>{N()>0&&L(J)})}var ae=i(z,2);{var E=L=>{var Q=ks(),le=a(Q),ke=a(le),Ee=a(ke);t(ke),t(le),Da(2),t(Q),O(()=>P(Ee,`⚠ Skipped ${w()??""} recurring event${w()===1?"":"s"}`)),o(L,Q)};m(ae,L=>{w()>0&&L(E)})}o(h,te)};m(ee,h=>{N()===0&&w()===0?h(U):h(de,!1)})}t(x);var S=i(x,2),H=a(S);t(S),t(q),t(K),t(g),j("click",G,C),j("click",H,C),o(oe,g),vt()}var Ds=c(`<div class="modal svelte-dmsnaa" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-danger text-white"><h5 class="modal-title">Delete Past Events</h5> <button type="button" class="btn-close btn-close-white" aria-label="Close"></button></div> <div class="modal-body"><p class="mb-3"><strong> </strong></p> <p class="mb-0 text-muted small">This action cannot be undone. Recurring events with future instances will be skipped
					automatically.</p></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-danger">Delete</button></div></div></div></div>`);function Ss(oe,T){it(T,!1);let N=ot(T,"cutoffDate",8),w=ot(T,"callback",8);function X(){w()(!0)}function C(){w()(!1)}dt();var g=Ds(),K=a(g),q=a(K),F=a(q),G=i(a(F),2);t(F);var x=i(F,2),ee=a(x),U=a(ee),de=a(U);t(U),t(ee),Da(2),t(x);var S=i(x,2),H=a(S),h=i(H,2);t(S),t(q),t(K),t(g),O(()=>P(de,`Are you sure you want to delete all events that occurred before ${N()??""}?`)),j("click",G,C),j("click",H,C),j("click",h,X),o(oe,g),vt()}var Ms=c('<button class="btn btn-sm btn-outline-secondary w-100"><i class="bi bi-clock-history me-1"></i> </button>'),Rs=c('<button class="btn btn-sm btn-outline-danger" type="button"><!></button>'),Ps=c('<div class="event-actions svelte-1ofdc1q"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit past event"><i class="bi bi-pencil-square"></i></button></div>'),Ts=c('<div class="daily-event-row svelte-1ofdc1q"><div class="event-content svelte-1ofdc1q"><!></div> <!></div>'),Is=c('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-1ofdc1q"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),Os=c('<li class="list-group-item py-3 text-muted">No events scheduled this week.</li>'),Cs=c('<li class="list-group-item list-group-item-light text-uppercase small fw-lighter p-0"><button><span class="d-flex align-items-center gap-2"><i></i> <span class="text-muted"> </span></span> <span> </span></button></li> <!>',1),Fs=c('<li class="list-group-item bg-secondary text-white fw-semibold"> </li> <!>',1),Us=c('<button class="btn btn-outline-secondary btn-sm">Reset</button>'),Ls=c('<div class="d-flex gap-2"><button class="btn btn-primary btn-sm">More</button> <button class="btn btn-outline-primary btn-sm">All</button></div>'),Bs=c('<div class="card-footer d-flex align-items-center justify-content-between"><small> </small> <!></div>'),Ns=c('<ul class="list-group list-group-flush border-top-0"></ul> <!>',1),Ws=c('<div class="card-body text-muted small">No past events available.</div>'),js=c('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center gap-3 flex-wrap fw-lighter"><span>Past Events</span> <div class="d-flex gap-2"><!> <button class="btn btn-sm btn-outline-secondary">Hide</button></div></div></div> <!></div>'),qs=c('<div class="d-flex flex-column gap-4"><!></div>'),Hs=c("<!> <!> <!> <!>",1);function Ks(oe,T){it(T,!1);const N=()=>ne(ie,"$weeksExpanded",x),w=()=>ne(W,"$allPastEvents",x),X=()=>ne(L,"$currentUser",x),C=()=>ne(ke,"$userOrganizations",x),g=()=>ne(E,"$currentUserHasPermission",x),K=()=>ne(le,"$currentUserIsRoot",x),q=()=>ne(Q,"$currentUserIsAdmin",x),F=()=>ne(Ee,"$ready",x),G=()=>ne(Re,"$searchQuery",x),[x,ee]=da(),U=f(),de=f(),S=f(),H=f(),h=f(),te=f(),z=f(),J=f(),ae=f(),{stores:{currentUserHasPermission:E,currentUser:L,currentUserIsAdmin:Q,currentUserIsRoot:le,userOrganizations:ke}}=ua(),{stores:{ready:Ee,dbData:B,weeksExpanded:ie,searchQuery:Re},actions:{reload:se}}=ca(),$t={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0};let Qe=ot(T,"formId",24,Pa),At=f(!1),Ye=f(!1),Ve=f(),ct=f(!1),ut=f(!1),Xe=f(!1),Je=f(new Set),Oe=f(!1),Dt=f(""),Ze=f({...$t}),We=f(!1),St=f(""),ft=f(!1),k=f({deleted:0,skipped:0});const pt=4,Mt=4;let Ce=f(pt),Ge=f(!1);const Rt=Wt();let r=f({});function v(s){return e(U).includes(s)}function p(s){const u=e(r)[s]??v(s);d(r,{...e(r),[s]:!u})}const y=s=>{d(Dt,"Event Item"),d(Ze,{...s,category:s?.meta_data?.category})},W=Qa(B,s=>{const u=Wt();return(s??[]).filter(n=>!(n.event_type!=="calendar_event"||!n.start_time||ye(n.start_time)>=u||n.recurrence_rule&&(!n.recurrence_end_date||n.recurrence_end_date&&ye(n.recurrence_end_date)>=u)))}),$e=s=>cs(s,{currentUserId:e(Ve),isPrivileged:e(Ye),canEditOwnOrgEvents:e(Xe),userOrganizations:e(Je)});let ve=f(!1);function M(){d(Ce,e(Ce)+Mt)}function be(){d(Ce,520),d(Ge,!0)}function Ae(){d(Ce,pt),d(Ge,!1)}const Pe=()=>{if(!e(At)||e(Oe)||!Ya(le)||!e(J))return;const s=Wt();d(St,pe(s,"MMM d, yyyy")),d(We,!0)};async function Fe(s){if(d(We,!1),!s)return;const u=Wt();d(Oe,!0);try{const n=await os(u);await se(),d(k,n),d(ft,!0)}catch(n){console.error("Failed to delete past events",n),alert("Failed to delete past events. Please try again.")}finally{d(Oe,!1)}}function _t(){d(ft,!1)}ia(async()=>{await se()}),D(()=>(w(),e(Ce)),()=>{d(S,(w()??[]).filter(s=>{if(!s.start_time)return!1;const u=ye(s.start_time),n=_s(Rt,e(Ce));return u>=n&&u<Rt}))}),D(()=>(e(S),pe),()=>{d(h,(()=>{const s=new Map;for(const u of e(S)){if(!u.start_time)continue;const n=ye(u.start_time),R=vs(n,{weekStartsOn:1}),$=Bt(n,{weekStartsOn:1}),A=pe(R,"yyyy-MM-dd"),re=`${pe(R,"MMM d")} – ${pe($,"MMM d")}`;let Y=s.get(A);Y||(Y={key:A,label:re,days:new Map},s.set(A,Y));const he=pe(n,"yyyy-MM-dd");let De=Y.days.get(he);De||(De={key:he,displayDay:pe(n,"EEE"),displayDate:pe(n,"MMM d"),events:[]},Y.days.set(he,De)),De.events.push(u)}return Array.from(s.values()).sort((u,n)=>u.key<n.key?1:-1).map(u=>({key:u.key,label:u.label,days:Array.from(u.days.values()).sort((n,R)=>n.key<R.key?1:-1).map(n=>({...n,events:n.events.slice().sort((R,$)=>{const A=R.is_all_day?0:1,re=$.is_all_day?0:1;if(A!==re)return A-re;const Y=R.start_time?ye(R.start_time).getTime():Number.MAX_SAFE_INTEGER,he=$.start_time?ye($.start_time).getTime():Number.MAX_SAFE_INTEGER;return Y-he})}))}))})())}),D(()=>e(h),()=>{d(U,(()=>{if(e(h).length===0)return[];const s=[];return e(h)[0]&&s.push(e(h)[0].key),e(h)[1]&&s.push(e(h)[1].key),s})())}),D(()=>(N(),e(r)),()=>{d(de,s=>N()?!0:e(r)[s]!==void 0?e(r)[s]:v(s))}),D(()=>e(S),()=>{d(H,e(S).length)}),D(()=>(e(h),pe),()=>{d(te,e(h).reduce((s,u)=>{const n=ye(u.key),R=Bt(n,{weekStartsOn:1}),$=pe(R,"yyyy-MM"),A=pe(R,"MMMM yyyy");return s[$]||(s[$]={label:A,weeks:[]}),s[$].weeks.push(u),s},{}))}),D(()=>X(),()=>{d(Ve,X()?.id)}),D(()=>C(),()=>{d(Je,C())}),D(()=>e(Ve),()=>{d(ut,!!e(Ve))}),D(()=>(e(Je),$a),()=>{d(ct,e(Je).has($a.Bishopric))}),D(()=>(g(),Me),()=>{d(Xe,g()(Me.EditOwnOrgEvents))}),D(()=>(K(),q(),e(ct),g(),Me),()=>{d(Ye,K()||q()||e(ct)||g()(Me.EditAllEvents))}),D(()=>(e(Ye),g(),e(Xe),e(ut)),()=>{d(At,e(Ye)||g()(Me.CreateEvents)||e(Xe)||e(ut))}),D(()=>(g(),Me),()=>{d(z,g()(Me.DeleteEvents))}),D(()=>e(S),()=>{d(J,e(S).length>0)}),D(()=>(w(),e(S)),()=>{d(ae,w().length>e(S).length)}),va(),dt();var et=Hs(),bt=_e(et);Ta(bt,{get title(){return e(Dt)},get id(){return Qe()},children:(s,u)=>{Ma(s,{get eventItem(){return e(Ze)},get drawerId(){return Qe()},name:"past-event-item-form",get canDelete(){return e(z)}})},$$slots:{default:!0}});var ge=i(bt,2);{var Pt=s=>{var u=rt(),n=_e(u);{var R=A=>{var re=rt(),Y=_e(re);{var he=Ue=>{var we=Ms(),Te=i(a(we));t(we),O(()=>P(Te,` Show Past Events (${w(),l(()=>w().length)??""})`)),j("click",we,()=>d(ve,!0)),o(Ue,we)},De=Ue=>{var we=js(),Te=a(we),It=a(Te),mt=i(a(It),2),yt=a(mt);{var Ht=ue=>{var me=Rs(),je=a(me);{var ht=V=>{var fe=nt("Deleting…");o(V,fe)},qe=V=>{var fe=nt();O(()=>P(fe,`Delete All (${e(H)??""})`)),o(V,fe)};m(je,V=>{e(Oe)?V(ht):V(qe,!1)})}t(me),O(()=>me.disabled=e(Oe)),j("click",me,Pe),o(ue,me)};m(yt,ue=>{K()&&e(J)&&ue(Ht)})}var gt=i(yt,2);t(mt),t(It),t(Te);var Ot=i(Te,2);{var Kt=ue=>{var me=Ns(),je=_e(me);Ne(je,5,()=>(e(te),l(()=>Object.entries(e(te)))),([V,fe])=>V,(V,fe)=>{var He=Xa(()=>Ja(e(fe),2));let Le=()=>e(He)[1];var Ke=Fs(),Ie=_e(Ke),tt=a(Ie,!0);t(Ie);var Se=i(Ie,2);Ne(Se,1,()=>(Le(),l(()=>Le().weeks)),b=>b.key,(b,_)=>{const ce=xe(()=>(Z(ye),e(_),l(()=>ye(e(_).key)))),Be=xe(()=>(Z(Bt),Z(e(ce)),l(()=>Bt(e(ce),{weekStartsOn:1})))),fa=xe(()=>(Z(Ea),Z(e(Be)),l(()=>Ea(e(Be))))),Ia=xe(()=>(Z(ka),Z(e(Be)),Z(e(fa)),l(()=>ka(e(Be),e(fa),{weekStartsOn:1})+1))),Qt=xe(()=>(e(de),e(_),l(()=>e(de)(e(_).key)))),Ct=xe(()=>(e(_),l(()=>e(_).days.reduce((xt,Ft)=>xt+Ft.events.length,0))));var pa=Cs(),Yt=_e(pa),wt=a(Yt);let _a;var Vt=a(wt),ba=a(Vt),ma=i(ba,2),Oa=a(ma);t(ma),t(Vt);var Xt=i(Vt,2);let ya;var Ca=a(Xt,!0);t(Xt),t(wt),t(Yt);var Fa=i(Yt,2);{var Ua=xt=>{var Ft=rt(),La=_e(Ft);{var Ba=at=>{var Ut=rt(),Wa=_e(Ut);Ne(Wa,1,()=>(e(_),l(()=>e(_).days)),Jt=>Jt.key,(Jt,st)=>{var Zt=Is(),ga=a(Zt),Gt=a(ga),ea=a(Gt),ja=a(ea,!0);t(ea);var ha=i(ea,2),qa=a(ha,!0);t(ha),t(Gt);var wa=i(Gt,2);Ne(wa,5,()=>(e(st),l(()=>e(st).events)),kt=>kt.id??`${kt.start_time}-${kt.meta_data?.recurring_instance_index??0}`,(kt,Lt)=>{var ta=Ts(),aa=a(ta),Ha=a(aa);ds(Ha,{get item(){return e(Lt)},showDate:!1,get searchQuery(){return G()}}),t(aa);var Ka=i(aa,2);{var za=sa=>{var ra=Ps(),na=a(ra);t(ra),O(()=>{lt(na,"data-bs-target",`#${Qe()??""}`),lt(na,"aria-controls",Qe())}),j("click",na,()=>y(e(Lt))),o(sa,ra)};m(Ka,sa=>{e(Lt),l(()=>$e(e(Lt)))&&sa(za)})}t(ta),o(kt,ta)}),t(wa),t(ga),t(Zt),O(()=>{P(ja,(e(st),l(()=>e(st).displayDay))),P(qa,(e(st),l(()=>e(st).displayDate)))}),o(Jt,Zt)}),o(at,Ut)},Na=at=>{var Ut=Os();o(at,Ut)};m(La,at=>{e(_),l(()=>e(_).days.length)?at(Ba):at(Na,!1)})}o(xt,Ft)};m(Fa,xt=>{e(Qt)&&xt(Ua)})}O(()=>{_a=ze(wt,1,"week-header w-100 d-flex justify-content-between align-items-center border-0 bg-transparent p-2 text-start svelte-1ofdc1q",null,_a,{"text-muted":e(Ct)===0}),lt(wt,"title",e(Qt)?"Click to collapse week":"Click to expand week"),ze(ba,1,`bi ${e(Qt)?"bi-chevron-up":"bi-chevron-down"}`),P(Oa,`Week ${e(Ia)??""} [${e(Ct)??""} Event${e(Ct)===1?"":"s"}]`),ya=ze(Xt,1,"",null,ya,{"opacity-50":e(Ct)===0}),P(Ca,(e(_),l(()=>e(_).label)))}),j("click",wt,()=>p(e(_).key)),o(b,pa)}),O(()=>P(tt,(Le(),l(()=>Le().label)))),o(V,Ke)}),t(je);var ht=i(je,2);{var qe=V=>{var fe=Bs(),He=a(fe),Le=a(He);t(He);var Ke=i(He,2);{var Ie=Se=>{var b=Us();j("click",b,Ae),o(Se,b)},tt=Se=>{var b=Ls(),_=a(b),ce=i(_,2);t(b),j("click",_,M),j("click",ce,be),o(Se,b)};m(Ke,Se=>{e(Ge)?Se(Ie):Se(tt,!1)})}t(fe),O(()=>P(Le,`Showing ${e(S),l(()=>e(S)?.length??0)??""} of ${w(),l(()=>w()?.length??0)??""}`)),o(V,fe)};m(ht,V=>{(e(ae)||e(Ge))&&V(qe)})}o(ue,me)},zt=ue=>{var me=Ws();o(ue,me)};m(Ot,ue=>{e(h),l(()=>e(h).length)?ue(Kt):ue(zt,!1)})}t(we),j("click",gt,()=>d(ve,!1)),o(Ue,we)};m(Y,Ue=>{e(ve)?Ue(De,!1):Ue(he)})}o(A,re)},$=A=>{var re=qs(),Y=a(re);Ra(Y,{}),t(re),o(A,re)};m(n,A=>{F()?A(R):A($,!1)})}o(s,u)};m(ge,s=>{K()&&s(Pt)})}var Tt=i(ge,2);{var jt=s=>{Ss(s,{get cutoffDate(){return e(St)},callback:Fe})};m(Tt,s=>{e(We)&&s(jt)})}var qt=i(Tt,2);{var I=s=>{As(s,{get deleted(){return e(k),l(()=>e(k).deleted)},get skipped(){return e(k),l(()=>e(k).skipped)},callback:_t})};m(qt,s=>{e(ft)&&s(I)})}o(oe,et),vt(),ee()}var zs=c('<div class="d-flex flex-column gap-4"><!> <!> <!> <!></div>');function Aa(oe){var T=zs(),N=a(T);hs(N,{});var w=i(N,2);ls(w,{});var X=i(w,2);is(X,{});var C=i(X,2);Ks(C,{}),t(T),o(oe,T)}var Qs=c('<div class="d-flex justify-content-center align-items-center py-5"><!></div>'),Ys=c('<button type="button" role="tab"> </button>'),Vs=c("<option> </option>"),Xs=c('<div class="py-5 text-center text-muted"><!></div>'),Js=c('<div class="description-preview text-muted small mb-1 svelte-f25tv"> </div>'),Zs=c("<span> </span>"),Gs=c('<span class="badge rounded-pill bg-secondary-subtle text-secondary-emphasis">Uncategorized</span>'),er=c('<span><i class="bi bi-geo-alt"></i> </span>'),tr=c('<span><i class="bi bi-arrow-repeat"></i> </span>'),ar=c('<span><i class="bi bi-calendar3"></i> </span>'),sr=c('<div class="submission-card text-start svelte-f25tv" role="button" tabindex="0"><div class="d-flex justify-content-between align-items-start gap-3 mb-1"><div class="fw-semibold"> </div> <div class="d-flex align-items-center gap-2"><span class="badge bg-light text-dark"> </span> <button class="btn btn-sm btn-outline-primary" type="button"><i class="bi bi-pencil-square"></i></button></div></div> <!> <div class="d-flex flex-wrap align-items-center gap-2 small text-muted mb-1"><!> <!> <!></div> <div class="d-flex flex-wrap align-items-center gap-2 small text-muted mb-1"><span><i class="bi bi-clock"></i> </span> <!></div> <div class="d-flex flex-wrap gap-1"><span><i></i> </span></div></div>'),rr=c('<div class="d-flex flex-column gap-3"></div>'),nr=c('<div class="my-submissions-page d-flex flex-column gap-4 svelte-f25tv"><div class="card"><div class="card-header d-flex flex-column gap-3"><div class="d-flex flex-md-row align-items-center justify-content-between gap-2"><div class="mb-0">My Submissions</div> <button class="btn btn-outline-secondary btn-sm"><!></button></div> <div class="submissions-status-tabs nav nav-pills gap-2" role="tablist"></div></div> <div class="card-body d-flex flex-column gap-3"><div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3"><div class="input-group input-group-sm my-submissions-search svelte-f25tv"><input class="form-control svelte-f25tv" type="search" placeholder="Search title, category, or location"/></div> <div class="type-filter-select svelte-f25tv"><select class="form-select form-select-sm"></select></div></div> <!></div></div></div>'),or=c('<div class="text-muted">Select a submission to edit.</div>'),lr=c("<!> <!>",1);function ir(oe,T){it(T,!1);const N=()=>ne(h,"$currentUserStore",g),w=()=>ne(te,"$currentUserHasPermission",g),X=()=>ne(S,"$dbData",g),C=()=>ne(de,"$ready",g),[g,K]=da(),q=f(),F=f(),G=f(),x=f(),ee=f(),U=f(),{stores:{ready:de,dbData:S},actions:{reload:H}}=ca(),{stores:{currentUser:h,currentUserHasPermission:te}}=ua();let z=f(!1),J=f([]),ae=f([]),E=f(null);const L=Pa();let Q=null;const le={approved:"var(--bs-success)",pending:"var(--bs-warning)",needs_review:"var(--bs-info)"},ke={pending:{text:"Awaiting Bishop's Decision",class:"bg-warning-subtle text-warning-emphasis",icon:"bi-hourglass-split"},needs_review:{text:"Needs Review",class:"bg-info-subtle text-info-emphasis",icon:"bi-pencil"},approved:{text:"Approved",class:"bg-success-subtle text-success-emphasis",icon:"bi-check-circle"}},Ee={pending:"Pending",needs_review:"Needs Review",approved:"Approved"},B=[{value:"pending",label:Ee.pending},{value:"needs_review",label:Ee.needs_review},{value:"approved",label:Ee.approved}],ie=[{value:"all",label:"Events & Announcements"},{value:"events",label:"Events only"},{value:"announcements",label:"Announcements only"}],Re=()=>({search:"",typeFilter:"all"});let se=f({pending:Re(),needs_review:Re(),approved:Re()});ia(async()=>{d(z,!0),await H(),d(z,!1),typeof window<"u"&&(Q=(await fs(()=>import("../chunks/DO0djbQe.js").then(v=>v.o),__vite__mapDeps([0,1]),import.meta.url)).default)});const $t=r=>{const v=r.meta_data?.submitted_at??r.created_at;if(!v)return 0;try{return ye(v).getTime()}catch(p){return console.warn("Failed to parse submission timestamp",p),0}},Qe=r=>{const v=r.meta_data?.submitted_at??r.created_at;if(!v)return"—";try{return pe(ye(v),"MMM d, yyyy 'at' h:mm a")}catch(p){return console.warn("Failed to format submission timestamp",p),"—"}},At=r=>{if(!r.start_time)return"—";try{return pe(ye(r.start_time),"MMM d, yyyy 'at' h:mm a")}catch(v){return console.warn("Failed to format event date",v),"—"}},Ye=r=>r.replace(/<[^>]*>/g,""),Ve=(r,v)=>r.length<=v?r:r.substring(0,v).trimEnd()+"…",ct=r=>r.description?Ve(Ye(r.description).trim(),120):"",ut=r=>{try{const p=Et.fromString(r).origOptions,y=p.interval||1,W=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],$e=["","1st","2nd","3rd","4th","5th"];if(p.freq===Et.DAILY)return y===1?"Repeats daily":`Repeats every ${y} days`;if(p.freq===Et.WEEKLY){if(p.byweekday){const M=(Array.isArray(p.byweekday)?p.byweekday:[p.byweekday]).map(be=>{const Ae=typeof be=="number"?be:be.weekday,Pe=Ae===6?0:Ae+1;return W[Pe]});return y===1?M.length===1?`Repeats every ${M[0]}`:`Repeats on ${M.join(", ")}`:`Repeats every ${y} weeks on ${M.join(", ")}`}return y===1?"Repeats weekly":`Repeats every ${y} weeks`}if(p.freq===Et.MONTHLY){if(p.byweekday){const M=(Array.isArray(p.byweekday)?p.byweekday:[p.byweekday])[0];if(M&&typeof M=="object"&&"n"in M&&"weekday"in M){const be=M.weekday,Ae=be===6?0:be+1,Pe=M.n,Fe=$e[Pe]||`${Pe}th`;return y===1?`Repeats on the ${Fe} ${W[Ae]} of the month`:`Repeats on the ${Fe} ${W[Ae]} every ${y} months`}}if(p.bymonthday){const ve=Array.isArray(p.bymonthday)?p.bymonthday[0]:p.bymonthday,M=ve===1?"st":ve===2?"nd":ve===3?"rd":"th";return y===1?`Repeats on the ${ve}${M} of the month`:`Repeats on the ${ve}${M} every ${y} months`}return y===1?"Repeats monthly":`Repeats every ${y} months`}return p.freq===Et.YEARLY?y===1?"Repeats yearly":`Repeats every ${y} years`:"Repeats"}catch{return"Repeats"}},Xe=(r,v)=>{const p=v.trim().toLowerCase();if(!p)return!0;const y=r.meta_data?.category?oa(r.meta_data.category)?.label??"":"";return[r.title??"",r.description??"",r.location??"",y??""].join(" ").toLowerCase().includes(p)},Je=(r,v)=>v==="all"?!0:v==="events"?r.event_type==="calendar_event":r.event_type==="announcement";function Oe(r,v){d(se,{...e(se),[r]:{...e(se)[r],...v}})}const Dt=r=>{const v=new Set,p=[];for(const y of r){const W=y.meta_data?.recurring_parent_id;if(y.meta_data?.recurring_instance&&W!=null){if(v.has(W))continue;v.add(W)}p.push(y)}return p},Ze=r=>r.meta_data?.recurring_parent_id!=null?`recurring-${r.meta_data.recurring_parent_id}`:`id-${r.id}`,We=r=>{d(E,r);const v=document.getElementById(L);v&&Q&&Q.getOrCreateInstance(v).show()},St=(r,v)=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),We(v))},ft=async()=>{d(z,!0),await H(),d(z,!1)};let k=f("pending");D(()=>N(),()=>{d(q,N())}),D(()=>(w(),Me),()=>{d(F,w()(Me.DeleteEvents))}),D(()=>(X(),e(q)),()=>{d(J,Dt((X()??[]).filter(r=>{const v=r.meta_data?.submitted_by_user_id;return v&&e(q)?.id&&v===e(q).id}).sort((r,v)=>$t(r)-$t(v))))}),D(()=>e(k),()=>{d(G,`type-filter-select-submissions-${e(k)}`)}),D(()=>(e(J),Nt),()=>{d(x,B.reduce((r,v)=>(r[v.value]=e(J).filter(p=>Nt(p)===v.value),r),{}))}),D(()=>(e(se),e(x)),()=>{d(ee,B.reduce((r,v)=>{const p=e(se)[v.value],y=(e(x)[v.value]??[]).filter(W=>Je(W,p.typeFilter));return r[v.value]=y.filter(W=>Xe(W,p.search)),r},{}))}),D(()=>(e(ee),e(k)),()=>{d(ae,e(ee)[e(k)]??[])}),D(()=>(e(E),e(J)),()=>{e(E)&&!e(J).some(r=>Ze(r)===Ze(e(E)))&&d(E,null)}),D(()=>e(E),()=>{d(U,e(E)?{...e(E),id:e(E).id??e(E).meta_data?.recurring_parent_id,category:e(E).meta_data?.category}:null)}),va(),dt();var pt=lr(),Mt=_e(pt);{var Ce=r=>{var v=Qs(),p=a(v);Ra(p,{}),t(v),o(r,v)},Ge=r=>{var v=nr(),p=a(v),y=a(p),W=a(y),$e=i(a(W),2),ve=a($e);{var M=I=>{var s=nt("Refreshing…");o(I,s)},be=I=>{var s=nt("Refresh");o(I,s)};m(ve,I=>{e(z)?I(M):I(be,!1)})}t($e),t(W);var Ae=i(W,2);Ne(Ae,5,()=>B,la,(I,s)=>{var u=Ys(),n=a(u);t(u),O(()=>{ze(u,1,(e(k),e(s),l(()=>`nav-link ${e(k)===e(s).value?"active":""}`)),"svelte-f25tv"),lt(u,"aria-selected",(e(k),e(s),l(()=>e(k)===e(s).value))),P(n,`${e(s),l(()=>e(s).label)??""} (${e(x),e(s),l(()=>(e(x)[e(s).value]??[]).length)??""})`)}),j("click",u,()=>d(k,e(s).value)),o(I,u)}),t(Ae),t(y);var Pe=i(y,2),Fe=a(Pe),_t=a(Fe),et=a(_t);Sa(et),t(_t);var bt=i(_t,2),ge=a(bt);Ne(ge,5,()=>ie,la,(I,s)=>{var u=Vs(),n=a(u,!0);t(u);var R={};O(()=>{P(n,(e(s),l(()=>e(s).label))),R!==(R=(e(s),l(()=>e(s).value)))&&(u.value=(u.__value=(e(s),l(()=>e(s).value)))??"")}),o(I,u)}),t(ge);var Pt;es(ge),t(bt),t(Fe);var Tt=i(Fe,2);{var jt=I=>{var s=Xs(),u=a(s);{var n=$=>{var A=nt("You haven't submitted any events or announcements yet.");o($,A)},R=$=>{var A=nt();O(re=>P(A,`No ${re??""} submissions match your current filters.`),[()=>(e(k),l(()=>Ee[e(k)].toLowerCase()))]),o($,A)};m(u,$=>{e(J),l(()=>e(J).length===0)?$(n):$(R,!1)})}t(s),o(I,s)},qt=I=>{var s=rr();Ne(s,5,()=>e(ae),u=>Ze(u),(u,n)=>{const R=xe(()=>(Z(Nt),e(n),l(()=>Nt(e(n))))),$=xe(()=>(Z(e(R)),l(()=>ke[e(R)]))),A=xe(()=>(e(n),Z(oa),l(()=>e(n).meta_data?.category?oa(e(n).meta_data.category):null))),re=xe(()=>(e(n),l(()=>ct(e(n)))));var Y=sr(),he=a(Y),De=a(he),Ue=a(De,!0);t(De);var we=i(De,2),Te=a(we),It=a(Te,!0);t(Te);var mt=i(Te,2);t(we),t(he);var yt=i(he,2);{var Ht=b=>{var _=Js(),ce=a(_,!0);t(_),O(()=>P(ce,e(re))),o(b,_)};m(yt,b=>{e(re)&&b(Ht)})}var gt=i(yt,2),Ot=a(gt);{var Kt=b=>{var _=Zs(),ce=a(_,!0);t(_),O(()=>{ze(_,1,`badge rounded-pill bg-color-${Z(e(A)),l(()=>e(A).color_number)??""}`,"svelte-f25tv"),P(ce,(Z(e(A)),l(()=>e(A).label)))}),o(b,_)},zt=b=>{var _=Gs();o(b,_)};m(Ot,b=>{e(A)?b(Kt):b(zt,!1)})}var ue=i(Ot,2);{var me=b=>{var _=er(),ce=i(a(_));t(_),O(()=>P(ce,` ${e(n),l(()=>e(n).location)??""}`)),o(b,_)};m(ue,b=>{e(n),l(()=>e(n).location)&&b(me)})}var je=i(ue,2);{var ht=b=>{var _=tr(),ce=i(a(_));t(_),O(Be=>P(ce,` ${Be??""}`),[()=>(e(n),l(()=>ut(e(n).recurrence_rule)))]),o(b,_)};m(je,b=>{e(n),l(()=>e(n).recurrence_rule)&&b(ht)})}t(gt);var qe=i(gt,2),V=a(qe),fe=i(a(V));t(V);var He=i(V,2);{var Le=b=>{var _=ar(),ce=i(a(_));t(_),O(Be=>P(ce,` Event ${Be??""}`),[()=>(e(n),l(()=>At(e(n))))]),o(b,_)};m(He,b=>{e(n),l(()=>e(n).event_type==="calendar_event")&&b(Le)})}t(qe);var Ke=i(qe,2),Ie=a(Ke),tt=a(Ie),Se=i(tt,1,!0);t(Ie),t(Ke),t(Y),O(b=>{ss(Y,`border-left: 4px solid ${Z(e(R)),l(()=>le[e(R)])??""}`),P(Ue,(e(n),l(()=>e(n).title))),P(It,(e(n),l(()=>e(n).event_type==="calendar_event"?"Event":"Announcement"))),lt(mt,"aria-label",(e(n),l(()=>`Edit ${e(n).title}`))),P(fe,` Submitted ${b??""}`),ze(Ie,1,(Z(e($)),l(()=>`badge ${e($).class}`)),"svelte-f25tv"),ze(tt,1,(Z(e($)),l(()=>`bi ${e($).icon} me-1`)),"svelte-f25tv"),P(Se,(Z(e($)),l(()=>e($).text)))},[()=>(e(n),l(()=>Qe(e(n))))]),j("click",mt,ps(()=>We(e(n)))),j("click",Y,()=>We(e(n))),j("keydown",Y,b=>St(b,e(n))),o(u,Y)}),t(s),o(I,s)};m(Tt,I=>{e(ae),l(()=>e(ae).length===0)?I(jt):I(qt,!1)})}t(Pe),t(p),t(v),O(()=>{$e.disabled=e(z),ts(et,(e(se),e(k),l(()=>e(se)[e(k)].search))),lt(ge,"id",e(G)),Pt!==(Pt=(e(se),e(k),l(()=>e(se)[e(k)].typeFilter)))&&(ge.value=(ge.__value=(e(se),e(k),l(()=>e(se)[e(k)].typeFilter)))??"",as(ge,(e(se),e(k),l(()=>e(se)[e(k)].typeFilter))))}),j("click",$e,ft),j("input",et,I=>Oe(e(k),{search:I.currentTarget.value})),j("change",ge,I=>Oe(e(k),{typeFilter:I.currentTarget.value})),o(r,v)};m(Mt,r=>{C()?r(Ge,!1):r(Ce)})}var Rt=i(Mt,2);{let r=xe(()=>(e(E),l(()=>e(E)?`Edit: ${e(E).title}`:"Submission Details")));Ta(Rt,{get id(){return L},get title(){return e(r)},children:(v,p)=>{var y=rt(),W=_e(y);{var $e=M=>{Ma(M,{get eventItem(){return e(U)},get drawerId(){return L},name:"my-submission-form",get canDelete(){return e(F)},canCreate:!1})},ve=M=>{var be=or();o(M,be)};m(W,M=>{e(U)?M($e):M(ve,!1)})}o(v,y)},$$slots:{default:!0}})}o(oe,pt),vt(),K()}var vr=c('<button class="nav-link" id="approvals-tab" data-bs-toggle="tab" data-bs-target="#approvals-pane" type="button" role="tab" aria-controls="approvals-pane" aria-selected="false">Approvals</button>'),dr=c('<button class="nav-link" id="my-submissions-tab" data-bs-toggle="tab" data-bs-target="#my-submissions-pane" type="button" role="tab" aria-controls="my-submissions-pane" aria-selected="false">My Submissions</button>'),cr=c('<div class="tab-pane fade" id="approvals-pane" role="tabpanel" aria-labelledby="approvals-tab"><!></div>'),ur=c('<div class="tab-pane fade" id="my-submissions-pane" role="tabpanel" aria-labelledby="my-submissions-tab"><!></div>'),fr=c('<nav class="d-print-none"><div class="nav nav-tabs" role="tablist"><button class="nav-link active" id="announcements-tab" data-bs-toggle="tab" data-bs-target="#announcements-pane" type="button" role="tab" aria-controls="announcements-pane" aria-selected="true">All</button> <!> <!></div></nav> <div class="tab-content mt-3"><div class="tab-pane fade show active" id="announcements-pane" role="tabpanel" aria-labelledby="announcements-tab"><!></div> <!> <!></div>',1);function Ur(oe,T){it(T,!1);const N=f(),{stores:{currentUserHasPermission:w,authenticated:X}}=ua();let C=f(!1),g=f(!1);ia(()=>{const K=w.subscribe(F=>{const G=F(Me.ManageWardBusiness);d(C,G)}),q=X.subscribe(F=>{d(g,F)});return()=>{K(),q()}}),D(()=>(e(C),e(g)),()=>{d(N,e(C)||e(g))}),va(),dt(),Za(oe,{pageTitle:"Announcements & Events",children:(K,q)=>{var F=rt(),G=_e(F);{var x=U=>{var de=fr(),S=_e(de),H=a(S),h=i(a(H),2);{var te=B=>{var ie=vr();o(B,ie)};m(h,B=>{e(C)&&B(te)})}var z=i(h,2);{var J=B=>{var ie=dr();o(B,ie)};m(z,B=>{e(g)&&B(J)})}t(H),t(S);var ae=i(S,2),E=a(ae),L=a(E);Aa(L),t(E);var Q=i(E,2);{var le=B=>{var ie=cr(),Re=a(ie);us(Re,{}),t(ie),o(B,ie)};m(Q,B=>{e(C)&&B(le)})}var ke=i(Q,2);{var Ee=B=>{var ie=ur(),Re=a(ie);ir(Re,{}),t(ie),o(B,ie)};m(ke,B=>{e(g)&&B(Ee)})}t(ae),o(U,de)},ee=U=>{Aa(U)};m(G,U=>{e(N)?U(x):U(ee,!1)})}o(K,F)},$$slots:{default:!0}}),vt()}export{Ur as component,Fr as universal};
