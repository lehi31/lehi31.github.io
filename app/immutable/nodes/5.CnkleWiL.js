import{s as tt,d,P as lt,C as k,A as Se,a as ke,i as he,b as a,B as me,p as i,D as at,c as s,e as b,H as C,g as E,f as be,h as o,j as w,t as ge,k as Ae,r as nt,J as Fe,G as Ye,n as qe,Q as ut}from"../chunks/DU0SEloV.js";import{S as st,i as ot,d as Me,t as Re,a as Be,m as He,c as je,b as ze}from"../chunks/BumSRjNr.js";import{P as dt}from"../chunks/Cv-oG3kn.js";import{e as Je,u as ft,d as _t}from"../chunks/DvEESi9F.js";import{D as ht}from"../chunks/CmpkIImW.js";import{d as rt,w as Qe,g as vt}from"../chunks/Xu_Rz6Zf.js";import{s as it,a as Ue,g as pt}from"../chunks/DdE8VZqO.js";const Ve=Qe([]),Oe=Qe(!1),Ie=Qe(null);async function ct(){Oe.set(!0),Ie.set(null);try{const n=localStorage.getItem("authToken"),e=await fetch(`${it}/functions/v1/admin-get-users`,{headers:{"x-auth-token":n??"",Authorization:`Bearer ${Ue}`,apikey:Ue}}),t=await e.json();if(!e.ok)throw new Error(t.error||"Failed to fetch users");if(t.users)Ve.set(t.users);else throw new Error("No users data returned")}catch(n){const e=n instanceof Error?n.message:"Unknown error occurred";Ie.set(e),console.error("Fetch users error:",n)}finally{Oe.set(!1)}}async function mt(n,e){Oe.set(!0),Ie.set(null);try{const t=localStorage.getItem("authToken"),l=await fetch(`${it}/functions/v1/admin-update-user`,{method:"POST",headers:{"Content-Type":"application/json","x-auth-token":t??"",Authorization:`Bearer ${Ue}`,apikey:Ue},body:JSON.stringify({userId:n,updates:e})}),c=await l.json();if(!l.ok)throw new Error(c.error||"Failed to update user");if(c.success)return await ct(),{success:!0};throw new Error(c.error||"Update failed")}catch(t){const l=t instanceof Error?t.message:"Unknown error occurred";return Ie.set(l),console.error("Update user error:",t),{success:!1,error:l}}finally{Oe.set(!1)}}rt(Ve,n=>n.filter(e=>e.is_active));rt(Ve,n=>{const e={};return n.forEach(t=>{e[t.role]||(e[t.role]=[]),e[t.role].push(t)}),e});const bt={stores:{users:Ve,loading:Oe,error:Ie},actions:{fetchUsers:ct,updateUser:mt}};function We(n,e,t){const l=n.slice();return l[25]=e[t],l}function Ge(n){let e,t,l,c,h,_;return{c(){e=o("div"),t=ge(n[5]),l=w(),c=o("button"),this.h()},l(y){e=s(y,"DIV",{class:!0,role:!0});var g=b(e);t=be(g,n[5]),l=E(g),c=s(g,"BUTTON",{type:!0,class:!0,"aria-label":!0}),b(c).forEach(d),g.forEach(d),this.h()},h(){i(c,"type","button"),i(c,"class","btn-close"),i(c,"aria-label","Close"),i(e,"class","alert alert-danger alert-dismissible fade show"),i(e,"role","alert")},m(y,g){he(y,e,g),a(e,t),a(e,l),a(e,c),h||(_=me(c,"click",n[16]),h=!0)},p(y,g){g&32&&ke(t,y[5])},d(y){y&&d(e),h=!1,_()}}}function gt(n){let e,t,l,c='<tr><th scope="col">Name</th> <th scope="col">Email</th> <th scope="col">Role</th> <th scope="col">Status</th> <th scope="col">Created</th> <th scope="col">Last Login</th> <th scope="col" class="text-end">Actions</th></tr>',h,_,y=[],g=new Map,O,I=Je(n[4]);const U=f=>f[25].id;for(let f=0;f<I.length;f+=1){let m=We(n,I,f),u=U(m);g.set(u,y[f]=Ke(u,m))}let r=n[4].length===0&&Xe();return{c(){e=o("div"),t=o("table"),l=o("thead"),l.innerHTML=c,h=w(),_=o("tbody");for(let f=0;f<y.length;f+=1)y[f].c();O=w(),r&&r.c(),this.h()},l(f){e=s(f,"DIV",{class:!0});var m=b(e);t=s(m,"TABLE",{class:!0});var u=b(t);l=s(u,"THEAD",{"data-svelte-h":!0}),C(l)!=="svelte-1lpwxoc"&&(l.innerHTML=c),h=E(u),_=s(u,"TBODY",{class:!0});var L=b(_);for(let A=0;A<y.length;A+=1)y[A].l(L);L.forEach(d),u.forEach(d),O=E(m),r&&r.l(m),m.forEach(d),this.h()},h(){i(_,"class","table-group-divider"),i(t,"class","table table-hover align-middle"),i(e,"class","table-responsive")},m(f,m){he(f,e,m),a(e,t),a(t,l),a(t,h),a(t,_);for(let u=0;u<y.length;u+=1)y[u]&&y[u].m(_,null);a(e,O),r&&r.m(e,null)},p(f,m){m&2064&&(I=Je(f[4]),y=ft(y,m,U,1,f,I,g,_,_t,Ke,null,We)),f[4].length===0?r||(r=Xe(),r.c(),r.m(e,null)):r&&(r.d(1),r=null)},d(f){f&&d(e);for(let m=0;m<y.length;m+=1)y[m].d();r&&r.d()}}}function Ct(n){let e,t='<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>';return{c(){e=o("div"),e.innerHTML=t,this.h()},l(l){e=s(l,"DIV",{class:!0,"data-svelte-h":!0}),C(e)!=="svelte-mlx3u2"&&(e.innerHTML=t),this.h()},h(){i(e,"class","text-center py-5")},m(l,c){he(l,e,c)},p:qe,d(l){l&&d(e)}}}function yt(n){let e,t="Never";return{c(){e=o("span"),e.textContent=t,this.h()},l(l){e=s(l,"SPAN",{class:!0,"data-svelte-h":!0}),C(e)!=="svelte-1qml2vo"&&(e.textContent=t),this.h()},h(){i(e,"class","text-muted")},m(l,c){he(l,e,c)},p:qe,d(l){l&&d(e)}}}function Tt(n){let e=new Date(n[25].last_login).toLocaleDateString()+"",t;return{c(){t=ge(e)},l(l){t=be(l,e)},m(l,c){he(l,t,c)},p(l,c){c&16&&e!==(e=new Date(l[25].last_login).toLocaleDateString()+"")&&ke(t,e)},d(l){l&&d(t)}}}function Ke(n,e){let t,l,c,h=(e[25].display_name??e[25].email)+"",_,y,g,O=e[25].email+"",I,U,r,f,m=e[25].role+"",u,L,A,V,S,q=e[25].is_active?"Active":"Disabled",z,Q,W,M,R,B=new Date(e[25].created_at).toLocaleDateString()+"",F,T,H,$,ne,Y,G,P,Te,K,ie,oe;function J(Z,p){return Z[25].last_login?Tt:yt}let X=J(e),N=X(e);function Ce(){return e[19](e[25])}return{key:n,first:null,c(){t=o("tr"),l=o("td"),c=o("div"),_=ge(h),y=w(),g=o("td"),I=ge(O),U=w(),r=o("td"),f=o("span"),u=ge(m),A=w(),V=o("td"),S=o("span"),z=ge(q),W=w(),M=o("td"),R=o("small"),F=ge(B),T=w(),H=o("td"),$=o("small"),N.c(),ne=w(),Y=o("td"),G=o("button"),P=o("i"),Te=w(),this.h()},l(Z){t=s(Z,"TR",{class:!0});var p=b(t);l=s(p,"TD",{});var ve=b(l);c=s(ve,"DIV",{class:!0});var pe=b(c);_=be(pe,h),pe.forEach(d),ve.forEach(d),y=E(p),g=s(p,"TD",{});var ce=b(g);I=be(ce,O),ce.forEach(d),U=E(p),r=s(p,"TD",{});var se=b(r);f=s(se,"SPAN",{class:!0});var ue=b(f);u=be(ue,m),ue.forEach(d),se.forEach(d),A=E(p),V=s(p,"TD",{});var fe=b(V);S=s(fe,"SPAN",{class:!0});var ee=b(S);z=be(ee,q),ee.forEach(d),fe.forEach(d),W=E(p),M=s(p,"TD",{});var xe=b(M);R=s(xe,"SMALL",{});var x=b(R);F=be(x,B),x.forEach(d),xe.forEach(d),T=E(p),H=s(p,"TD",{});var re=b(H);$=s(re,"SMALL",{});var ye=b($);N.l(ye),ye.forEach(d),re.forEach(d),ne=E(p),Y=s(p,"TD",{class:!0});var te=b(Y);G=s(te,"BUTTON",{class:!0,type:!0,"data-bs-toggle":!0,"data-bs-target":!0,"aria-controls":!0});var v=b(G);P=s(v,"I",{class:!0}),b(P).forEach(d),v.forEach(d),te.forEach(d),Te=E(p),p.forEach(d),this.h()},h(){i(c,"class","fw-semibold"),i(f,"class",L=`badge bg-${Ze(e[25].role)} text-uppercase`),i(S,"class",Q=`badge ${e[25].is_active?"bg-success":"bg-danger"}`),i(P,"class","bi bi-pencil"),i(G,"class","btn btn-sm btn-outline-primary"),i(G,"type","button"),i(G,"data-bs-toggle","offcanvas"),i(G,"data-bs-target",`#${$e}`),i(G,"aria-controls",$e),i(Y,"class","text-end"),i(t,"class",K=e[25].is_active?"":"opacity-75"),this.first=t},m(Z,p){he(Z,t,p),a(t,l),a(l,c),a(c,_),a(t,y),a(t,g),a(g,I),a(t,U),a(t,r),a(r,f),a(f,u),a(t,A),a(t,V),a(V,S),a(S,z),a(t,W),a(t,M),a(M,R),a(R,F),a(t,T),a(t,H),a(H,$),N.m($,null),a(t,ne),a(t,Y),a(Y,G),a(G,P),a(t,Te),ie||(oe=me(G,"click",Ce),ie=!0)},p(Z,p){e=Z,p&16&&h!==(h=(e[25].display_name??e[25].email)+"")&&ke(_,h),p&16&&O!==(O=e[25].email+"")&&ke(I,O),p&16&&m!==(m=e[25].role+"")&&ke(u,m),p&16&&L!==(L=`badge bg-${Ze(e[25].role)} text-uppercase`)&&i(f,"class",L),p&16&&q!==(q=e[25].is_active?"Active":"Disabled")&&ke(z,q),p&16&&Q!==(Q=`badge ${e[25].is_active?"bg-success":"bg-danger"}`)&&i(S,"class",Q),p&16&&B!==(B=new Date(e[25].created_at).toLocaleDateString()+"")&&ke(F,B),X===(X=J(e))&&N?N.p(e,p):(N.d(1),N=X(e),N&&(N.c(),N.m($,null))),p&16&&K!==(K=e[25].is_active?"":"opacity-75")&&i(t,"class",K)},d(Z){Z&&d(t),N.d(),ie=!1,oe()}}}function Xe(n){let e,t="<p>No users found matching your filters.</p>";return{c(){e=o("div"),e.innerHTML=t,this.h()},l(l){e=s(l,"DIV",{class:!0,"data-svelte-h":!0}),C(e)!=="svelte-i4erte"&&(e.innerHTML=t),this.h()},h(){i(e,"class","text-center py-5 text-muted")},m(l,c){he(l,e,c)},d(l){l&&d(e)}}}function xt(n){let e,t="Select a user to edit.";return{c(){e=o("p"),e.textContent=t,this.h()},l(l){e=s(l,"P",{class:!0,"data-svelte-h":!0}),C(e)!=="svelte-l09ef1"&&(e.textContent=t),this.h()},h(){i(e,"class","text-muted mb-0")},m(l,c){he(l,e,c)},p:qe,d(l){l&&d(e)}}}function Et(n){let e,t,l,c="Display Name",h,_,y,g,O,I="Role",U,r,f,m="Root",u,L="Admin",A,V="Primary",S,q="Relief Society",z,Q="Elders Quorum",W,M="Teachers Quorum",R,B="Young Women",F,T="Sunday School",H,$="Authenticated",ne,Y="Un-Authenticated",G,P,Te="Assign a church calling role to grant permissions",K,ie,oe,J,X,N,Ce="Active Account",Z,p,ve="Disabled accounts cannot login",pe,ce,se,ue="Admin Notes",fe,ee,xe,x,re,ye="Cancel",te,v,D="Save Changes",_e,Ee;return{c(){e=o("form"),t=o("div"),l=o("label"),l.textContent=c,h=w(),_=o("input"),y=w(),g=o("div"),O=o("label"),O.textContent=I,U=w(),r=o("select"),f=o("option"),f.textContent=m,u=o("option"),u.textContent=L,A=o("option"),A.textContent=V,S=o("option"),S.textContent=q,z=o("option"),z.textContent=Q,W=o("option"),W.textContent=M,R=o("option"),R.textContent=B,F=o("option"),F.textContent=T,H=o("option"),H.textContent=$,ne=o("option"),ne.textContent=Y,G=w(),P=o("div"),P.textContent=Te,K=w(),ie=o("div"),oe=o("div"),J=o("input"),X=w(),N=o("label"),N.textContent=Ce,Z=w(),p=o("div"),p.textContent=ve,pe=w(),ce=o("div"),se=o("label"),se.textContent=ue,fe=w(),ee=o("textarea"),xe=w(),x=o("div"),re=o("button"),re.textContent=ye,te=w(),v=o("button"),v.textContent=D,this.h()},l(de){e=s(de,"FORM",{class:!0});var j=b(e);t=s(j,"DIV",{});var le=b(t);l=s(le,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),C(l)!=="svelte-1qww9aa"&&(l.textContent=c),h=E(le),_=s(le,"INPUT",{type:!0,class:!0,id:!0,placeholder:!0}),le.forEach(d),y=E(j),g=s(j,"DIV",{});var we=b(g);O=s(we,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),C(O)!=="svelte-qedzc3"&&(O.textContent=I),U=E(we),r=s(we,"SELECT",{class:!0,id:!0});var ae=b(r);f=s(ae,"OPTION",{"data-svelte-h":!0}),C(f)!=="svelte-j6h65q"&&(f.textContent=m),u=s(ae,"OPTION",{"data-svelte-h":!0}),C(u)!=="svelte-17op260"&&(u.textContent=L),A=s(ae,"OPTION",{"data-svelte-h":!0}),C(A)!=="svelte-afolwu"&&(A.textContent=V),S=s(ae,"OPTION",{"data-svelte-h":!0}),C(S)!=="svelte-caqcsh"&&(S.textContent=q),z=s(ae,"OPTION",{"data-svelte-h":!0}),C(z)!=="svelte-z5bf0h"&&(z.textContent=Q),W=s(ae,"OPTION",{"data-svelte-h":!0}),C(W)!=="svelte-h2ndd"&&(W.textContent=M),R=s(ae,"OPTION",{"data-svelte-h":!0}),C(R)!=="svelte-13e2z3"&&(R.textContent=B),F=s(ae,"OPTION",{"data-svelte-h":!0}),C(F)!=="svelte-1gqwsr1"&&(F.textContent=T),H=s(ae,"OPTION",{"data-svelte-h":!0}),C(H)!=="svelte-1hh738g"&&(H.textContent=$),ne=s(ae,"OPTION",{"data-svelte-h":!0}),C(ne)!=="svelte-1nm0qee"&&(ne.textContent=Y),ae.forEach(d),G=E(we),P=s(we,"DIV",{class:!0,"data-svelte-h":!0}),C(P)!=="svelte-adi1xr"&&(P.textContent=Te),we.forEach(d),K=E(j),ie=s(j,"DIV",{});var De=b(ie);oe=s(De,"DIV",{class:!0});var Ne=b(oe);J=s(Ne,"INPUT",{class:!0,type:!0,id:!0}),X=E(Ne),N=s(Ne,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),C(N)!=="svelte-gc2a6c"&&(N.textContent=Ce),Ne.forEach(d),Z=E(De),p=s(De,"DIV",{class:!0,"data-svelte-h":!0}),C(p)!=="svelte-ip672x"&&(p.textContent=ve),De.forEach(d),pe=E(j),ce=s(j,"DIV",{});var Le=b(ce);se=s(Le,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),C(se)!=="svelte-17a0zww"&&(se.textContent=ue),fe=E(Le),ee=s(Le,"TEXTAREA",{class:!0,id:!0,rows:!0,placeholder:!0}),b(ee).forEach(d),Le.forEach(d),xe=E(j),x=s(j,"DIV",{class:!0});var Pe=b(x);re=s(Pe,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),C(re)!=="svelte-10ov1w5"&&(re.textContent=ye),te=E(Pe),v=s(Pe,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),C(v)!=="svelte-bcbxuj"&&(v.textContent=D),Pe.forEach(d),j.forEach(d),this.h()},h(){i(l,"class","form-label"),i(l,"for","displayName"),i(_,"type","text"),i(_,"class","form-control"),i(_,"id","displayName"),i(_,"placeholder","Display name (optional)"),i(O,"class","form-label"),i(O,"for","userRole"),f.__value="root",k(f,f.__value),u.__value="admin",k(u,u.__value),A.__value="primary",k(A,A.__value),S.__value="relief-society",k(S,S.__value),z.__value="elders-quorum",k(z,z.__value),W.__value="teachers-quorum",k(W,W.__value),R.__value="young-women",k(R,R.__value),F.__value="sunday-school",k(F,F.__value),H.__value="authenticated",k(H,H.__value),ne.__value="un-authenticated",k(ne,ne.__value),i(r,"class","form-select"),i(r,"id","userRole"),n[2].role===void 0&&at(()=>n[21].call(r)),i(P,"class","form-text"),i(J,"class","form-check-input"),i(J,"type","checkbox"),i(J,"id","isActive"),i(N,"class","form-check-label"),i(N,"for","isActive"),i(oe,"class","form-check form-switch"),i(p,"class","form-text"),i(se,"class","form-label"),i(se,"for","adminNotes"),i(ee,"class","form-control"),i(ee,"id","adminNotes"),i(ee,"rows","3"),i(ee,"placeholder","Internal notes about this user..."),i(re,"type","button"),i(re,"class","btn btn-secondary"),i(v,"type","submit"),i(v,"class","btn btn-primary"),i(x,"class","d-flex justify-content-end gap-2"),i(e,"class","d-flex flex-column gap-3")},m(de,j){he(de,e,j),a(e,t),a(t,l),a(t,h),a(t,_),k(_,n[2].display_name),a(e,y),a(e,g),a(g,O),a(g,U),a(g,r),a(r,f),a(r,u),a(r,A),a(r,S),a(r,z),a(r,W),a(r,R),a(r,F),a(r,H),a(r,ne),Se(r,n[2].role,!0),a(g,G),a(g,P),a(e,K),a(e,ie),a(ie,oe),a(oe,J),J.checked=n[2].is_active,a(oe,X),a(oe,N),a(ie,Z),a(ie,p),a(e,pe),a(e,ce),a(ce,se),a(ce,fe),a(ce,ee),k(ee,n[2].notes),a(e,xe),a(e,x),a(x,re),a(x,te),a(x,v),_e||(Ee=[me(_,"input",n[20]),me(r,"change",n[21]),me(J,"change",n[22]),me(ee,"input",n[23]),me(re,"click",n[12]),me(e,"submit",ut(n[13]))],_e=!0)},p(de,j){j&4&&_.value!==de[2].display_name&&k(_,de[2].display_name),j&4&&Se(r,de[2].role),j&4&&(J.checked=de[2].is_active),j&4&&k(ee,de[2].notes)},d(de){de&&d(e),_e=!1,lt(Ee)}}}function wt(n){let e;function t(h,_){return h[2]?Et:xt}let l=t(n),c=l(n);return{c(){c.c(),e=Fe()},l(h){c.l(h),e=Fe()},m(h,_){c.m(h,_),he(h,e,_)},p(h,_){l===(l=t(h))&&c?c.p(h,_):(c.d(1),c=l(h),c&&(c.c(),c.m(e.parentNode,e)))},d(h){h&&d(e),c.d(h)}}}function kt(n){let e,t,l,c="User Management",h,_,y='<i class="bi bi-arrow-clockwise"></i> Refresh',g,O,I,U,r,f,m,u,L,A="All Roles",V,S="Root",q,z="Admin",Q,W="Primary",M,R="Relief Society",B,F="Elders Quorum",T,H="Teachers Quorum",$,ne="Young Women",Y,G="Sunday School",P,Te="Authenticated",K,ie="Un-Authenticated",oe,J,X,N,Ce=n[4].length+"",Z,p,ve=n[4].length!==1?"s":"",pe,ce,se,ue,fe,ee,xe,x=n[5]&&Ge(n);function re(v,D){return v[6]?Ct:gt}let ye=re(n),te=ye(n);return ue=new ht({props:{title:n[3],id:$e,$$slots:{default:[wt]},$$scope:{ctx:n}}}),{c(){e=o("div"),t=o("div"),l=o("h2"),l.textContent=c,h=w(),_=o("button"),_.innerHTML=y,g=w(),x&&x.c(),O=w(),I=o("div"),U=o("div"),r=o("input"),f=w(),m=o("div"),u=o("select"),L=o("option"),L.textContent=A,V=o("option"),V.textContent=S,q=o("option"),q.textContent=z,Q=o("option"),Q.textContent=W,M=o("option"),M.textContent=R,B=o("option"),B.textContent=F,T=o("option"),T.textContent=H,$=o("option"),$.textContent=ne,Y=o("option"),Y.textContent=G,P=o("option"),P.textContent=Te,K=o("option"),K.textContent=ie,oe=w(),J=o("div"),X=o("div"),N=ge("Total: "),Z=ge(Ce),p=ge(" user"),pe=ge(ve),ce=w(),te.c(),se=w(),ze(ue.$$.fragment),this.h()},l(v){e=s(v,"DIV",{class:!0});var D=b(e);t=s(D,"DIV",{class:!0});var _e=b(t);l=s(_e,"H2",{"data-svelte-h":!0}),C(l)!=="svelte-1w9k0u8"&&(l.textContent=c),h=E(_e),_=s(_e,"BUTTON",{class:!0,"data-svelte-h":!0}),C(_)!=="svelte-1t5isil"&&(_.innerHTML=y),_e.forEach(d),g=E(D),x&&x.l(D),O=E(D),I=s(D,"DIV",{class:!0});var Ee=b(I);U=s(Ee,"DIV",{class:!0});var de=b(U);r=s(de,"INPUT",{type:!0,class:!0,placeholder:!0}),de.forEach(d),f=E(Ee),m=s(Ee,"DIV",{class:!0});var j=b(m);u=s(j,"SELECT",{class:!0});var le=b(u);L=s(le,"OPTION",{"data-svelte-h":!0}),C(L)!=="svelte-1yhiy9v"&&(L.textContent=A),V=s(le,"OPTION",{"data-svelte-h":!0}),C(V)!=="svelte-j6h65q"&&(V.textContent=S),q=s(le,"OPTION",{"data-svelte-h":!0}),C(q)!=="svelte-17op260"&&(q.textContent=z),Q=s(le,"OPTION",{"data-svelte-h":!0}),C(Q)!=="svelte-afolwu"&&(Q.textContent=W),M=s(le,"OPTION",{"data-svelte-h":!0}),C(M)!=="svelte-caqcsh"&&(M.textContent=R),B=s(le,"OPTION",{"data-svelte-h":!0}),C(B)!=="svelte-z5bf0h"&&(B.textContent=F),T=s(le,"OPTION",{"data-svelte-h":!0}),C(T)!=="svelte-h2ndd"&&(T.textContent=H),$=s(le,"OPTION",{"data-svelte-h":!0}),C($)!=="svelte-13e2z3"&&($.textContent=ne),Y=s(le,"OPTION",{"data-svelte-h":!0}),C(Y)!=="svelte-1gqwsr1"&&(Y.textContent=G),P=s(le,"OPTION",{"data-svelte-h":!0}),C(P)!=="svelte-1hh738g"&&(P.textContent=Te),K=s(le,"OPTION",{"data-svelte-h":!0}),C(K)!=="svelte-1nm0qee"&&(K.textContent=ie),le.forEach(d),j.forEach(d),oe=E(Ee),J=s(Ee,"DIV",{class:!0});var we=b(J);X=s(we,"DIV",{class:!0});var ae=b(X);N=be(ae,"Total: "),Z=be(ae,Ce),p=be(ae," user"),pe=be(ae,ve),ae.forEach(d),we.forEach(d),Ee.forEach(d),ce=E(D),te.l(D),D.forEach(d),se=E(v),je(ue.$$.fragment,v),this.h()},h(){i(_,"class","btn btn-primary"),i(t,"class","d-flex justify-content-between align-items-center mb-4"),i(r,"type","text"),i(r,"class","form-control"),i(r,"placeholder","Search by email or name..."),i(U,"class","col-md-6"),L.__value="all",k(L,L.__value),V.__value="root",k(V,V.__value),q.__value="admin",k(q,q.__value),Q.__value="primary",k(Q,Q.__value),M.__value="relief-society",k(M,M.__value),B.__value="elders-quorum",k(B,B.__value),T.__value="teachers-quorum",k(T,T.__value),$.__value="young-women",k($,$.__value),Y.__value="sunday-school",k(Y,Y.__value),P.__value="authenticated",k(P,P.__value),K.__value="un-authenticated",k(K,K.__value),i(u,"class","form-select"),n[0]===void 0&&at(()=>n[18].call(u)),i(m,"class","col-md-3"),i(X,"class","text-muted mt-2"),i(J,"class","col-md-3"),i(I,"class","row mb-3"),i(e,"class","user-management")},m(v,D){he(v,e,D),a(e,t),a(t,l),a(t,h),a(t,_),a(e,g),x&&x.m(e,null),a(e,O),a(e,I),a(I,U),a(U,r),k(r,n[1]),a(I,f),a(I,m),a(m,u),a(u,L),a(u,V),a(u,q),a(u,Q),a(u,M),a(u,B),a(u,T),a(u,$),a(u,Y),a(u,P),a(u,K),Se(u,n[0],!0),a(I,oe),a(I,J),a(J,X),a(X,N),a(X,Z),a(X,p),a(X,pe),a(e,ce),te.m(e,null),he(v,se,D),He(ue,v,D),fe=!0,ee||(xe=[me(_,"click",n[15]),me(r,"input",n[17]),me(u,"change",n[18])],ee=!0)},p(v,[D]){v[5]?x?x.p(v,D):(x=Ge(v),x.c(),x.m(e,O)):x&&(x.d(1),x=null),D&2&&r.value!==v[1]&&k(r,v[1]),D&1&&Se(u,v[0]),(!fe||D&16)&&Ce!==(Ce=v[4].length+"")&&ke(Z,Ce),(!fe||D&16)&&ve!==(ve=v[4].length!==1?"s":"")&&ke(pe,ve),ye===(ye=re(v))&&te?te.p(v,D):(te.d(1),te=ye(v),te&&(te.c(),te.m(e,null)));const _e={};D&8&&(_e.title=v[3]),D&268435460&&(_e.$$scope={dirty:D,ctx:v}),ue.$set(_e)},i(v){fe||(Be(ue.$$.fragment,v),fe=!0)},o(v){Re(ue.$$.fragment,v),fe=!1},d(v){v&&(d(e),d(se)),x&&x.d(),te.d(),Me(ue,v),ee=!1,lt(xe)}}}function Ze(n){switch(n){case"root":return"danger";case"admin":return"primary";case"primary":case"relief-society":case"elders-quorum":case"teachers-quorum":case"young-women":case"sunday-school":return"info";case"authenticated":return"success";case"un-authenticated":return"secondary";default:return"secondary"}}const $e="edit-user-drawer";function et(){document.querySelector(`[data-bs-target="#${$e}"]`)?.click()}function Ot(n,e,t){let l,c,h,_;const{stores:y,actions:g}=bt,{users:O,loading:I,error:U}=y;Ae(n,O,T=>t(14,c=T)),Ae(n,I,T=>t(6,_=T)),Ae(n,U,T=>t(5,h=T));let r=null,f="all",m="",u="Edit User";nt(()=>{g.fetchUsers()});function L(T){t(2,r={...T}),t(3,u=`Edit User: ${T.email}`)}function A(){t(2,r=null),et()}async function V(){if(!r)return;(await g.updateUser(r.id,{role:r.role,is_active:r.is_active,notes:r.notes,display_name:r.display_name})).success&&(et(),t(2,r=null))}const S=()=>g.fetchUsers(),q=()=>U.set(null);function z(){m=this.value,t(1,m)}function Q(){f=Ye(this),t(0,f)}const W=T=>L(T);function M(){r.display_name=this.value,t(2,r)}function R(){r.role=Ye(this),t(2,r)}function B(){r.is_active=this.checked,t(2,r)}function F(){r.notes=this.value,t(2,r)}return n.$$.update=()=>{n.$$.dirty&16387&&t(4,l=c.filter(T=>{const H=f==="all"||T.role===f,$=m===""||T.email.toLowerCase().includes(m.toLowerCase())||T.display_name?.toLowerCase().includes(m.toLowerCase());return H&&$}))},[f,m,r,u,l,h,_,g,O,I,U,L,A,V,c,S,q,z,Q,W,M,R,B,F]}class It extends st{constructor(e){super(),ot(this,e,Ot,kt,tt,{})}}function Dt(n){let e,t;return e=new It({}),{c(){ze(e.$$.fragment)},l(l){je(e.$$.fragment,l)},m(l,c){He(e,l,c),t=!0},i(l){t||(Be(e.$$.fragment,l),t=!0)},o(l){Re(e.$$.fragment,l),t=!1},d(l){Me(e,l)}}}function Nt(n){let e,t;return e=new dt({props:{pageTitle:"Manage Users",$$slots:{default:[Dt]},$$scope:{ctx:n}}}),{c(){ze(e.$$.fragment)},l(l){je(e.$$.fragment,l)},m(l,c){He(e,l,c),t=!0},p(l,[c]){const h={};c&4&&(h.$$scope={dirty:c,ctx:l}),e.$set(h)},i(l){t||(Be(e.$$.fragment,l),t=!0)},o(l){Re(e.$$.fragment,l),t=!1},d(l){Me(e,l)}}}function Lt(n,e,t){let l;const{stores:{currentUser:c}}=pt();return Ae(n,c,h=>t(1,l=h)),nt(()=>{l?.role!=="root"&&l?.role!=="admin"&&vt("/home")}),[c]}class Mt extends st{constructor(e){super(),ot(this,e,Lt,Nt,tt,{})}}export{Mt as component};
