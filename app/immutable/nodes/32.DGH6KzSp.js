import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{P as at}from"../chunks/CArQcAaT.js";import{w as Ae,g as Ue,c as Ge,o as rt}from"../chunks/DjNGvcU6.js";import{p as Fe,aj as z,D as l,E as h,g as e,ak as qe,c as o,s as v,r as i,u as x,t as ie,a as Re,f as ee,F as Je,R as it}from"../chunks/JKZwkikK.js";import{b as ne,i as j,e as Z,a as Te,s as de}from"../chunks/BxjzTaz1.js";import{e as ye,i as we}from"../chunks/B2BlSr7K.js";import{f as _,a as c,c as Le,t as Se}from"../chunks/JDsN5plM.js";import{r as Ce,s as Me}from"../chunks/Bh5oNA2x.js";import{b as me,g as nt,P as ot,c as lt}from"../chunks/282ZQEaZ.js";import{i as Be}from"../chunks/b8c_lO2i.js";import{D as Ve}from"../chunks/CDqcjSyf.js";import{S as he}from"../chunks/CcH1v8Wt.js";import{g as Oe}from"../chunks/BioSw8zH.js";import{b as Ie}from"../chunks/BL6gm64P.js";import{p as Ke}from"../chunks/CdEA5IGF.js";const ct=`
	*,
	member_list_members (
		id,
		list_id,
		member_id,
		added_by,
		created_at,
		members (
			id,
			first_name,
			last_name,
			date_of_birth,
			phone_number
		)
	)
`;async function dt(){const{data:b,error:u}=await me.from("member_lists").select(ct).order("name");if(u)throw u;return b||[]}async function mt(b){const{data:u,error:f}=await me.from("member_lists").insert({name:b}).select().single();if(f)throw f;return u}async function ut(b,u){const{data:f,error:y}=await me.from("member_lists").update({name:u,updated_at:new Date().toISOString()}).eq("id",b).select().single();if(y)throw y;return f}async function ft(b){const{error:u}=await me.from("member_lists").delete().eq("id",b);if(u)throw u}async function Ye(b,u){const{data:f,error:y}=await me.from("member_list_members").insert({list_id:b,member_id:u}).select("id, list_id, member_id, added_by, created_at").single();if(y)throw y;return f}async function vt(b,u){const{error:f}=await me.from("member_list_members").delete().eq("list_id",b).eq("member_id",u);if(f)throw f}let De=null;const bt=()=>{const b=Ae(!1),u=Ae([]),f=Ae(null),y=async()=>{b.set(!1);const n=await dt();u.set(n);const $=Ue(f);!$&&n.length?f.set(n[0].id??null):$&&(n.some(F=>F.id===$)||f.set(n.length?n[0].id??null:null)),b.set(!0)};return De={stores:{ready:b,lists:u,selectedListId:f},actions:{reload:y,selectList:n=>{f.set(n)},createListWithMembers:async(n,$)=>{const P=await mt(n);if(P.id)for(const F of $)await Ye(P.id,F);return await y(),Ue(u).find(F=>F.id===P.id)??null},renameList:async(n,$)=>{await ut(n,$),await y()},removeList:async n=>{await ft(n),await y()},addMember:async(n,$)=>{await Ye(n,$),await y()},removeMember:async(n,$)=>{await vt(n,$),await y()}}},De},We=()=>De||bt();var pt=_('<li class="list-group-item d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-primary" type="button">Add</button></li>'),_t=_('<ul class="list-group list-group-flush border rounded mt-2"></ul>'),gt=_('<p class="text-muted mt-2">No members match that search.</p>'),ht=_('<li class="list-group-item d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-link text-danger text-decoration-none" type="button">Remove</button></li>'),yt=_('<div class="mt-3"><p class="mb-2">Selected members:</p> <ul class="list-group list-group-flush border rounded"></ul></div>'),wt=_("<!> Creating...",1),Lt=_('<form class="d-flex flex-column gap-3"><div><label class="form-label" for="member-list-name">List name</label> <input id="member-list-name" class="form-control" type="text" required placeholder="e.g., Temple Preparation"/></div> <div><label class="form-label" for="member-list-members">Members (optional)</label> <input id="member-list-members" class="form-control" type="text" placeholder="Search members..."/> <!> <!></div> <div class="d-flex justify-content-end gap-2"><button class="btn btn-secondary" type="button" data-bs-dismiss="offcanvas">Cancel</button> <button class="btn btn-primary" type="submit"><!></button></div></form>');function xt(b,u){Fe(u,!1);const f=()=>ne(P,"$members",y),[y,te]=Te(),A=h(),Y=h();let C=h(!1),I=h(""),s=h([]),n=h("");const $=Ge(),{stores:{members:P}}=Oe(),{actions:{createListWithMembers:F}}=We();function ue(a,d=[],t=6){if(!a.trim())return[];const p=a.toLowerCase();return e(A).filter(m=>{if(!m.id||d.includes(m.id))return!1;const w=m.first_name?.toLowerCase()??"",M=m.last_name?.toLowerCase()??"";return`${w} ${M}`.includes(p)}).slice(0,t)}function fe(a){!a.id||e(s).some(t=>t.id===a.id)||(l(s,[...e(s),a]),l(n,""))}function ve(a){l(s,e(s).filter(d=>d.id!==a))}async function oe(a){if(a.preventDefault(),!e(I).trim())return;l(C,!0);const d=e(s).map(t=>t.id||0).filter(t=>!!t);try{await F(e(I).trim(),d),l(I,""),l(s,[]),l(n,""),$("listCreated")}catch(t){console.error("Failed to create list",t)}finally{l(C,!1)}}z(()=>f(),()=>{l(A,f()||[])}),z(()=>(e(n),e(s)),()=>{l(Y,ue(e(n),e(s).map(a=>a.id||0).filter(a=>!!a)))}),qe(),Be();var G=Lt(),U=o(G),J=v(o(U),2);Ce(J),i(U);var E=v(U,2),q=v(o(E),2);Ce(q);var R=v(q,2);{var K=a=>{var d=_t();ye(d,5,()=>e(Y),we,(t,p)=>{var m=pt(),w=o(m),M=o(w);i(w);var V=v(w,2);i(m),ie(()=>de(M,`${e(p),x(()=>e(p).first_name)??""} ${e(p),x(()=>e(p).last_name)??""}`)),Z("click",V,()=>fe(e(p))),c(t,m)}),i(d),c(a,d)},se=a=>{var d=Le(),t=ee(d);{var p=m=>{var w=gt();c(m,w)};j(t,m=>{e(n),x(()=>e(n).trim())&&m(p)},!0)}c(a,d)};j(R,a=>{e(Y),x(()=>e(Y).length)?a(K):a(se,!1)})}var be=v(R,2);{var pe=a=>{var d=yt(),t=v(o(d),2);ye(t,5,()=>e(s),we,(p,m)=>{var w=ht(),M=o(w),V=o(M);i(M);var L=v(M,2);i(w),ie(()=>de(V,`${e(m),x(()=>e(m).first_name)??""} ${e(m),x(()=>e(m).last_name)??""}`)),Z("click",L,()=>{e(m)?.id&&ve(e(m)?.id)}),c(p,w)}),i(t),i(d),c(a,d)};j(be,a=>{e(s),x(()=>e(s).length)&&a(pe)})}i(E);var S=v(E,2),D=v(o(S),2),T=o(D);{var N=a=>{var d=wt(),t=ee(d);he(t,{size:"sm"}),Je(),c(a,d)},le=a=>{var d=Se("Create List");c(a,d)};j(T,a=>{e(C)?a(N):a(le,!1)})}i(D),i(S),i(G),ie(()=>D.disabled=e(C)),Ie(J,()=>e(I),a=>l(I,a)),Ie(q,()=>e(n),a=>l(n,a)),Z("submit",G,Ke(oe)),c(b,G),Re(),te()}var $t=_("<!> Deleting...",1),Mt=_('<li class="list-group-item d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-primary" type="button">Add</button></li>'),St=_('<ul class="list-group list-group-flush border rounded mt-2"></ul>'),Ct=_('<p class="text-muted mt-2">No members match that search.</p>'),It=_('<li class="list-group-item d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-link text-danger text-decoration-none" type="button" aria-label="Remove member"><i class="bi bi-trash"></i></button></li>'),Dt=_('<ul class="list-group"></ul>'),Et=_('<p class="text-muted">No members in this list yet.</p>'),kt=_('<div class="d-flex flex-column gap-4"><div class="d-flex flex-column gap-4"><form class="d-flex gap-2"><input class="form-control" type="text" placeholder="List name"/></form> <div class="d-flex justify-content-between gap-2"><button class="btn btn-danger" aria-label="Delete list" type="button"><!></button> <div class="d-flex gap-2"><button class="btn btn-secondary" aria-label="Cancel" type="button" data-bs-dismiss="offcanvas"><!></button> <button class="btn btn-primary" aria-label="save" type="submit"><!></button></div></div></div> <div><h2 class="h6 mb-2">Add Member</h2> <input class="form-control" type="text" placeholder="Search members..."/> <!></div> <div><h2 class="h6">Members</h2> <!></div></div>'),jt=_('<p class="text-muted">Select a list to manage it.</p>');function Nt(b,u){Fe(u,!1);const f=()=>ne(ue,"$lists",A),y=()=>ne(fe,"$selectedListId",A),te=()=>ne(F,"$members",A),[A,Y]=Te(),C=h(),I=h(),s=h(),n=h(),$=h(),P=h(),{stores:{members:F}}=Oe(),{stores:{lists:ue,selectedListId:fe},actions:{addMember:ve,removeMember:oe,renameList:G,removeList:U}}=We(),J=Ge();let E=h(""),q=h(""),R=h(!1),K=h(!1),se=h(null);function be(t,p=[],m=6){if(!t.trim())return[];const w=t.toLowerCase();return e($).filter(M=>{if(!M.id||p.includes(M.id))return!1;const V=M.first_name?.toLowerCase()??"",L=M.last_name?.toLowerCase()??"";return`${V} ${L}`.includes(w)}).slice(0,m)}async function pe(t){e(s)&&(await ve(e(s).id,t),l(E,""))}async function S(t){e(s)&&await oe(e(s).id,t)}async function D(t){if(t.preventDefault(),!(!e(s)||!e(q).trim())){l(R,!0);try{await G(e(s).id,e(q).trim())}catch(p){console.error("Failed to rename list",p)}finally{l(R,!1)}}}async function T(){if(e(s)&&confirm("Are you sure you want to delete this member list?")){l(K,!0);try{await U(e(s).id)}catch(t){console.error("Failed to delete list",t)}finally{l(K,!1),J("listDeleted")}}}z(()=>f(),()=>{l(C,f()||[])}),z(()=>y(),()=>{l(I,y())}),z(()=>(e(C),e(I)),()=>{l(s,e(C).find(t=>t.id===e(I))||null)}),z(()=>e(s),()=>{l(P,e(s)?.member_list_members?.map(t=>t.member_id)??[])}),z(()=>(e(s),e(E),e(P)),()=>{l(n,e(s)?be(e(E),e(P)):[])}),z(()=>te(),()=>{l($,te()||[])}),z(()=>(e(s),e(se)),()=>{(e(s)?.id??null)!==e(se)&&(l(se,e(s)?.id??null),l(q,e(s)?.name??""))}),qe(),Be();var N=Le(),le=ee(N);{var a=t=>{var p=kt(),m=o(p),w=o(m),M=o(w);Ce(M),i(w);var V=v(w,2),L=o(V),B=o(L);{var ce=r=>{var g=$t(),re=ee(g);he(re,{size:"sm"}),Je(),c(r,g)},Ee=r=>{var g=Se("Delete List");c(r,g)};j(B,r=>{e(K)?r(ce):r(Ee,!1)})}i(L);var xe=v(L,2),O=o(xe),ae=o(O);{var ke=r=>{he(r,{size:"sm"})},Q=r=>{var g=Se("Cancel");c(r,g)};j(ae,r=>{e(R)?r(ke):r(Q,!1)})}i(O);var W=v(O,2),_e=o(W);{var je=r=>{he(r,{size:"sm"})},$e=r=>{var g=Se("Save");c(r,g)};j(_e,r=>{e(R)?r(je):r($e,!1)})}i(W),i(xe),i(V),i(m);var ge=v(m,2),Ne=v(o(ge),2);Ce(Ne);var Qe=v(Ne,2);{var Xe=r=>{var g=St();ye(g,5,()=>e(n),we,(re,k)=>{var H=Mt(),X=o(H),Pe=o(X);i(X);var ze=v(X,2);i(H),ie(()=>de(Pe,`${e(k),x(()=>e(k).first_name)??""} ${e(k),x(()=>e(k).last_name)??""}`)),Z("click",ze,()=>{e(k)?.id&&pe(e(k)?.id)}),c(re,H)}),i(g),c(r,g)},Ze=r=>{var g=Le(),re=ee(g);{var k=H=>{var X=Ct();c(H,X)};j(re,H=>{e(E),x(()=>e(E).trim())&&H(k)},!0)}c(r,g)};j(Qe,r=>{e(n),x(()=>e(n).length)?r(Xe):r(Ze,!1)})}i(ge);var He=v(ge,2),et=v(o(He),2);{var tt=r=>{var g=Dt();ye(g,5,()=>(e(s),x(()=>e(s).member_list_members)),we,(re,k)=>{var H=It(),X=o(H),Pe=o(X);i(X);var ze=v(X,2);i(H),ie(()=>de(Pe,`${e(k),x(()=>e(k).members?.first_name)??""} ${e(k),x(()=>e(k).members?.last_name)??""}`)),Z("click",ze,()=>S(e(k).member_id)),c(re,H)}),i(g),c(r,g)},st=r=>{var g=Et();c(r,g)};j(et,r=>{e(s),x(()=>e(s).member_list_members?.length)?r(tt):r(st,!1)})}i(He),i(p),ie(()=>{L.disabled=e(K),O.disabled=e(R),W.disabled=e(R)}),Ie(M,()=>e(q),r=>l(q,r)),Z("submit",w,Ke(D)),Z("click",L,T),Ie(Ne,()=>e(E),r=>l(E,r)),c(t,p)},d=t=>{var p=jt();c(t,p)};j(le,t=>{e(s)?t(a):t(d,!1)})}c(b,N),Re(),Y()}var Pt=_('<div class="alert alert-warning mt-4">You do not have permission to manage member lists.</div>'),zt=_('<button type="button" data-bs-toggle="offcanvas"><span> </span> <span class="badge bg-secondary rounded-pill"> </span></button>'),At=_('<div class="list-group list-group-flush"></div>'),Ft=_('<p class="text-muted p-3 mb-0">No lists yet. Create one to get started.</p>'),qt=_('<div class="p-4"><!></div>'),Rt=_('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center w-100"><span>Lists</span> <div class="d-flex align-items-center gap-2"><button class="btn btn-primary btn-sm" aria-label="Create new list" type="button" data-bs-toggle="offcanvas"><i class="bi bi-plus"></i></button></div></div></div> <div class="card-body p-0"><!></div></div> <!> <!>',1);function Tt(b,u){Fe(u,!1);const f=()=>ne(F,"$lists",A),y=()=>ne(ue,"$selectedListId",A),te=()=>ne(P,"$ready",A),[A,Y]=Te(),C=h(),I=h(),s=h(),{stores:{currentUserHasPermission:n}}=nt(),{actions:{reload:$}}=Oe(),{stores:{ready:P,lists:F,selectedListId:ue},actions:{reload:fe,selectList:ve}}=We();let oe=h(!1),G=!1;rt(()=>{const S=n.subscribe(D=>{const T=D(ot.ManageMemberLists);T&&!G&&(G=!0,$().catch(N=>console.error("Members reload failed",N)),fe().catch(N=>console.error("Member lists reload failed",N))),l(oe,T)});return()=>{S()}});const U="member-lists-create-drawer",J="member-lists-edit-drawer";function E(S){if(typeof window>"u")return;const D=document.getElementById(S);if(!D)return;window.bootstrap?.Offcanvas?.getInstance(D)?.hide()}function q(){E(J)}function R(){E(U)}z(()=>f(),()=>{l(C,f()||[])}),z(()=>y(),()=>{l(I,y())}),z(()=>(e(C),e(I)),()=>{l(s,e(C).find(S=>S.id===e(I))||null)}),qe(),Be();var K=Le(),se=ee(K);{var be=S=>{var D=Pt();c(S,D)},pe=S=>{var D=Rt(),T=ee(D),N=o(T),le=o(N),a=v(o(le),2),d=o(a);Me(d,"data-bs-target",`#${U}`),Me(d,"aria-controls",U),i(a),i(le),i(N);var t=v(N,2),p=o(t);{var m=L=>{var B=Le(),ce=ee(B);{var Ee=O=>{var ae=At();ye(ae,5,()=>e(C),we,(ke,Q)=>{var W=zt();Me(W,"data-bs-target",`#${J}`),Me(W,"aria-controls",J);var _e=o(W),je=o(_e,!0);i(_e);var $e=v(_e,2),ge=o($e,!0);i($e),i(W),ie(()=>{lt(W,1,(e(Q),e(I),x(()=>`list-group-item list-group-item-action d-flex justify-content-between align-items-center ${e(Q).id===e(I)?"active":""}`))),de(je,(e(Q),x(()=>e(Q).name))),de(ge,(e(Q),x(()=>e(Q).member_list_members?.length??0)))}),Z("click",W,()=>ve(e(Q).id??null)),c(ke,W)}),i(ae),c(O,ae)},xe=O=>{var ae=Ft();c(O,ae)};j(ce,O=>{e(C),x(()=>e(C).length)?O(Ee):O(xe,!1)})}c(L,B)},w=L=>{var B=qt(),ce=o(B);he(ce,{}),i(B),c(L,B)};j(p,L=>{te()?L(m):L(w,!1)})}i(t),i(T);var M=v(T,2);Ve(M,{title:"Create Member List",id:U,children:(L,B)=>{xt(L,{$$events:{listCreated:R}})},$$slots:{default:!0}});var V=v(M,2);{let L=it(()=>(e(s),x(()=>e(s)?`Edit ${e(s).name}`:"Edit Member List")));Ve(V,{get title(){return e(L)},id:J,children:(B,ce)=>{Nt(B,{$$events:{listDeleted:q}})},$$slots:{default:!0}})}c(S,D)};j(se,S=>{e(oe)?S(pe,!1):S(be)})}c(b,K),Re(),Y()}function as(b){at(b,{pageTitle:"Member Lists",children:(u,f)=>{Tt(u,{})},$$slots:{default:!0}})}export{as as component};
