import{s as Y,n as le,d as g,D as he,i as I,q as m,a as C,c as S,k as M,g as $,l as O,e as w,m as L,z,t as K,K as ge,r as pe,G as ae,y as Q,H as Ee,v as B,w as P,x as U,B as se}from"../chunks/Is0eQybD.js";import{S as J,i as W,d as X,t as Z,a as x,m as ee,c as te,b as ne}from"../chunks/DtCfv1Xo.js";import{P as De}from"../chunks/WdUv-xkR.js";import{e as j}from"../chunks/CTDgMtPg.js";import{R as G}from"../chunks/CA5X64sq.js";import{c as re,d as ve,f as H,g as Se}from"../chunks/B7muYh3r.js";import{w as we}from"../chunks/Oc_eB7Hn.js";function oe(l,e){const n=re(l),t=re(e);return+n==+t}const Te=!0,We=Object.freeze(Object.defineProperty({__proto__:null,prerender:Te},Symbol.toStringTag,{value:"Module"})),ye={SacramentBreadAssignments:"Sacrament Bread Assignments"},ke=["Folau Kaveinga","Tipi Kofe","Clenn Leituala","Vili Mapu","Keanu Naluai","Manase Soifua","Alex Tauteoli","Tray Teriipaia","Manoa Tuifua"],Me=[{date:new Date(2026,3,5),event:"General Conference"},{date:new Date(2026,9,4),event:"General Conference"}],Ae={Sundays:({start_date:l,until:e})=>new G({freq:G.WEEKLY,dtstart:l,until:e,byweekday:[G.SU]})},Ce=(l,e)=>l(e).all(),Ne=l=>{const e=l.getMonth(),n=l.getFullYear();let t=0;for(let s=1;s<=31;s++){const r=new Date(n,e,s);if(r.getMonth()!==e)break;if(r.getDay()===0&&(t++,r.getDate()===l.getDate())){const f=["st","nd","rd","th"],d=t<=3?f[t-1]:f[3];return`${t}${d}`}}return""},Oe=we([]);async function be(l){const{data:e,error:n}=await ve.from("assignments").select("*").eq("list_name",l).order("date");if(n)throw n;const t=e||[];return Oe.set(t),t}async function Le(l,e,n){const{error:t}=await ve.from("assignments").upsert([{list_name:l,date:e,overridden_member:n,updated_at:new Date().toISOString()}],{onConflict:"list_name, date"});if(t)throw t;await be(l)}function ie(l,e,n){const t=l.slice();return t[13]=e[n],t[14]=e,t[15]=n,t}function ce(l,e,n){const t=l.slice();return t[16]=e[n],t}function Re(l){let e,n=H(l[13].date,"MMM dd")+"",t,s,r,f=l[13].sundayNumber+"",d,u,c=H(l[13].date,"EEEE")+"",D,a,o,_,A,N=(l[13].overridden_member?l[13].overridden_member:l[13].member)+"",h,k,T=l[13].overridden_member?"*":"",E,y,b=l[0]&&ue();return{c(){e=w("td"),t=U(n),s=L(),r=w("small"),d=U(f),u=L(),D=U(c),a=L(),o=w("td"),_=w("div"),A=w("span"),h=U(N),k=L(),E=U(T),y=L(),b&&b.c(),this.h()},l(i){e=S(i,"TD",{});var v=M(e);t=P(v,n),s=O(v),r=S(v,"SMALL",{class:!0});var p=M(r);d=P(p,f),u=O(p),D=P(p,c),p.forEach(g),v.forEach(g),a=O(i),o=S(i,"TD",{});var R=M(o);_=S(R,"DIV",{class:!0});var q=M(_);A=S(q,"SPAN",{});var V=M(A);h=P(V,N),k=O(V),E=P(V,T),V.forEach(g),y=O(q),b&&b.l(q),q.forEach(g),R.forEach(g),this.h()},h(){C(r,"class","fw-lighter"),C(_,"class","d-flex justify-content-between")},m(i,v){I(i,e,v),m(e,t),m(e,s),m(e,r),m(r,d),m(r,u),m(r,D),I(i,a,v),I(i,o,v),m(o,_),m(_,A),m(A,h),m(A,k),m(A,E),m(_,y),b&&b.m(_,null)},p(i,v){v&4&&n!==(n=H(i[13].date,"MMM dd")+"")&&B(t,n),v&4&&f!==(f=i[13].sundayNumber+"")&&B(d,f),v&4&&c!==(c=H(i[13].date,"EEEE")+"")&&B(D,c),v&4&&N!==(N=(i[13].overridden_member?i[13].overridden_member:i[13].member)+"")&&B(h,N),v&4&&T!==(T=i[13].overridden_member?"*":"")&&B(E,T),i[0]?b||(b=ue(),b.c(),b.m(_,null)):b&&(b.d(1),b=null)},d(i){i&&(g(e),g(a),g(o)),b&&b.d()}}}function Ie(l){let e,n=H(l[13].date,"MMM dd")+"",t,s,r,f=l[13].sundayNumber+"",d,u,c=H(l[13].date,"EEEE")+"",D,a,o,_=(l[13].event??"")+"",A,N,h,k,T,E="No Sacrament Services";return{c(){e=w("td"),t=U(n),s=L(),r=w("small"),d=U(f),u=L(),D=U(c),a=L(),o=w("td"),A=U(_),N=L(),h=w("br"),k=L(),T=w("small"),T.textContent=E,this.h()},l(y){e=S(y,"TD",{});var b=M(e);t=P(b,n),s=O(b),r=S(b,"SMALL",{class:!0});var i=M(r);d=P(i,f),u=O(i),D=P(i,c),i.forEach(g),b.forEach(g),a=O(y),o=S(y,"TD",{});var v=M(o);A=P(v,_),N=O(v),h=S(v,"BR",{}),k=O(v),T=S(v,"SMALL",{class:!0,"data-svelte-h":!0}),$(T)!=="svelte-2r8039"&&(T.textContent=E),v.forEach(g),this.h()},h(){C(r,"class","fw-lighter"),C(T,"class","fw-lighter")},m(y,b){I(y,e,b),m(e,t),m(e,s),m(e,r),m(r,d),m(r,u),m(r,D),I(y,a,b),I(y,o,b),m(o,A),m(o,N),m(o,h),m(o,k),m(o,T)},p(y,b){b&4&&n!==(n=H(y[13].date,"MMM dd")+"")&&B(t,n),b&4&&f!==(f=y[13].sundayNumber+"")&&B(d,f),b&4&&c!==(c=H(y[13].date,"EEEE")+"")&&B(D,c),b&4&&_!==(_=(y[13].event??"")+"")&&B(A,_)},d(y){y&&(g(e),g(a),g(o))}}}function ue(l){let e;return{c(){e=w("i"),this.h()},l(n){e=S(n,"I",{class:!0}),M(e).forEach(g),this.h()},h(){C(e,"class","bi bi-pencil-square")},m(n,t){I(n,e,t)},d(n){n&&g(e)}}}function fe(l){let e,n,t,s,r="Change assignment to:",f,d,u,c="Default",D,a,o,_="Save",A,N,h,k,T=j(l[1]),E=[];for(let i=0;i<T.length;i+=1)E[i]=me(ce(l,T,i));function y(){l[9].call(d,l[14],l[15])}function b(){return l[10](l[13],l[15])}return{c(){e=w("tr"),n=w("td"),t=w("div"),s=w("div"),s.textContent=r,f=L(),d=w("select"),u=w("option"),u.textContent=c;for(let i=0;i<E.length;i+=1)E[i].c();D=L(),a=w("div"),o=w("button"),o.textContent=_,A=L(),this.h()},l(i){e=S(i,"TR",{class:!0});var v=M(e);n=S(v,"TD",{colspan:!0});var p=M(n);t=S(p,"DIV",{class:!0});var R=M(t);s=S(R,"DIV",{"data-svelte-h":!0}),$(s)!=="svelte-1t5xiq"&&(s.textContent=r),f=O(R),d=S(R,"SELECT",{class:!0});var q=M(d);u=S(q,"OPTION",{"data-svelte-h":!0}),$(u)!=="svelte-zvp3al"&&(u.textContent=c);for(let F=0;F<E.length;F+=1)E[F].l(q);q.forEach(g),D=O(R),a=S(R,"DIV",{class:!0});var V=M(a);o=S(V,"BUTTON",{class:!0,"data-svelte-h":!0}),$(o)!=="svelte-rtvwan"&&(o.textContent=_),V.forEach(g),R.forEach(g),p.forEach(g),A=O(v),v.forEach(g),this.h()},h(){u.__value="",Q(u,u.__value),C(d,"class","form-select form-control-sm"),l[13].overridden_member===void 0&&Ee(y),C(o,"class","btn btn-sm btn-primary"),C(a,"class","d-flex justify-content-end"),C(t,"class","d-flex flex-column gap-2 p-2"),C(n,"colspan","2"),C(e,"class",N=l[3][`row-${l[15]}`]?"table-light":"d-none")},m(i,v){I(i,e,v),m(e,n),m(n,t),m(t,s),m(t,f),m(t,d),m(d,u);for(let p=0;p<E.length;p+=1)E[p]&&E[p].m(d,null);ae(d,l[13].overridden_member,!0),m(t,D),m(t,a),m(a,o),m(e,A),h||(k=[z(d,"change",y),z(o,"click",b)],h=!0)},p(i,v){if(l=i,v&6){T=j(l[1]);let p;for(p=0;p<T.length;p+=1){const R=ce(l,T,p);E[p]?E[p].p(R,v):(E[p]=me(R),E[p].c(),E[p].m(d,null))}for(;p<E.length;p+=1)E[p].d(1);E.length=T.length}v&6&&ae(d,l[13].overridden_member),v&8&&N!==(N=l[3][`row-${l[15]}`]?"table-light":"d-none")&&C(e,"class",N)},d(i){i&&g(e),he(E,i),h=!1,pe(k)}}}function de(l){let e,n=l[16]+"",t,s;return{c(){e=w("option"),t=U(n),this.h()},l(r){e=S(r,"OPTION",{});var f=M(e);t=P(f,n),f.forEach(g),this.h()},h(){e.__value=s=l[16],Q(e,e.__value)},m(r,f){I(r,e,f),m(e,t)},p(r,f){f&2&&n!==(n=r[16]+"")&&B(t,n),f&2&&s!==(s=r[16])&&(e.__value=s,Q(e,e.__value))},d(r){r&&g(e)}}}function me(l){let e,n=l[16]!==l[13].member&&de(l);return{c(){n&&n.c(),e=K()},l(t){n&&n.l(t),e=K()},m(t,s){n&&n.m(t,s),I(t,e,s)},p(t,s){t[16]!==t[13].member?n?n.p(t,s):(n=de(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(t){t&&g(e),n&&n.d(t)}}}function _e(l){let e,n,t,s,r,f;function d(o,_){return o[13]?.event?Ie:Re}let u=d(l),c=u(l);function D(){return l[8](l[15])}let a=l[0]&&fe(l);return{c(){e=w("tr"),c.c(),t=L(),a&&a.c(),s=K(),this.h()},l(o){e=S(o,"TR",{class:!0});var _=M(e);c.l(_),_.forEach(g),t=O(o),a&&a.l(o),s=K(),this.h()},h(){C(e,"class",n=l[13].member===null?"table-secondary":"")},m(o,_){I(o,e,_),c.m(e,null),I(o,t,_),a&&a.m(o,_),I(o,s,_),r||(f=z(e,"click",D),r=!0)},p(o,_){l=o,u===(u=d(l))&&c?c.p(l,_):(c.d(1),c=u(l),c&&(c.c(),c.m(e,null))),_&6&&n!==(n=l[13].member===null?"table-secondary":"")&&C(e,"class",n),l[0]?a?a.p(l,_):(a=fe(l),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null)},d(o){o&&(g(e),g(t),g(s)),c.d(),a&&a.d(o),r=!1,f()}}}function Be(l){let e,n,t,s='<tr><td class="small">Date</td> <td class="small">Bread Assignment</td></tr>',r,f,d=j(l[2]),u=[];for(let c=0;c<d.length;c+=1)u[c]=_e(ie(l,d,c));return{c(){e=w("div"),n=w("table"),t=w("thead"),t.innerHTML=s,r=L(),f=w("tbody");for(let c=0;c<u.length;c+=1)u[c].c();this.h()},l(c){e=S(c,"DIV",{class:!0});var D=M(e);n=S(D,"TABLE",{class:!0});var a=M(n);t=S(a,"THEAD",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-t1kb4m"&&(t.innerHTML=s),r=O(a),f=S(a,"TBODY",{});var o=M(f);for(let _=0;_<u.length;_+=1)u[_].l(o);o.forEach(g),a.forEach(g),D.forEach(g),this.h()},h(){C(t,"class","table-dark"),C(n,"class","table"),C(e,"class","table-responsive")},m(c,D){I(c,e,D),m(e,n),m(n,t),m(n,r),m(n,f);for(let a=0;a<u.length;a+=1)u[a]&&u[a].m(f,null)},p(c,[D]){if(D&63){d=j(c[2]);let a;for(a=0;a<d.length;a+=1){const o=ie(c,d,a);u[a]?u[a].p(o,D):(u[a]=_e(o),u[a].c(),u[a].m(f,null))}for(;a<u.length;a+=1)u[a].d(1);u.length=d.length}},i:le,o:le,d(c){c&&g(e),he(u,c)}}}function Pe(l,e,n){let{editable:t=!1}=e,{listName:s="Some List"}=e,{names:r=[]}=e,{excludedDates:f=[]}=e,d=[],u=[];const c=async(h=new Date(2026,0,1,0,0,0),k=new Date(2026,11,31,0,0,0))=>{const T={start_date:h,until:k};d=Ce(Ae.Sundays,T);const E=new Date;E.setHours(0,0,0,0);const y=d.map((i,v)=>{const p=f.find(R=>oe(i,R.date));return{member:p?null:r[v%r.length],date:i,sundayNumber:Ne(i),event:p?p.event:void 0,overridden_member:null}}).filter(i=>i.date>=E),b=await be(s);return y.map(i=>{const v=b.find(p=>oe(new Date(p.date),i.date));return{...i,overridden_member:v?v.overridden_member:null}})},D=h=>{t&&n(3,o[`row-${h}`]=!o[`row-${h}`],o)},a=async(h,k)=>{const T=h.overridden_member||null;await Le(s,h.date.toISOString(),T),n(3,o[k]=!o[k],o),c().then(E=>{n(2,u=E)})},o={},_=h=>D(h);function A(h,k){h[k].overridden_member=ge(this),n(2,u),n(1,r)}const N=(h,k)=>a(h,`row-${k}`);return l.$$set=h=>{"editable"in h&&n(0,t=h.editable),"listName"in h&&n(6,s=h.listName),"names"in h&&n(1,r=h.names),"excludedDates"in h&&n(7,f=h.excludedDates)},c().then(h=>{n(2,u=h)}),[t,r,u,o,D,a,s,f,_,A,N]}class Ue extends J{constructor(e){super(),W(this,e,Pe,Be,Y,{editable:0,listName:6,names:1,excludedDates:7})}}function qe(l){let e,n;return e=new Ue({props:{editable:l[0]||l[1],listName:ye.SacramentBreadAssignments,names:ke,excludedDates:Me}}),{c(){ne(e.$$.fragment)},l(t){te(e.$$.fragment,t)},m(t,s){ee(e,t,s),n=!0},p(t,[s]){const r={};s&3&&(r.editable=t[0]||t[1]),e.$set(r)},i(t){n||(x(e.$$.fragment,t),n=!0)},o(t){Z(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function He(l,e,n){let t,s;const{stores:{currentUserIsRootOrAdmin:r,currentUserIsTeachersQuorum:f}}=Se();return se(l,r,d=>n(0,t=d)),se(l,f,d=>n(1,s=d)),[t,s,r,f]}class Ve extends J{constructor(e){super(),W(this,e,He,qe,Y,{})}}function $e(l){let e,n;return e=new Ve({}),{c(){ne(e.$$.fragment)},l(t){te(e.$$.fragment,t)},m(t,s){ee(e,t,s),n=!0},i(t){n||(x(e.$$.fragment,t),n=!0)},o(t){Z(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function Ke(l){let e,n;return e=new De({props:{pageTitle:"Assignments",$$slots:{default:[$e]},$$scope:{ctx:l}}}),{c(){ne(e.$$.fragment)},l(t){te(e.$$.fragment,t)},m(t,s){ee(e,t,s),n=!0},p(t,[s]){const r={};s&1&&(r.$$scope={dirty:s,ctx:t}),e.$set(r)},i(t){n||(x(e.$$.fragment,t),n=!0)},o(t){Z(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}class Xe extends J{constructor(e){super(),W(this,e,null,Ke,Y,{})}}export{Xe as component,We as universal};
