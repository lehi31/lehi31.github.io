import{a as Ut}from"../chunks/B5LTcAhG.js";import{P as qt,e as wt,m as jt,n as gt,o as yt,O as ht,q as At,r as Ft,f as xt}from"../chunks/DnVuGurV.js";import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{o as ct}from"../chunks/CuVcyAaV.js";import{p as Xe,D as r,E as _,ai as we,m as e,aj as Ye,c as a,s,r as t,B as k,C as ot,F as vt,u as i,n as Le,a as Ze,f as Ae,R as $t,ap as Lt,aq as Rt,ar as kt}from"../chunks/BWCcv1pC.js";import{b as he,i as F,s as m,e as M,a as ut,p as Be}from"../chunks/KiCntiD6.js";import{e as ge,i as ye}from"../chunks/CvOYN50o.js";import{f as b,a as d,c as nt,t as Bt}from"../chunks/DqgkBxsg.js";import{r as Ne,b as it,s as dt,f as Nt}from"../chunks/CDrl09S1.js";import{b as Fe}from"../chunks/CzDGc265.js";import{i as et}from"../chunks/BeNQ5BU7.js";import{P as It}from"../chunks/CgZT8wvO.js";import{u as Mt}from"../chunks/C6mmD5Kx.js";import{D as Ot}from"../chunks/pEAXO0Hl.js";import{f as Tt,g as Kt,h as Qt,p as Ht,d as Gt,r as Jt,i as Vt,j as Wt,k as Xt,m as Yt,n as Zt}from"../chunks/CIV_sNUJ.js";const ea=!1,ta=async()=>(Ut(qt.AssignCallings,"Assign Callings"),{}),Xa=Object.freeze(Object.defineProperty({__proto__:null,load:ta,ssr:ea},Symbol.toStringTag,{value:"Module"}));var aa=b('<div class="alert alert-danger alert-dismissible fade show" role="alert"> <button type="button" class="btn-close" aria-label="Close"></button></div>'),sa=b("<option> </option>"),ra=b("<option> </option>"),la=b("<optgroup></optgroup>"),oa=b('<span class="spinner-border spinner-border-sm me-2" role="status"></span>'),ia=b("<option> </option>"),na=b('<div class="text-center py-5"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></div>'),da=b('<div class="alert alert-info">No active role assignments found. <!></div>'),ca=b('<tr><td><div class="fw-semibold"> </div> <small class="d-md-none text-muted d-block"> </small></td><td class="d-none d-md-table-cell"><small class="text-muted"> </small></td><td><strong> </strong> <div class="d-lg-none mt-1"><span class="badge bg-info"> </span></div></td><td class="d-none d-lg-table-cell"><span class="badge bg-info"> </span></td><td class="d-none d-lg-table-cell"><small> </small></td><td class="d-none d-xl-table-cell"><small class="text-muted"> </small></td><td class="text-end"><button class="btn btn-sm btn-outline-danger" aria-label="Release role"><i class="bi bi-x-circle"></i></button></td></tr>'),va=b('<div class="table-responsive"><table class="table table-hover align-middle svelte-1qcbfdi"><thead><tr><th scope="col" class="svelte-1qcbfdi">Name</th><th scope="col" class="d-none d-md-table-cell svelte-1qcbfdi">Email</th><th scope="col" class="svelte-1qcbfdi">Role</th><th scope="col" class="d-none d-lg-table-cell svelte-1qcbfdi">Organization</th><th scope="col" class="d-none d-lg-table-cell svelte-1qcbfdi">Assigned Date</th><th scope="col" class="d-none d-xl-table-cell svelte-1qcbfdi">Notes</th><th scope="col" class="text-end svelte-1qcbfdi">Actions</th></tr></thead><tbody class="table-group-divider"></tbody></table></div>'),ua=b('<div class="role-assignment svelte-1qcbfdi"><div class="d-flex justify-content-between align-items-center mb-4"><h2>Role Assignments</h2> <button class="btn btn-primary"><i class="bi bi-arrow-clockwise"></i> Refresh</button></div> <!> <div class="card mb-4"><div class="card-header svelte-1qcbfdi"><h5 class="mb-0">Assign New Role</h5></div> <div class="card-body"><div class="row g-3"><div class="col-md-4"><label for="user-select" class="form-label">Select User</label> <select id="user-select" class="form-select"><option>Choose a user...</option><!></select></div> <div class="col-md-4"><label for="role-select" class="form-label">Select Role</label> <select id="role-select" class="form-select"><option>Choose a role...</option><!></select></div> <div class="col-md-4"><label for="notes-input" class="form-label">Notes (Optional)</label> <input id="notes-input" type="text" class="form-control" placeholder="Assignment notes..."/></div> <div class="col-12"><button class="btn btn-success"><!> Assign Role</button></div></div></div></div> <div class="row mb-3"><div class="col-md-4"><select class="form-select"><option>All Organizations</option><!></select></div> <div class="col-md-8"><div class="text-muted mt-2"> </div></div></div> <!></div>');function ba($e,X){Xe(X,!1);const q=()=>he(oe,"$users",D),Y=()=>he(O,"$currentUser",D),[D,le]=ut(),$=_(),L=_(),f=_(),C=_(),{stores:T,actions:B}=Mt,{users:oe}=T,{stores:{currentUser:O}}=wt();let A=_([]),c=_(!1),p=_(null),Z=_(null),u=_(""),U=_(""),v=_("all");ct(async()=>{await B.fetchUsers(),await g()});async function g(){r(c,!0),r(p,null);try{const l=await jt();r(A,l.map(o=>{const n=q().find(w=>w.id===o.user_id),x=o.roles;return{...o,user:n,roleName:x?.name||String(o.role_id),roleOrganization:x?.organization}}))}catch(l){r(p,l instanceof Error?l.message:"Failed to load roles")}finally{r(c,!1)}}async function K(){if(!e(Z)||!e(u)){r(p,"Please select both a user and a role");return}if(!Y()?.id){r(p,"Unable to determine current user. Please refresh and try again.");return}r(c,!0),r(p,null);try{const l=await At(e(Z),e(u),Y().id,e(U)||void 0);l.success?(r(Z,null),r(u,""),r(U,""),await g()):r(p,l.error||"Failed to assign role")}catch(l){r(p,l instanceof Error?l.message:"Failed to assign role")}finally{r(c,!1)}}async function N(l){if(confirm("Are you sure you want to release this role?")){r(c,!0),r(p,null);try{const o=await Ft(l);o.success?await g():r(p,o.error||"Failed to release role")}catch(o){r(p,o instanceof Error?o.message:"Failed to release role")}finally{r(c,!1)}}}function ue(l){return l.split("-").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ")}function ie(l){return l?l.split("-").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" "):"Unknown"}we(()=>(e(A),e(v)),()=>{r($,e(A).filter(l=>e(v)==="all"?!0:l.roleOrganization===e(v)))}),we(()=>gt,()=>{r(L,gt())}),we(()=>(e(L),yt),()=>{r(f,e(L).reduce((l,o)=>{const n=yt(o);if(n){const x=n.organization;l[x]||(l[x]=[]),l[x].push(n)}return l},{}))}),we(()=>e(f),()=>{r(C,Object.keys(e(f)))}),Ye(),et();var ne=ua(),ee=a(ne),be=s(a(ee),2);t(ee);var S=s(ee,2);{var I=l=>{var o=aa(),n=a(o),x=s(n);t(o),k(()=>m(n,`${e(p)??""} `)),M("click",x,()=>r(p,null)),d(l,o)};F(S,l=>{e(p)&&l(I)})}var Q=s(S,2),H=s(a(Q),2),de=a(H),G=a(de),te=s(a(G),2);k(()=>{e(Z),ot(()=>{e(c),q()})});var ae=a(te);ae.value=(ae.__value=null)??"";var y=s(ae);ge(y,1,q,ye,(l,o)=>{var n=sa(),x=a(n);t(n);var w={};k(()=>{m(x,`${e(o),i(()=>e(o).display_name||e(o).email)??""} (${e(o),i(()=>e(o).email)??""})`),w!==(w=(e(o),i(()=>e(o).id)))&&(n.value=(n.__value=(e(o),i(()=>e(o).id)))??"")}),d(l,n)}),t(te),t(G);var j=s(G,2),fe=s(a(j),2);k(()=>{e(u),ot(()=>{e(c),e(C),e(f)})});var ce=a(fe);ce.value=ce.__value="";var Re=s(ce);ge(Re,1,()=>e(C),ye,(l,o)=>{var n=la();ge(n,5,()=>(e(f),e(o),i(()=>e(f)[e(o)])),ye,(x,w)=>{var E=ra(),W=a(E,!0);t(E);var se={};k(()=>{m(W,(e(w),i(()=>e(w).name))),se!==(se=(e(w),i(()=>e(w).id)))&&(E.value=(E.__value=(e(w),i(()=>e(w).id)))??"")}),d(x,E)}),t(n),k(x=>dt(n,"label",x),[()=>(e(o),i(()=>ue(e(o))))]),d(l,n)}),t(fe),t(j);var ve=s(j,2),ke=s(a(ve),2);Ne(ke),t(ve);var De=s(ve,2),xe=a(De),z=a(xe);{var J=l=>{var o=oa();d(l,o)};F(z,l=>{e(c)&&l(J)})}vt(),t(xe),t(De),t(de),t(H),t(Q);var me=s(Q,2),Oe=a(me),ze=a(Oe);k(()=>{e(v),ot(()=>{})});var V=a(ze);V.value=V.__value="all";var pe=s(V);ge(pe,1,()=>(Le(ht),i(()=>Object.values(ht))),ye,(l,o)=>{var n=ia(),x=a(n,!0);t(n);var w={};k(E=>{m(x,E),w!==(w=e(o))&&(n.value=(n.__value=e(o))??"")},[()=>(e(o),i(()=>ue(e(o))))]),d(l,n)}),t(ze),t(Oe);var Ce=s(Oe,2),Ue=a(Ce),Ie=a(Ue);t(Ue),t(Ce),t(me);var P=s(me,2);{var Pe=l=>{var o=na();d(l,o)},_e=l=>{var o=nt(),n=Ae(o);{var x=E=>{var W=da(),se=s(a(W));{var re=R=>{var h=Bt("Try selecting a different organization.");d(R,h)};F(se,R=>{e(v)!=="all"&&R(re)})}t(W),d(E,W)},w=E=>{var W=va(),se=a(W),re=s(a(se));ge(re,5,()=>e($),ye,(R,h)=>{var Se=ca(),qe=a(Se),Me=a(qe),Te=a(Me,!0);t(Me);var Ke=s(Me,2),tt=a(Ke,!0);t(Ke),t(qe);var Ee=s(qe),Ve=a(Ee),Qe=a(Ve,!0);t(Ve),t(Ee);var je=s(Ee),He=a(je),We=a(He,!0);t(He);var Ge=s(He,2),Je=a(Ge),at=a(Je,!0);t(Je),t(Ge),t(je);var st=s(je),bt=a(st),zt=a(bt,!0);t(bt),t(st);var rt=s(st),ft=a(rt),Pt=a(ft,!0);t(ft),t(rt);var lt=s(rt),mt=a(lt),St=a(mt,!0);t(mt),t(lt);var pt=s(lt),_t=a(pt);t(pt),t(Se),k((Et,Dt,Ct)=>{m(Te,(e(h),i(()=>e(h).user?.display_name||"Unknown"))),m(tt,(e(h),i(()=>e(h).user?.email||"N/A"))),m(Qe,(e(h),i(()=>e(h).user?.email||"N/A"))),m(We,(e(h),i(()=>e(h).roleName))),m(at,Et),m(zt,Dt),m(Pt,Ct),m(St,(e(h),i(()=>e(h).notes||"â€”"))),_t.disabled=e(c)},[()=>(e(h),i(()=>ie(e(h).roleOrganization))),()=>(e(h),i(()=>ie(e(h).roleOrganization))),()=>(e(h),i(()=>new Date(e(h).assigned_date).toLocaleDateString()))]),M("click",_t,()=>N(e(h).id)),d(R,Se)}),t(re),t(se),t(W),d(E,W)};F(n,E=>{e($),i(()=>e($).length===0)?E(x):E(w,!1)},!0)}d(l,o)};F(P,l=>{e(c),e(A),i(()=>e(c)&&e(A).length===0)?l(Pe):l(_e,!1)})}t(ne),k(()=>{be.disabled=e(c),te.disabled=e(c),fe.disabled=e(c),ke.disabled=e(c),xe.disabled=e(c)||!e(Z)||!e(u),m(Ie,`Showing ${e($),i(()=>e($).length)??""} active role${e($),i(()=>e($).length!==1?"s":"")??""}`)}),M("click",be,g),it(te,()=>e(Z),l=>r(Z,l)),it(fe,()=>e(u),l=>r(u,l)),Fe(ke,()=>e(U),l=>r(U,l)),M("click",xe,K),it(ze,()=>e(v),l=>r(v,l)),d($e,ne),Ze(),le()}var fa=b('<div class="alert alert-danger" role="alert"> </div>'),ma=b('<div class="form-text">Key cannot be changed after creation</div>'),pa=b('<span class="spinner-border spinner-border-sm me-2" role="status"></span>'),_a=b('<form><!> <div class="mb-3"><label for="role-key" class="form-label">Key <span class="text-danger">*</span></label> <input type="text" class="form-control" id="role-key" required placeholder="e.g., primary-president"/> <!></div> <div class="mb-3"><label for="role-name" class="form-label">Name <span class="text-danger">*</span></label> <input type="text" class="form-control" id="role-name" required placeholder="e.g., Primary President"/></div> <div class="mb-3"><label for="role-organization" class="form-label">Organization</label> <input type="text" class="form-control" id="role-organization" placeholder="e.g., primary, bishopric, relief-society"/> <div class="form-text">Used for grouping roles</div></div> <div class="mb-3"><label for="role-description" class="form-label">Description</label> <textarea class="form-control" id="role-description" rows="3" placeholder="Describe this role..."></textarea></div> <div class="d-flex gap-2"><button type="submit" class="btn btn-primary"><!> </button> <button type="button" class="btn btn-secondary" data-bs-dismiss="offcanvas">Cancel</button></div></form>');function ga($e,X){Xe(X,!1);const q=_();let Y=Be(X,"id",8,"role-form-drawer"),D=Be(X,"role",8,null),le=Be(X,"onSave",8,null),$=_(""),L=_(""),f=_(""),C=_(""),T=_(!1),B=_("");async function oe(c){c.preventDefault(),r(T,!0),r(B,"");try{e(q)&&D()?await Tt(D().id,{name:e(L),organization:e(f)||null,description:e(C)||null}):await Kt({key:e($),name:e(L),organization:e(f)||null,description:e(C)||null});const p=document.getElementById(Y());if(p){const u=window.bootstrap?.Offcanvas?.getInstance(p);u&&u.hide()}O(),le()&&le()()}catch(p){r(B,p instanceof Error?p.message:"Failed to save role")}finally{r(T,!1)}}function O(){r($,""),r(L,""),r(f,""),r(C,""),r(B,"")}function A(){O()}ct(()=>{const c=document.getElementById(Y());if(c)return c.addEventListener("hidden.bs.offcanvas",A),()=>{c.removeEventListener("hidden.bs.offcanvas",A)}}),we(()=>Le(D()),()=>{r(q,D()!==null)}),we(()=>Le(D()),()=>{D()&&(r($,D().key),r(L,D().name),r(f,D().organization||""),r(C,D().description||""))}),Ye(),et();{let c=$t(()=>e(q)?"Edit Role":"Create Role");Ot($e,{get title(){return e(c)},get id(){return Y()},children:(p,Z)=>{var u=_a(),U=a(u);{var v=y=>{var j=fa(),fe=a(j,!0);t(j),k(()=>m(fe,e(B))),d(y,j)};F(U,y=>{e(B)&&y(v)})}var g=s(U,2),K=s(a(g),2);Ne(K);var N=s(K,2);{var ue=y=>{var j=ma();d(y,j)};F(N,y=>{e(q)&&y(ue)})}t(g);var ie=s(g,2),ne=s(a(ie),2);Ne(ne),t(ie);var ee=s(ie,2),be=s(a(ee),2);Ne(be),vt(2),t(ee);var S=s(ee,2),I=s(a(S),2);Lt(I),t(S);var Q=s(S,2),H=a(Q),de=a(H);{var G=y=>{var j=pa();d(y,j)};F(de,y=>{e(T)&&y(G)})}var te=s(de);t(H);var ae=s(H,2);t(Q),t(u),k(()=>{K.disabled=e(q),H.disabled=e(T),m(te,` ${e(q)?"Update":"Create"} Role`),ae.disabled=e(T)}),Fe(K,()=>e($),y=>r($,y)),Fe(ne,()=>e(L),y=>r(L,y)),Fe(be,()=>e(f),y=>r(f,y)),Fe(I,()=>e(C),y=>r(C,y)),M("submit",u,oe),d(p,u)},$$slots:{default:!0}})}Ze()}var ya=b('<div class="alert alert-danger" role="alert"> </div>'),ha=b('<div class="text-muted small"> </div>'),xa=b('<div class="form-check mb-2"><input class="form-check-input" type="checkbox"/> <label class="form-check-label"><div><strong> </strong> <span class="text-muted small"> </span></div> <!></label></div>'),wa=b('<div class="mb-3"><h6 class="text-uppercase text-muted small mb-2"> </h6> <!></div>'),$a=b('<span class="spinner-border spinner-border-sm me-2" role="status"></span>'),Ra=b('<div class="mb-3"><div class="d-flex justify-content-between align-items-center mb-2"><div><strong>Role:</strong> </div> <div><button type="button" class="btn btn-sm btn-outline-primary me-1">Select All</button> <button type="button" class="btn btn-sm btn-outline-secondary">Deselect All</button></div></div> <div class="text-muted small"> </div></div> <div class="mb-3"></div> <div class="d-flex gap-2 sticky-bottom bg-body pt-3 border-top svelte-12zccnf"><button type="submit" class="btn btn-primary"><!> Save Permissions</button> <button type="button" class="btn btn-secondary" data-bs-dismiss="offcanvas">Cancel</button></div>',1),ka=b('<div class="alert alert-info">Please select a role to manage permissions.</div>'),Oa=b("<form><!> <!></form>");function za($e,X){Xe(X,!1);const q=()=>he(Gt,"$permissions",le),Y=()=>he(B,"$currentUser",le),D=()=>he(Ht,"$permissionsByCategory",le),[le,$]=ut();let L=Be(X,"id",8,"role-permissions-drawer"),f=Be(X,"role",8,null),C=Be(X,"onSave",8,null);const T=wt(),{currentUser:B}=T.stores,{loadUserPermissions:oe}=T.actions;let O=_(new Set),A=_(!1),c=_("");function p(v){e(O).has(v)?e(O).delete(v):e(O).add(v),r(O,new Set(e(O)))}function Z(){r(O,new Set(q().map(v=>v.id)))}function u(){r(O,new Set)}async function U(v){if(v.preventDefault(),!!f()){r(A,!0),r(c,"");try{if(await Qt(f().id,Array.from(e(O))),Y()?.roles?.includes(f().key)&&Y().id)try{await oe(Y().id),console.log("[RolePermissions] Reloaded permissions for current user"),window.location.reload();return}catch(K){console.error("[RolePermissions] Failed to reload user permissions:",K)}const g=document.getElementById(L());if(g){const N=window.bootstrap?.Offcanvas?.getInstance(g);N&&N.hide()}C()&&C()()}catch(g){r(c,g instanceof Error?g.message:"Failed to assign permissions")}finally{r(A,!1)}}}we(()=>Le(f()),()=>{f()&&r(O,new Set(f().permissions.map(v=>v.id)))}),Ye(),et();{let v=$t(()=>(Le(f()),i(()=>f()?`Manage Permissions: ${f().name}`:"Manage Permissions")));Ot($e,{get title(){return e(v)},get id(){return L()},children:(g,K)=>{var N=Oa(),ue=a(N);{var ie=S=>{var I=ya(),Q=a(I,!0);t(I),k(()=>m(Q,e(c))),d(S,I)};F(ue,S=>{e(c)&&S(ie)})}var ne=s(ue,2);{var ee=S=>{var I=Ra(),Q=Ae(I),H=a(Q),de=a(H),G=s(a(de));t(de);var te=s(de,2),ae=a(te),y=s(ae,2);t(te),t(H);var j=s(H,2),fe=a(j);t(j),t(Q);var ce=s(Q,2);ge(ce,5,()=>(D(),i(()=>Object.entries(D()))),ye,(z,J)=>{var me=Rt(()=>kt(e(J),2));let Oe=()=>e(me)[0],ze=()=>e(me)[1];var V=wa(),pe=a(V),Ce=a(pe,!0);t(pe);var Ue=s(pe,2);ge(Ue,1,ze,ye,(Ie,P)=>{var Pe=xa(),_e=a(Pe);Ne(_e);var l=s(_e,2),o=a(l),n=a(o),x=a(n,!0);t(n);var w=s(n,2),E=a(w);t(w),t(o);var W=s(o,2);{var se=re=>{var R=ha(),h=a(R,!0);t(R),k(()=>m(h,(e(P),i(()=>e(P).description)))),d(re,R)};F(W,re=>{e(P),i(()=>e(P).description)&&re(se)})}t(l),t(Pe),k(re=>{dt(_e,"id",`permission-${e(P),i(()=>e(P).id)??""}`),Nt(_e,re),dt(l,"for",`permission-${e(P),i(()=>e(P).id)??""}`),m(x,(e(P),i(()=>e(P).name))),m(E,`(${e(P),i(()=>e(P).key)??""})`)},[()=>(e(O),e(P),i(()=>e(O).has(e(P).id)))]),M("change",_e,()=>p(e(P).id)),d(Ie,Pe)}),t(V),k(()=>m(Ce,Oe())),d(z,V)}),t(ce);var Re=s(ce,2),ve=a(Re),ke=a(ve);{var De=z=>{var J=$a();d(z,J)};F(ke,z=>{e(A)&&z(De)})}vt(),t(ve);var xe=s(ve,2);t(Re),k(()=>{m(G,` ${Le(f()),i(()=>f().name)??""}`),m(fe,`${e(O),i(()=>e(O).size)??""} of ${q(),i(()=>q().length)??""} permissions selected`),ve.disabled=e(A),xe.disabled=e(A)}),M("click",ae,Z),M("click",y,u),d(S,I)},be=S=>{var I=ka();d(S,I)};F(ne,S=>{f()?S(ee):S(be,!1)})}t(N),M("submit",N,U),d(g,N)},$$slots:{default:!0}})}Ze(),$()}var Pa=b('<div class="alert alert-danger" role="alert"><i class="bi bi-exclamation-triangle me-2"></i> </div>'),Sa=b('<div class="d-flex justify-content-center align-items-center py-5"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Ea=b('<div class="alert alert-info">No roles found. Create your first role to get started.</div>'),Da=b('<tr><td><strong> </strong></td><td><code> </code></td><td> </td><td><span class="badge bg-secondary"> </span></td><td><button type="button" class="btn btn-sm btn-outline-success me-1" title="Manage Permissions"><i class="bi bi-key"></i></button> <button type="button" class="btn btn-sm btn-outline-primary me-1" title="Edit"><i class="bi bi-pencil"></i></button> <button type="button" class="btn btn-sm btn-outline-danger" title="Delete"><i class="bi bi-trash"></i></button></td></tr>'),Ca=b('<div class="card mb-3"><div class="card-header"><h5 class="mb-0 text-uppercase"> </h5></div> <div class="card-body"><div class="table-responsive"><table class="table table-hover mb-0"><thead><tr><th>Name</th><th>Key</th><th>Description</th><th>Permissions</th><th style="width: 200px;">Actions</th></tr></thead><tbody></tbody></table></div></div></div>'),Ua=b('<div class="d-flex justify-content-between align-items-center mb-4"><h2>Role Definitions</h2> <button type="button" class="btn btn-primary"><i class="bi bi-plus-lg me-1"></i> Create Role</button></div> <!> <div class="card mb-4"><div class="card-body"><input type="text" class="form-control" placeholder="Search roles..."/></div></div> <!>',1),qa=b('<div class="container-fluid py-4"><ul class="nav nav-tabs mb-4"><li class="nav-item"><button>User Role Assignments</button></li> <li class="nav-item"><button>Role Definitions</button></li></ul> <!></div> <!> <!>',1);function Ya($e,X){Xe(X,!1);const q=()=>he(Jt,"$rolesByOrganization",$),Y=()=>he(Wt,"$rolesError",$),D=()=>he(Xt,"$loadingRoles",$),le=()=>he(Yt,"$roles",$),[$,L]=ut(),f=_();let C=_(null),T=_(null),B=_(""),oe=_("assignments");ct(async()=>{await Vt()});function O(){r(C,null),p("role-form-drawer")}function A(u){r(C,u),p("role-form-drawer")}function c(u){r(T,u),p("role-permissions-drawer")}function p(u){const U=document.getElementById(u);if(U){const v=window.bootstrap;v?.Offcanvas&&new v.Offcanvas(U).show()}}async function Z(u){if(confirm(`Are you sure you want to delete the role "${u.name}"? This will remove it from all users.`))try{await Zt(u.id)}catch(U){alert(`Failed to delete role: ${U instanceof Error?U.message:"Unknown error"}`)}}we(()=>(q(),e(B)),()=>{r(f,Object.entries(q()).filter(([u,U])=>{if(!e(B))return!0;const v=e(B).toLowerCase();return u.toLowerCase().includes(v)||U.some(g=>g.name.toLowerCase().includes(v)||g.key.toLowerCase().includes(v)||g.description?.toLowerCase().includes(v))}))}),Ye(),et(),It($e,{pageTitle:"Manage Roles",children:(u,U)=>{var v=qa(),g=Ae(v),K=a(g),N=a(K),ue=a(N);let ie;t(N);var ne=s(N,2),ee=a(ne);let be;t(ne),t(K);var S=s(K,2);{var I=G=>{ba(G,{})},Q=G=>{var te=Ua(),ae=Ae(te),y=s(a(ae),2);t(ae);var j=s(ae,2);{var fe=z=>{var J=Pa(),me=s(a(J));t(J),k(()=>m(me,` ${Y()??""}`)),d(z,J)};F(j,z=>{Y()&&z(fe)})}var ce=s(j,2),Re=a(ce),ve=a(Re);Ne(ve),t(Re),t(ce);var ke=s(ce,2);{var De=z=>{var J=Sa();d(z,J)},xe=z=>{var J=nt(),me=Ae(J);{var Oe=V=>{var pe=Ea();d(V,pe)},ze=V=>{var pe=nt(),Ce=Ae(pe);ge(Ce,1,()=>e(f),ye,(Ue,Ie)=>{var P=Rt(()=>kt(e(Ie),2));let Pe=()=>e(P)[0],_e=()=>e(P)[1];var l=Ca(),o=a(l),n=a(o),x=a(n,!0);t(n),t(o);var w=s(o,2),E=a(w),W=a(E),se=s(a(W));ge(se,5,_e,ye,(re,R)=>{var h=Da(),Se=a(h),qe=a(Se),Me=a(qe,!0);t(qe),t(Se);var Te=s(Se),Ke=a(Te),tt=a(Ke,!0);t(Ke),t(Te);var Ee=s(Te),Ve=a(Ee,!0);t(Ee);var Qe=s(Ee),je=a(Qe),He=a(je);t(je),t(Qe);var We=s(Qe),Ge=a(We),Je=s(Ge,2),at=s(Je,2);t(We),t(h),k(()=>{m(Me,(e(R),i(()=>e(R).name))),m(tt,(e(R),i(()=>e(R).key))),m(Ve,(e(R),i(()=>e(R).description||"-"))),m(He,`${e(R),i(()=>e(R).permissions.length)??""} permissions`)}),M("click",Ge,()=>c(e(R))),M("click",Je,()=>A(e(R))),M("click",at,()=>Z(e(R))),d(re,h)}),t(se),t(W),t(E),t(w),t(l),k(()=>m(x,Pe())),d(Ue,l)}),d(V,pe)};F(me,V=>{le(),i(()=>le().length===0)?V(Oe):V(ze,!1)},!0)}d(z,J)};F(ke,z=>{D()?z(De):z(xe,!1)})}M("click",y,O),Fe(ve,()=>e(B),z=>r(B,z)),d(G,te)};F(S,G=>{e(oe)==="assignments"?G(I):G(Q,!1)})}t(g);var H=s(g,2);ga(H,{id:"role-form-drawer",get role(){return e(C)},onSave:()=>{r(C,null)}});var de=s(H,2);za(de,{id:"role-permissions-drawer",get role(){return e(T)},onSave:()=>{r(T,null)}}),k(()=>{ie=xt(ue,1,"nav-link",null,ie,{active:e(oe)==="assignments"}),be=xt(ee,1,"nav-link",null,be,{active:e(oe)==="definitions"})}),M("click",ue,()=>r(oe,"assignments")),M("click",ee,()=>r(oe,"definitions")),d(u,v)},$$slots:{default:!0}}),Ze(),L()}export{Ya as component,Xa as universal};
