import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{P as ye}from"../chunks/EvxTPCwk.js";import{w as P,g as xe,o as se}from"../chunks/DjNGvcU6.js";import{p as q,c as b,t as F,a as R,ao as W,g as t,E as I,s as S,r as v,u as Z,D as k,aj as H,ak as ie,w as K,F as de,f as ce}from"../chunks/JKZwkikK.js";import{p,i as A,e as V,s as O,a as Se,b as re}from"../chunks/CvNikv6W.js";import{e as we,i as Te}from"../chunks/B2BlSr7K.js";import{f as M,a as D,t as Ce}from"../chunks/JDsN5plM.js";import{r as X,s as ne}from"../chunks/BJ5CEYPI.js";import{b as ue,a as ke}from"../chunks/BL6gm64P.js";import{i as ee}from"../chunks/b8c_lO2i.js";import{e as me,b as U}from"../chunks/D9ZoHZwa.js";import{D as Ne}from"../chunks/42h8s0UR.js";import{s as De}from"../chunks/Bhs7oqge.js";import{b as Ie}from"../chunks/C_E5hxn_.js";import{S as Me}from"../chunks/C9CzWhdS.js";import{t as le}from"../chunks/r7-tBYgy.js";import{S as ge}from"../chunks/C_iZwsfV.js";import{b as $e}from"../chunks/Bk8fdyPk.js";const ze=!0,yt=Object.freeze(Object.defineProperty({__proto__:null,prerender:ze},Symbol.toStringTag,{value:"Module"}));async function Oe(){const{data:n,error:e}=await me.from("callings").select("*");if(e)throw e;return n?.length?n:[]}const Pe=()=>{const n=P(!1),e=P(!1),u=P([]);return{stores:{ready:n,loading:e,data:u},actions:{init:async()=>{const r=await Oe();r?.length&&u.set(r)}}}},Fe=()=>Pe();function Ae(n,e,u){var i=u||{},r=i.noTrailing,o=r===void 0?!1:r,s=i.noLeading,c=s===void 0?!1:s,h=i.debounceMode,l=h===void 0?void 0:h,m,g=!1,_=0;function y(){m&&clearTimeout(m)}function a(C){var N=C||{},f=N.upcomingOnly,d=f===void 0?!1:f;y(),g=!d}function T(){for(var C=arguments.length,N=new Array(C),f=0;f<C;f++)N[f]=arguments[f];var d=this,$=Date.now()-_;if(g)return;function z(){_=Date.now(),e.apply(d,N)}function L(){m=void 0}!c&&l&&!m&&z(),y(),l===void 0&&$>n?c?(_=Date.now(),o||(m=setTimeout(l?L:z,n))):z():o!==!0&&(m=setTimeout(l?L:z,l===void 0?n-$:n))}return T.cancel=a,T}function Le(n,e,u){var i={},r=i.atBegin,o=r===void 0?!1:r;return Ae(n,e,{debounceMode:o!==!1})}var Ee=M('<span class="position-absolute top-0 start-100 translate-middle p-2 bg-danger border border-light rounded-circle"><span class="visually-hidden">Item not saved</span></span>'),je=M('<div class="d-flex flex-column gap-4"><!> <div class="d-flex justify-content-end align-items-center gap-2 flex-row"><small> </small> <span><!></span> <button class="btn btn-primary position-relative"><span>Save</span> <!></button></div></div>');function qe(n,e){q(e,!1);let u=p(e,"valueChanged",8,!1),i=p(e,"loading",8,!1),r=p(e,"save",8),o=I({message:"",type:"info"});const s=d=>{d.type=d.type?d.type:"info",d.message=d.message?d.message:"",W(o,t(o).message=d.message),W(o,t(o).type=d.type),d.duration&&setTimeout(()=>{W(o,t(o).message="")},d.duration)};var c={setNotice:s},h=je(),l=b(h);De(l,e,"default",{});var m=S(l,2),g=b(m),_=b(g,!0);v(g);var y=S(g,2);let a;var T=b(y);Me(T,{size:"xs"}),v(y);var C=S(y,2),N=S(b(C),2);{var f=d=>{var $=Ee();D(d,$)};A(N,d=>{u()&&d(f)})}return v(C),v(m),v(h),F(()=>{U(g,1,`fw-lighter fst-italic text-${t(o),Z(()=>t(o).type)??""}`),O(_,(t(o),Z(()=>t(o).message))),a=U(y,1,"",null,a,{"d-none":!i()})}),V("click",C,function(...d){r()?.apply(this,d)}),D(n,h),Ie(e,"setNotice",s),R(c)}function Re(n,e){let u=p(e,"organization",12),i=p(e,"loading",8),r=p(e,"disabled",8);const s=["Elders Quorum","Primary","Relief Society","Sunday School","Young Men","Young Women"].map(c=>({key:c,value:c}));ge(n,{get options(){return s},get disabled(){return r()},label:"Organization",helperText:"",get loading(){return i()},get value(){return u()},set value(c){u(c)},$$legacy:!0})}var Be=M('<small class="fw-lighter fst-italic"> </small>'),Ge=M('<div class="d-flex flex-column gap-2"><div> </div> <input type="text"/> <!></div>');function fe(n,e){let u=p(e,"label",8,""),i=p(e,"name",8,""),r=p(e,"helperText",8,""),o=p(e,"placeholder",8,""),s=p(e,"value",12),c=p(e,"loading",8),h=p(e,"required",8),l=p(e,"isInvalid",8),m=I();var g=Ge(),_=b(g),y=b(_,!0);v(_);var a=S(_,2);X(a);let T;$e(a,f=>k(m,f),()=>t(m));var C=S(a,2);{var N=f=>{var d=Be(),$=b(d,!0);v(d),F(()=>O($,r())),D(f,d)};A(C,f=>{r()&&f(N)})}v(g),F(()=>{O(y,u()),ne(a,"name",i()),T=U(a,1,"form-control",null,T,{"is-invalid":l()}),ne(a,"placeholder",o()),a.disabled=c(),a.required=h()}),V("focus",a,()=>t(m).select()),ue(a,s),D(n,g)}const oe=P([]);let Y=!1;async function Je(){if(Y)return xe(oe);Y=!0;const{data:n,error:e}=await me.from("members").select("*");if(e)throw e;const u=n||[];return oe.set(u),setTimeout(()=>Y=!1,800),u}var Qe=M('<div class="d-flex flex-column gap-2"><div>Member</div> <!> <div class="form-check"><input class="form-check-input" type="checkbox" id="is-new-member"/> <label class="form-check-label" for="is-new-member">Member not found in the list, lets create a new record.</label></div> <!></div>');function We(n,e){q(e,!1);const u=I(),i=I();let r=p(e,"member",12),o=p(e,"loading",8),s=I([]),c=I();se(async()=>{k(s,await Je())}),H(()=>K(r()),()=>{k(u,r().name==="")}),H(()=>t(s),()=>{k(i,t(s)?.length?t(s).map(a=>({key:a.name,value:a.name})):[])}),ie(),ee();var h=Qe(),l=S(b(h),2);ge(l,{get options(){return t(i)},get loading(){return o()},get disabled(){return t(c)},helperText:"",get value(){return r().name},set value(a){r(r().name=a,!0)},$$legacy:!0});var m=S(l,2),g=b(m);X(g),de(2),v(m);var _=S(m,2);{var y=a=>{fe(a,{placeholder:"Members name",name:"member-name",get isInvalid(){return t(u)},get loading(){return o()},helperText:"Brother John Smith or Sister Jane Smith",required:!0,get value(){return r().name},set value(T){r(r().name=T,!0)},$$legacy:!0})};A(_,a=>{t(c)&&a(y)})}v(h),ke(g,()=>t(c),a=>k(c,a)),D(n,h),R()}var Ye=M("<!> <!> <!>",1);function Ze(n,e){q(e,!1);const u=I();let i=p(e,"calling",12),r=p(e,"member",8),o=I(!1),s=I(!1),c=I();const h=async()=>{if(!t(o)){t(c)({message:"Sorry nothing has changed, therefore, there is nothing to save.",duration:700});return}try{t(c)({message:"Saving ..."}),k(s,!0),le("set_sacrament_testimony_success","interaction","Set Successful",1),setTimeout(()=>{k(s,!1),t(c)({message:"Saved",duration:3e3,type:"success"})},800)}catch(l){le("set_sacrament_testimony_failed","interaction","Set Failed",1),setTimeout(()=>{k(s,!1),console.error("Sacrament Program update failed",l),t(c)({message:"Save failed, please reload browser and try again.",duration:7e3,type:"danger"})},800)}};H(()=>K(i()),()=>{k(u,i().name!=="")}),ie(),ee(),qe(n,{save:h,get loading(){return t(s)},set loading(l){k(s,l)},get valueChanged(){return t(o)},set valueChanged(l){k(o,l)},get setNotice(){return t(c)},set setNotice(l){k(c,l)},children:(l,m)=>{var g=Ye(),_=ce(g);fe(_,{label:"Name",name:"calling-name",placeholder:"Calling Name",get loading(){return t(s)},get isInvalid(){return t(u)},helperText:"Elders Quorum Secretary, Primary Teacher, etc",required:!0,get value(){return i().name},set value(T){i(i().name=T,!0)},$$legacy:!0});var y=S(_,2);Re(y,{get loading(){return t(s)},get disabled(){return t(s)},get organization(){return K(i()),Z(()=>i().organization)}});var a=S(y,2);We(a,{get loading(){return t(s)},get member(){return r()}}),D(l,g)},$$slots:{default:!0},$$legacy:!0}),R()}var He=M('<i slot="label" class="bi bi-plus"></i>'),Ke=M("<tr><td> </td><td> </td><td><!></td><td></td></tr>"),Ue=M('<table class="table"><thead><tr><th scope="col">Organization</th><th scope="col">Calling</th><th scope="col">Member</th><th scope="col">Actions</th></tr></thead><tbody></tbody></table>'),Ve=M('<div class="p-4 d-block bg-dark-subtle">No Data Found</div>'),Xe=M('<div class="d-flex justify-content-end gap-3"><div class="w-50"><input class="form-control" type="text" placeholder="search"/></div> <!></div> <!>',1);function et(n,e){q(e,!1);const u=()=>re(c,"$data",r),i=()=>re(m,"$gridData",r),[r,o]=Se(),{stores:{loading:s,data:c},actions:{init:h}}=Fe();let l=I();const m=P([]),g=()=>{let x=u().map(w=>({...w,searchStr:`${w.name}${w.organization}${w.calling_records?.length?w.calling_records[0]?.member?.name:""}`.toLowerCase()}));t(l)?.length&&(x=x.filter(w=>w.searchStr.includes(t(l).toLowerCase()))),m.set(x)},_=Le(400,()=>{s.set(!0),g(),s.set(!1)});se(async()=>{await h(),g()});let y={name:"",organization:"",sort_order:1},a={name:""};ee();var T=Xe(),C=ce(T),N=b(C),f=b(N);X(f),v(N);var d=S(N,2);Ne(d,{drawerTitle:"New Calling",id:"new-calling-trigger-button",children:(x,w)=>{Ze(x,{get member(){return a},get calling(){return y}})},$$slots:{default:!0,label:(x,w)=>{var E=He();D(x,E)}}}),v(C);var $=S(C,2);{var z=x=>{var w=Ue(),E=S(b(w));we(E,5,i,Te,(ve,j)=>{var B=Ke(),G=b(B),pe=b(G,!0);v(G);var J=S(G),be=b(J,!0);v(J);var te=S(J),he=b(te);{var _e=Q=>{var ae=Ce();F(()=>O(ae,t(j).calling_records[0].member.name)),D(Q,ae)};A(he,Q=>{t(j).calling_records?.length&&Q(_e)})}v(te),de(),v(B),F(()=>{O(pe,t(j).organization),O(be,t(j).name)}),D(ve,B)}),v(E),v(w),D(x,w)},L=x=>{var w=Ve();D(x,w)};A($,x=>{i()?.length?x(z):x(L,!1)})}V("keyup",f,_),ue(f,()=>t(l),x=>k(l,x)),D(n,T),R(),o()}function xt(n){ye(n,{pageTitle:"Callings",children:(e,u)=>{et(e,{})},$$slots:{default:!0}})}export{xt as component,yt as universal};
