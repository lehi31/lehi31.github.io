const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/DO0djbQe.js","../chunks/Cpj98o6Y.js"])))=>i.map(i=>d[i]);
import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{d as Xa,o as ua,g as Ja}from"../chunks/CuVcyAaV.js";import{p as ct,c as a,r as t,s as i,a as vt,B as C,C as Za,m as e,f as be,F as Ra,ai as D,D as c,E as f,aj as fa,u as o,R as Se,aq as Ga,n as K,ar as es}from"../chunks/BWCcv1pC.js";import{f as v,a as l,c as ot,t as lt}from"../chunks/DqgkBxsg.js";import{i as b,b as le,k as Ea,a as pa,s as R,p as it,e as q}from"../chunks/KiCntiD6.js";import{i as ut}from"../chunks/BeNQ5BU7.js";import{P as ts}from"../chunks/COTiBOj0.js";import{e as Ne,i as ca}from"../chunks/CvOYN50o.js";import{r as Ia,b as as,s as dt,i as ss,c as rs,d as ns,e as os}from"../chunks/BLfjesDR.js";import{b as ls}from"../chunks/CzDGc265.js";import{c as is,g as _a,d as ds,a as Nt,b as da,e as jt}from"../chunks/DYjrPUtT.js";import{s as Sa,A as cs,E as vs}from"../chunks/kblsOOHo.js";import{y as va,v as Da,z as us,e as ba,p as he,i as _e,O as Aa,P as Ee,f as Ye}from"../chunks/BZ_cLCXa.js";import{C as Ta,E as fs,c as ps}from"../chunks/CQ9ys_Rk.js";import{S as Ca}from"../chunks/BeYvafiM.js";import{v as Oa,D as Fa}from"../chunks/B4f_lHFw.js";import{s as qt}from"../chunks/DrfTdo8l.js";import{e as zt}from"../chunks/DuvDvsb0.js";import{B as _s}from"../chunks/B9HdDZQI.js";import{_ as bs}from"../chunks/CmsKOCeN.js";import{s as ms}from"../chunks/CdEA5IGF.js";import{R as St}from"../chunks/D7yrvtzI.js";function Ma(G,A,O){const m=va(G,O),N=va(A,O),I=+m-Da(m),y=+N-Da(N);return Math.round((I-y)/us)}function ys(G,A){return is(G,-A)}const gs=!0,Nr=Object.freeze(Object.defineProperty({__proto__:null,prerender:gs},Symbol.toStringTag,{value:"Module"}));var hs=v("<option> </option>"),ks=v('<div class="col-12 col-md-auto"><select class="form-select form-select" aria-label="Filter by category"><option>All Categories</option><!></select></div>'),ws=v('<div class="search-filter sticky-top svelte-14zxluq"><div class="row g-2"><div class="col-12 col-md"><input type="search" class="form-control form-control" placeholder="Search..."/></div> <!></div></div>');function xs(G,A){ct(A,!1);const O=()=>le(U,"$searchQuery",I),m=()=>le(Q,"$currentCategories",I),N=()=>le(z,"$categoryFilter",I),[I,y]=pa(),{stores:{currentCategories:Q,categoryFilter:z,searchQuery:U}}=_a();ut();var te=ws(),w=a(te),ae=a(w),L=a(ae);Ia(L),t(ae);var ve=i(ae,2);{var M=H=>{var k=ks(),se=a(k);C(()=>{N(),Za(()=>{m()})});var Y=a(se);Y.value=Y.__value="";var ee=i(Y);Ne(ee,1,m,ca,(re,$)=>{var B=hs(),V=a(B,!0);t(B);var ie={};C(()=>{R(V,e($).label),ie!==(ie=e($).key)&&(B.value=(B.__value=e($).key)??"")}),l(re,B)}),t(se),t(k),as(se,N,re=>Ea(z,re)),l(H,k)};b(ve,H=>{m().length&&H(M)})}t(w),t(te),ls(L,O,H=>Ea(U,H)),l(G,te),vt(),y()}var $s=v('<p class="mb-0">No past events to delete.</p>'),Es=v('<p class="mb-2"><strong> </strong></p>'),Ss=v(`<div class="alert alert-warning mb-0" role="alert"><p class="mb-2"><strong> </strong></p> <p class="mb-0 small">These recurring events have active future instances and cannot be deleted until all
								future occurrences have passed.</p></div>`),Ds=v("<!> <!>",1),As=v('<div class="modal svelte-1u875uh" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-primary text-white"><h5 class="modal-title">Delete Past Events - Results</h5> <button type="button" class="btn-close btn-close-white" aria-label="Close"></button></div> <div class="modal-body"><!></div> <div class="modal-footer"><button type="button" class="btn btn-primary">OK</button></div></div></div></div>');function Ms(G,A){ct(A,!1);let O=it(A,"deleted",8),m=it(A,"skipped",8),N=it(A,"callback",8);function I(){N()()}ut();var y=As(),Q=a(y),z=a(Q),U=a(z),te=i(a(U),2);t(U);var w=i(U,2),ae=a(w);{var L=k=>{var se=$s();l(k,se)},ve=k=>{var se=Ds(),Y=be(se);{var ee=B=>{var V=Es(),ie=a(V),De=a(ie);t(ie),t(V),C(()=>R(De,`✓ Deleted ${O()??""} past event${O()===1?"":"s"}.`)),l(B,V)};b(Y,B=>{O()>0&&B(ee)})}var re=i(Y,2);{var $=B=>{var V=Ss(),ie=a(V),De=a(ie),ke=a(De);t(De),t(ie),Ra(2),t(V),C(()=>R(ke,`⚠ Skipped ${m()??""} recurring event${m()===1?"":"s"}`)),l(B,V)};b(re,B=>{m()>0&&B($)})}l(k,se)};b(ae,k=>{O()===0&&m()===0?k(L):k(ve,!1)})}t(w);var M=i(w,2),H=a(M);t(M),t(z),t(Q),t(y),q("click",te,I),q("click",H,I),l(G,y),vt()}var Ps=v(`<div class="modal svelte-dmsnaa" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-danger text-white"><h5 class="modal-title">Delete Past Events</h5> <button type="button" class="btn-close btn-close-white" aria-label="Close"></button></div> <div class="modal-body"><p class="mb-3"><strong> </strong></p> <p class="mb-0 text-muted small">This action cannot be undone. Recurring events with future instances will be skipped
					automatically.</p></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-danger">Delete</button></div></div></div></div>`);function Rs(G,A){ct(A,!1);let O=it(A,"cutoffDate",8),m=it(A,"callback",8);function N(){m()(!0)}function I(){m()(!1)}ut();var y=Ps(),Q=a(y),z=a(Q),U=a(z),te=i(a(U),2);t(U);var w=i(U,2),ae=a(w),L=a(ae),ve=a(L);t(L),t(ae),Ra(2),t(w);var M=i(w,2),H=a(M),k=i(H,2);t(M),t(z),t(Q),t(y),C(()=>R(ve,`Are you sure you want to delete all events that occurred before ${O()??""}?`)),q("click",te,I),q("click",H,I),q("click",k,N),l(G,y),vt()}var Is=v('<button class="btn btn-sm btn-outline-secondary w-100"><i class="bi bi-clock-history me-1"></i> </button>'),Ts=v('<button class="btn btn-sm btn-outline-danger" type="button"><!></button>'),Cs=v('<div class="event-actions svelte-1ichfmm"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit past event"><i class="bi bi-pencil-square"></i></button></div>'),Os=v('<div class="daily-event-row svelte-1ichfmm"><div class="event-content svelte-1ichfmm"><!></div> <!></div>'),Fs=v('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-1ichfmm"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),Us=v('<li class="list-group-item py-3 text-muted">No events scheduled this week.</li>'),Ls=v('<li class="list-group-item list-group-item-light text-uppercase small fw-lighter p-0"><button><span class="d-flex align-items-center gap-2"><i></i> <span class="text-muted"> </span></span> <span> </span></button></li> <!>',1),Bs=v('<li class="list-group-item bg-secondary text-white fw-semibold"> </li> <!>',1),Ws=v('<button class="btn btn-outline-secondary btn-sm">Reset</button>'),Ns=v('<div class="d-flex gap-2"><button class="btn btn-primary btn-sm">More</button> <button class="btn btn-outline-primary btn-sm">All</button></div>'),js=v('<div class="card-footer d-flex align-items-center justify-content-between"><small> </small> <!></div>'),qs=v('<ul class="list-group list-group-flush border-top-0"></ul> <!>',1),zs=v('<div class="card-body text-muted small">No past events available.</div>'),Hs=v('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center gap-3 flex-wrap fw-lighter"><span>Past Events</span> <div class="d-flex gap-2"><!> <button class="btn btn-sm btn-outline-secondary">Hide</button></div></div></div> <!></div>'),Ks=v('<div class="d-flex flex-column gap-4"><!></div>'),Qs=v("<!> <!> <!> <!>",1);function Ys(G,A){ct(A,!1);const O=()=>le(de,"$weeksExpanded",w),m=()=>le(j,"$allPastEvents",w),N=()=>le(B,"$currentUser",w),I=()=>le(De,"$userOrganizations",w),y=()=>le($,"$currentUserHasPermission",w),Q=()=>le(ie,"$currentUserIsRoot",w),z=()=>le(V,"$currentUserIsAdmin",w),U=()=>le(ke,"$ready",w),te=()=>le(Ae,"$searchQuery",w),[w,ae]=pa(),L=f(),ve=f(),M=f(),H=f(),k=f(),se=f(),Y=f(),ee=f(),re=f(),{stores:{currentUserHasPermission:$,currentUser:B,currentUserIsAdmin:V,currentUserIsRoot:ie,userOrganizations:De}}=ba(),{stores:{ready:ke,dbData:W,weeksExpanded:de,searchQuery:Ae},actions:{reload:ne}}=_a(),Dt={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0};let Ve=it(A,"formId",24,Oa),At=f(!1),Xe=f(!1),Je=f(),ft=f(!1),pt=f(!1),Ze=f(!1),Ge=f(new Set),Fe=f(!1),Mt=f(""),et=f({...Dt}),je=f(!1),Pt=f(""),_t=f(!1),x=f({deleted:0,skipped:0});const bt=4,Rt=4;let Ue=f(bt),tt=f(!1);const It=qt();let r=f({});function d(s){return e(L).includes(s)}function p(s){const u=e(r)[s]??d(s);c(r,{...e(r),[s]:!u})}const g=s=>{c(Mt,"Event Item"),c(et,{...s,category:s?.meta_data?.category})},j=Xa(W,s=>{const u=qt();return(s??[]).filter(n=>!(n.event_type!=="calendar_event"||!n.start_time||he(n.start_time)>=u||n.recurrence_rule&&(!n.recurrence_end_date||n.recurrence_end_date&&he(n.recurrence_end_date)>=u)))}),Me=s=>ps(s,{currentUserId:e(Je),isPrivileged:e(Xe),canEditOwnOrgEvents:e(Ze),userOrganizations:e(Ge)});let ce=f(!1);function P(){c(Ue,e(Ue)+Rt)}function me(){c(Ue,520),c(tt,!0)}function Pe(){c(Ue,bt),c(tt,!1)}const Ce=()=>{if(!e(At)||e(Fe)||!Ja(ie)||!e(ee))return;const s=qt();c(Pt,_e(s,"MMM d, yyyy")),c(je,!0)};async function Le(s){if(c(je,!1),!s)return;const u=qt();c(Fe,!0);try{const n=await ds(u);await ne(),c(x,n),c(_t,!0)}catch(n){console.error("Failed to delete past events",n),alert("Failed to delete past events. Please try again.")}finally{c(Fe,!1)}}function mt(){c(_t,!1)}ua(async()=>{await ne()}),D(()=>(m(),e(Ue)),()=>{c(M,(m()??[]).filter(s=>{if(!s.start_time)return!1;const u=he(s.start_time),n=ys(It,e(Ue));return u>=n&&u<It}))}),D(()=>(e(M),_e),()=>{c(k,(()=>{const s=new Map;for(const u of e(M)){if(!u.start_time)continue;const n=he(u.start_time),T=va(n,{weekStartsOn:1}),E=zt(n,{weekStartsOn:1}),S=_e(T,"yyyy-MM-dd"),oe=`${_e(T,"MMM d")} – ${_e(E,"MMM d")}`;let X=s.get(S);X||(X={key:S,label:oe,days:new Map},s.set(S,X));const xe=_e(n,"yyyy-MM-dd");let Re=X.days.get(xe);Re||(Re={key:xe,displayDay:_e(n,"EEE"),displayDate:_e(n,"MMM d"),events:[]},X.days.set(xe,Re)),Re.events.push(u)}return Array.from(s.values()).sort((u,n)=>u.key<n.key?1:-1).map(u=>({key:u.key,label:u.label,days:Array.from(u.days.values()).sort((n,T)=>n.key<T.key?1:-1).map(n=>({...n,events:n.events.slice().sort((T,E)=>{const S=T.is_all_day?0:1,oe=E.is_all_day?0:1;if(S!==oe)return S-oe;const X=T.start_time?he(T.start_time).getTime():Number.MAX_SAFE_INTEGER,xe=E.start_time?he(E.start_time).getTime():Number.MAX_SAFE_INTEGER;return X-xe})}))}))})())}),D(()=>e(k),()=>{c(L,(()=>{if(e(k).length===0)return[];const s=[];return e(k)[0]&&s.push(e(k)[0].key),e(k)[1]&&s.push(e(k)[1].key),s})())}),D(()=>(O(),e(r)),()=>{c(ve,s=>O()?!0:e(r)[s]!==void 0?e(r)[s]:d(s))}),D(()=>e(M),()=>{c(H,e(M).length)}),D(()=>(e(k),_e),()=>{c(se,e(k).reduce((s,u)=>{const n=he(u.key),T=zt(n,{weekStartsOn:1}),E=_e(T,"yyyy-MM"),S=_e(T,"MMMM yyyy");return s[E]||(s[E]={label:S,weeks:[]}),s[E].weeks.push(u),s},{}))}),D(()=>N(),()=>{c(Je,N()?.id)}),D(()=>I(),()=>{c(Ge,I())}),D(()=>e(Je),()=>{c(pt,!!e(Je))}),D(()=>(e(Ge),Aa),()=>{c(ft,e(Ge).has(Aa.Bishopric))}),D(()=>(y(),Ee),()=>{c(Ze,y()(Ee.EditOwnOrgEvents))}),D(()=>(Q(),z(),e(ft),y(),Ee),()=>{c(Xe,Q()||z()||e(ft)||y()(Ee.EditAllEvents))}),D(()=>(e(Xe),y(),e(Ze),e(pt)),()=>{c(At,e(Xe)||y()(Ee.CreateEvents)||e(Ze)||e(pt))}),D(()=>(y(),Ee),()=>{c(Y,y()(Ee.DeleteEvents))}),D(()=>e(M),()=>{c(ee,e(M).length>0)}),D(()=>(m(),e(M)),()=>{c(re,m().length>e(M).length)}),fa(),ut();var at=Qs(),yt=be(at);Fa(yt,{get title(){return e(Mt)},get id(){return Ve()},children:(s,u)=>{Ta(s,{get eventItem(){return e(et)},get drawerId(){return Ve()},name:"past-event-item-form",get canDelete(){return e(Y)}})},$$slots:{default:!0}});var we=i(yt,2);{var Tt=s=>{var u=ot(),n=be(u);{var T=S=>{var oe=ot(),X=be(oe);{var xe=Be=>{var $e=Is(),Oe=i(a($e));t($e),C(()=>R(Oe,` Show Past Events (${m(),o(()=>m().length)??""})`)),q("click",$e,()=>c(ce,!0)),l(Be,$e)},Re=Be=>{var $e=Hs(),Oe=a($e),Ot=a(Oe),gt=i(a(Ot),2),ht=a(gt);{var Qt=fe=>{var ye=Ts(),qe=a(ye);{var wt=J=>{var pe=lt("Deleting…");l(J,pe)},ze=J=>{var pe=lt();C(()=>R(pe,`Delete All (${e(H)??""})`)),l(J,pe)};b(qe,J=>{e(Fe)?J(wt):J(ze,!1)})}t(ye),C(()=>ye.disabled=e(Fe)),q("click",ye,Ce),l(fe,ye)};b(ht,fe=>{Q()&&e(ee)&&fe(Qt)})}var kt=i(ht,2);t(gt),t(Ot),t(Oe);var Ft=i(Oe,2);{var Yt=fe=>{var ye=qs(),qe=be(ye);Ne(qe,5,()=>(e(se),o(()=>Object.entries(e(se)))),([J,pe])=>J,(J,pe)=>{var He=Ga(()=>es(e(pe),2));let We=()=>e(He)[1];var Ke=Bs(),Ie=be(Ke),st=a(Ie,!0);t(Ie);var Te=i(Ie,2);Ne(Te,1,()=>(We(),o(()=>We().weeks)),ge=>ge.key,(ge,Z)=>{const _=Se(()=>(K(he),e(Z),o(()=>he(e(Z).key)))),h=Se(()=>(K(zt),K(e(_)),o(()=>zt(e(_),{weekStartsOn:1})))),ue=Se(()=>(K(Sa),K(e(h)),o(()=>Sa(e(h))))),Qe=Se(()=>(K(Ma),K(e(h)),K(e(ue)),o(()=>Ma(e(h),e(ue),{weekStartsOn:1})+1))),Xt=Se(()=>(e(ve),e(Z),o(()=>e(ve)(e(Z).key)))),Ut=Se(()=>(e(Z),o(()=>e(Z).days.reduce(($t,Lt)=>$t+Lt.events.length,0))));var ma=Ls(),Jt=be(ma),xt=a(Jt);let ya;var Zt=a(xt),ga=a(Zt),ha=i(ga,2),Ua=a(ha);t(ha),t(Zt);var Gt=i(Zt,2);let ka;var La=a(Gt,!0);t(Gt),t(xt),t(Jt);var Ba=i(Jt,2);{var Wa=$t=>{var Lt=ot(),Na=be(Lt);{var ja=rt=>{var Bt=ot(),za=be(Bt);Ne(za,1,()=>(e(Z),o(()=>e(Z).days)),ea=>ea.key,(ea,nt)=>{var ta=Fs(),wa=a(ta),aa=a(wa),sa=a(aa),Ha=a(sa,!0);t(sa);var xa=i(sa,2),Ka=a(xa,!0);t(xa),t(aa);var $a=i(aa,2);Ne($a,5,()=>(e(nt),o(()=>e(nt).events)),Et=>Et.id??`${Et.start_time}-${Et.meta_data?.recurring_instance_index??0}`,(Et,Wt)=>{var ra=Os(),na=a(ra),Qa=a(na);fs(Qa,{get item(){return e(Wt)},showDate:!1,get searchQuery(){return te()}}),t(na);var Ya=i(na,2);{var Va=oa=>{var la=Cs(),ia=a(la);t(la),C(()=>{dt(ia,"data-bs-target",`#${Ve()??""}`),dt(ia,"aria-controls",Ve())}),q("click",ia,()=>g(e(Wt))),l(oa,la)};b(Ya,oa=>{e(Wt),o(()=>Me(e(Wt)))&&oa(Va)})}t(ra),l(Et,ra)}),t($a),t(wa),t(ta),C(()=>{R(Ha,(e(nt),o(()=>e(nt).displayDay))),R(Ka,(e(nt),o(()=>e(nt).displayDate)))}),l(ea,ta)}),l(rt,Bt)},qa=rt=>{var Bt=Us();l(rt,Bt)};b(Na,rt=>{e(Z),o(()=>e(Z).days.length)?rt(ja):rt(qa,!1)})}l($t,Lt)};b(Ba,$t=>{e(Xt)&&$t(Wa)})}C(()=>{ya=Ye(xt,1,"week-header w-100 d-flex justify-content-between align-items-center border-0 bg-transparent p-2 text-start svelte-1ichfmm",null,ya,{"text-muted":e(Ut)===0}),dt(xt,"title",e(Xt)?"Click to collapse week":"Click to expand week"),Ye(ga,1,`bi ${e(Xt)?"bi-chevron-up":"bi-chevron-down"}`),R(Ua,`Week ${e(Qe)??""} [${e(Ut)??""} Event${e(Ut)===1?"":"s"}]`),ka=Ye(Gt,1,"",null,ka,{"opacity-50":e(Ut)===0}),R(La,(e(Z),o(()=>e(Z).label)))}),q("click",xt,()=>p(e(Z).key)),l(ge,ma)}),C(()=>R(st,(We(),o(()=>We().label)))),l(J,Ke)}),t(qe);var wt=i(qe,2);{var ze=J=>{var pe=js(),He=a(pe),We=a(He);t(He);var Ke=i(He,2);{var Ie=Te=>{var ge=Ws();q("click",ge,Pe),l(Te,ge)},st=Te=>{var ge=Ns(),Z=a(ge),_=i(Z,2);t(ge),q("click",Z,P),q("click",_,me),l(Te,ge)};b(Ke,Te=>{e(tt)?Te(Ie):Te(st,!1)})}t(pe),C(()=>R(We,`Showing ${e(M),o(()=>e(M)?.length??0)??""} of ${m(),o(()=>m()?.length??0)??""}`)),l(J,pe)};b(wt,J=>{(e(re)||e(tt))&&J(ze)})}l(fe,ye)},Vt=fe=>{var ye=zs();l(fe,ye)};b(Ft,fe=>{e(k),o(()=>e(k).length)?fe(Yt):fe(Vt,!1)})}t($e),q("click",kt,()=>c(ce,!1)),l(Be,$e)};b(X,Be=>{e(ce)?Be(Re,!1):Be(xe)})}l(S,oe)},E=S=>{var oe=Ks(),X=a(oe);Ca(X,{}),t(oe),l(S,oe)};b(n,S=>{U()?S(T):S(E,!1)})}l(s,u)};b(we,s=>{Q()&&s(Tt)})}var Ct=i(we,2);{var Ht=s=>{Rs(s,{get cutoffDate(){return e(Pt)},callback:Le})};b(Ct,s=>{e(je)&&s(Ht)})}var Kt=i(Ct,2);{var F=s=>{Ms(s,{get deleted(){return e(x),o(()=>e(x).deleted)},get skipped(){return e(x),o(()=>e(x).skipped)},callback:mt})};b(Kt,s=>{e(_t)&&s(F)})}l(G,at),vt(),ae()}var Vs=v('<div class="d-flex flex-column gap-4"><!> <!> <!> <!></div>');function Pa(G){var A=Vs(),O=a(A);xs(O,{});var m=i(O,2);cs(m,{});var N=i(m,2);vs(N,{});var I=i(N,2);Ys(I,{}),t(A),l(G,A)}var Xs=v('<div class="d-flex justify-content-center align-items-center py-5"><!></div>'),Js=v('<button type="button" role="tab"> </button>'),Zs=v("<option> </option>"),Gs=v('<div class="py-5 text-center text-muted"><!></div>'),er=v('<div class="description-preview text-muted small mb-1 svelte-9fakr"> </div>'),tr=v("<span> </span>"),ar=v('<span class="badge rounded-pill bg-secondary-subtle text-secondary-emphasis">Uncategorized</span>'),sr=v('<span><i class="bi bi-geo-alt"></i> </span>'),rr=v('<span><i class="bi bi-arrow-repeat"></i> </span>'),nr=v('<span><i class="bi bi-calendar3"></i> </span>'),or=v('<span class="text-muted small"> </span>'),lr=v('<div class="submission-card text-start svelte-9fakr" role="button" tabindex="0"><div class="d-flex justify-content-between align-items-start gap-3 mb-1"><div class="fw-semibold"> </div> <div class="d-flex align-items-center gap-2"><span class="badge bg-light text-dark"> </span> <button class="btn btn-sm btn-outline-primary" type="button"><i class="bi bi-pencil-square"></i></button></div></div> <!> <div class="d-flex flex-wrap align-items-center gap-2 small text-muted mb-1"><!> <!> <!></div> <div class="d-flex flex-wrap align-items-center gap-2 small text-muted mb-1"><span><i class="bi bi-clock"></i> </span> <!></div> <div class="d-flex flex-wrap align-items-center gap-2"><span><i></i> </span> <!></div></div>'),ir=v('<div class="d-flex flex-column gap-3"></div>'),dr=v('<div class="my-submissions-page d-flex flex-column gap-4 svelte-9fakr"><div class="card"><div class="card-header d-flex flex-column gap-3"><div class="d-flex flex-md-row align-items-center justify-content-between gap-2"><div class="mb-0">My Submissions</div> <button class="btn btn-outline-secondary btn-sm"><!></button></div> <div class="submissions-status-tabs nav nav-pills gap-2" role="tablist"></div></div> <div class="card-body d-flex flex-column gap-3"><div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3"><div class="input-group input-group-sm my-submissions-search svelte-9fakr"><input class="form-control svelte-9fakr" type="search" placeholder="Search title, category, or location"/></div> <div class="type-filter-select svelte-9fakr"><select class="form-select form-select-sm"></select></div></div> <!></div></div></div>'),cr=v('<div class="text-muted">Select a submission to edit.</div>'),vr=v("<!> <!>",1);function ur(G,A){ct(A,!1);const O=()=>le(k,"$currentUserStore",y),m=()=>le(se,"$currentUserHasPermission",y),N=()=>le(M,"$dbData",y),I=()=>le(ve,"$ready",y),[y,Q]=pa(),z=f(),U=f(),te=f(),w=f(),ae=f(),L=f(),{stores:{ready:ve,dbData:M},actions:{reload:H}}=_a(),{stores:{currentUser:k,currentUserHasPermission:se}}=ba();let Y=f(!1),ee=f([]),re=f([]),$=f(null);const B=Oa();let V=null;const ie={approved:"var(--bs-success)",pending:"var(--bs-warning)",needs_review:"var(--bs-info)",published:"var(--bs-primary)"},De={pending:{text:"Awaiting Approval",class:"bg-warning-subtle text-warning-emphasis",icon:"bi-hourglass-split"},needs_review:{text:"Changes Suggested",class:"bg-info-subtle text-info-emphasis",icon:"bi-pencil"},approved:{text:"Approved — Awaiting Publish",class:"bg-success-subtle text-success-emphasis",icon:"bi-check-circle"},published:{text:"Published",class:"bg-primary-subtle text-primary-emphasis",icon:"bi-globe"}},ke={pending:"Pending",needs_review:"Changes Suggested",approved:"Approved",published:"Published"},W=[{value:"pending",label:ke.pending},{value:"needs_review",label:ke.needs_review},{value:"approved",label:ke.approved},{value:"published",label:ke.published}],de=[{value:"all",label:"Events & Announcements"},{value:"events",label:"Events only"},{value:"announcements",label:"Announcements only"}],Ae=()=>({search:"",typeFilter:"all"});let ne=f({pending:Ae(),needs_review:Ae(),approved:Ae(),published:Ae()});ua(async()=>{c(Y,!0),await H(),c(Y,!1),typeof window<"u"&&(V=(await bs(()=>import("../chunks/DO0djbQe.js").then(d=>d.o),__vite__mapDeps([0,1]),import.meta.url)).default)});const Dt=r=>{const d=r.meta_data?.submitted_at??r.created_at;if(!d)return 0;try{return he(d).getTime()}catch(p){return console.warn("Failed to parse submission timestamp",p),0}},Ve=r=>{const d=r.meta_data?.submitted_at??r.created_at;if(!d)return"—";try{return _e(he(d),"MMM d, yyyy 'at' h:mm a")}catch(p){return console.warn("Failed to format submission timestamp",p),"—"}},At=r=>{if(!r.start_time)return"—";try{return _e(he(r.start_time),"MMM d, yyyy 'at' h:mm a")}catch(d){return console.warn("Failed to format event date",d),"—"}},Xe=r=>r.replace(/<[^>]*>/g,""),Je=(r,d)=>r.length<=d?r:r.substring(0,d).trimEnd()+"…",ft=r=>r.description?Je(Xe(r.description).trim(),120):"",pt=r=>{try{const p=St.fromString(r).origOptions,g=p.interval||1,j=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Me=["","1st","2nd","3rd","4th","5th"];if(p.freq===St.DAILY)return g===1?"Repeats daily":`Repeats every ${g} days`;if(p.freq===St.WEEKLY){if(p.byweekday){const P=(Array.isArray(p.byweekday)?p.byweekday:[p.byweekday]).map(me=>{const Pe=typeof me=="number"?me:me.weekday,Ce=Pe===6?0:Pe+1;return j[Ce]});return g===1?P.length===1?`Repeats every ${P[0]}`:`Repeats on ${P.join(", ")}`:`Repeats every ${g} weeks on ${P.join(", ")}`}return g===1?"Repeats weekly":`Repeats every ${g} weeks`}if(p.freq===St.MONTHLY){if(p.byweekday){const P=(Array.isArray(p.byweekday)?p.byweekday:[p.byweekday])[0];if(P&&typeof P=="object"&&"n"in P&&"weekday"in P){const me=P.weekday,Pe=me===6?0:me+1,Ce=P.n,Le=Me[Ce]||`${Ce}th`;return g===1?`Repeats on the ${Le} ${j[Pe]} of the month`:`Repeats on the ${Le} ${j[Pe]} every ${g} months`}}if(p.bymonthday){const ce=Array.isArray(p.bymonthday)?p.bymonthday[0]:p.bymonthday,P=ce===1?"st":ce===2?"nd":ce===3?"rd":"th";return g===1?`Repeats on the ${ce}${P} of the month`:`Repeats on the ${ce}${P} every ${g} months`}return g===1?"Repeats monthly":`Repeats every ${g} months`}return p.freq===St.YEARLY?g===1?"Repeats yearly":`Repeats every ${g} years`:"Repeats"}catch{return"Repeats"}},Ze=(r,d)=>{const p=d.trim().toLowerCase();if(!p)return!0;const g=r.meta_data?.category?da(r.meta_data.category)?.label??"":"";return[r.title??"",r.description??"",r.location??"",g??""].join(" ").toLowerCase().includes(p)},Ge=(r,d)=>d==="all"?!0:d==="events"?r.event_type==="calendar_event":r.event_type==="announcement";function Fe(r,d){c(ne,{...e(ne),[r]:{...e(ne)[r],...d}})}const Mt=r=>{const d=new Set,p=[];for(const g of r){const j=g.meta_data?.recurring_parent_id;if(g.meta_data?.recurring_instance&&j!=null){if(d.has(j))continue;d.add(j)}p.push(g)}return p},et=r=>r.meta_data?.recurring_parent_id!=null?`recurring-${r.meta_data.recurring_parent_id}`:`id-${r.id}`,je=r=>{c($,r);const d=document.getElementById(B);d&&V&&V.getOrCreateInstance(d).show()},Pt=(r,d)=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),je(d))},_t=async()=>{c(Y,!0),await H(),c(Y,!1)};let x=f("pending");D(()=>O(),()=>{c(z,O())}),D(()=>(m(),Ee),()=>{c(U,m()(Ee.DeleteEvents)||m()(Ee.DeleteOwnEvents))}),D(()=>(N(),e(z)),()=>{c(ee,Mt((N()??[]).filter(r=>{const d=r.meta_data?.submitted_by_user_id;return d&&e(z)?.id&&d===e(z).id}).sort((r,d)=>Dt(r)-Dt(d))))}),D(()=>e(x),()=>{c(te,`type-filter-select-submissions-${e(x)}`)}),D(()=>(e(ee),Nt),()=>{c(w,W.reduce((r,d)=>(r[d.value]=e(ee).filter(p=>Nt(p)===d.value),r),{}))}),D(()=>(e(ne),e(w)),()=>{c(ae,W.reduce((r,d)=>{const p=e(ne)[d.value],g=(e(w)[d.value]??[]).filter(j=>Ge(j,p.typeFilter));return r[d.value]=g.filter(j=>Ze(j,p.search)),r},{}))}),D(()=>(e(ae),e(x)),()=>{c(re,e(ae)[e(x)]??[])}),D(()=>(e($),e(ee)),()=>{e($)&&!e(ee).some(r=>et(r)===et(e($)))&&c($,null)}),D(()=>e($),()=>{c(L,e($)?{...e($),id:e($).id??e($).meta_data?.recurring_parent_id,category:e($).meta_data?.category}:null)}),fa(),ut();var bt=vr(),Rt=be(bt);{var Ue=r=>{var d=Xs(),p=a(d);Ca(p,{}),t(d),l(r,d)},tt=r=>{var d=dr(),p=a(d),g=a(p),j=a(g),Me=i(a(j),2),ce=a(Me);{var P=F=>{var s=lt("Refreshing…");l(F,s)},me=F=>{var s=lt("Refresh");l(F,s)};b(ce,F=>{e(Y)?F(P):F(me,!1)})}t(Me),t(j);var Pe=i(j,2);Ne(Pe,5,()=>W,ca,(F,s)=>{var u=Js(),n=a(u);t(u),C(()=>{Ye(u,1,(e(x),e(s),o(()=>`nav-link ${e(x)===e(s).value?"active":""}`)),"svelte-9fakr"),dt(u,"aria-selected",(e(x),e(s),o(()=>e(x)===e(s).value))),R(n,`${e(s),o(()=>e(s).label)??""} (${e(w),e(s),o(()=>(e(w)[e(s).value]??[]).length)??""})`)}),q("click",u,()=>c(x,e(s).value)),l(F,u)}),t(Pe),t(g);var Ce=i(g,2),Le=a(Ce),mt=a(Le),at=a(mt);Ia(at),t(mt);var yt=i(mt,2),we=a(yt);Ne(we,5,()=>de,ca,(F,s)=>{var u=Zs(),n=a(u,!0);t(u);var T={};C(()=>{R(n,(e(s),o(()=>e(s).label))),T!==(T=(e(s),o(()=>e(s).value)))&&(u.value=(u.__value=(e(s),o(()=>e(s).value)))??"")}),l(F,u)}),t(we);var Tt;ss(we),t(yt),t(Le);var Ct=i(Le,2);{var Ht=F=>{var s=Gs(),u=a(s);{var n=E=>{var S=lt("You haven't submitted any events or announcements yet.");l(E,S)},T=E=>{var S=lt();C(oe=>R(S,`No ${oe??""} submissions match your current filters.`),[()=>(e(x),o(()=>ke[e(x)].toLowerCase()))]),l(E,S)};b(u,E=>{e(ee),o(()=>e(ee).length===0)?E(n):E(T,!1)})}t(s),l(F,s)},Kt=F=>{var s=ir();Ne(s,5,()=>e(re),u=>et(u),(u,n)=>{const T=Se(()=>(K(Nt),e(n),o(()=>Nt(e(n))))),E=Se(()=>(K(e(T)),o(()=>De[e(T)]))),S=Se(()=>(e(n),K(da),o(()=>e(n).meta_data?.category?da(e(n).meta_data.category):null))),oe=Se(()=>(e(n),o(()=>ft(e(n)))));var X=lr(),xe=a(X),Re=a(xe),Be=a(Re,!0);t(Re);var $e=i(Re,2),Oe=a($e),Ot=a(Oe,!0);t(Oe);var gt=i(Oe,2);t($e),t(xe);var ht=i(xe,2);{var Qt=_=>{var h=er(),ue=a(h,!0);t(h),C(()=>R(ue,e(oe))),l(_,h)};b(ht,_=>{e(oe)&&_(Qt)})}var kt=i(ht,2),Ft=a(kt);{var Yt=_=>{var h=tr(),ue=a(h,!0);t(h),C(()=>{Ye(h,1,`badge rounded-pill bg-color-${K(e(S)),o(()=>e(S).color_number)??""}`,"svelte-9fakr"),R(ue,(K(e(S)),o(()=>e(S).label)))}),l(_,h)},Vt=_=>{var h=ar();l(_,h)};b(Ft,_=>{e(S)?_(Yt):_(Vt,!1)})}var fe=i(Ft,2);{var ye=_=>{var h=sr(),ue=i(a(h));t(h),C(()=>R(ue,` ${e(n),o(()=>e(n).location)??""}`)),l(_,h)};b(fe,_=>{e(n),o(()=>e(n).location)&&_(ye)})}var qe=i(fe,2);{var wt=_=>{var h=rr(),ue=i(a(h));t(h),C(Qe=>R(ue,` ${Qe??""}`),[()=>(e(n),o(()=>pt(e(n).recurrence_rule)))]),l(_,h)};b(qe,_=>{e(n),o(()=>e(n).recurrence_rule)&&_(wt)})}t(kt);var ze=i(kt,2),J=a(ze),pe=i(a(J));t(J);var He=i(J,2);{var We=_=>{var h=nr(),ue=i(a(h));t(h),C(Qe=>R(ue,` Event ${Qe??""}`),[()=>(e(n),o(()=>At(e(n))))]),l(_,h)};b(He,_=>{e(n),o(()=>e(n).event_type==="calendar_event")&&_(We)})}t(ze);var Ke=i(ze,2),Ie=a(Ke),st=a(Ie),Te=i(st,1,!0);t(Ie);var ge=i(Ie,2);{var Z=_=>{var h=or(),ue=a(h);t(h),C(Qe=>R(ue,`Approvals: ${Qe??""} of 3`),[()=>(K(jt),e(n),o(()=>jt(e(n))))]),l(_,h)};b(ge,_=>{K(jt),e(n),o(()=>jt(e(n))>0)&&_(Z)})}t(Ke),t(X),C(_=>{os(X,`border-left: 4px solid ${K(e(T)),o(()=>ie[e(T)])??""}`),R(Be,(e(n),o(()=>e(n).title))),R(Ot,(e(n),o(()=>e(n).event_type==="calendar_event"?"Event":"Announcement"))),dt(gt,"aria-label",(e(n),o(()=>`Edit ${e(n).title}`))),R(pe,` Submitted ${_??""}`),Ye(Ie,1,(K(e(E)),o(()=>`badge ${e(E).class}`)),"svelte-9fakr"),Ye(st,1,(K(e(E)),o(()=>`bi ${e(E).icon} me-1`)),"svelte-9fakr"),R(Te,(K(e(E)),o(()=>e(E).text)))},[()=>(e(n),o(()=>Ve(e(n))))]),q("click",gt,ms(()=>je(e(n)))),q("click",X,()=>je(e(n))),q("keydown",X,_=>Pt(_,e(n))),l(u,X)}),t(s),l(F,s)};b(Ct,F=>{e(re),o(()=>e(re).length===0)?F(Ht):F(Kt,!1)})}t(Ce),t(p),t(d),C(()=>{Me.disabled=e(Y),rs(at,(e(ne),e(x),o(()=>e(ne)[e(x)].search))),dt(we,"id",e(te)),Tt!==(Tt=(e(ne),e(x),o(()=>e(ne)[e(x)].typeFilter)))&&(we.value=(we.__value=(e(ne),e(x),o(()=>e(ne)[e(x)].typeFilter)))??"",ns(we,(e(ne),e(x),o(()=>e(ne)[e(x)].typeFilter))))}),q("click",Me,_t),q("input",at,F=>Fe(e(x),{search:F.currentTarget.value})),q("change",we,F=>Fe(e(x),{typeFilter:F.currentTarget.value})),l(r,d)};b(Rt,r=>{I()?r(tt,!1):r(Ue)})}var It=i(Rt,2);{let r=Se(()=>(e($),o(()=>e($)?`Edit: ${e($).title}`:"Submission Details")));Fa(It,{get id(){return B},get title(){return e(r)},children:(d,p)=>{var g=ot(),j=be(g);{var Me=P=>{Ta(P,{get eventItem(){return e(L)},get drawerId(){return B},name:"my-submission-form",get canDelete(){return e(U)},canCreate:!1})},ce=P=>{var me=cr();l(P,me)};b(j,P=>{e(L)?P(Me):P(ce,!1)})}l(d,g)},$$slots:{default:!0}})}l(G,bt),vt(),Q()}var fr=v('<button class="nav-link" id="approvals-tab" data-bs-toggle="tab" data-bs-target="#approvals-pane" type="button" role="tab" aria-controls="approvals-pane" aria-selected="false">Approvals</button>'),pr=v('<button class="nav-link" id="my-submissions-tab" data-bs-toggle="tab" data-bs-target="#my-submissions-pane" type="button" role="tab" aria-controls="my-submissions-pane" aria-selected="false">My Submissions</button>'),_r=v('<div class="tab-pane fade" id="approvals-pane" role="tabpanel" aria-labelledby="approvals-tab"><!></div>'),br=v('<div class="tab-pane fade" id="my-submissions-pane" role="tabpanel" aria-labelledby="my-submissions-tab"><!></div>'),mr=v('<nav class="d-print-none"><div class="nav nav-tabs" role="tablist"><button class="nav-link active" id="calendar-tab" data-bs-toggle="tab" data-bs-target="#calendar-pane" type="button" role="tab" aria-controls="calendar-pane" aria-selected="true">All</button> <!> <!></div></nav> <div class="tab-content mt-3"><div class="tab-pane fade show active" id="calendar-pane" role="tabpanel" aria-labelledby="calendar-tab"><!></div> <!> <!></div>',1);function jr(G,A){ct(A,!1);const O=f(),{stores:{currentUserHasPermission:m,authenticated:N}}=ba();let I=f(!1),y=f(!1);ua(()=>{const Q=m.subscribe(U=>{const te=U(Ee.ManageWardBusiness);c(I,te)}),z=N.subscribe(U=>{c(y,U)});return()=>{Q(),z()}}),D(()=>(e(I),e(y)),()=>{c(O,e(I)||e(y))}),fa(),ut(),ts(G,{pageTitle:"Calendar",children:(Q,z)=>{var U=ot(),te=be(U);{var w=L=>{var ve=mr(),M=be(ve),H=a(M),k=i(a(H),2);{var se=W=>{var de=fr();l(W,de)};b(k,W=>{e(I)&&W(se)})}var Y=i(k,2);{var ee=W=>{var de=pr();l(W,de)};b(Y,W=>{e(y)&&W(ee)})}t(H),t(M);var re=i(M,2),$=a(re),B=a($);Pa(B),t($);var V=i($,2);{var ie=W=>{var de=_r(),Ae=a(de);_s(Ae,{}),t(de),l(W,de)};b(V,W=>{e(I)&&W(ie)})}var De=i(V,2);{var ke=W=>{var de=br(),Ae=a(de);ur(Ae,{}),t(de),l(W,de)};b(De,W=>{e(y)&&W(ke)})}t(re),l(L,ve)},ae=L=>{Pa(L)};b(te,L=>{e(O)?L(w):L(ae,!1)})}l(Q,U)},$$slots:{default:!0}}),vt()}export{jr as component,Nr as universal};
