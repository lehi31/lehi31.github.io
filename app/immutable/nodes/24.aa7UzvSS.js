import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{w as ne,g as Oe,d as ie,o as Se}from"../chunks/DNltCNNq.js";import{p as me,aj as z,D as x,E as D,g as t,ak as Ee,s as d,c as e,r as a,F as J,t as Q,a as ge,f as de,w as G,u as F,am as Le,an as Ne}from"../chunks/CPcjNedw.js";import{f as k,a as b,t as Ge,c as _e}from"../chunks/BYls_3XS.js";import{b as H,i as W,s as A,a as we,p as Re,e as Je}from"../chunks/BafKDQNK.js";import{i as fe}from"../chunks/DPzVpBhB.js";import{P as We}from"../chunks/CsvcWhex.js";import{d as Ye,s as Ie,r as Pe}from"../chunks/Bq7r-knE.js";import{e as pe,b as ye,f as Ke,g as Ve}from"../chunks/C4Muj5SU.js";import{e as $e,i as Be}from"../chunks/B-ARnQOI.js";import{b as ze,a as He}from"../chunks/DSiQ23iJ.js";import{b as Qe}from"../chunks/GyUl0P7I.js";import{p as Xe}from"../chunks/CdLnE0kV.js";const Me=ne([]),Ae=ne([]);let he=!1,be=!1;async function Ze(){if(he)return Oe(Me);he=!0;try{const{data:o,error:r}=await pe.from("bom_reading_schedule").select("*").order("day_number",{ascending:!0});if(r)throw console.error("[API] Get BOM reading schedule failed:",r),new Error(`Failed to load reading schedule: ${r.message}`);const s=o||[];return Me.set(s),setTimeout(()=>he=!1,800),s}catch(o){throw he=!1,console.error("[API] Unexpected error fetching BOM reading schedule:",o),o}}async function xe(){if(be)return Oe(Ae);be=!0;try{const{data:o,error:r}=await pe.from("bom_reading_entries").select("*").order("created_at",{ascending:!1});if(r)throw console.error("[API] Get BOM reading entries failed:",r),new Error(`Failed to load reading entries: ${r.message}`);const s=o||[];return Ae.set(s),setTimeout(()=>be=!1,800),s}catch(o){throw be=!1,console.error("[API] Unexpected error fetching BOM reading entries:",o),o}}async function ea(o){try{const{data:r,error:s}=await pe.from("bom_reading_entries").insert([o]).select();if(s)throw console.error("[API] Create BOM reading entry failed:",s),s.message.includes("JWT")?new Error("Authentication error - please try reloading the page"):s.code==="42501"?new Error("Permission denied - please check your authentication"):s.code==="23505"?new Error("This entry already exists"):s.code==="23503"?new Error("Invalid chapter reference"):s.message.includes("fetch")||s.message.includes("Failed to fetch")?new Error("Network error - please check your connection and try again"):new Error(`Failed to save entry: ${s.message}`);return await xe(),console.log("[API] BOM reading entry created successfully"),r?r[0]:void 0}catch(r){throw console.error("[API] Unexpected error creating BOM reading entry:",r),r}}async function aa(o,r){try{const{data:s,error:h}=await pe.from("bom_reading_entries").update(r).eq("id",o).select();if(h)throw console.error("[API] Update BOM reading entry failed:",h),new Error(`Failed to update entry: ${h.message}`);return await xe(),console.log("[API] BOM reading entry updated successfully"),s?s[0]:void 0}catch(s){throw console.error("[API] Unexpected error updating BOM reading entry:",s),s}}async function ra(o){try{const{error:r}=await pe.from("bom_reading_entries").delete().eq("id",o);if(r)throw console.error("[API] Delete BOM reading entry failed:",r),new Error(`Failed to delete entry: ${r.message}`);await xe(),console.log("[API] BOM reading entry deleted successfully")}catch(r){throw console.error("[API] Unexpected error deleting BOM reading entry:",r),r}}function ta(o){const r=new Map;return o.forEach(s=>{const h=r.get(s.chapter_ref)||0;r.set(s.chapter_ref,h+1)}),r}let ve=null;const sa=()=>{const o=ne(!1),r=ne(!1),s=ne([]),h=ne([]),$=ie(h,i=>ta(i)),n=ie(s,i=>{const l=new Date().toISOString().split("T")[0];return i.find(f=>f.date===l)||null}),m=ie([s,$],([i,l])=>{const f=new Date().toISOString().split("T")[0];return i.map(u=>({chapter_ref:u.chapter_ref,day_number:u.day_number,date:u.date,book_name:u.book_name,chapter_number:u.chapter_number,read_count:l.get(u.chapter_ref)||0,is_today:u.date===f,is_past:u.date<f,is_future:u.date>f}))}),P=ie(s,i=>i.length),B=ie($,i=>{let l=0;return i.forEach(f=>{f>0&&l++}),l}),_=ie([P,B],([i,l])=>i>0?Math.round(l/i*100):0),g=async()=>{r.set(!0);try{const[i,l]=await Promise.all([Ze(),xe()]);s.set(i),h.set(l),o.set(!0)}catch(i){console.error("[State] Failed to reload BOM reading data:",i),o.set(!0)}finally{r.set(!1)}};return ve={stores:{ready:o,loading:r,schedule:s,entries:h,progressByChapter:$,todaysReading:n,chapterProgress:m,totalChapters:P,chaptersReadByAnyone:B,overallProgress:_},actions:{reload:g,apiCreate:async i=>{await ea(i),await g()},apiUpdate:async(i,l)=>{await aa(i,l),await g()},apiDelete:async i=>{await ra(i),await g()}}},ve},ke=()=>ve?.stores&&Object.keys(ve.stores).length>0?ve:sa();var oa=k(`<div class="card bom-reading-progress svelte-1yqd1va"><div class="card-header bg-primary text-white"><h4 class="mb-0"><i class="bi bi-graph-up me-2"></i> Ward Progress</h4></div> <div class="card-body"><div class="mb-4"><div class="d-flex justify-content-between align-items-center mb-2"><span class="fw-bold">Overall Completion</span> <span class="badge bg-primary fs-6"> </span></div> <div class="progress svelte-1yqd1va" style="height: 30px;"><div class="progress-bar bg-success progress-bar-striped progress-bar-animated svelte-1yqd1va" role="progressbar" aria-valuemin="0" aria-valuemax="100"><!></div></div> <small class="text-muted mt-1 d-block"> </small></div> <div class="row text-center g-3"><div class="col-6 col-md-3"><div class="stat-card p-3 border rounded svelte-1yqd1va"><i class="bi bi-calendar3 text-primary fs-2 d-block mb-2"></i> <div class="fs-4 fw-bold"> </div> <small class="text-muted">Total Days</small></div></div> <div class="col-6 col-md-3"><div class="stat-card p-3 border rounded svelte-1yqd1va"><i class="bi bi-book text-info fs-2 d-block mb-2"></i> <div class="fs-4 fw-bold"> </div> <small class="text-muted">BOM Chapters</small></div></div> <div class="col-6 col-md-3"><div class="stat-card p-3 border rounded svelte-1yqd1va"><i class="bi bi-check-circle text-success fs-2 d-block mb-2"></i> <div class="fs-4 fw-bold"> </div> <small class="text-muted">Chapters Read</small></div></div> <div class="col-6 col-md-3"><div class="stat-card p-3 border rounded svelte-1yqd1va"><i class="bi bi-people-fill text-warning fs-2 d-block mb-2"></i> <div class="fs-4 fw-bold"> </div> <small class="text-muted">Total Readings</small></div></div></div> <div class="alert alert-info mt-4 mb-0" role="alert"><i class="bi bi-info-circle me-2"></i> <small>This progress shows how many chapters have been read by <strong>anyone</strong> in the ward. Each
				person can mark chapters as read anonymously.</small></div></div></div>`);function ia(o,r){me(r,!1);const s=()=>H(i,"$entries",m),h=()=>H(l,"$schedule",m),$=()=>H(C,"$totalChapters",m),n=()=>H(O,"$chaptersReadByAnyone",m),[m,P]=we(),B=D(),_=D(),g=D(),p=D(),{stores:{totalChapters:C,chaptersReadByAnyone:O,entries:i,schedule:l}}=ke();z(()=>s(),()=>{x(B,s().length)}),z(()=>h(),()=>{x(_,h().filter(j=>j.book_name!=="Review").length)}),z(()=>(h(),s()),()=>{x(g,h().filter(j=>j.book_name!=="Review").filter(j=>s().some(ae=>ae.chapter_ref===j.chapter_ref)).length)}),z(()=>(t(_),t(g)),()=>{x(p,t(_)>0?Math.round(t(g)/t(_)*100):0)}),Ee(),fe();var f=oa(),u=d(e(f),2),R=e(u),I=e(R),c=d(e(I),2),w=e(c);a(c),a(I);var S=d(I,2),E=e(S),Y=e(E);{var q=j=>{var ae=Ge();Q(()=>A(ae,`${t(p)??""}%`)),b(j,ae)};W(Y,j=>{t(p)>10&&j(q)})}a(E),a(S);var L=d(S,2),le=e(L);a(L),a(R);var M=d(R,2),U=e(M),v=e(U),y=d(e(v),2),T=e(y,!0);a(y),J(2),a(v),a(U);var N=d(U,2),ue=e(N),K=d(e(ue),2),Z=e(K,!0);a(K),J(2),a(ue),a(N);var ee=d(N,2),re=e(ee),X=d(e(re),2),V=e(X,!0);a(X),J(2),a(re),a(ee);var te=d(ee,2),se=e(te),oe=d(e(se),2),ce=e(oe,!0);a(oe),J(2),a(se),a(te),a(M),J(2),a(u),a(f),Q(()=>{A(w,`${t(p)??""}%`),Ye(E,`width: ${t(p)??""}%`),Ie(E,"aria-valuenow",t(p)),A(le,`${t(g)??""} of ${t(_)??""} chapters read by at least one person`),A(T,$()),A(Z,t(_)),A(V,n()),A(ce,t(B))}),b(o,f),ge(),P()}const Te="bom_reading_submissions";function De(){if(typeof localStorage>"u")return new Set;try{const o=localStorage.getItem(Te);if(!o)return new Set;const r=JSON.parse(o);return new Set(Array.isArray(r)?r:[])}catch(o){return console.error("[ReadingTracker] Error reading from localStorage:",o),new Set}}function na(o){return De().has(o)}function da(o){if(typeof localStorage>"u"){console.warn("[ReadingTracker] localStorage not available");return}try{const r=De();r.add(o),localStorage.setItem(Te,JSON.stringify([...r]))}catch(r){console.error("[ReadingTracker] Error writing to localStorage:",r)}}var la=k('<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span> Updating...',1),ca=k('<i class="bi bi-check-circle-fill me-1"></i> Already Marked',1),va=k('<i class="bi bi-check-circle me-1"></i> Mark as Read',1),ma=k('<div class="alert alert-danger alert-sm mt-2 mb-0 svelte-18cjesl" role="alert"><i class="bi bi-exclamation-triangle-fill me-1"></i> </div>'),ga=k('<div class="bom-reading-entry-form svelte-18cjesl"><button type="button"><!></button> <!></div>');function fa(o,r){me(r,!1);const s=()=>H(P,"$loading",h),[h,$]=we();let n=Re(r,"chapterRef",8),m=Re(r,"onSuccess",8,void 0);const{stores:{loading:P},actions:{apiCreate:B}}=ke();let _=D(!1),g=D(""),p=D(!1);Se(()=>{x(p,na(n()))});async function C(){if(t(p)){x(g,"You have already marked this chapter as read");return}try{x(_,!0),x(g,"");const c={date:new Date().toISOString().split("T")[0],chapter_ref:n()};await B(c),da(n()),x(p,!0),m()&&m()()}catch(c){x(g,c instanceof Error?c.message:"Failed to save reading"),console.error("[BomReadingEntryForm] Error:",c)}finally{x(_,!1)}}fe();var O=ga(),i=e(O),l=e(i);{var f=c=>{var w=la();J(),b(c,w)},u=c=>{var w=_e(),S=de(w);{var E=q=>{var L=ca();J(),b(q,L)},Y=q=>{var L=va();J(),b(q,L)};W(S,q=>{t(p)?q(E):q(Y,!1)},!0)}b(c,w)};W(l,c=>{t(_)?c(f):c(u,!1)})}a(i);var R=d(i,2);{var I=c=>{var w=ma(),S=d(e(w));a(w),Q(()=>A(S,` ${t(g)??""}`)),b(c,w)};W(R,c=>{t(g)&&c(I)})}a(O),Q(()=>{ye(i,1,`btn btn-sm ${t(p)?"btn-secondary":"btn-primary"}`,"svelte-18cjesl"),i.disabled=t(_)||s()||t(p)}),Je("click",i,C),b(o,O),ge(),$()}var pa=k('<span class="badge bg-info text-dark svelte-x251hv"><i class="bi bi-calendar-day"></i> Today</span>'),ua=k('<i class="bi bi-check-circle"></i> ',1),ha=k('<i class="bi bi-circle"></i> 0',1),ba=k('<div><div class="card-body p-2"><div class="d-flex align-items-center justify-content-between gap-2 flex-wrap"><div class="flex-grow-1"><div class="d-flex align-items-baseline gap-2 flex-wrap"><small class="text-muted"> </small> <span> </span> <!></div> <div class="d-flex align-items-center gap-2 mt-1"><small class="text-muted"> </small></div></div> <div class="d-flex align-items-center gap-2"><span><!></span> <!></div></div></div></div>');function Ce(o,r){me(r,!1);const s=D(),h=D(),$=D();let n=Re(r,"progress",8);const m=!1;z(()=>G(n()),()=>{x(s,Ke(Xe(n().date,"yyyy-MM-dd",new Date),"MMM d, yyyy (EEE)"))}),z(()=>G(n()),()=>{x(h,n().is_today?"border-primary border-2":n().is_past?"past-reading":"")}),z(()=>G(n()),()=>{x($,n().read_count>0?"bg-success":"bg-secondary")}),Ee();var P={compact:m};fe();var B=ba(),_=e(B),g=e(_),p=e(g),C=e(p),O=e(C),i=e(O);a(O);var l=d(O,2),f=e(l,!0);a(l);var u=d(l,2);{var R=M=>{var U=pa();b(M,U)};W(u,M=>{G(n()),F(()=>n().is_today)&&M(R)})}a(C);var I=d(C,2),c=e(I),w=e(c,!0);a(c),a(I),a(p);var S=d(p,2),E=e(S),Y=e(E);{var q=M=>{var U=ua(),v=d(de(U));Q(()=>A(v,` ${G(n()),F(()=>n().read_count)??""}`)),b(M,U)},L=M=>{var U=ha();J(),b(M,U)};W(Y,M=>{G(n()),F(()=>n().read_count>0)?M(q):M(L,!1)})}a(E);var le=d(E,2);return fa(le,{get chapterRef(){return G(n()),F(()=>n().chapter_ref)}}),a(S),a(g),a(_),a(B),Q(()=>{ye(B,1,`card bom-day-card ${t(h)??""} mb-2`,"svelte-x251hv"),A(i,`Day ${G(n()),F(()=>n().day_number)??""}`),ye(l,1,`fw-semibold ${G(n()),F(()=>n().is_today?"text-primary":"")??""}`,"svelte-x251hv"),A(f,(G(n()),F(()=>n().chapter_ref))),A(w,t(s)),ye(E,1,`badge ${t($)??""}`,"svelte-x251hv")}),b(o,B),Qe(r,"compact",m),ge(P)}var _a=k('<div class="alert alert-warning" role="alert"><i class="bi bi-exclamation-triangle me-2"></i> No readings found for the selected filter.</div>'),ya=k('<div class="book-group mb-4 svelte-nbte28"><h4 class="border-bottom pb-2 mb-3 svelte-nbte28"><i class="bi bi-book me-2"></i> <span class="badge bg-secondary ms-2"> </span></h4> <!></div>'),wa=k("<div><!></div>"),xa=k('<div class="text-center mt-4"><p class="text-muted"><i class="bi bi-info-circle me-1"></i> </p></div>'),ka=k('<div class="bom-reading-schedule svelte-nbte28"><div class="card mb-3"><div class="card-body"><div class="row g-3 align-items-end"><div class="col-md-8"><label for="search" class="form-label fw-bold">Search</label> <div class="input-group"><span class="input-group-text"><i class="bi bi-search"></i></span> <input type="text" class="form-control" id="search" placeholder="Search chapters or books..."/></div></div> <div class="col-md-4"><div class="form-check"><input class="form-check-input" type="checkbox" id="groupByBook"/> <label class="form-check-label" for="groupByBook">Group by Book</label></div></div></div></div></div> <div class="reading-list svelte-nbte28"><!></div> <!></div>');function $a(o,r){me(r,!1);const s=()=>H(B,"$chapterProgress",$),h=()=>H(_,"$todaysReading",$),[$,n]=we(),m=D(),P=D(),{stores:{chapterProgress:B,todaysReading:_}}=ke();let g=D(""),p=D(!1);function C(v,y){if(!y)return v;const T=y.toLowerCase();return v.filter(N=>N.chapter_ref.toLowerCase().includes(T)||N.book_name.toLowerCase().includes(T))}function O(v){const y={};return v.forEach(T=>{y[T.book_name]||(y[T.book_name]=[]),y[T.book_name].push(T)}),y}Se(()=>{h()&&setTimeout(()=>{const v=document.getElementById("today-reading");v&&v.scrollIntoView({behavior:"smooth",block:"center"})},500)}),z(()=>(s(),t(g)),()=>{x(m,C(s(),t(g)))}),z(()=>(t(p),t(m)),()=>{x(P,t(p)?O(t(m)):null)}),Ee(),fe();var i=ka(),l=e(i),f=e(l),u=e(f),R=e(u),I=d(e(R),2),c=d(e(I),2);Pe(c),a(I),a(R);var w=d(R,2),S=e(w),E=e(S);Pe(E),J(2),a(S),a(w),a(u),a(f),a(l);var Y=d(l,2),q=e(Y);{var L=v=>{var y=_a();b(v,y)},le=v=>{var y=_e(),T=de(y);{var N=K=>{var Z=_e(),ee=de(Z);$e(ee,1,()=>(t(P),F(()=>Object.entries(t(P)))),Be,(re,X)=>{var V=Le(()=>Ne(t(X),2));let te=()=>t(V)[0],se=()=>t(V)[1];var oe=ya(),ce=e(oe),j=d(e(ce)),ae=d(j),Fe=e(ae);a(ae),a(ce);var qe=d(ce,2);$e(qe,1,se,Be,(Ue,je)=>{Ce(Ue,{get progress(){return t(je)},compact:!0})}),a(oe),Q(()=>{A(j,` ${te()??""} `),A(Fe,`${se(),F(()=>se().length)??""} days`)}),b(re,oe)}),b(K,Z)},ue=K=>{var Z=_e(),ee=de(Z);$e(ee,1,()=>t(m),Be,(re,X)=>{var V=wa(),te=e(V);Ce(te,{get progress(){return t(X)}}),a(V),Q(()=>Ie(V,"id",(t(X),F(()=>t(X).is_today?"today-reading":void 0)))),b(re,V)}),b(K,Z)};W(T,K=>{t(P)?K(N):K(ue,!1)},!0)}b(v,y)};W(q,v=>{t(m),F(()=>t(m).length===0)?v(L):v(le,!1)})}a(Y);var M=d(Y,2);{var U=v=>{var y=xa(),T=e(y),N=d(e(T));a(T),a(y),Q(()=>A(N,` Showing ${t(m),F(()=>t(m).length)??""} reading days`)),b(v,y)};W(M,v=>{t(m),F(()=>t(m).length>20)&&v(U)})}a(i),ze(c,()=>t(g),v=>x(g,v)),He(E,()=>t(p),v=>x(p,v)),b(o,i),ge(),n()}var Ba=k('<div class="text-center py-5"><div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"><span class="visually-hidden">Loading...</span></div> <p class="text-muted mt-3">Loading reading schedule...</p></div>'),Ra=k('<div class="row mb-4"><div class="col-12"><!></div></div> <div class="row"><div class="col-12"><!></div></div>',1),Sa=k(`<div class="container py-4 svelte-q48pc2"><div class="row mb-4"><div class="col-12"><h2 class="display-6 svelte-q48pc2"><i class="bi bi-book me-2"></i> Ward Reading Progress</h2> <p class="lead">Join our ward in reading the Book of Mormon in 2026. Mark the chapters you've read and see
					how our ward is progressing together!</p> <p class="text-muted"><i class="bi bi-info-circle me-1"></i> This tracker is completely anonymous - your readings are counted toward the ward total without
					identifying who read what.</p></div></div> <!></div>`);function Na(o,r){me(r,!1);const s=()=>H(B,"$loading",$),h=()=>H(P,"$ready",$),[$,n]=we(),{stores:{pageName:m}}=Ve(),{stores:{ready:P,loading:B},actions:{reload:_}}=ke();m.set("Book of Mormon Reading 2026"),Se(async()=>{await _()}),fe(),We(o,{pageTitle:"Book of Mormon Reading Challenge 2026",children:(g,p)=>{var C=Sa(),O=d(e(C),2);{var i=f=>{var u=Ba();b(f,u)},l=f=>{var u=Ra(),R=de(u),I=e(R),c=e(I);ia(c,{}),a(I),a(R);var w=d(R,2),S=e(w),E=e(S);$a(E,{}),a(S),a(w),b(f,u)};W(O,f=>{s()&&!h()?f(i):f(l,!1)})}a(C),b(g,C)},$$slots:{default:!0}}),ge(),n()}export{Na as component};
