const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/DO0djbQe.js","../chunks/Cpj98o6Y.js"])))=>i.map(i=>d[i]);
import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{d as Ya,o as ca,g as Va}from"../chunks/DHXte27T.js";import{p as dt,c as a,r as t,s as i,a as ct,t as T,i as Xa,g as e,f as be,F as Ma,ai as S,D as d,E as p,aj as ua,u as o,R as $e,an as Ja,w as K,ao as Za}from"../chunks/CPOcesE7.js";import{f as c,a as l,c as ot,t as lt}from"../chunks/YsHTGu5k.js";import{i as b,b as oe,k as Ea,a as pa,s as P,p as it,e as j}from"../chunks/opPvMm1W.js";import{i as ut}from"../chunks/C2Q_9cr2.js";import{P as Ga}from"../chunks/DGBEC5Wb.js";import{e as We,i as da}from"../chunks/DAwrR-3T.js";import{r as Pa,b as es,s as vt,i as ts,c as as,d as ss,e as rs}from"../chunks/B678cWRA.js";import{b as ns}from"../chunks/QDlYjqxz.js";import{c as os,g as fa,e as Wt,d as ls,a as jt,b as va,f as qt}from"../chunks/DA0iFnz8.js";import{d as $a,s as Aa,A as is,E as vs}from"../chunks/Bny6KXjQ.js";import{g as _a,p as he,k as ds,f as _e,O as Sa,P as Ie,c as Ye}from"../chunks/BsRP2LKs.js";import{A as Ra,E as cs,c as us}from"../chunks/BWjn87HK.js";import{S as Ta}from"../chunks/rXwHPYJY.js";import{v as Ia,D as Oa}from"../chunks/COaApZh_.js";import{s as Ht}from"../chunks/D_BP0e98.js";import{B as ps}from"../chunks/CWJDqtkW.js";import{_ as fs}from"../chunks/CmsKOCeN.js";import{s as _s}from"../chunks/CdEA5IGF.js";import{R as At}from"../chunks/CC589K26.js";function bs(le,I){return os(le,-I)}const ms=!0,Lr=Object.freeze(Object.defineProperty({__proto__:null,prerender:ms},Symbol.toStringTag,{value:"Module"}));var ys=c("<option> </option>"),gs=c('<div class="col-12 col-md-auto"><select class="form-select form-select" aria-label="Filter by category"><option>All Categories</option><!></select></div>'),hs=c('<div class="search-filter sticky-top svelte-1wm3u0q"><div class="row g-2"><div class="col-12 col-md"><input type="search" class="form-control form-control" placeholder="Search..."/></div> <!></div></div>');function ws(le,I){dt(I,!1);const N=()=>oe(F,"$searchQuery",C),w=()=>oe(z,"$currentCategories",C),Z=()=>oe(q,"$categoryFilter",C),[C,g]=pa(),{stores:{currentCategories:z,categoryFilter:q,searchQuery:F}}=fa();ut();var ee=hs(),x=a(ee),te=a(x),U=a(te);Pa(U),t(te);var ce=i(te,2);{var D=H=>{var h=gs(),ae=a(h);T(()=>{Z(),Xa(()=>{w()})});var Q=a(ae);Q.value=Q.__value="";var G=i(Q);We(G,1,w,da,(se,E)=>{var L=ys(),Y=a(L,!0);t(L);var ie={};T(()=>{P(Y,e(E).label),ie!==(ie=e(E).key)&&(L.value=(L.__value=e(E).key)??"")}),l(se,L)}),t(ae),t(h),es(ae,Z,se=>Ea(q,se)),l(H,h)};b(ce,H=>{w().length&&H(D)})}t(x),t(ee),ns(U,N,H=>Ea(F,H)),l(le,ee),ct(),g()}var xs=c('<p class="mb-0">No past events to delete.</p>'),ks=c('<p class="mb-2"><strong> </strong></p>'),Es=c(`<div class="alert alert-warning mb-0" role="alert"><p class="mb-2"><strong> </strong></p> <p class="mb-0 small">These recurring events have active future instances and cannot be deleted until all
								future occurrences have passed.</p></div>`),$s=c("<!> <!>",1),As=c('<div class="modal svelte-1u875uh" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-primary text-white"><h5 class="modal-title">Delete Past Events - Results</h5> <button type="button" class="btn-close btn-close-white" aria-label="Close"></button></div> <div class="modal-body"><!></div> <div class="modal-footer"><button type="button" class="btn btn-primary">OK</button></div></div></div></div>');function Ss(le,I){dt(I,!1);let N=it(I,"deleted",8),w=it(I,"skipped",8),Z=it(I,"callback",8);function C(){Z()()}ut();var g=As(),z=a(g),q=a(z),F=a(q),ee=i(a(F),2);t(F);var x=i(F,2),te=a(x);{var U=h=>{var ae=xs();l(h,ae)},ce=h=>{var ae=$s(),Q=be(ae);{var G=L=>{var Y=ks(),ie=a(Y),Ae=a(ie);t(ie),t(Y),T(()=>P(Ae,`✓ Deleted ${N()??""} past event${N()===1?"":"s"}.`)),l(L,Y)};b(Q,L=>{N()>0&&L(G)})}var se=i(Q,2);{var E=L=>{var Y=Es(),ie=a(Y),Ae=a(ie),we=a(Ae);t(Ae),t(ie),Ma(2),t(Y),T(()=>P(we,`⚠ Skipped ${w()??""} recurring event${w()===1?"":"s"}`)),l(L,Y)};b(se,L=>{w()>0&&L(E)})}l(h,ae)};b(te,h=>{N()===0&&w()===0?h(U):h(ce,!1)})}t(x);var D=i(x,2),H=a(D);t(D),t(q),t(z),t(g),j("click",ee,C),j("click",H,C),l(le,g),ct()}var Ds=c(`<div class="modal svelte-dmsnaa" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-danger text-white"><h5 class="modal-title">Delete Past Events</h5> <button type="button" class="btn-close btn-close-white" aria-label="Close"></button></div> <div class="modal-body"><p class="mb-3"><strong> </strong></p> <p class="mb-0 text-muted small">This action cannot be undone. Recurring events with future instances will be skipped
					automatically.</p></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-danger">Delete</button></div></div></div></div>`);function Ms(le,I){dt(I,!1);let N=it(I,"cutoffDate",8),w=it(I,"callback",8);function Z(){w()(!0)}function C(){w()(!1)}ut();var g=Ds(),z=a(g),q=a(z),F=a(q),ee=i(a(F),2);t(F);var x=i(F,2),te=a(x),U=a(te),ce=a(U);t(U),t(te),Ma(2),t(x);var D=i(x,2),H=a(D),h=i(H,2);t(D),t(q),t(z),t(g),T(()=>P(ce,`Are you sure you want to delete all events that occurred before ${N()??""}?`)),j("click",ee,C),j("click",H,C),j("click",h,Z),l(le,g),ct()}var Ps=c('<button class="btn btn-sm btn-outline-secondary w-100"><i class="bi bi-clock-history me-1"></i> </button>'),Rs=c('<button class="btn btn-sm btn-outline-danger" type="button"><!></button>'),Ts=c('<div class="event-actions svelte-1ofdc1q"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit past event"><i class="bi bi-pencil-square"></i></button></div>'),Is=c('<div class="daily-event-row svelte-1ofdc1q"><div class="event-content svelte-1ofdc1q"><!></div> <!></div>'),Os=c('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-1ofdc1q"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),Cs=c('<li class="list-group-item py-3 text-muted">No events scheduled this week.</li>'),Fs=c('<li class="list-group-item list-group-item-light text-uppercase small fw-lighter p-0"><button><span class="d-flex align-items-center gap-2"><i></i> <span class="text-muted"> </span></span> <span> </span></button></li> <!>',1),Us=c('<li class="list-group-item bg-secondary text-white fw-semibold"> </li> <!>',1),Ls=c('<button class="btn btn-outline-secondary btn-sm">Reset</button>'),Bs=c('<div class="d-flex gap-2"><button class="btn btn-primary btn-sm">More</button> <button class="btn btn-outline-primary btn-sm">All</button></div>'),Ns=c('<div class="card-footer d-flex align-items-center justify-content-between"><small> </small> <!></div>'),Ws=c('<ul class="list-group list-group-flush border-top-0"></ul> <!>',1),js=c('<div class="card-body text-muted small">No past events available.</div>'),qs=c('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center gap-3 flex-wrap fw-lighter"><span>Past Events</span> <div class="d-flex gap-2"><!> <button class="btn btn-sm btn-outline-secondary">Hide</button></div></div></div> <!></div>'),Hs=c('<div class="d-flex flex-column gap-4"><!></div>'),Ks=c("<!> <!> <!> <!>",1);function zs(le,I){dt(I,!1);const N=()=>oe(ve,"$weeksExpanded",x),w=()=>oe(W,"$allPastEvents",x),Z=()=>oe(L,"$currentUser",x),C=()=>oe(Ae,"$userOrganizations",x),g=()=>oe(E,"$currentUserHasPermission",x),z=()=>oe(ie,"$currentUserIsRoot",x),q=()=>oe(Y,"$currentUserIsAdmin",x),F=()=>oe(we,"$ready",x),ee=()=>oe(Se,"$searchQuery",x),[x,te]=pa(),U=p(),ce=p(),D=p(),H=p(),h=p(),ae=p(),Q=p(),G=p(),se=p(),{stores:{currentUserHasPermission:E,currentUser:L,currentUserIsAdmin:Y,currentUserIsRoot:ie,userOrganizations:Ae}}=_a(),{stores:{ready:we,dbData:B,weeksExpanded:ve,searchQuery:Se},actions:{reload:re}}=fa(),St={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0};let Ve=it(I,"formId",24,Ia),Dt=p(!1),Xe=p(!1),Je=p(),pt=p(!1),ft=p(!1),Ze=p(!1),Ge=p(new Set),Fe=p(!1),Mt=p(""),et=p({...St}),je=p(!1),Pt=p(""),_t=p(!1),k=p({deleted:0,skipped:0});const bt=4,Rt=4;let Ue=p(bt),tt=p(!1);const Tt=Ht();let r=p({});function v(s){return e(U).includes(s)}function f(s){const u=e(r)[s]??v(s);d(r,{...e(r),[s]:!u})}const m=s=>{d(Mt,"Event Item"),d(et,{...s,category:s?.meta_data?.category})},W=Ya(B,s=>{const u=Ht();return(s??[]).filter(n=>!(n.event_type!=="calendar_event"||!n.start_time||he(n.start_time)>=u||n.recurrence_rule&&(!n.recurrence_end_date||n.recurrence_end_date&&he(n.recurrence_end_date)>=u)))}),De=s=>us(s,{currentUserId:e(Je),isPrivileged:e(Xe),canEditOwnOrgEvents:e(Ze),userOrganizations:e(Ge)});let de=p(!1);function M(){d(Ue,e(Ue)+Rt)}function me(){d(Ue,520),d(tt,!0)}function Me(){d(Ue,bt),d(tt,!1)}const Oe=()=>{if(!e(Dt)||e(Fe)||!Va(ie)||!e(G))return;const s=Ht();d(Pt,_e(s,"MMM d, yyyy")),d(je,!0)};async function Le(s){if(d(je,!1),!s)return;const u=Ht();d(Fe,!0);try{const n=await ls(u);await re(),d(k,n),d(_t,!0)}catch(n){console.error("Failed to delete past events",n),alert("Failed to delete past events. Please try again.")}finally{d(Fe,!1)}}function mt(){d(_t,!1)}ca(async()=>{await re()}),S(()=>(w(),e(Ue)),()=>{d(D,(w()??[]).filter(s=>{if(!s.start_time)return!1;const u=he(s.start_time),n=bs(Tt,e(Ue));return u>=n&&u<Tt}))}),S(()=>(e(D),_e),()=>{d(h,(()=>{const s=new Map;for(const u of e(D)){if(!u.start_time)continue;const n=he(u.start_time),R=ds(n,{weekStartsOn:1}),$=Wt(n,{weekStartsOn:1}),A=_e(R,"yyyy-MM-dd"),ne=`${_e(R,"MMM d")} – ${_e($,"MMM d")}`;let V=s.get(A);V||(V={key:A,label:ne,days:new Map},s.set(A,V));const ke=_e(n,"yyyy-MM-dd");let Pe=V.days.get(ke);Pe||(Pe={key:ke,displayDay:_e(n,"EEE"),displayDate:_e(n,"MMM d"),events:[]},V.days.set(ke,Pe)),Pe.events.push(u)}return Array.from(s.values()).sort((u,n)=>u.key<n.key?1:-1).map(u=>({key:u.key,label:u.label,days:Array.from(u.days.values()).sort((n,R)=>n.key<R.key?1:-1).map(n=>({...n,events:n.events.slice().sort((R,$)=>{const A=R.is_all_day?0:1,ne=$.is_all_day?0:1;if(A!==ne)return A-ne;const V=R.start_time?he(R.start_time).getTime():Number.MAX_SAFE_INTEGER,ke=$.start_time?he($.start_time).getTime():Number.MAX_SAFE_INTEGER;return V-ke})}))}))})())}),S(()=>e(h),()=>{d(U,(()=>{if(e(h).length===0)return[];const s=[];return e(h)[0]&&s.push(e(h)[0].key),e(h)[1]&&s.push(e(h)[1].key),s})())}),S(()=>(N(),e(r)),()=>{d(ce,s=>N()?!0:e(r)[s]!==void 0?e(r)[s]:v(s))}),S(()=>e(D),()=>{d(H,e(D).length)}),S(()=>(e(h),_e),()=>{d(ae,e(h).reduce((s,u)=>{const n=he(u.key),R=Wt(n,{weekStartsOn:1}),$=_e(R,"yyyy-MM"),A=_e(R,"MMMM yyyy");return s[$]||(s[$]={label:A,weeks:[]}),s[$].weeks.push(u),s},{}))}),S(()=>Z(),()=>{d(Je,Z()?.id)}),S(()=>C(),()=>{d(Ge,C())}),S(()=>e(Je),()=>{d(ft,!!e(Je))}),S(()=>(e(Ge),Sa),()=>{d(pt,e(Ge).has(Sa.Bishopric))}),S(()=>(g(),Ie),()=>{d(Ze,g()(Ie.EditOwnOrgEvents))}),S(()=>(z(),q(),e(pt),g(),Ie),()=>{d(Xe,z()||q()||e(pt)||g()(Ie.EditAllEvents))}),S(()=>(e(Xe),g(),e(Ze),e(ft)),()=>{d(Dt,e(Xe)||g()(Ie.CreateEvents)||e(Ze)||e(ft))}),S(()=>(g(),Ie),()=>{d(Q,g()(Ie.DeleteEvents))}),S(()=>e(D),()=>{d(G,e(D).length>0)}),S(()=>(w(),e(D)),()=>{d(se,w().length>e(D).length)}),ua(),ut();var at=Ks(),yt=be(at);Oa(yt,{get title(){return e(Mt)},get id(){return Ve()},children:(s,u)=>{Ra(s,{get eventItem(){return e(et)},get drawerId(){return Ve()},name:"past-event-item-form",get canDelete(){return e(Q)}})},$$slots:{default:!0}});var xe=i(yt,2);{var It=s=>{var u=ot(),n=be(u);{var R=A=>{var ne=ot(),V=be(ne);{var ke=Be=>{var Ee=Ps(),Ce=i(a(Ee));t(Ee),T(()=>P(Ce,` Show Past Events (${w(),o(()=>w().length)??""})`)),j("click",Ee,()=>d(de,!0)),l(Be,Ee)},Pe=Be=>{var Ee=qs(),Ce=a(Ee),Ct=a(Ce),gt=i(a(Ct),2),ht=a(gt);{var Qt=pe=>{var ye=Rs(),qe=a(ye);{var xt=X=>{var fe=lt("Deleting…");l(X,fe)},He=X=>{var fe=lt();T(()=>P(fe,`Delete All (${e(H)??""})`)),l(X,fe)};b(qe,X=>{e(Fe)?X(xt):X(He,!1)})}t(ye),T(()=>ye.disabled=e(Fe)),j("click",ye,Oe),l(pe,ye)};b(ht,pe=>{z()&&e(G)&&pe(Qt)})}var wt=i(ht,2);t(gt),t(Ct),t(Ce);var Ft=i(Ce,2);{var Yt=pe=>{var ye=Ws(),qe=be(ye);We(qe,5,()=>(e(ae),o(()=>Object.entries(e(ae)))),([X,fe])=>X,(X,fe)=>{var Ke=Ja(()=>Za(e(fe),2));let Ne=()=>e(Ke)[1];var ze=Us(),Re=be(ze),st=a(Re,!0);t(Re);var Te=i(Re,2);We(Te,1,()=>(Ne(),o(()=>Ne().weeks)),ge=>ge.key,(ge,J)=>{const _=$e(()=>(K(he),e(J),o(()=>he(e(J).key)))),y=$e(()=>(K(Wt),K(e(_)),o(()=>Wt(e(_),{weekStartsOn:1})))),ue=$e(()=>(K(Aa),K(e(y)),o(()=>Aa(e(y))))),Qe=$e(()=>(K($a),K(e(y)),K(e(ue)),o(()=>$a(e(y),e(ue),{weekStartsOn:1})+1))),Xt=$e(()=>(e(ce),e(J),o(()=>e(ce)(e(J).key)))),Ut=$e(()=>(e(J),o(()=>e(J).days.reduce((Et,Lt)=>Et+Lt.events.length,0))));var ba=Fs(),Jt=be(ba),kt=a(Jt);let ma;var Zt=a(kt),ya=a(Zt),ga=i(ya,2),Ca=a(ga);t(ga),t(Zt);var Gt=i(Zt,2);let ha;var Fa=a(Gt,!0);t(Gt),t(kt),t(Jt);var Ua=i(Jt,2);{var La=Et=>{var Lt=ot(),Ba=be(Lt);{var Na=rt=>{var Bt=ot(),ja=be(Bt);We(ja,1,()=>(e(J),o(()=>e(J).days)),ea=>ea.key,(ea,nt)=>{var ta=Os(),wa=a(ta),aa=a(wa),sa=a(aa),qa=a(sa,!0);t(sa);var xa=i(sa,2),Ha=a(xa,!0);t(xa),t(aa);var ka=i(aa,2);We(ka,5,()=>(e(nt),o(()=>e(nt).events)),$t=>$t.id??`${$t.start_time}-${$t.meta_data?.recurring_instance_index??0}`,($t,Nt)=>{var ra=Is(),na=a(ra),Ka=a(na);cs(Ka,{get item(){return e(Nt)},showDate:!1,get searchQuery(){return ee()}}),t(na);var za=i(na,2);{var Qa=oa=>{var la=Ts(),ia=a(la);t(la),T(()=>{vt(ia,"data-bs-target",`#${Ve()??""}`),vt(ia,"aria-controls",Ve())}),j("click",ia,()=>m(e(Nt))),l(oa,la)};b(za,oa=>{e(Nt),o(()=>De(e(Nt)))&&oa(Qa)})}t(ra),l($t,ra)}),t(ka),t(wa),t(ta),T(()=>{P(qa,(e(nt),o(()=>e(nt).displayDay))),P(Ha,(e(nt),o(()=>e(nt).displayDate)))}),l(ea,ta)}),l(rt,Bt)},Wa=rt=>{var Bt=Cs();l(rt,Bt)};b(Ba,rt=>{e(J),o(()=>e(J).days.length)?rt(Na):rt(Wa,!1)})}l(Et,Lt)};b(Ua,Et=>{e(Xt)&&Et(La)})}T(()=>{ma=Ye(kt,1,"week-header w-100 d-flex justify-content-between align-items-center border-0 bg-transparent p-2 text-start svelte-1ofdc1q",null,ma,{"text-muted":e(Ut)===0}),vt(kt,"title",e(Xt)?"Click to collapse week":"Click to expand week"),Ye(ya,1,`bi ${e(Xt)?"bi-chevron-up":"bi-chevron-down"}`),P(Ca,`Week ${e(Qe)??""} [${e(Ut)??""} Event${e(Ut)===1?"":"s"}]`),ha=Ye(Gt,1,"",null,ha,{"opacity-50":e(Ut)===0}),P(Fa,(e(J),o(()=>e(J).label)))}),j("click",kt,()=>f(e(J).key)),l(ge,ba)}),T(()=>P(st,(Ne(),o(()=>Ne().label)))),l(X,ze)}),t(qe);var xt=i(qe,2);{var He=X=>{var fe=Ns(),Ke=a(fe),Ne=a(Ke);t(Ke);var ze=i(Ke,2);{var Re=Te=>{var ge=Ls();j("click",ge,Me),l(Te,ge)},st=Te=>{var ge=Bs(),J=a(ge),_=i(J,2);t(ge),j("click",J,M),j("click",_,me),l(Te,ge)};b(ze,Te=>{e(tt)?Te(Re):Te(st,!1)})}t(fe),T(()=>P(Ne,`Showing ${e(D),o(()=>e(D)?.length??0)??""} of ${w(),o(()=>w()?.length??0)??""}`)),l(X,fe)};b(xt,X=>{(e(se)||e(tt))&&X(He)})}l(pe,ye)},Vt=pe=>{var ye=js();l(pe,ye)};b(Ft,pe=>{e(h),o(()=>e(h).length)?pe(Yt):pe(Vt,!1)})}t(Ee),j("click",wt,()=>d(de,!1)),l(Be,Ee)};b(V,Be=>{e(de)?Be(Pe,!1):Be(ke)})}l(A,ne)},$=A=>{var ne=Hs(),V=a(ne);Ta(V,{}),t(ne),l(A,ne)};b(n,A=>{F()?A(R):A($,!1)})}l(s,u)};b(xe,s=>{z()&&s(It)})}var Ot=i(xe,2);{var Kt=s=>{Ms(s,{get cutoffDate(){return e(Pt)},callback:Le})};b(Ot,s=>{e(je)&&s(Kt)})}var zt=i(Ot,2);{var O=s=>{Ss(s,{get deleted(){return e(k),o(()=>e(k).deleted)},get skipped(){return e(k),o(()=>e(k).skipped)},callback:mt})};b(zt,s=>{e(_t)&&s(O)})}l(le,at),ct(),te()}var Qs=c('<div class="d-flex flex-column gap-4"><!> <!> <!> <!></div>');function Da(le){var I=Qs(),N=a(I);ws(N,{});var w=i(N,2);is(w,{});var Z=i(w,2);vs(Z,{});var C=i(Z,2);zs(C,{}),t(I),l(le,I)}var Ys=c('<div class="d-flex justify-content-center align-items-center py-5"><!></div>'),Vs=c('<button type="button" role="tab"> </button>'),Xs=c("<option> </option>"),Js=c('<div class="py-5 text-center text-muted"><!></div>'),Zs=c('<div class="description-preview text-muted small mb-1 svelte-f25tv"> </div>'),Gs=c("<span> </span>"),er=c('<span class="badge rounded-pill bg-secondary-subtle text-secondary-emphasis">Uncategorized</span>'),tr=c('<span><i class="bi bi-geo-alt"></i> </span>'),ar=c('<span><i class="bi bi-arrow-repeat"></i> </span>'),sr=c('<span><i class="bi bi-calendar3"></i> </span>'),rr=c('<span class="text-muted small"> </span>'),nr=c('<div class="submission-card text-start svelte-f25tv" role="button" tabindex="0"><div class="d-flex justify-content-between align-items-start gap-3 mb-1"><div class="fw-semibold"> </div> <div class="d-flex align-items-center gap-2"><span class="badge bg-light text-dark"> </span> <button class="btn btn-sm btn-outline-primary" type="button"><i class="bi bi-pencil-square"></i></button></div></div> <!> <div class="d-flex flex-wrap align-items-center gap-2 small text-muted mb-1"><!> <!> <!></div> <div class="d-flex flex-wrap align-items-center gap-2 small text-muted mb-1"><span><i class="bi bi-clock"></i> </span> <!></div> <div class="d-flex flex-wrap align-items-center gap-2"><span><i></i> </span> <!></div></div>'),or=c('<div class="d-flex flex-column gap-3"></div>'),lr=c('<div class="my-submissions-page d-flex flex-column gap-4 svelte-f25tv"><div class="card"><div class="card-header d-flex flex-column gap-3"><div class="d-flex flex-md-row align-items-center justify-content-between gap-2"><div class="mb-0">My Submissions</div> <button class="btn btn-outline-secondary btn-sm"><!></button></div> <div class="submissions-status-tabs nav nav-pills gap-2" role="tablist"></div></div> <div class="card-body d-flex flex-column gap-3"><div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3"><div class="input-group input-group-sm my-submissions-search svelte-f25tv"><input class="form-control svelte-f25tv" type="search" placeholder="Search title, category, or location"/></div> <div class="type-filter-select svelte-f25tv"><select class="form-select form-select-sm"></select></div></div> <!></div></div></div>'),ir=c('<div class="text-muted">Select a submission to edit.</div>'),vr=c("<!> <!>",1);function dr(le,I){dt(I,!1);const N=()=>oe(h,"$currentUserStore",g),w=()=>oe(ae,"$currentUserHasPermission",g),Z=()=>oe(D,"$dbData",g),C=()=>oe(ce,"$ready",g),[g,z]=pa(),q=p(),F=p(),ee=p(),x=p(),te=p(),U=p(),{stores:{ready:ce,dbData:D},actions:{reload:H}}=fa(),{stores:{currentUser:h,currentUserHasPermission:ae}}=_a();let Q=p(!1),G=p([]),se=p([]),E=p(null);const L=Ia();let Y=null;const ie={approved:"var(--bs-success)",pending:"var(--bs-warning)",needs_review:"var(--bs-info)",published:"var(--bs-primary)"},Ae={pending:{text:"Awaiting Approval",class:"bg-warning-subtle text-warning-emphasis",icon:"bi-hourglass-split"},needs_review:{text:"Changes Suggested",class:"bg-info-subtle text-info-emphasis",icon:"bi-pencil"},approved:{text:"Approved — Awaiting Publish",class:"bg-success-subtle text-success-emphasis",icon:"bi-check-circle"},published:{text:"Published",class:"bg-primary-subtle text-primary-emphasis",icon:"bi-globe"}},we={pending:"Pending",needs_review:"Changes Suggested",approved:"Approved",published:"Published"},B=[{value:"pending",label:we.pending},{value:"needs_review",label:we.needs_review},{value:"approved",label:we.approved},{value:"published",label:we.published}],ve=[{value:"all",label:"Events & Announcements"},{value:"events",label:"Events only"},{value:"announcements",label:"Announcements only"}],Se=()=>({search:"",typeFilter:"all"});let re=p({pending:Se(),needs_review:Se(),approved:Se(),published:Se()});ca(async()=>{d(Q,!0),await H(),d(Q,!1),typeof window<"u"&&(Y=(await fs(()=>import("../chunks/DO0djbQe.js").then(v=>v.o),__vite__mapDeps([0,1]),import.meta.url)).default)});const St=r=>{const v=r.meta_data?.submitted_at??r.created_at;if(!v)return 0;try{return he(v).getTime()}catch(f){return console.warn("Failed to parse submission timestamp",f),0}},Ve=r=>{const v=r.meta_data?.submitted_at??r.created_at;if(!v)return"—";try{return _e(he(v),"MMM d, yyyy 'at' h:mm a")}catch(f){return console.warn("Failed to format submission timestamp",f),"—"}},Dt=r=>{if(!r.start_time)return"—";try{return _e(he(r.start_time),"MMM d, yyyy 'at' h:mm a")}catch(v){return console.warn("Failed to format event date",v),"—"}},Xe=r=>r.replace(/<[^>]*>/g,""),Je=(r,v)=>r.length<=v?r:r.substring(0,v).trimEnd()+"…",pt=r=>r.description?Je(Xe(r.description).trim(),120):"",ft=r=>{try{const f=At.fromString(r).origOptions,m=f.interval||1,W=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],De=["","1st","2nd","3rd","4th","5th"];if(f.freq===At.DAILY)return m===1?"Repeats daily":`Repeats every ${m} days`;if(f.freq===At.WEEKLY){if(f.byweekday){const M=(Array.isArray(f.byweekday)?f.byweekday:[f.byweekday]).map(me=>{const Me=typeof me=="number"?me:me.weekday,Oe=Me===6?0:Me+1;return W[Oe]});return m===1?M.length===1?`Repeats every ${M[0]}`:`Repeats on ${M.join(", ")}`:`Repeats every ${m} weeks on ${M.join(", ")}`}return m===1?"Repeats weekly":`Repeats every ${m} weeks`}if(f.freq===At.MONTHLY){if(f.byweekday){const M=(Array.isArray(f.byweekday)?f.byweekday:[f.byweekday])[0];if(M&&typeof M=="object"&&"n"in M&&"weekday"in M){const me=M.weekday,Me=me===6?0:me+1,Oe=M.n,Le=De[Oe]||`${Oe}th`;return m===1?`Repeats on the ${Le} ${W[Me]} of the month`:`Repeats on the ${Le} ${W[Me]} every ${m} months`}}if(f.bymonthday){const de=Array.isArray(f.bymonthday)?f.bymonthday[0]:f.bymonthday,M=de===1?"st":de===2?"nd":de===3?"rd":"th";return m===1?`Repeats on the ${de}${M} of the month`:`Repeats on the ${de}${M} every ${m} months`}return m===1?"Repeats monthly":`Repeats every ${m} months`}return f.freq===At.YEARLY?m===1?"Repeats yearly":`Repeats every ${m} years`:"Repeats"}catch{return"Repeats"}},Ze=(r,v)=>{const f=v.trim().toLowerCase();if(!f)return!0;const m=r.meta_data?.category?va(r.meta_data.category)?.label??"":"";return[r.title??"",r.description??"",r.location??"",m??""].join(" ").toLowerCase().includes(f)},Ge=(r,v)=>v==="all"?!0:v==="events"?r.event_type==="calendar_event":r.event_type==="announcement";function Fe(r,v){d(re,{...e(re),[r]:{...e(re)[r],...v}})}const Mt=r=>{const v=new Set,f=[];for(const m of r){const W=m.meta_data?.recurring_parent_id;if(m.meta_data?.recurring_instance&&W!=null){if(v.has(W))continue;v.add(W)}f.push(m)}return f},et=r=>r.meta_data?.recurring_parent_id!=null?`recurring-${r.meta_data.recurring_parent_id}`:`id-${r.id}`,je=r=>{d(E,r);const v=document.getElementById(L);v&&Y&&Y.getOrCreateInstance(v).show()},Pt=(r,v)=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),je(v))},_t=async()=>{d(Q,!0),await H(),d(Q,!1)};let k=p("pending");S(()=>N(),()=>{d(q,N())}),S(()=>(w(),Ie),()=>{d(F,w()(Ie.DeleteEvents))}),S(()=>(Z(),e(q)),()=>{d(G,Mt((Z()??[]).filter(r=>{const v=r.meta_data?.submitted_by_user_id;return v&&e(q)?.id&&v===e(q).id}).sort((r,v)=>St(r)-St(v))))}),S(()=>e(k),()=>{d(ee,`type-filter-select-submissions-${e(k)}`)}),S(()=>(e(G),jt),()=>{d(x,B.reduce((r,v)=>(r[v.value]=e(G).filter(f=>jt(f)===v.value),r),{}))}),S(()=>(e(re),e(x)),()=>{d(te,B.reduce((r,v)=>{const f=e(re)[v.value],m=(e(x)[v.value]??[]).filter(W=>Ge(W,f.typeFilter));return r[v.value]=m.filter(W=>Ze(W,f.search)),r},{}))}),S(()=>(e(te),e(k)),()=>{d(se,e(te)[e(k)]??[])}),S(()=>(e(E),e(G)),()=>{e(E)&&!e(G).some(r=>et(r)===et(e(E)))&&d(E,null)}),S(()=>e(E),()=>{d(U,e(E)?{...e(E),id:e(E).id??e(E).meta_data?.recurring_parent_id,category:e(E).meta_data?.category}:null)}),ua(),ut();var bt=vr(),Rt=be(bt);{var Ue=r=>{var v=Ys(),f=a(v);Ta(f,{}),t(v),l(r,v)},tt=r=>{var v=lr(),f=a(v),m=a(f),W=a(m),De=i(a(W),2),de=a(De);{var M=O=>{var s=lt("Refreshing…");l(O,s)},me=O=>{var s=lt("Refresh");l(O,s)};b(de,O=>{e(Q)?O(M):O(me,!1)})}t(De),t(W);var Me=i(W,2);We(Me,5,()=>B,da,(O,s)=>{var u=Vs(),n=a(u);t(u),T(()=>{Ye(u,1,(e(k),e(s),o(()=>`nav-link ${e(k)===e(s).value?"active":""}`)),"svelte-f25tv"),vt(u,"aria-selected",(e(k),e(s),o(()=>e(k)===e(s).value))),P(n,`${e(s),o(()=>e(s).label)??""} (${e(x),e(s),o(()=>(e(x)[e(s).value]??[]).length)??""})`)}),j("click",u,()=>d(k,e(s).value)),l(O,u)}),t(Me),t(m);var Oe=i(m,2),Le=a(Oe),mt=a(Le),at=a(mt);Pa(at),t(mt);var yt=i(mt,2),xe=a(yt);We(xe,5,()=>ve,da,(O,s)=>{var u=Xs(),n=a(u,!0);t(u);var R={};T(()=>{P(n,(e(s),o(()=>e(s).label))),R!==(R=(e(s),o(()=>e(s).value)))&&(u.value=(u.__value=(e(s),o(()=>e(s).value)))??"")}),l(O,u)}),t(xe);var It;ts(xe),t(yt),t(Le);var Ot=i(Le,2);{var Kt=O=>{var s=Js(),u=a(s);{var n=$=>{var A=lt("You haven't submitted any events or announcements yet.");l($,A)},R=$=>{var A=lt();T(ne=>P(A,`No ${ne??""} submissions match your current filters.`),[()=>(e(k),o(()=>we[e(k)].toLowerCase()))]),l($,A)};b(u,$=>{e(G),o(()=>e(G).length===0)?$(n):$(R,!1)})}t(s),l(O,s)},zt=O=>{var s=or();We(s,5,()=>e(se),u=>et(u),(u,n)=>{const R=$e(()=>(K(jt),e(n),o(()=>jt(e(n))))),$=$e(()=>(K(e(R)),o(()=>Ae[e(R)]))),A=$e(()=>(e(n),K(va),o(()=>e(n).meta_data?.category?va(e(n).meta_data.category):null))),ne=$e(()=>(e(n),o(()=>pt(e(n)))));var V=nr(),ke=a(V),Pe=a(ke),Be=a(Pe,!0);t(Pe);var Ee=i(Pe,2),Ce=a(Ee),Ct=a(Ce,!0);t(Ce);var gt=i(Ce,2);t(Ee),t(ke);var ht=i(ke,2);{var Qt=_=>{var y=Zs(),ue=a(y,!0);t(y),T(()=>P(ue,e(ne))),l(_,y)};b(ht,_=>{e(ne)&&_(Qt)})}var wt=i(ht,2),Ft=a(wt);{var Yt=_=>{var y=Gs(),ue=a(y,!0);t(y),T(()=>{Ye(y,1,`badge rounded-pill bg-color-${K(e(A)),o(()=>e(A).color_number)??""}`,"svelte-f25tv"),P(ue,(K(e(A)),o(()=>e(A).label)))}),l(_,y)},Vt=_=>{var y=er();l(_,y)};b(Ft,_=>{e(A)?_(Yt):_(Vt,!1)})}var pe=i(Ft,2);{var ye=_=>{var y=tr(),ue=i(a(y));t(y),T(()=>P(ue,` ${e(n),o(()=>e(n).location)??""}`)),l(_,y)};b(pe,_=>{e(n),o(()=>e(n).location)&&_(ye)})}var qe=i(pe,2);{var xt=_=>{var y=ar(),ue=i(a(y));t(y),T(Qe=>P(ue,` ${Qe??""}`),[()=>(e(n),o(()=>ft(e(n).recurrence_rule)))]),l(_,y)};b(qe,_=>{e(n),o(()=>e(n).recurrence_rule)&&_(xt)})}t(wt);var He=i(wt,2),X=a(He),fe=i(a(X));t(X);var Ke=i(X,2);{var Ne=_=>{var y=sr(),ue=i(a(y));t(y),T(Qe=>P(ue,` Event ${Qe??""}`),[()=>(e(n),o(()=>Dt(e(n))))]),l(_,y)};b(Ke,_=>{e(n),o(()=>e(n).event_type==="calendar_event")&&_(Ne)})}t(He);var ze=i(He,2),Re=a(ze),st=a(Re),Te=i(st,1,!0);t(Re);var ge=i(Re,2);{var J=_=>{var y=rr(),ue=a(y);t(y),T(Qe=>P(ue,`Approvals: ${Qe??""} of 3`),[()=>(K(qt),e(n),o(()=>qt(e(n))))]),l(_,y)};b(ge,_=>{K(qt),e(n),o(()=>qt(e(n))>0)&&_(J)})}t(ze),t(V),T(_=>{rs(V,`border-left: 4px solid ${K(e(R)),o(()=>ie[e(R)])??""}`),P(Be,(e(n),o(()=>e(n).title))),P(Ct,(e(n),o(()=>e(n).event_type==="calendar_event"?"Event":"Announcement"))),vt(gt,"aria-label",(e(n),o(()=>`Edit ${e(n).title}`))),P(fe,` Submitted ${_??""}`),Ye(Re,1,(K(e($)),o(()=>`badge ${e($).class}`)),"svelte-f25tv"),Ye(st,1,(K(e($)),o(()=>`bi ${e($).icon} me-1`)),"svelte-f25tv"),P(Te,(K(e($)),o(()=>e($).text)))},[()=>(e(n),o(()=>Ve(e(n))))]),j("click",gt,_s(()=>je(e(n)))),j("click",V,()=>je(e(n))),j("keydown",V,_=>Pt(_,e(n))),l(u,V)}),t(s),l(O,s)};b(Ot,O=>{e(se),o(()=>e(se).length===0)?O(Kt):O(zt,!1)})}t(Oe),t(f),t(v),T(()=>{De.disabled=e(Q),as(at,(e(re),e(k),o(()=>e(re)[e(k)].search))),vt(xe,"id",e(ee)),It!==(It=(e(re),e(k),o(()=>e(re)[e(k)].typeFilter)))&&(xe.value=(xe.__value=(e(re),e(k),o(()=>e(re)[e(k)].typeFilter)))??"",ss(xe,(e(re),e(k),o(()=>e(re)[e(k)].typeFilter))))}),j("click",De,_t),j("input",at,O=>Fe(e(k),{search:O.currentTarget.value})),j("change",xe,O=>Fe(e(k),{typeFilter:O.currentTarget.value})),l(r,v)};b(Rt,r=>{C()?r(tt,!1):r(Ue)})}var Tt=i(Rt,2);{let r=$e(()=>(e(E),o(()=>e(E)?`Edit: ${e(E).title}`:"Submission Details")));Oa(Tt,{get id(){return L},get title(){return e(r)},children:(v,f)=>{var m=ot(),W=be(m);{var De=M=>{Ra(M,{get eventItem(){return e(U)},get drawerId(){return L},name:"my-submission-form",get canDelete(){return e(F)},canCreate:!1})},de=M=>{var me=ir();l(M,me)};b(W,M=>{e(U)?M(De):M(de,!1)})}l(v,m)},$$slots:{default:!0}})}l(le,bt),ct(),z()}var cr=c('<button class="nav-link" id="approvals-tab" data-bs-toggle="tab" data-bs-target="#approvals-pane" type="button" role="tab" aria-controls="approvals-pane" aria-selected="false">Approvals</button>'),ur=c('<button class="nav-link" id="my-submissions-tab" data-bs-toggle="tab" data-bs-target="#my-submissions-pane" type="button" role="tab" aria-controls="my-submissions-pane" aria-selected="false">My Submissions</button>'),pr=c('<div class="tab-pane fade" id="approvals-pane" role="tabpanel" aria-labelledby="approvals-tab"><!></div>'),fr=c('<div class="tab-pane fade" id="my-submissions-pane" role="tabpanel" aria-labelledby="my-submissions-tab"><!></div>'),_r=c('<nav class="d-print-none"><div class="nav nav-tabs" role="tablist"><button class="nav-link active" id="announcements-tab" data-bs-toggle="tab" data-bs-target="#announcements-pane" type="button" role="tab" aria-controls="announcements-pane" aria-selected="true">All</button> <!> <!></div></nav> <div class="tab-content mt-3"><div class="tab-pane fade show active" id="announcements-pane" role="tabpanel" aria-labelledby="announcements-tab"><!></div> <!> <!></div>',1);function Br(le,I){dt(I,!1);const N=p(),{stores:{currentUserHasPermission:w,authenticated:Z}}=_a();let C=p(!1),g=p(!1);ca(()=>{const z=w.subscribe(F=>{const ee=F(Ie.ManageWardBusiness);d(C,ee)}),q=Z.subscribe(F=>{d(g,F)});return()=>{z(),q()}}),S(()=>(e(C),e(g)),()=>{d(N,e(C)||e(g))}),ua(),ut(),Ga(le,{pageTitle:"Announcements & Events",children:(z,q)=>{var F=ot(),ee=be(F);{var x=U=>{var ce=_r(),D=be(ce),H=a(D),h=i(a(H),2);{var ae=B=>{var ve=cr();l(B,ve)};b(h,B=>{e(C)&&B(ae)})}var Q=i(h,2);{var G=B=>{var ve=ur();l(B,ve)};b(Q,B=>{e(g)&&B(G)})}t(H),t(D);var se=i(D,2),E=a(se),L=a(E);Da(L),t(E);var Y=i(E,2);{var ie=B=>{var ve=pr(),Se=a(ve);ps(Se,{}),t(ve),l(B,ve)};b(Y,B=>{e(C)&&B(ie)})}var Ae=i(Y,2);{var we=B=>{var ve=fr(),Se=a(ve);dr(Se,{}),t(ve),l(B,ve)};b(Ae,B=>{e(g)&&B(we)})}t(se),l(U,ce)},te=U=>{Da(U)};b(ee,U=>{e(N)?U(x):U(te,!1)})}l(z,F)},$$slots:{default:!0}}),ct()}export{Br as component,Lr as universal};
