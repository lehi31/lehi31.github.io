import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{p as qe,c as s,s as o,r as t,a as Le,f as Z,t as C,F as qt,aj as se,ak as ka,g as e,E as f,D as l,u as c,R as me,an as Ea,w as re,ao as xa,i as wa}from"../chunks/DVz9v3yu.js";import{f as v,a as r,c as Fe,t as Tt}from"../chunks/BMBpHE4F.js";import{P as Da}from"../chunks/dvZ4Twdn.js";import{d as Rt,s as Ft,A as Ma,E as $a}from"../chunks/DlczjW8I.js";import{d as Wt,o as Pa,g as Ca}from"../chunks/CxzQr61Z.js";import{p as be,i as b,e as S,s as R,a as Lt,b as G,c as Nt}from"../chunks/DxLPEELx.js";import{e as Pe,i as Sa}from"../chunks/BoUt-3Zs.js";import{s as lt,r as Aa,b as Oa}from"../chunks/Zte9W7v2.js";import{g as Ia,p as Y,f as Q,P as it,k as Ta,c as vt}from"../chunks/nNGA7-yB.js";import{i as je}from"../chunks/B41JjjA1.js";import{c as Ra,g as jt,A as Fa,e as We,d as Wa,E as Na}from"../chunks/BmjvMspZ.js";import{S as qa}from"../chunks/Ct0CT-jp.js";import{v as La,D as ja}from"../chunks/CiEVd2ZP.js";import{s as Ne}from"../chunks/rN9Z-W37.js";import{b as Qa}from"../chunks/DSlOdaIK.js";function Ha(F,_){return Ra(F,-_)}const Ka=!0,Ns=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ka},Symbol.toStringTag,{value:"Module"}));var Ua=v('<p class="mb-0">No past events to delete.</p>'),Ba=v('<p class="mb-2"><strong> </strong></p>'),Va=v(`<div class="alert alert-warning mb-0" role="alert"><p class="mb-2"><strong> </strong></p> <p class="mb-0 small">These recurring events have active future instances and cannot be deleted until all
								future occurrences have passed.</p></div>`),Xa=v("<!> <!>",1),za=v('<div class="modal svelte-1u875uh" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-primary text-white"><h5 class="modal-title">Delete Past Events - Results</h5> <button type="button" class="btn-close btn-close-white" aria-label="Close"></button></div> <div class="modal-body"><!></div> <div class="modal-footer"><button type="button" class="btn btn-primary">OK</button></div></div></div></div>');function Ja(F,_){qe(_,!1);let A=be(_,"deleted",8),d=be(_,"skipped",8),P=be(_,"callback",8);function g(){P()()}je();var x=za(),W=s(x),y=s(W),O=s(y),H=o(s(O),2);t(O);var w=o(O,2),u=s(w);{var K=h=>{var U=Ua();r(h,U)},m=h=>{var U=Xa(),ee=Z(U);{var pe=k=>{var I=Ba(),B=s(I),J=s(B);t(B),t(I),C(()=>R(J,`✓ Deleted ${A()??""} past event${A()===1?"":"s"}.`)),r(k,I)};b(ee,k=>{A()>0&&k(pe)})}var ne=o(ee,2);{var oe=k=>{var I=Va(),B=s(I),J=s(B),ge=s(J);t(J),t(B),qt(2),t(I),C(()=>R(ge,`⚠ Skipped ${d()??""} recurring event${d()===1?"":"s"}`)),r(k,I)};b(ne,k=>{d()>0&&k(oe)})}r(h,U)};b(u,h=>{A()===0&&d()===0?h(K):h(m,!1)})}t(w);var N=o(w,2),D=s(N);t(N),t(y),t(W),t(x),S("click",H,g),S("click",D,g),r(F,x),Le()}var Ya=v(`<div class="modal svelte-dmsnaa" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-danger text-white"><h5 class="modal-title">Delete Past Events</h5> <button type="button" class="btn-close btn-close-white" aria-label="Close"></button></div> <div class="modal-body"><p class="mb-3"><strong> </strong></p> <p class="mb-0 text-muted small">This action cannot be undone. Recurring events with future instances will be skipped
					automatically.</p></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-danger">Delete</button></div></div></div></div>`);function Za(F,_){qe(_,!1);let A=be(_,"cutoffDate",8),d=be(_,"callback",8);function P(){d()(!0)}function g(){d()(!1)}je();var x=Ya(),W=s(x),y=s(W),O=s(y),H=o(s(O),2);t(O);var w=o(O,2),u=s(w),K=s(u),m=s(K);t(K),t(u),qt(2),t(w);var N=o(w,2),D=s(N),h=o(D,2);t(N),t(y),t(W),t(x),C(()=>R(m,`Are you sure you want to delete all events that occurred before ${A()??""}?`)),S("click",H,g),S("click",D,g),S("click",h,P),r(F,x),Le()}var Ga=v('<button class="btn btn-sm btn-outline-secondary w-100"><i class="bi bi-clock-history me-1"></i> </button>'),es=v('<button class="btn btn-sm btn-outline-danger" type="button"><!></button>'),ts=v('<div class="event-actions svelte-1ofdc1q"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit past event"><i class="bi bi-pencil-square"></i></button></div>'),as=v('<div class="daily-event-row svelte-1ofdc1q"><div class="event-content svelte-1ofdc1q"><!></div> <!></div>'),ss=v('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-1ofdc1q"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),rs=v('<li class="list-group-item py-3 text-muted">No events scheduled this week.</li>'),ns=v('<li class="list-group-item list-group-item-light text-uppercase small fw-lighter p-0"><button><span class="d-flex align-items-center gap-2"><i></i> <span class="text-muted"> </span></span> <span> </span></button></li> <!>',1),os=v('<li class="list-group-item bg-secondary text-white fw-semibold"> </li> <!>',1),ls=v('<button class="btn btn-outline-secondary btn-sm">Reset</button>'),is=v('<div class="d-flex gap-2"><button class="btn btn-primary btn-sm">More</button> <button class="btn btn-outline-primary btn-sm">All</button></div>'),vs=v('<div class="card-footer d-flex align-items-center justify-content-between"><small> </small> <!></div>'),ds=v('<ul class="list-group list-group-flush border-top-0"></ul> <!>',1),cs=v('<div class="card-body text-muted small">No past events available.</div>'),us=v('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center gap-3 flex-wrap fw-lighter"><span>Past Events</span> <div class="d-flex gap-2"><!> <button class="btn btn-sm btn-outline-secondary">Hide</button></div></div></div> <!></div>'),fs=v('<div class="d-flex flex-column gap-4"><!></div>'),_s=v("<!> <!> <!> <!>",1);function ms(F,_){qe(_,!1);const A=()=>G(oe,"$weeksExpanded",y),d=()=>G(Ut,"$allPastEvents",y),P=()=>G(U,"$currentUserHasPermission",y),g=()=>G(bt,"$userIsRoot",y),x=()=>G(pe,"$ready",y),W=()=>G(k,"$searchQuery",y),[y,O]=Lt(),H=f(),w=f(),u=f(),K=f(),m=f(),N=f(),D=f(),h=f(),{stores:{currentUserHasPermission:U,currentUser:ee}}=Ia(),{stores:{ready:pe,dbData:ne,weeksExpanded:oe,searchQuery:k},actions:{reload:I}}=jt(),B={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0};let J=be(_,"formId",24,La),ge=f(!1),ye=f(!1),dt=f(""),ct=f({...B}),Qe=f(!1),ut=f(""),He=f(!1),he=f({deleted:0,skipped:0});const ft=4,Qt=4;let ie=f(ft),Ce=f(!1);const _t=Ne();let ve=f({});function mt(a){return e(H).includes(a)}function Ht(a){const i=e(ve)[a]??mt(a);l(ve,{...e(ve),[a]:!i})}const Kt=a=>{l(dt,"Event Item"),l(ct,{...a,category:a?.meta_data?.category})},Ut=Wt(ne,a=>{const i=Ne();return(a??[]).filter(n=>!(n.event_type!=="calendar_event"||!n.start_time||Y(n.start_time)>=i||n.recurrence_rule&&(!n.recurrence_end_date||n.recurrence_end_date&&Y(n.recurrence_end_date)>=i)))}),bt=Wt(ee,a=>a.roles?.includes("system-root")??!1);let Ke=f(!1);function Bt(){l(ie,e(ie)+Qt)}function Vt(){l(ie,520),l(Ce,!0)}function Xt(){l(ie,ft),l(Ce,!1)}const zt=()=>{if(!e(ge)||e(ye)||!Ca(bt)||!e(D))return;const a=Ne();l(ut,Q(a,"MMM d, yyyy")),l(Qe,!0)};async function Jt(a){if(l(Qe,!1),!a)return;const i=Ne();l(ye,!0);try{const n=await Wa(i);await I(),l(he,n),l(He,!0)}catch(n){console.error("Failed to delete past events",n),alert("Failed to delete past events. Please try again.")}finally{l(ye,!1)}}function Yt(){l(He,!1)}Pa(async()=>{l(ge,P()(it.CreateEvents)||P()(it.EditOwnOrgEvents)||P()(it.EditAllEvents)),await I()}),se(()=>(d(),e(ie)),()=>{l(u,(d()??[]).filter(a=>{if(!a.start_time)return!1;const i=Y(a.start_time),n=Ha(_t,e(ie));return i>=n&&i<_t}))}),se(()=>(e(u),Q),()=>{l(m,(()=>{const a=new Map;for(const i of e(u)){if(!i.start_time)continue;const n=Y(i.start_time),M=Ta(n,{weekStartsOn:1}),T=We(n,{weekStartsOn:1}),E=Q(M,"yyyy-MM-dd"),q=`${Q(M,"MMM d")} – ${Q(T,"MMM d")}`;let L=a.get(E);L||(L={key:E,label:q,days:new Map},a.set(E,L));const le=Q(n,"yyyy-MM-dd");let de=L.days.get(le);de||(de={key:le,displayDay:Q(n,"EEE"),displayDate:Q(n,"MMM d"),events:[]},L.days.set(le,de)),de.events.push(i)}return Array.from(a.values()).sort((i,n)=>i.key<n.key?1:-1).map(i=>({key:i.key,label:i.label,days:Array.from(i.days.values()).sort((n,M)=>n.key<M.key?1:-1).map(n=>({...n,events:n.events.slice().sort((M,T)=>{const E=M.is_all_day?0:1,q=T.is_all_day?0:1;if(E!==q)return E-q;const L=M.start_time?Y(M.start_time).getTime():Number.MAX_SAFE_INTEGER,le=T.start_time?Y(T.start_time).getTime():Number.MAX_SAFE_INTEGER;return L-le})}))}))})())}),se(()=>e(m),()=>{l(H,(()=>{if(e(m).length===0)return[];const a=[];return e(m)[0]&&a.push(e(m)[0].key),e(m)[1]&&a.push(e(m)[1].key),a})())}),se(()=>(A(),e(ve)),()=>{l(w,a=>A()?!0:e(ve)[a]!==void 0?e(ve)[a]:mt(a))}),se(()=>e(u),()=>{l(K,e(u).length)}),se(()=>(e(m),Q),()=>{l(N,e(m).reduce((a,i)=>{const n=Y(i.key),M=We(n,{weekStartsOn:1}),T=Q(M,"yyyy-MM"),E=Q(M,"MMMM yyyy");return a[T]||(a[T]={label:E,weeks:[]}),a[T].weeks.push(i),a},{}))}),se(()=>e(u),()=>{l(D,e(u).length>0)}),se(()=>(d(),e(u)),()=>{l(h,d().length>e(u).length)}),ka(),je();var pt=_s(),gt=Z(pt);ja(gt,{get title(){return e(dt)},get id(){return J()},children:(a,i)=>{Fa(a,{get eventItem(){return e(ct)},get drawerId(){return J()},name:"past-event-item-form"})},$$slots:{default:!0}});var yt=o(gt,2);{var Zt=a=>{var i=Fe(),n=Z(i);{var M=E=>{var q=Fe(),L=Z(q);{var le=ce=>{var te=Ga(),ke=o(s(te));t(te),C(()=>R(ke,` Show Past Events (${d(),c(()=>d().length)??""})`)),S("click",te,()=>l(Ke,!0)),r(ce,te)},de=ce=>{var te=us(),ke=s(te),kt=s(ke),Et=o(s(kt),2),xt=s(Et);{var aa=V=>{var X=es(),Ee=s(X);{var Ue=$=>{var j=Tt("Deleting…");r($,j)},Be=$=>{var j=Tt();C(()=>R(j,`Delete All (${e(K)??""})`)),r($,j)};b(Ee,$=>{e(ye)?$(Ue):$(Be,!1)})}t(X),C(()=>X.disabled=e(ye)),S("click",X,zt),r(V,X)};b(xt,V=>{g()&&e(D)&&V(aa)})}var sa=o(xt,2);t(Et),t(kt),t(ke);var ra=o(ke,2);{var na=V=>{var X=ds(),Ee=Z(X);Pe(Ee,5,()=>(e(N),c(()=>Object.entries(e(N)))),([$,j])=>$,($,j)=>{var xe=Ea(()=>xa(e(j),2));let ue=()=>e(xe)[1];var Se=os(),we=Z(Se),Ve=s(we,!0);t(we);var ae=o(we,2);Pe(ae,1,()=>(ue(),c(()=>ue().weeks)),z=>z.key,(z,p)=>{const Ae=me(()=>(re(Y),e(p),c(()=>Y(e(p).key)))),Oe=me(()=>(re(We),re(e(Ae)),c(()=>We(e(Ae),{weekStartsOn:1})))),wt=me(()=>(re(Ft),re(e(Oe)),c(()=>Ft(e(Oe))))),la=me(()=>(re(Rt),re(e(Oe)),re(e(wt)),c(()=>Rt(e(Oe),e(wt),{weekStartsOn:1})+1))),Xe=me(()=>(e(w),e(p),c(()=>e(w)(e(p).key)))),Ie=me(()=>(e(p),c(()=>e(p).days.reduce((Me,Te)=>Me+Te.events.length,0))));var Dt=ns(),ze=Z(Dt),De=s(ze);let Mt;var Je=s(De),$t=s(Je),Pt=o($t,2),ia=s(Pt);t(Pt),t(Je);var Ye=o(Je,2);let Ct;var va=s(Ye,!0);t(Ye),t(De),t(ze);var da=o(ze,2);{var ca=Me=>{var Te=Fe(),ua=Z(Te);{var fa=fe=>{var Re=Fe(),ma=Z(Re);Pe(ma,1,()=>(e(p),c(()=>e(p).days)),Ze=>Ze.key,(Ze,_e)=>{var Ge=ss(),St=s(Ge),et=s(St),tt=s(et),ba=s(tt,!0);t(tt);var At=o(tt,2),pa=s(At,!0);t(At),t(et);var Ot=o(et,2);Pe(Ot,5,()=>(e(_e),c(()=>e(_e).events)),$e=>$e.id??`${$e.start_time}-${$e.meta_data?.recurring_instance_index??0}`,($e,It)=>{var at=as(),st=s(at),ga=s(st);Na(ga,{get item(){return e(It)},showDate:!1,get searchQuery(){return W()}}),t(st);var ya=o(st,2);{var ha=rt=>{var nt=ts(),ot=s(nt);t(nt),C(()=>{lt(ot,"data-bs-target",`#${J()??""}`),lt(ot,"aria-controls",J())}),S("click",ot,()=>Kt(e(It))),r(rt,nt)};b(ya,rt=>{e(ge)&&rt(ha)})}t(at),r($e,at)}),t(Ot),t(St),t(Ge),C(()=>{R(ba,(e(_e),c(()=>e(_e).displayDay))),R(pa,(e(_e),c(()=>e(_e).displayDate)))}),r(Ze,Ge)}),r(fe,Re)},_a=fe=>{var Re=rs();r(fe,Re)};b(ua,fe=>{e(p),c(()=>e(p).days.length)?fe(fa):fe(_a,!1)})}r(Me,Te)};b(da,Me=>{e(Xe)&&Me(ca)})}C(()=>{Mt=vt(De,1,"week-header w-100 d-flex justify-content-between align-items-center border-0 bg-transparent p-2 text-start svelte-1ofdc1q",null,Mt,{"text-muted":e(Ie)===0}),lt(De,"title",e(Xe)?"Click to collapse week":"Click to expand week"),vt($t,1,`bi ${e(Xe)?"bi-chevron-up":"bi-chevron-down"}`),R(ia,`Week ${e(la)??""} [${e(Ie)??""} Event${e(Ie)===1?"":"s"}]`),Ct=vt(Ye,1,"",null,Ct,{"opacity-50":e(Ie)===0}),R(va,(e(p),c(()=>e(p).label)))}),S("click",De,()=>Ht(e(p).key)),r(z,Dt)}),C(()=>R(Ve,(ue(),c(()=>ue().label)))),r($,Se)}),t(Ee);var Ue=o(Ee,2);{var Be=$=>{var j=vs(),xe=s(j),ue=s(xe);t(xe);var Se=o(xe,2);{var we=ae=>{var z=ls();S("click",z,Xt),r(ae,z)},Ve=ae=>{var z=is(),p=s(z),Ae=o(p,2);t(z),S("click",p,Bt),S("click",Ae,Vt),r(ae,z)};b(Se,ae=>{e(Ce)?ae(we):ae(Ve,!1)})}t(j),C(()=>R(ue,`Showing ${e(u),c(()=>e(u)?.length??0)??""} of ${d(),c(()=>d()?.length??0)??""}`)),r($,j)};b(Ue,$=>{(e(h)||e(Ce))&&$(Be)})}r(V,X)},oa=V=>{var X=cs();r(V,X)};b(ra,V=>{e(m),c(()=>e(m).length)?V(na):V(oa,!1)})}t(te),S("click",sa,()=>l(Ke,!1)),r(ce,te)};b(L,ce=>{e(Ke)?ce(de,!1):ce(le)})}r(E,q)},T=E=>{var q=fs(),L=s(q);qa(L,{}),t(q),r(E,q)};b(n,E=>{x()?E(M):E(T,!1)})}r(a,i)};b(yt,a=>{g()&&a(Zt)})}var ht=o(yt,2);{var Gt=a=>{Za(a,{get cutoffDate(){return e(ut)},callback:Jt})};b(ht,a=>{e(Qe)&&a(Gt)})}var ea=o(ht,2);{var ta=a=>{Ja(a,{get deleted(){return e(he),c(()=>e(he).deleted)},get skipped(){return e(he),c(()=>e(he).skipped)},callback:Yt})};b(ea,a=>{e(He)&&a(ta)})}r(F,pt),Le(),O()}var bs=v("<option> </option>"),ps=v('<div class="col-12 col-md-auto"><select class="form-select form-select" aria-label="Filter by category"><option>All Categories</option><!></select></div>'),gs=v('<div class="search-filter sticky-top svelte-1wm3u0q"><div class="row g-2"><div class="col-12 col-md"><input type="search" class="form-control form-control" placeholder="Search..."/></div> <!></div></div>');function ys(F,_){qe(_,!1);const A=()=>G(O,"$searchQuery",g),d=()=>G(W,"$currentCategories",g),P=()=>G(y,"$categoryFilter",g),[g,x]=Lt(),{stores:{currentCategories:W,categoryFilter:y,searchQuery:O}}=jt();je();var H=gs(),w=s(H),u=s(w),K=s(u);Aa(K),t(u);var m=o(u,2);{var N=D=>{var h=ps(),U=s(h);C(()=>{P(),wa(()=>{d()})});var ee=s(U);ee.value=ee.__value="";var pe=o(ee);Pe(pe,1,d,Sa,(ne,oe)=>{var k=bs(),I=s(k,!0);t(k);var B={};C(()=>{R(I,e(oe).label),B!==(B=e(oe).key)&&(k.value=(k.__value=e(oe).key)??"")}),r(ne,k)}),t(U),t(h),Oa(U,P,ne=>Nt(y,ne)),r(D,h)};b(m,D=>{d().length&&D(N)})}t(w),t(H),Qa(K,A,D=>Nt(O,D)),r(F,H),Le(),x()}var hs=v('<div class="d-flex flex-column gap-4"><!> <!> <!> <!></div>');function qs(F){Da(F,{pageTitle:"Announcements & Events",children:(_,A)=>{var d=hs(),P=s(d);ys(P,{});var g=o(P,2);Ma(g,{});var x=o(g,2);$a(x,{});var W=o(x,2);ms(W,{}),t(d),r(_,d)},$$slots:{default:!0}})}export{qs as component,Ns as universal};
