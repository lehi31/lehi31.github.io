import{a as $t}from"../chunks/CnC24E_g.js";import{P as el,O as Tt,g as Zt,i as tl,j as ll,k as sl,r as nl,l as rl}from"../chunks/uRgtERvd.js";import{s as rt,n as Ie,d as i,C as Ae,r as Ye,F as Fe,y as _e,v as ne,i as G,q as n,z as ce,a,G as dt,c as f,k as b,g as re,l as N,w as j,e as d,m as A,x as F,N as Ne,o as vt,J as ht,L as lt,t as nt}from"../chunks/XwK7VtW3.js";import{S as ot,i as at,d as qe,t as Pe,a as Ue,m as Ge,c as Ke,b as Qe,g as ol,e as al}from"../chunks/e-rlo9AR.js";import{e as be}from"../chunks/BXYRyfL2.js";import{P as il}from"../chunks/Bi9MFkoo.js";import{u as cl}from"../chunks/D1Lb4JeS.js";import{D as xt}from"../chunks/Ct6k4Xpq.js";import{f as ul,g as fl,h as dl,e as hl,p as _l,i as ml,j as vl,r as pl,k as bl,m as gl,n as El}from"../chunks/G6hjsaDa.js";const kl=!1,Tl=async()=>($t(el.AssignCallings,"Assign Callings"),{}),ls=Object.freeze(Object.defineProperty({__proto__:null,load:Tl,ssr:kl},Symbol.toStringTag,{value:"Module"}));function Ct(s,e,t){const l=s.slice();return l[26]=e[t],l}function wt(s,e,t){const l=s.slice();return l[29]=e[t],l}function Dt(s,e,t){const l=s.slice();return l[29]=e[t],l}function yt(s,e,t){const l=s.slice();return l[34]=e[t],l}function It(s,e,t){const l=s.slice();return l[37]=e[t],l}function Ot(s){let e,t,l,r,o,h;return{c(){e=d("div"),t=F(s[4]),l=A(),r=d("button"),this.h()},l(c){e=f(c,"DIV",{class:!0,role:!0});var u=b(e);t=j(u,s[4]),l=N(u),r=f(u,"BUTTON",{type:!0,class:!0,"aria-label":!0}),b(r).forEach(i),u.forEach(i),this.h()},h(){a(r,"type","button"),a(r,"class","btn-close"),a(r,"aria-label","Close"),a(e,"class","alert alert-danger alert-dismissible fade show"),a(e,"role","alert")},m(c,u){G(c,e,u),n(e,t),n(e,l),n(e,r),o||(h=ce(r,"click",s[17]),o=!0)},p(c,u){u[0]&16&&ne(t,c[4])},d(c){c&&i(e),o=!1,h()}}}function Lt(s){let e,t=(s[37].display_name||s[37].email)+"",l,r,o=s[37].email+"",h,c,u;return{c(){e=d("option"),l=F(t),r=F(" ("),h=F(o),c=F(`)
							`),this.h()},l(_){e=f(_,"OPTION",{});var p=b(e);l=j(p,t),r=j(p," ("),h=j(p,o),c=j(p,`)
							`),p.forEach(i),this.h()},h(){e.__value=u=s[37].id,_e(e,e.__value)},m(_,p){G(_,e,p),n(e,l),n(e,r),n(e,h),n(e,c)},p(_,p){p[0]&1024&&t!==(t=(_[37].display_name||_[37].email)+"")&&ne(l,t),p[0]&1024&&o!==(o=_[37].email+"")&&ne(h,o),p[0]&1024&&u!==(u=_[37].id)&&(e.__value=u,_e(e,e.__value))},d(_){_&&i(e)}}}function Nt(s){let e,t=s[34].name+"",l,r;return{c(){e=d("option"),l=F(t),this.h()},l(o){e=f(o,"OPTION",{});var h=b(e);l=j(h,t),h.forEach(i),this.h()},h(){e.__value=r=s[34].id,_e(e,e.__value)},m(o,h){G(o,e,h),n(e,l)},p(o,h){h[0]&260&&t!==(t=o[34].name+"")&&ne(l,t),h[0]&260&&r!==(r=o[34].id)&&(e.__value=r,_e(e,e.__value))},d(o){o&&i(e)}}}function At(s){let e,t,l=be(s[2][s[29]]),r=[];for(let o=0;o<l.length;o+=1)r[o]=Nt(yt(s,l,o));return{c(){e=d("optgroup");for(let o=0;o<r.length;o+=1)r[o].c();this.h()},l(o){e=f(o,"OPTGROUP",{label:!0});var h=b(e);for(let c=0;c<r.length;c+=1)r[c].l(h);h.forEach(i),this.h()},h(){a(e,"label",t=mt(s[29]))},m(o,h){G(o,e,h);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(e,null)},p(o,h){if(h[0]&260){l=be(o[2][o[29]]);let c;for(c=0;c<l.length;c+=1){const u=yt(o,l,c);r[c]?r[c].p(u,h):(r[c]=Nt(u),r[c].c(),r[c].m(e,null))}for(;c<r.length;c+=1)r[c].d(1);r.length=l.length}h[0]&256&&t!==(t=mt(o[29]))&&a(e,"label",t)},d(o){o&&i(e),Ae(r,o)}}}function Rt(s){let e;return{c(){e=d("span"),this.h()},l(t){e=f(t,"SPAN",{class:!0,role:!0}),b(e).forEach(i),this.h()},h(){a(e,"class","spinner-border spinner-border-sm me-2"),a(e,"role","status")},m(t,l){G(t,e,l)},d(t){t&&i(e)}}}function St(s){let e,t=mt(s[29])+"",l;return{c(){e=d("option"),l=F(t),this.h()},l(r){e=f(r,"OPTION",{});var o=b(e);l=j(o,t),o.forEach(i),this.h()},h(){e.__value=s[29],_e(e,e.__value)},m(r,o){G(r,e,o),n(e,l)},p:Ie,d(r){r&&i(e)}}}function Cl(s){let e,t,l,r='<tr><th scope="col" class="svelte-1h4f1is">Name</th> <th scope="col" class="d-none d-md-table-cell svelte-1h4f1is">Email</th> <th scope="col" class="svelte-1h4f1is">Role</th> <th scope="col" class="d-none d-lg-table-cell svelte-1h4f1is">Organization</th> <th scope="col" class="d-none d-lg-table-cell svelte-1h4f1is">Assigned Date</th> <th scope="col" class="d-none d-xl-table-cell svelte-1h4f1is">Notes</th> <th scope="col" class="text-end svelte-1h4f1is">Actions</th></tr>',o,h,c=be(s[9]),u=[];for(let _=0;_<c.length;_+=1)u[_]=Vt(Ct(s,c,_));return{c(){e=d("div"),t=d("table"),l=d("thead"),l.innerHTML=r,o=A(),h=d("tbody");for(let _=0;_<u.length;_+=1)u[_].c();this.h()},l(_){e=f(_,"DIV",{class:!0});var p=b(e);t=f(p,"TABLE",{class:!0});var m=b(t);l=f(m,"THEAD",{"data-svelte-h":!0}),re(l)!=="svelte-1wg3omm"&&(l.innerHTML=r),o=N(m),h=f(m,"TBODY",{class:!0});var E=b(h);for(let P=0;P<u.length;P+=1)u[P].l(E);E.forEach(i),m.forEach(i),p.forEach(i),this.h()},h(){a(h,"class","table-group-divider"),a(t,"class","table table-hover align-middle svelte-1h4f1is"),a(e,"class","table-responsive")},m(_,p){G(_,e,p),n(e,t),n(t,l),n(t,o),n(t,h);for(let m=0;m<u.length;m+=1)u[m]&&u[m].m(h,null)},p(_,p){if(p[0]&33288){c=be(_[9]);let m;for(m=0;m<c.length;m+=1){const E=Ct(_,c,m);u[m]?u[m].p(E,p):(u[m]=Vt(E),u[m].c(),u[m].m(h,null))}for(;m<u.length;m+=1)u[m].d(1);u.length=c.length}},d(_){_&&i(e),Ae(u,_)}}}function wl(s){let e,t,l=s[1]!=="all"&&Pt();return{c(){e=d("div"),t=F(`No active role assignments found.
			`),l&&l.c(),this.h()},l(r){e=f(r,"DIV",{class:!0});var o=b(e);t=j(o,`No active role assignments found.
			`),l&&l.l(o),o.forEach(i),this.h()},h(){a(e,"class","alert alert-info")},m(r,o){G(r,e,o),n(e,t),l&&l.m(e,null)},p(r,o){r[1]!=="all"?l||(l=Pt(),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},d(r){r&&i(e),l&&l.d()}}}function Dl(s){let e,t='<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>';return{c(){e=d("div"),e.innerHTML=t,this.h()},l(l){e=f(l,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-mlx3u2"&&(e.innerHTML=t),this.h()},h(){a(e,"class","text-center py-5")},m(l,r){G(l,e,r)},p:Ie,d(l){l&&i(e)}}}function Vt(s){let e,t,l,r=(s[26].user?.display_name||"Unknown")+"",o,h,c,u=(s[26].user?.email||"N/A")+"",_,p,m,E,P=(s[26].user?.email||"N/A")+"",D,V,g,k,R=s[26].roleName+"",O,v,C,y,T=st(s[26].roleOrganization)+"",w,U,z,Q,$=st(s[26].roleOrganization)+"",I,Z,Y,X,oe=new Date(s[26].assigned_date).toLocaleDateString()+"",ie,fe,ee,H,L=(s[26].notes||"—")+"",x,q,ae,J,te,le,K,B;function ue(){return s[22](s[26])}return{c(){e=d("tr"),t=d("td"),l=d("div"),o=F(r),h=A(),c=d("small"),_=F(u),p=A(),m=d("td"),E=d("small"),D=F(P),V=A(),g=d("td"),k=d("strong"),O=F(R),v=A(),C=d("div"),y=d("span"),w=F(T),U=A(),z=d("td"),Q=d("span"),I=F($),Z=A(),Y=d("td"),X=d("small"),ie=F(oe),fe=A(),ee=d("td"),H=d("small"),x=F(L),q=A(),ae=d("td"),J=d("button"),te=d("i"),le=A(),this.h()},l(me){e=f(me,"TR",{});var W=b(e);t=f(W,"TD",{});var ke=b(t);l=f(ke,"DIV",{class:!0});var ge=b(l);o=j(ge,r),ge.forEach(i),h=N(ke),c=f(ke,"SMALL",{class:!0});var Te=b(c);_=j(Te,u),Te.forEach(i),ke.forEach(i),p=N(W),m=f(W,"TD",{class:!0});var we=b(m);E=f(we,"SMALL",{class:!0});var ze=b(E);D=j(ze,P),ze.forEach(i),we.forEach(i),V=N(W),g=f(W,"TD",{});var Re=b(g);k=f(Re,"STRONG",{});var Se=b(k);O=j(Se,R),Se.forEach(i),v=N(Re),C=f(Re,"DIV",{class:!0});var Me=b(C);y=f(Me,"SPAN",{class:!0});var Be=b(y);w=j(Be,T),Be.forEach(i),Me.forEach(i),Re.forEach(i),U=N(W),z=f(W,"TD",{class:!0});var He=b(z);Q=f(He,"SPAN",{class:!0});var Je=b(Q);I=j(Je,$),Je.forEach(i),He.forEach(i),Z=N(W),Y=f(W,"TD",{class:!0});var ve=b(Y);X=f(ve,"SMALL",{});var Oe=b(X);ie=j(Oe,oe),Oe.forEach(i),ve.forEach(i),fe=N(W),ee=f(W,"TD",{class:!0});var de=b(ee);H=f(de,"SMALL",{class:!0});var Le=b(H);x=j(Le,L),Le.forEach(i),de.forEach(i),q=N(W),ae=f(W,"TD",{class:!0});var he=b(ae);J=f(he,"BUTTON",{class:!0});var pe=b(J);te=f(pe,"I",{class:!0}),b(te).forEach(i),pe.forEach(i),he.forEach(i),le=N(W),W.forEach(i),this.h()},h(){a(l,"class","fw-semibold"),a(c,"class","d-md-none text-muted d-block"),a(E,"class","text-muted"),a(m,"class","d-none d-md-table-cell"),a(y,"class","badge bg-info"),a(C,"class","d-lg-none mt-1"),a(Q,"class","badge bg-info"),a(z,"class","d-none d-lg-table-cell"),a(Y,"class","d-none d-lg-table-cell"),a(H,"class","text-muted"),a(ee,"class","d-none d-xl-table-cell"),a(te,"class","bi bi-x-circle"),a(J,"class","btn btn-sm btn-outline-danger"),J.disabled=s[3],a(ae,"class","text-end")},m(me,W){G(me,e,W),n(e,t),n(t,l),n(l,o),n(t,h),n(t,c),n(c,_),n(e,p),n(e,m),n(m,E),n(E,D),n(e,V),n(e,g),n(g,k),n(k,O),n(g,v),n(g,C),n(C,y),n(y,w),n(e,U),n(e,z),n(z,Q),n(Q,I),n(e,Z),n(e,Y),n(Y,X),n(X,ie),n(e,fe),n(e,ee),n(ee,H),n(H,x),n(e,q),n(e,ae),n(ae,J),n(J,te),n(e,le),K||(B=ce(J,"click",ue),K=!0)},p(me,W){s=me,W[0]&512&&r!==(r=(s[26].user?.display_name||"Unknown")+"")&&ne(o,r),W[0]&512&&u!==(u=(s[26].user?.email||"N/A")+"")&&ne(_,u),W[0]&512&&P!==(P=(s[26].user?.email||"N/A")+"")&&ne(D,P),W[0]&512&&R!==(R=s[26].roleName+"")&&ne(O,R),W[0]&512&&T!==(T=st(s[26].roleOrganization)+"")&&ne(w,T),W[0]&512&&$!==($=st(s[26].roleOrganization)+"")&&ne(I,$),W[0]&512&&oe!==(oe=new Date(s[26].assigned_date).toLocaleDateString()+"")&&ne(ie,oe),W[0]&512&&L!==(L=(s[26].notes||"—")+"")&&ne(x,L),W[0]&8&&(J.disabled=s[3])},d(me){me&&i(e),K=!1,B()}}}function Pt(s){let e;return{c(){e=F("Try selecting a different organization.")},l(t){e=j(t,"Try selecting a different organization.")},m(t,l){G(t,e,l)},d(t){t&&i(e)}}}function yl(s){let e,t,l,r="Role Assignments",o,h,c,u,_,p,m,E,P='<h5 class="mb-0">Assign New Role</h5>',D,V,g,k,R,O="Select User",v,C,y,T="Choose a user...",w,U,z,Q="Select Role",$,I,Z,Y="Choose a role...",X,oe,ie,fe="Notes (Optional)",ee,H,L,x,q,ae,J,te,le,K,B,ue,me="All Organizations",W,ke,ge,Te,we=s[9].length+"",ze,Re,Se=s[9].length!==1?"s":"",Me,Be,He,Je,ve=s[4]&&Ot(s),Oe=be(s[10]),de=[];for(let S=0;S<Oe.length;S+=1)de[S]=Lt(It(s,Oe,S));let Le=be(s[8]),he=[];for(let S=0;S<Le.length;S+=1)he[S]=At(Dt(s,Le,S));let pe=s[3]&&Rt(),je=be(Object.values(Tt)),Ee=[];for(let S=0;S<je.length;S+=1)Ee[S]=St(wt(s,je,S));function pt(S,se){return S[3]&&S[0].length===0?Dl:S[9].length===0?wl:Cl}let We=pt(s),De=We(s);return{c(){e=d("div"),t=d("div"),l=d("h2"),l.textContent=r,o=A(),h=d("button"),c=d("i"),u=F(" Refresh"),_=A(),ve&&ve.c(),p=A(),m=d("div"),E=d("div"),E.innerHTML=P,D=A(),V=d("div"),g=d("div"),k=d("div"),R=d("label"),R.textContent=O,v=A(),C=d("select"),y=d("option"),y.textContent=T;for(let S=0;S<de.length;S+=1)de[S].c();w=A(),U=d("div"),z=d("label"),z.textContent=Q,$=A(),I=d("select"),Z=d("option"),Z.textContent=Y;for(let S=0;S<he.length;S+=1)he[S].c();X=A(),oe=d("div"),ie=d("label"),ie.textContent=fe,ee=A(),H=d("input"),L=A(),x=d("div"),q=d("button"),pe&&pe.c(),ae=F(`
						Assign Role`),te=A(),le=d("div"),K=d("div"),B=d("select"),ue=d("option"),ue.textContent=me;for(let S=0;S<Ee.length;S+=1)Ee[S].c();W=A(),ke=d("div"),ge=d("div"),Te=F("Showing "),ze=F(we),Re=F(" active role"),Me=F(Se),Be=A(),De.c(),this.h()},l(S){e=f(S,"DIV",{class:!0});var se=b(e);t=f(se,"DIV",{class:!0});var M=b(t);l=f(M,"H2",{"data-svelte-h":!0}),re(l)!=="svelte-1xkrq8g"&&(l.textContent=r),o=N(M),h=f(M,"BUTTON",{class:!0});var Ce=b(h);c=f(Ce,"I",{class:!0}),b(c).forEach(i),u=j(Ce," Refresh"),Ce.forEach(i),M.forEach(i),_=N(se),ve&&ve.l(se),p=N(se),m=f(se,"DIV",{class:!0});var Ze=b(m);E=f(Ze,"DIV",{class:!0,"data-svelte-h":!0}),re(E)!=="svelte-1dkbtll"&&(E.innerHTML=P),D=N(Ze),V=f(Ze,"DIV",{class:!0});var bt=b(V);g=f(bt,"DIV",{class:!0});var Ve=b(g);k=f(Ve,"DIV",{class:!0});var xe=b(k);R=f(xe,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),re(R)!=="svelte-1s8xk4p"&&(R.textContent=O),v=N(xe),C=f(xe,"SELECT",{id:!0,class:!0});var it=b(C);y=f(it,"OPTION",{"data-svelte-h":!0}),re(y)!=="svelte-kua526"&&(y.textContent=T);for(let ye=0;ye<de.length;ye+=1)de[ye].l(it);it.forEach(i),xe.forEach(i),w=N(Ve),U=f(Ve,"DIV",{class:!0});var $e=b(U);z=f($e,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),re(z)!=="svelte-rwhvvv"&&(z.textContent=Q),$=N($e),I=f($e,"SELECT",{id:!0,class:!0});var ct=b(I);Z=f(ct,"OPTION",{"data-svelte-h":!0}),re(Z)!=="svelte-1fatopy"&&(Z.textContent=Y);for(let ye=0;ye<he.length;ye+=1)he[ye].l(ct);ct.forEach(i),$e.forEach(i),X=N(Ve),oe=f(Ve,"DIV",{class:!0});var et=b(oe);ie=f(et,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),re(ie)!=="svelte-vpme2u"&&(ie.textContent=fe),ee=N(et),H=f(et,"INPUT",{id:!0,type:!0,class:!0,placeholder:!0}),et.forEach(i),L=N(Ve),x=f(Ve,"DIV",{class:!0});var gt=b(x);q=f(gt,"BUTTON",{class:!0});var ut=b(q);pe&&pe.l(ut),ae=j(ut,`
						Assign Role`),ut.forEach(i),gt.forEach(i),Ve.forEach(i),bt.forEach(i),Ze.forEach(i),te=N(se),le=f(se,"DIV",{class:!0});var tt=b(le);K=f(tt,"DIV",{class:!0});var Et=b(K);B=f(Et,"SELECT",{class:!0});var ft=b(B);ue=f(ft,"OPTION",{"data-svelte-h":!0}),re(ue)!=="svelte-1vw7buo"&&(ue.textContent=me);for(let ye=0;ye<Ee.length;ye+=1)Ee[ye].l(ft);ft.forEach(i),Et.forEach(i),W=N(tt),ke=f(tt,"DIV",{class:!0});var kt=b(ke);ge=f(kt,"DIV",{class:!0});var Xe=b(ge);Te=j(Xe,"Showing "),ze=j(Xe,we),Re=j(Xe," active role"),Me=j(Xe,Se),Xe.forEach(i),kt.forEach(i),tt.forEach(i),Be=N(se),De.l(se),se.forEach(i),this.h()},h(){a(c,"class","bi bi-arrow-clockwise"),a(h,"class","btn btn-primary"),h.disabled=s[3],a(t,"class","d-flex justify-content-between align-items-center mb-4"),a(E,"class","card-header svelte-1h4f1is"),a(R,"for","user-select"),a(R,"class","form-label"),y.__value=null,_e(y,y.__value),a(C,"id","user-select"),a(C,"class","form-select"),C.disabled=s[3],s[5]===void 0&&dt(()=>s[18].call(C)),a(k,"class","col-md-4"),a(z,"for","role-select"),a(z,"class","form-label"),Z.__value="",_e(Z,Z.__value),a(I,"id","role-select"),a(I,"class","form-select"),I.disabled=s[3],s[6]===void 0&&dt(()=>s[19].call(I)),a(U,"class","col-md-4"),a(ie,"for","notes-input"),a(ie,"class","form-label"),a(H,"id","notes-input"),a(H,"type","text"),a(H,"class","form-control"),a(H,"placeholder","Assignment notes..."),H.disabled=s[3],a(oe,"class","col-md-4"),a(q,"class","btn btn-success"),q.disabled=J=s[3]||!s[5]||!s[6],a(x,"class","col-12"),a(g,"class","row g-3"),a(V,"class","card-body"),a(m,"class","card mb-4"),ue.__value="all",_e(ue,ue.__value),a(B,"class","form-select"),s[1]===void 0&&dt(()=>s[21].call(B)),a(K,"class","col-md-4"),a(ge,"class","text-muted mt-2"),a(ke,"class","col-md-8"),a(le,"class","row mb-3"),a(e,"class","role-assignment svelte-1h4f1is")},m(S,se){G(S,e,se),n(e,t),n(t,l),n(t,o),n(t,h),n(h,c),n(h,u),n(e,_),ve&&ve.m(e,null),n(e,p),n(e,m),n(m,E),n(m,D),n(m,V),n(V,g),n(g,k),n(k,R),n(k,v),n(k,C),n(C,y);for(let M=0;M<de.length;M+=1)de[M]&&de[M].m(C,null);Fe(C,s[5],!0),n(g,w),n(g,U),n(U,z),n(U,$),n(U,I),n(I,Z);for(let M=0;M<he.length;M+=1)he[M]&&he[M].m(I,null);Fe(I,s[6],!0),n(g,X),n(g,oe),n(oe,ie),n(oe,ee),n(oe,H),_e(H,s[7]),n(g,L),n(g,x),n(x,q),pe&&pe.m(q,null),n(q,ae),n(e,te),n(e,le),n(le,K),n(K,B),n(B,ue);for(let M=0;M<Ee.length;M+=1)Ee[M]&&Ee[M].m(B,null);Fe(B,s[1],!0),n(le,W),n(le,ke),n(ke,ge),n(ge,Te),n(ge,ze),n(ge,Re),n(ge,Me),n(e,Be),De.m(e,null),He||(Je=[ce(h,"click",s[13]),ce(C,"change",s[18]),ce(I,"change",s[19]),ce(H,"input",s[20]),ce(q,"click",s[14]),ce(B,"change",s[21])],He=!0)},p(S,se){if(se[0]&8&&(h.disabled=S[3]),S[4]?ve?ve.p(S,se):(ve=Ot(S),ve.c(),ve.m(e,p)):ve&&(ve.d(1),ve=null),se[0]&1024){Oe=be(S[10]);let M;for(M=0;M<Oe.length;M+=1){const Ce=It(S,Oe,M);de[M]?de[M].p(Ce,se):(de[M]=Lt(Ce),de[M].c(),de[M].m(C,null))}for(;M<de.length;M+=1)de[M].d(1);de.length=Oe.length}if(se[0]&8&&(C.disabled=S[3]),se[0]&1056&&Fe(C,S[5]),se[0]&260){Le=be(S[8]);let M;for(M=0;M<Le.length;M+=1){const Ce=Dt(S,Le,M);he[M]?he[M].p(Ce,se):(he[M]=At(Ce),he[M].c(),he[M].m(I,null))}for(;M<he.length;M+=1)he[M].d(1);he.length=Le.length}if(se[0]&8&&(I.disabled=S[3]),se[0]&324&&Fe(I,S[6]),se[0]&8&&(H.disabled=S[3]),se[0]&128&&H.value!==S[7]&&_e(H,S[7]),S[3]?pe||(pe=Rt(),pe.c(),pe.m(q,ae)):pe&&(pe.d(1),pe=null),se[0]&1388&&J!==(J=S[3]||!S[5]||!S[6])&&(q.disabled=J),se&0){je=be(Object.values(Tt));let M;for(M=0;M<je.length;M+=1){const Ce=wt(S,je,M);Ee[M]?Ee[M].p(Ce,se):(Ee[M]=St(Ce),Ee[M].c(),Ee[M].m(B,null))}for(;M<Ee.length;M+=1)Ee[M].d(1);Ee.length=je.length}se[0]&2&&Fe(B,S[1]),se[0]&512&&we!==(we=S[9].length+"")&&ne(ze,we),se[0]&512&&Se!==(Se=S[9].length!==1?"s":"")&&ne(Me,Se),We===(We=pt(S))&&De?De.p(S,se):(De.d(1),De=We(S),De&&(De.c(),De.m(e,null)))},i:Ie,o:Ie,d(S){S&&i(e),ve&&ve.d(),Ae(de,S),Ae(he,S),pe&&pe.d(),Ae(Ee,S),De.d(),He=!1,Ye(Je)}}}function mt(s){return s.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function st(s){return s?s.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"Unknown"}function Il(s,e,t){let l,r,o,h,c,u;const{stores:_,actions:p}=cl,{users:m}=_;Ne(s,m,I=>t(10,u=I));const{stores:{currentUser:E}}=Zt();Ne(s,E,I=>t(23,c=I));let P=[],D=!1,V=null,g=null,k="",R="",O="all";vt(async()=>{await p.fetchUsers(),await v()});async function v(){t(3,D=!0),t(4,V=null);try{const I=await tl();t(0,P=I.map(Z=>{const Y=u.find(oe=>oe.id===Z.user_id),X=Z.roles;return{...Z,user:Y,roleName:X?.name||String(Z.role_id),roleOrganization:X?.organization}}))}catch(I){t(4,V=I instanceof Error?I.message:"Failed to load roles")}finally{t(3,D=!1)}}async function C(){if(!g||!k){t(4,V="Please select both a user and a role");return}if(!c?.id){t(4,V="Unable to determine current user. Please refresh and try again.");return}t(3,D=!0),t(4,V=null);try{const I=await rl(g,k,c.id,R||void 0);I.success?(t(5,g=null),t(6,k=""),t(7,R=""),await v()):t(4,V=I.error||"Failed to assign role")}catch(I){t(4,V=I instanceof Error?I.message:"Failed to assign role")}finally{t(3,D=!1)}}async function y(I){if(confirm("Are you sure you want to release this role?")){t(3,D=!0),t(4,V=null);try{const Z=await nl(I);Z.success?await v():t(4,V=Z.error||"Failed to release role")}catch(Z){t(4,V=Z instanceof Error?Z.message:"Failed to release role")}finally{t(3,D=!1)}}}const T=()=>t(4,V=null);function w(){g=ht(this),t(5,g)}function U(){k=ht(this),t(6,k),t(2,o),t(16,r),t(8,h),t(2,o),t(16,r)}function z(){R=this.value,t(7,R)}function Q(){O=ht(this),t(1,O)}const $=I=>y(I.id);return s.$$.update=()=>{s.$$.dirty[0]&3&&t(9,l=P.filter(I=>O==="all"?!0:I.roleOrganization===O)),s.$$.dirty[0]&65536&&t(2,o=r.reduce((I,Z)=>{const Y=ll(Z);if(Y){const X=Y.organization;I[X]||(I[X]=[]),I[X].push(Y)}return I},{})),s.$$.dirty[0]&4&&t(8,h=Object.keys(o))},t(16,r=sl()),[P,O,o,D,V,g,k,R,h,l,u,m,E,v,C,y,r,T,w,U,z,Q,$]}class Ol extends ot{constructor(e){super(),at(this,e,Il,yl,rt,{},null,[-1,-1])}}function Ut(s){let e,t;return{c(){e=d("div"),t=F(s[6]),this.h()},l(l){e=f(l,"DIV",{class:!0,role:!0});var r=b(e);t=j(r,s[6]),r.forEach(i),this.h()},h(){a(e,"class","alert alert-danger"),a(e,"role","alert")},m(l,r){G(l,e,r),n(e,t)},p(l,r){r&64&&ne(t,l[6])},d(l){l&&i(e)}}}function zt(s){let e,t="Key cannot be changed after creation";return{c(){e=d("div"),e.textContent=t,this.h()},l(l){e=f(l,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-1k89ihx"&&(e.textContent=t),this.h()},h(){a(e,"class","form-text")},m(l,r){G(l,e,r)},d(l){l&&i(e)}}}function Mt(s){let e;return{c(){e=d("span"),this.h()},l(t){e=f(t,"SPAN",{class:!0,role:!0}),b(e).forEach(i),this.h()},h(){a(e,"class","spinner-border spinner-border-sm me-2"),a(e,"role","status")},m(t,l){G(t,e,l)},d(t){t&&i(e)}}}function Ll(s){let e,t,l,r,o='Key <span class="text-danger">*</span>',h,c,u,_,p,m,E='Name <span class="text-danger">*</span>',P,D,V,g,k,R="Organization",O,v,C,y,T="Used for grouping roles",w,U,z,Q="Description",$,I,Z,Y,X,oe,ie=s[7]?"Update":"Create",fe,ee,H,L,x,q,ae,J=s[6]&&Ut(s),te=s[7]&&zt(),le=s[5]&&Mt();return{c(){e=d("form"),J&&J.c(),t=A(),l=d("div"),r=d("label"),r.innerHTML=o,h=A(),c=d("input"),u=A(),te&&te.c(),_=A(),p=d("div"),m=d("label"),m.innerHTML=E,P=A(),D=d("input"),V=A(),g=d("div"),k=d("label"),k.textContent=R,O=A(),v=d("input"),C=A(),y=d("div"),y.textContent=T,w=A(),U=d("div"),z=d("label"),z.textContent=Q,$=A(),I=d("textarea"),Z=A(),Y=d("div"),X=d("button"),le&&le.c(),oe=A(),fe=F(ie),ee=F(" Role"),H=A(),L=d("button"),x=F("Cancel"),this.h()},l(K){e=f(K,"FORM",{});var B=b(e);J&&J.l(B),t=N(B),l=f(B,"DIV",{class:!0});var ue=b(l);r=f(ue,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),re(r)!=="svelte-136wa73"&&(r.innerHTML=o),h=N(ue),c=f(ue,"INPUT",{type:!0,class:!0,id:!0,placeholder:!0}),u=N(ue),te&&te.l(ue),ue.forEach(i),_=N(B),p=f(B,"DIV",{class:!0});var me=b(p);m=f(me,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),re(m)!=="svelte-kgvawd"&&(m.innerHTML=E),P=N(me),D=f(me,"INPUT",{type:!0,class:!0,id:!0,placeholder:!0}),me.forEach(i),V=N(B),g=f(B,"DIV",{class:!0});var W=b(g);k=f(W,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),re(k)!=="svelte-hzptp9"&&(k.textContent=R),O=N(W),v=f(W,"INPUT",{type:!0,class:!0,id:!0,placeholder:!0}),C=N(W),y=f(W,"DIV",{class:!0,"data-svelte-h":!0}),re(y)!=="svelte-a7bjz3"&&(y.textContent=T),W.forEach(i),w=N(B),U=f(B,"DIV",{class:!0});var ke=b(U);z=f(ke,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),re(z)!=="svelte-1wym8yn"&&(z.textContent=Q),$=N(ke),I=f(ke,"TEXTAREA",{class:!0,id:!0,rows:!0,placeholder:!0}),b(I).forEach(i),ke.forEach(i),Z=N(B),Y=f(B,"DIV",{class:!0});var ge=b(Y);X=f(ge,"BUTTON",{type:!0,class:!0});var Te=b(X);le&&le.l(Te),oe=N(Te),fe=j(Te,ie),ee=j(Te," Role"),Te.forEach(i),H=N(ge),L=f(ge,"BUTTON",{type:!0,class:!0,"data-bs-dismiss":!0});var we=b(L);x=j(we,"Cancel"),we.forEach(i),ge.forEach(i),B.forEach(i),this.h()},h(){a(r,"for","role-key"),a(r,"class","form-label"),a(c,"type","text"),a(c,"class","form-control"),a(c,"id","role-key"),c.required=!0,c.disabled=s[7],a(c,"placeholder","e.g., primary-president"),a(l,"class","mb-3"),a(m,"for","role-name"),a(m,"class","form-label"),a(D,"type","text"),a(D,"class","form-control"),a(D,"id","role-name"),D.required=!0,a(D,"placeholder","e.g., Primary President"),a(p,"class","mb-3"),a(k,"for","role-organization"),a(k,"class","form-label"),a(v,"type","text"),a(v,"class","form-control"),a(v,"id","role-organization"),a(v,"placeholder","e.g., primary, bishopric, relief-society"),a(y,"class","form-text"),a(g,"class","mb-3"),a(z,"for","role-description"),a(z,"class","form-label"),a(I,"class","form-control"),a(I,"id","role-description"),a(I,"rows","3"),a(I,"placeholder","Describe this role..."),a(U,"class","mb-3"),a(X,"type","submit"),a(X,"class","btn btn-primary"),X.disabled=s[5],a(L,"type","button"),a(L,"class","btn btn-secondary"),a(L,"data-bs-dismiss","offcanvas"),L.disabled=s[5],a(Y,"class","d-flex gap-2")},m(K,B){G(K,e,B),J&&J.m(e,null),n(e,t),n(e,l),n(l,r),n(l,h),n(l,c),_e(c,s[1]),n(l,u),te&&te.m(l,null),n(e,_),n(e,p),n(p,m),n(p,P),n(p,D),_e(D,s[2]),n(e,V),n(e,g),n(g,k),n(g,O),n(g,v),_e(v,s[3]),n(g,C),n(g,y),n(e,w),n(e,U),n(U,z),n(U,$),n(U,I),_e(I,s[4]),n(e,Z),n(e,Y),n(Y,X),le&&le.m(X,null),n(X,oe),n(X,fe),n(X,ee),n(Y,H),n(Y,L),n(L,x),q||(ae=[ce(c,"input",s[11]),ce(D,"input",s[12]),ce(v,"input",s[13]),ce(I,"input",s[14]),ce(e,"submit",s[8])],q=!0)},p(K,B){K[6]?J?J.p(K,B):(J=Ut(K),J.c(),J.m(e,t)):J&&(J.d(1),J=null),B&128&&(c.disabled=K[7]),B&2&&c.value!==K[1]&&_e(c,K[1]),K[7]?te||(te=zt(),te.c(),te.m(l,null)):te&&(te.d(1),te=null),B&4&&D.value!==K[2]&&_e(D,K[2]),B&8&&v.value!==K[3]&&_e(v,K[3]),B&16&&_e(I,K[4]),K[5]?le||(le=Mt(),le.c(),le.m(X,oe)):le&&(le.d(1),le=null),B&128&&ie!==(ie=K[7]?"Update":"Create")&&ne(fe,ie),B&32&&(X.disabled=K[5]),B&32&&(L.disabled=K[5])},d(K){K&&i(e),J&&J.d(),te&&te.d(),le&&le.d(),q=!1,Ye(ae)}}}function Nl(s){let e,t;return e=new xt({props:{title:s[7]?"Edit Role":"Create Role",id:s[0],$$slots:{default:[Ll]},$$scope:{ctx:s}}}),{c(){Qe(e.$$.fragment)},l(l){Ke(e.$$.fragment,l)},m(l,r){Ge(e,l,r),t=!0},p(l,[r]){const o={};r&128&&(o.title=l[7]?"Edit Role":"Create Role"),r&1&&(o.id=l[0]),r&131326&&(o.$$scope={dirty:r,ctx:l}),e.$set(o)},i(l){t||(Ue(e.$$.fragment,l),t=!0)},o(l){Pe(e.$$.fragment,l),t=!1},d(l){qe(e,l)}}}function Al(s,e,t){let l,{id:r="role-form-drawer"}=e,{role:o=null}=e,{onSave:h=null}=e,c="",u="",_="",p="",m=!1,E="";async function P(v){v.preventDefault(),t(5,m=!0),t(6,E="");try{l&&o?await ul(o.id,{name:u,organization:_||null,description:p||null}):await fl({key:c,name:u,organization:_||null,description:p||null});const C=document.getElementById(r);if(C){const T=window.bootstrap?.Offcanvas?.getInstance(C);T&&T.hide()}D(),h&&h()}catch(C){t(6,E=C instanceof Error?C.message:"Failed to save role")}finally{t(5,m=!1)}}function D(){t(1,c=""),t(2,u=""),t(3,_=""),t(4,p=""),t(6,E="")}function V(){D()}vt(()=>{const v=document.getElementById(r);if(v)return v.addEventListener("hidden.bs.offcanvas",V),()=>{v.removeEventListener("hidden.bs.offcanvas",V)}});function g(){c=this.value,t(1,c),t(9,o)}function k(){u=this.value,t(2,u),t(9,o)}function R(){_=this.value,t(3,_),t(9,o)}function O(){p=this.value,t(4,p),t(9,o)}return s.$$set=v=>{"id"in v&&t(0,r=v.id),"role"in v&&t(9,o=v.role),"onSave"in v&&t(10,h=v.onSave)},s.$$.update=()=>{s.$$.dirty&512&&t(7,l=o!==null),s.$$.dirty&512&&o&&(t(1,c=o.key),t(2,u=o.name),t(3,_=o.organization||""),t(4,p=o.description||""))},[r,c,u,_,p,m,E,l,P,o,h,g,k,R,O]}class Rl extends ot{constructor(e){super(),at(this,e,Al,Nl,rt,{id:0,role:9,onSave:10})}}function Bt(s,e,t){const l=s.slice();return l[17]=e[t][0],l[18]=e[t][1],l}function Ht(s,e,t){const l=s.slice();return l[21]=e[t],l}function jt(s){let e,t;return{c(){e=d("div"),t=F(s[4]),this.h()},l(l){e=f(l,"DIV",{class:!0,role:!0});var r=b(e);t=j(r,s[4]),r.forEach(i),this.h()},h(){a(e,"class","alert alert-danger"),a(e,"role","alert")},m(l,r){G(l,e,r),n(e,t)},p(l,r){r&16&&ne(t,l[4])},d(l){l&&i(e)}}}function Sl(s){let e,t="Please select a role to manage permissions.";return{c(){e=d("div"),e.textContent=t,this.h()},l(l){e=f(l,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-d823lb"&&(e.textContent=t),this.h()},h(){a(e,"class","alert alert-info")},m(l,r){G(l,e,r)},p:Ie,d(l){l&&i(e)}}}function Vl(s){let e,t,l,r,o="Role:",h,c=s[1].name+"",u,_,p,m,E="Select All",P,D,V="Deselect All",g,k,R=s[2].size+"",O,v,C=s[5].length+"",y,T,w,U,z,Q,$,I,Z,Y,X,oe,ie,fe=be(Object.entries(s[6])),ee=[];for(let L=0;L<fe.length;L+=1)ee[L]=Gt(Bt(s,fe,L));let H=s[3]&&Kt();return{c(){e=d("div"),t=d("div"),l=d("div"),r=d("strong"),r.textContent=o,h=A(),u=F(c),_=A(),p=d("div"),m=d("button"),m.textContent=E,P=A(),D=d("button"),D.textContent=V,g=A(),k=d("div"),O=F(R),v=F(" of "),y=F(C),T=F(" permissions selected"),w=A(),U=d("div");for(let L=0;L<ee.length;L+=1)ee[L].c();z=A(),Q=d("div"),$=d("button"),H&&H.c(),I=F(`
					Save Permissions`),Z=A(),Y=d("button"),X=F("Cancel"),this.h()},l(L){e=f(L,"DIV",{class:!0});var x=b(e);t=f(x,"DIV",{class:!0});var q=b(t);l=f(q,"DIV",{});var ae=b(l);r=f(ae,"STRONG",{"data-svelte-h":!0}),re(r)!=="svelte-4i7x80"&&(r.textContent=o),h=N(ae),u=j(ae,c),ae.forEach(i),_=N(q),p=f(q,"DIV",{});var J=b(p);m=f(J,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),re(m)!=="svelte-grzpeo"&&(m.textContent=E),P=N(J),D=f(J,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),re(D)!=="svelte-18kd0i8"&&(D.textContent=V),J.forEach(i),q.forEach(i),g=N(x),k=f(x,"DIV",{class:!0});var te=b(k);O=j(te,R),v=j(te," of "),y=j(te,C),T=j(te," permissions selected"),te.forEach(i),x.forEach(i),w=N(L),U=f(L,"DIV",{class:!0});var le=b(U);for(let me=0;me<ee.length;me+=1)ee[me].l(le);le.forEach(i),z=N(L),Q=f(L,"DIV",{class:!0});var K=b(Q);$=f(K,"BUTTON",{type:!0,class:!0});var B=b($);H&&H.l(B),I=j(B,`
					Save Permissions`),B.forEach(i),Z=N(K),Y=f(K,"BUTTON",{type:!0,class:!0,"data-bs-dismiss":!0});var ue=b(Y);X=j(ue,"Cancel"),ue.forEach(i),K.forEach(i),this.h()},h(){a(m,"type","button"),a(m,"class","btn btn-sm btn-outline-primary me-1"),a(D,"type","button"),a(D,"class","btn btn-sm btn-outline-secondary"),a(t,"class","d-flex justify-content-between align-items-center mb-2"),a(k,"class","text-muted small"),a(e,"class","mb-3"),a(U,"class","mb-3"),a($,"type","submit"),a($,"class","btn btn-primary"),$.disabled=s[3],a(Y,"type","button"),a(Y,"class","btn btn-secondary"),a(Y,"data-bs-dismiss","offcanvas"),Y.disabled=s[3],a(Q,"class","d-flex gap-2 sticky-bottom bg-body pt-3 border-top svelte-nth4dh")},m(L,x){G(L,e,x),n(e,t),n(t,l),n(l,r),n(l,h),n(l,u),n(t,_),n(t,p),n(p,m),n(p,P),n(p,D),n(e,g),n(e,k),n(k,O),n(k,v),n(k,y),n(k,T),G(L,w,x),G(L,U,x);for(let q=0;q<ee.length;q+=1)ee[q]&&ee[q].m(U,null);G(L,z,x),G(L,Q,x),n(Q,$),H&&H.m($,null),n($,I),n(Q,Z),n(Q,Y),n(Y,X),oe||(ie=[ce(m,"click",s[9]),ce(D,"click",s[10])],oe=!0)},p(L,x){if(x&2&&c!==(c=L[1].name+"")&&ne(u,c),x&4&&R!==(R=L[2].size+"")&&ne(O,R),x&32&&C!==(C=L[5].length+"")&&ne(y,C),x&324){fe=be(Object.entries(L[6]));let q;for(q=0;q<fe.length;q+=1){const ae=Bt(L,fe,q);ee[q]?ee[q].p(ae,x):(ee[q]=Gt(ae),ee[q].c(),ee[q].m(U,null))}for(;q<ee.length;q+=1)ee[q].d(1);ee.length=fe.length}L[3]?H||(H=Kt(),H.c(),H.m($,I)):H&&(H.d(1),H=null),x&8&&($.disabled=L[3]),x&8&&(Y.disabled=L[3])},d(L){L&&(i(e),i(w),i(U),i(z),i(Q)),Ae(ee,L),H&&H.d(),oe=!1,Ye(ie)}}}function Ft(s){let e,t=s[21].description+"",l;return{c(){e=d("div"),l=F(t),this.h()},l(r){e=f(r,"DIV",{class:!0});var o=b(e);l=j(o,t),o.forEach(i),this.h()},h(){a(e,"class","text-muted small")},m(r,o){G(r,e,o),n(e,l)},p(r,o){o&64&&t!==(t=r[21].description+"")&&ne(l,t)},d(r){r&&i(e)}}}function qt(s){let e,t,l,r,o,h,c,u,_=s[21].name+"",p,m,E,P,D=s[21].key+"",V,g,k,R,O,v;function C(){return s[13](s[21])}let y=s[21].description&&Ft(s);return{c(){e=d("div"),t=d("input"),o=A(),h=d("label"),c=d("div"),u=d("strong"),p=F(_),m=A(),E=d("span"),P=F("("),V=F(D),g=F(")"),k=A(),y&&y.c(),this.h()},l(T){e=f(T,"DIV",{class:!0});var w=b(e);t=f(w,"INPUT",{class:!0,type:!0,id:!0}),o=N(w),h=f(w,"LABEL",{class:!0,for:!0});var U=b(h);c=f(U,"DIV",{});var z=b(c);u=f(z,"STRONG",{});var Q=b(u);p=j(Q,_),Q.forEach(i),m=N(z),E=f(z,"SPAN",{class:!0});var $=b(E);P=j($,"("),V=j($,D),g=j($,")"),$.forEach(i),z.forEach(i),k=N(U),y&&y.l(U),U.forEach(i),w.forEach(i),this.h()},h(){a(t,"class","form-check-input"),a(t,"type","checkbox"),a(t,"id",l="permission-"+s[21].id),t.checked=r=s[2].has(s[21].id),a(E,"class","text-muted small"),a(h,"class","form-check-label"),a(h,"for",R="permission-"+s[21].id),a(e,"class","form-check mb-2")},m(T,w){G(T,e,w),n(e,t),n(e,o),n(e,h),n(h,c),n(c,u),n(u,p),n(c,m),n(c,E),n(E,P),n(E,V),n(E,g),n(h,k),y&&y.m(h,null),O||(v=ce(t,"change",C),O=!0)},p(T,w){s=T,w&64&&l!==(l="permission-"+s[21].id)&&a(t,"id",l),w&68&&r!==(r=s[2].has(s[21].id))&&(t.checked=r),w&64&&_!==(_=s[21].name+"")&&ne(p,_),w&64&&D!==(D=s[21].key+"")&&ne(V,D),s[21].description?y?y.p(s,w):(y=Ft(s),y.c(),y.m(h,null)):y&&(y.d(1),y=null),w&64&&R!==(R="permission-"+s[21].id)&&a(h,"for",R)},d(T){T&&i(e),y&&y.d(),O=!1,v()}}}function Gt(s){let e,t,l=s[17]+"",r,o,h,c=be(s[18]),u=[];for(let _=0;_<c.length;_+=1)u[_]=qt(Ht(s,c,_));return{c(){e=d("div"),t=d("h6"),r=F(l),o=A();for(let _=0;_<u.length;_+=1)u[_].c();h=A(),this.h()},l(_){e=f(_,"DIV",{class:!0});var p=b(e);t=f(p,"H6",{class:!0});var m=b(t);r=j(m,l),m.forEach(i),o=N(p);for(let E=0;E<u.length;E+=1)u[E].l(p);h=N(p),p.forEach(i),this.h()},h(){a(t,"class","text-uppercase text-muted small mb-2"),a(e,"class","mb-3")},m(_,p){G(_,e,p),n(e,t),n(t,r),n(e,o);for(let m=0;m<u.length;m+=1)u[m]&&u[m].m(e,null);n(e,h)},p(_,p){if(p&64&&l!==(l=_[17]+"")&&ne(r,l),p&324){c=be(_[18]);let m;for(m=0;m<c.length;m+=1){const E=Ht(_,c,m);u[m]?u[m].p(E,p):(u[m]=qt(E),u[m].c(),u[m].m(e,h))}for(;m<u.length;m+=1)u[m].d(1);u.length=c.length}},d(_){_&&i(e),Ae(u,_)}}}function Kt(s){let e;return{c(){e=d("span"),this.h()},l(t){e=f(t,"SPAN",{class:!0,role:!0}),b(e).forEach(i),this.h()},h(){a(e,"class","spinner-border spinner-border-sm me-2"),a(e,"role","status")},m(t,l){G(t,e,l)},d(t){t&&i(e)}}}function Pl(s){let e,t,l,r,o=s[4]&&jt(s);function h(_,p){return _[1]?Vl:Sl}let c=h(s),u=c(s);return{c(){e=d("form"),o&&o.c(),t=A(),u.c()},l(_){e=f(_,"FORM",{});var p=b(e);o&&o.l(p),t=N(p),u.l(p),p.forEach(i)},m(_,p){G(_,e,p),o&&o.m(e,null),n(e,t),u.m(e,null),l||(r=ce(e,"submit",s[11]),l=!0)},p(_,p){_[4]?o?o.p(_,p):(o=jt(_),o.c(),o.m(e,t)):o&&(o.d(1),o=null),c===(c=h(_))&&u?u.p(_,p):(u.d(1),u=c(_),u&&(u.c(),u.m(e,null)))},d(_){_&&i(e),o&&o.d(),u.d(),l=!1,r()}}}function Ul(s){let e,t;return e=new xt({props:{title:s[1]?`Manage Permissions: ${s[1].name}`:"Manage Permissions",id:s[0],$$slots:{default:[Pl]},$$scope:{ctx:s}}}),{c(){Qe(e.$$.fragment)},l(l){Ke(e.$$.fragment,l)},m(l,r){Ge(e,l,r),t=!0},p(l,[r]){const o={};r&2&&(o.title=l[1]?`Manage Permissions: ${l[1].name}`:"Manage Permissions"),r&1&&(o.id=l[0]),r&16777342&&(o.$$scope={dirty:r,ctx:l}),e.$set(o)},i(l){t||(Ue(e.$$.fragment,l),t=!0)},o(l){Pe(e.$$.fragment,l),t=!1},d(l){qe(e,l)}}}function zl(s,e,t){let l,r,o;Ne(s,hl,v=>t(5,r=v)),Ne(s,_l,v=>t(6,o=v));let{id:h="role-permissions-drawer"}=e,{role:c=null}=e,{onSave:u=null}=e;const _=Zt(),{currentUser:p}=_.stores;Ne(s,p,v=>t(14,l=v));const{loadUserPermissions:m}=_.actions;let E=new Set,P=!1,D="";function V(v){E.has(v)?E.delete(v):E.add(v),t(2,E=new Set(E))}function g(){t(2,E=new Set(r.map(v=>v.id)))}function k(){t(2,E=new Set)}async function R(v){if(v.preventDefault(),!!c){t(3,P=!0),t(4,D="");try{if(await dl(c.id,Array.from(E)),l?.roles?.includes(c.key)&&l.id)try{await m(l.id),console.log("[RolePermissions] Reloaded permissions for current user"),window.location.reload();return}catch(y){console.error("[RolePermissions] Failed to reload user permissions:",y)}const C=document.getElementById(h);if(C){const T=window.bootstrap?.Offcanvas?.getInstance(C);T&&T.hide()}u&&u()}catch(C){t(4,D=C instanceof Error?C.message:"Failed to assign permissions")}finally{t(3,P=!1)}}}const O=v=>V(v.id);return s.$$set=v=>{"id"in v&&t(0,h=v.id),"role"in v&&t(1,c=v.role),"onSave"in v&&t(12,u=v.onSave)},s.$$.update=()=>{s.$$.dirty&2&&c&&t(2,E=new Set(c.permissions.map(v=>v.id)))},[h,c,E,P,D,r,o,p,V,g,k,R,u,O]}class Ml extends ot{constructor(e){super(),at(this,e,zl,Ul,rt,{id:0,role:1,onSave:12})}}function Qt(s,e,t){const l=s.slice();return l[21]=e[t][0],l[22]=e[t][1],l}function Yt(s,e,t){const l=s.slice();return l[25]=e[t],l}function Bl(s){let e,t,l="Role Definitions",r,o,h=`<i class="bi bi-plus-lg me-1"></i>
					Create Role`,c,u,_,p,m,E,P,D,V,g=s[5]&&Jt(s);function k(v,C){return v[6]?ql:v[7].length===0?Fl:jl}let R=k(s),O=R(s);return{c(){e=d("div"),t=d("h2"),t.textContent=l,r=A(),o=d("button"),o.innerHTML=h,c=A(),g&&g.c(),u=A(),_=d("div"),p=d("div"),m=d("input"),E=A(),O.c(),P=nt(),this.h()},l(v){e=f(v,"DIV",{class:!0});var C=b(e);t=f(C,"H2",{"data-svelte-h":!0}),re(t)!=="svelte-104zljo"&&(t.textContent=l),r=N(C),o=f(C,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),re(o)!=="svelte-gydj2j"&&(o.innerHTML=h),C.forEach(i),c=N(v),g&&g.l(v),u=N(v),_=f(v,"DIV",{class:!0});var y=b(_);p=f(y,"DIV",{class:!0});var T=b(p);m=f(T,"INPUT",{type:!0,class:!0,placeholder:!0}),T.forEach(i),y.forEach(i),E=N(v),O.l(v),P=nt(),this.h()},h(){a(o,"type","button"),a(o,"class","btn btn-primary"),a(e,"class","d-flex justify-content-between align-items-center mb-4"),a(m,"type","text"),a(m,"class","form-control"),a(m,"placeholder","Search roles..."),a(p,"class","card-body"),a(_,"class","card mb-4")},m(v,C){G(v,e,C),n(e,t),n(e,r),n(e,o),G(v,c,C),g&&g.m(v,C),G(v,u,C),G(v,_,C),n(_,p),n(p,m),_e(m,s[0]),G(v,E,C),O.m(v,C),G(v,P,C),D||(V=[ce(o,"click",s[8]),ce(m,"input",s[15])],D=!0)},p(v,C){v[5]?g?g.p(v,C):(g=Jt(v),g.c(),g.m(u.parentNode,u)):g&&(g.d(1),g=null),C&1&&m.value!==v[0]&&_e(m,v[0]),R===(R=k(v))&&O?O.p(v,C):(O.d(1),O=R(v),O&&(O.c(),O.m(P.parentNode,P)))},i:Ie,o:Ie,d(v){v&&(i(e),i(c),i(u),i(_),i(E),i(P)),g&&g.d(v),O.d(v),D=!1,Ye(V)}}}function Hl(s){let e,t;return e=new Ol({}),{c(){Qe(e.$$.fragment)},l(l){Ke(e.$$.fragment,l)},m(l,r){Ge(e,l,r),t=!0},p:Ie,i(l){t||(Ue(e.$$.fragment,l),t=!0)},o(l){Pe(e.$$.fragment,l),t=!1},d(l){qe(e,l)}}}function Jt(s){let e,t,l,r;return{c(){e=d("div"),t=d("i"),l=A(),r=F(s[5]),this.h()},l(o){e=f(o,"DIV",{class:!0,role:!0});var h=b(e);t=f(h,"I",{class:!0}),b(t).forEach(i),l=N(h),r=j(h,s[5]),h.forEach(i),this.h()},h(){a(t,"class","bi bi-exclamation-triangle me-2"),a(e,"class","alert alert-danger"),a(e,"role","alert")},m(o,h){G(o,e,h),n(e,t),n(e,l),n(e,r)},p(o,h){h&32&&ne(r,o[5])},d(o){o&&i(e)}}}function jl(s){let e,t=be(s[4]),l=[];for(let r=0;r<t.length;r+=1)l[r]=Wt(Qt(s,t,r));return{c(){for(let r=0;r<l.length;r+=1)l[r].c();e=nt()},l(r){for(let o=0;o<l.length;o+=1)l[o].l(r);e=nt()},m(r,o){for(let h=0;h<l.length;h+=1)l[h]&&l[h].m(r,o);G(r,e,o)},p(r,o){if(o&3600){t=be(r[4]);let h;for(h=0;h<t.length;h+=1){const c=Qt(r,t,h);l[h]?l[h].p(c,o):(l[h]=Wt(c),l[h].c(),l[h].m(e.parentNode,e))}for(;h<l.length;h+=1)l[h].d(1);l.length=t.length}},d(r){r&&i(e),Ae(l,r)}}}function Fl(s){let e,t="No roles found. Create your first role to get started.";return{c(){e=d("div"),e.textContent=t,this.h()},l(l){e=f(l,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-1hcv02t"&&(e.textContent=t),this.h()},h(){a(e,"class","alert alert-info")},m(l,r){G(l,e,r)},p:Ie,d(l){l&&i(e)}}}function ql(s){let e,t='<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>';return{c(){e=d("div"),e.innerHTML=t,this.h()},l(l){e=f(l,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-1xj70p"&&(e.innerHTML=t),this.h()},h(){a(e,"class","d-flex justify-content-center align-items-center py-5")},m(l,r){G(l,e,r)},p:Ie,d(l){l&&i(e)}}}function Xt(s){let e,t,l,r=s[25].name+"",o,h,c,u,_=s[25].key+"",p,m,E,P=(s[25].description||"-")+"",D,V,g,k,R=s[25].permissions.length+"",O,v,C,y,T,w='<i class="bi bi-key"></i>',U,z,Q='<i class="bi bi-pencil"></i>',$,I,Z='<i class="bi bi-trash"></i>',Y,X,oe;function ie(){return s[16](s[25])}function fe(){return s[17](s[25])}function ee(){return s[18](s[25])}return{c(){e=d("tr"),t=d("td"),l=d("strong"),o=F(r),h=A(),c=d("td"),u=d("code"),p=F(_),m=A(),E=d("td"),D=F(P),V=A(),g=d("td"),k=d("span"),O=F(R),v=F(" permissions"),C=A(),y=d("td"),T=d("button"),T.innerHTML=w,U=A(),z=d("button"),z.innerHTML=Q,$=A(),I=d("button"),I.innerHTML=Z,Y=A(),this.h()},l(H){e=f(H,"TR",{});var L=b(e);t=f(L,"TD",{});var x=b(t);l=f(x,"STRONG",{});var q=b(l);o=j(q,r),q.forEach(i),x.forEach(i),h=N(L),c=f(L,"TD",{});var ae=b(c);u=f(ae,"CODE",{});var J=b(u);p=j(J,_),J.forEach(i),ae.forEach(i),m=N(L),E=f(L,"TD",{});var te=b(E);D=j(te,P),te.forEach(i),V=N(L),g=f(L,"TD",{});var le=b(g);k=f(le,"SPAN",{class:!0});var K=b(k);O=j(K,R),v=j(K," permissions"),K.forEach(i),le.forEach(i),C=N(L),y=f(L,"TD",{});var B=b(y);T=f(B,"BUTTON",{type:!0,class:!0,title:!0,"data-svelte-h":!0}),re(T)!=="svelte-1jg2ize"&&(T.innerHTML=w),U=N(B),z=f(B,"BUTTON",{type:!0,class:!0,title:!0,"data-svelte-h":!0}),re(z)!=="svelte-rmv7u4"&&(z.innerHTML=Q),$=N(B),I=f(B,"BUTTON",{type:!0,class:!0,title:!0,"data-svelte-h":!0}),re(I)!=="svelte-bhg5w1"&&(I.innerHTML=Z),B.forEach(i),Y=N(L),L.forEach(i),this.h()},h(){a(k,"class","badge bg-secondary"),a(T,"type","button"),a(T,"class","btn btn-sm btn-outline-success me-1"),a(T,"title","Manage Permissions"),a(z,"type","button"),a(z,"class","btn btn-sm btn-outline-primary me-1"),a(z,"title","Edit"),a(I,"type","button"),a(I,"class","btn btn-sm btn-outline-danger"),a(I,"title","Delete")},m(H,L){G(H,e,L),n(e,t),n(t,l),n(l,o),n(e,h),n(e,c),n(c,u),n(u,p),n(e,m),n(e,E),n(E,D),n(e,V),n(e,g),n(g,k),n(k,O),n(k,v),n(e,C),n(e,y),n(y,T),n(y,U),n(y,z),n(y,$),n(y,I),n(e,Y),X||(oe=[ce(T,"click",ie),ce(z,"click",fe),ce(I,"click",ee)],X=!0)},p(H,L){s=H,L&16&&r!==(r=s[25].name+"")&&ne(o,r),L&16&&_!==(_=s[25].key+"")&&ne(p,_),L&16&&P!==(P=(s[25].description||"-")+"")&&ne(D,P),L&16&&R!==(R=s[25].permissions.length+"")&&ne(O,R)},d(H){H&&i(e),X=!1,Ye(oe)}}}function Wt(s){let e,t,l,r=s[21]+"",o,h,c,u,_,p,m='<tr><th>Name</th> <th>Key</th> <th>Description</th> <th>Permissions</th> <th style="width: 200px;">Actions</th></tr>',E,P,D,V=be(s[22]),g=[];for(let k=0;k<V.length;k+=1)g[k]=Xt(Yt(s,V,k));return{c(){e=d("div"),t=d("div"),l=d("h5"),o=F(r),h=A(),c=d("div"),u=d("div"),_=d("table"),p=d("thead"),p.innerHTML=m,E=A(),P=d("tbody");for(let k=0;k<g.length;k+=1)g[k].c();D=A(),this.h()},l(k){e=f(k,"DIV",{class:!0});var R=b(e);t=f(R,"DIV",{class:!0});var O=b(t);l=f(O,"H5",{class:!0});var v=b(l);o=j(v,r),v.forEach(i),O.forEach(i),h=N(R),c=f(R,"DIV",{class:!0});var C=b(c);u=f(C,"DIV",{class:!0});var y=b(u);_=f(y,"TABLE",{class:!0});var T=b(_);p=f(T,"THEAD",{"data-svelte-h":!0}),re(p)!=="svelte-106iwxu"&&(p.innerHTML=m),E=N(T),P=f(T,"TBODY",{});var w=b(P);for(let U=0;U<g.length;U+=1)g[U].l(w);w.forEach(i),T.forEach(i),y.forEach(i),C.forEach(i),D=N(R),R.forEach(i),this.h()},h(){a(l,"class","mb-0 text-uppercase"),a(t,"class","card-header"),a(_,"class","table table-hover mb-0"),a(u,"class","table-responsive"),a(c,"class","card-body"),a(e,"class","card mb-3")},m(k,R){G(k,e,R),n(e,t),n(t,l),n(l,o),n(e,h),n(e,c),n(c,u),n(u,_),n(_,p),n(_,E),n(_,P);for(let O=0;O<g.length;O+=1)g[O]&&g[O].m(P,null);n(e,D)},p(k,R){if(R&16&&r!==(r=k[21]+"")&&ne(o,r),R&3600){V=be(k[22]);let O;for(O=0;O<V.length;O+=1){const v=Yt(k,V,O);g[O]?g[O].p(v,R):(g[O]=Xt(v),g[O].c(),g[O].m(P,null))}for(;O<g.length;O+=1)g[O].d(1);g.length=V.length}},d(k){k&&i(e),Ae(g,k)}}}function Gl(s){let e,t,l,r,o="User Role Assignments",h,c,u,_="Role Definitions",p,m,E,P,D,V,g,k,R,O;const v=[Hl,Bl],C=[];function y(T,w){return T[3]==="assignments"?0:1}return m=y(s),E=C[m]=v[m](s),D=new Rl({props:{id:"role-form-drawer",role:s[1],onSave:s[19]}}),g=new Ml({props:{id:"role-permissions-drawer",role:s[2],onSave:s[20]}}),{c(){e=d("div"),t=d("ul"),l=d("li"),r=d("button"),r.textContent=o,h=A(),c=d("li"),u=d("button"),u.textContent=_,p=A(),E.c(),P=A(),Qe(D.$$.fragment),V=A(),Qe(g.$$.fragment),this.h()},l(T){e=f(T,"DIV",{class:!0});var w=b(e);t=f(w,"UL",{class:!0});var U=b(t);l=f(U,"LI",{class:!0});var z=b(l);r=f(z,"BUTTON",{class:!0,"data-svelte-h":!0}),re(r)!=="svelte-1ja0zxy"&&(r.textContent=o),z.forEach(i),h=N(U),c=f(U,"LI",{class:!0});var Q=b(c);u=f(Q,"BUTTON",{class:!0,"data-svelte-h":!0}),re(u)!=="svelte-1rl4saz"&&(u.textContent=_),Q.forEach(i),U.forEach(i),p=N(w),E.l(w),w.forEach(i),P=N(T),Ke(D.$$.fragment,T),V=N(T),Ke(g.$$.fragment,T),this.h()},h(){a(r,"class","nav-link"),lt(r,"active",s[3]==="assignments"),a(l,"class","nav-item"),a(u,"class","nav-link"),lt(u,"active",s[3]==="definitions"),a(c,"class","nav-item"),a(t,"class","nav nav-tabs mb-4"),a(e,"class","container-fluid py-4")},m(T,w){G(T,e,w),n(e,t),n(t,l),n(l,r),n(t,h),n(t,c),n(c,u),n(e,p),C[m].m(e,null),G(T,P,w),Ge(D,T,w),G(T,V,w),Ge(g,T,w),k=!0,R||(O=[ce(r,"click",s[13]),ce(u,"click",s[14])],R=!0)},p(T,w){(!k||w&8)&&lt(r,"active",T[3]==="assignments"),(!k||w&8)&&lt(u,"active",T[3]==="definitions");let U=m;m=y(T),m===U?C[m].p(T,w):(ol(),Pe(C[U],1,1,()=>{C[U]=null}),al(),E=C[m],E?E.p(T,w):(E=C[m]=v[m](T),E.c()),Ue(E,1),E.m(e,null));const z={};w&2&&(z.role=T[1]),w&2&&(z.onSave=T[19]),D.$set(z);const Q={};w&4&&(Q.role=T[2]),w&4&&(Q.onSave=T[20]),g.$set(Q)},i(T){k||(Ue(E),Ue(D.$$.fragment,T),Ue(g.$$.fragment,T),k=!0)},o(T){Pe(E),Pe(D.$$.fragment,T),Pe(g.$$.fragment,T),k=!1},d(T){T&&(i(e),i(P),i(V)),C[m].d(),qe(D,T),qe(g,T),R=!1,Ye(O)}}}function Kl(s){let e,t;return e=new il({props:{pageTitle:"Manage Roles",$$slots:{default:[Gl]},$$scope:{ctx:s}}}),{c(){Qe(e.$$.fragment)},l(l){Ke(e.$$.fragment,l)},m(l,r){Ge(e,l,r),t=!0},p(l,[r]){const o={};r&268435711&&(o.$$scope={dirty:r,ctx:l}),e.$set(o)},i(l){t||(Ue(e.$$.fragment,l),t=!0)},o(l){Pe(e.$$.fragment,l),t=!1},d(l){qe(e,l)}}}function _t(s){const e=document.getElementById(s);if(e){const t=window.bootstrap;t?.Offcanvas&&new t.Offcanvas(e).show()}}function Ql(s,e,t){let l,r,o,h,c;Ne(s,pl,w=>t(12,r=w)),Ne(s,bl,w=>t(5,o=w)),Ne(s,gl,w=>t(6,h=w)),Ne(s,El,w=>t(7,c=w));let u=null,_=null,p="",m="assignments";vt(async()=>{await ml()});function E(){t(1,u=null),_t("role-form-drawer")}function P(w){t(1,u=w),_t("role-form-drawer")}function D(w){t(2,_=w),_t("role-permissions-drawer")}async function V(w){if(confirm(`Are you sure you want to delete the role "${w.name}"? This will remove it from all users.`))try{await vl(w.id)}catch(U){alert(`Failed to delete role: ${U instanceof Error?U.message:"Unknown error"}`)}}const g=()=>t(3,m="assignments"),k=()=>t(3,m="definitions");function R(){p=this.value,t(0,p)}const O=w=>D(w),v=w=>P(w),C=w=>V(w),y=()=>{t(1,u=null)},T=()=>{t(2,_=null)};return s.$$.update=()=>{s.$$.dirty&4097&&t(4,l=Object.entries(r).filter(([w,U])=>{if(!p)return!0;const z=p.toLowerCase();return w.toLowerCase().includes(z)||U.some(Q=>Q.name.toLowerCase().includes(z)||Q.key.toLowerCase().includes(z)||Q.description?.toLowerCase().includes(z))}))},[p,u,_,m,l,o,h,c,E,P,D,V,r,g,k,R,O,v,C,y,T]}class ss extends ot{constructor(e){super(),at(this,e,Ql,Kl,rt,{})}}export{ss as component,ls as universal};
