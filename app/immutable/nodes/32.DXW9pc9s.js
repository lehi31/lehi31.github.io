import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{P as at}from"../chunks/MdjouUvo.js";import{w as ze,g as Ue,c as Ge,o as rt}from"../chunks/DjNGvcU6.js";import{p as Ae,aj as z,D as l,E as h,g as e,ak as Fe,c as o,s as v,r as i,u as w,t as ne,a as qe,f as se,F as Je,R as it}from"../chunks/JKZwkikK.js";import{b as oe,i as E,e as te,a as Te,s as fe}from"../chunks/BxjzTaz1.js";import{e as xe,i as $e}from"../chunks/B2BlSr7K.js";import{f as _,a as c,c as Me,t as Ie}from"../chunks/JDsN5plM.js";import{r as De,s as Ce}from"../chunks/CqlCxHBn.js";import{b as ve,g as nt,P as ot,c as lt}from"../chunks/DLOhH4NZ.js";import{i as Be}from"../chunks/b8c_lO2i.js";import{D as Ve}from"../chunks/BJ1YkRJq.js";import{S as Le}from"../chunks/HqW6tlxZ.js";import{g as Oe}from"../chunks/BzGmNfZb.js";import{b as Ee}from"../chunks/BL6gm64P.js";import{p as Ke}from"../chunks/CdEA5IGF.js";const ct=`
	*,
	member_list_members (
		id,
		list_id,
		member_id,
		added_by,
		created_at,
		members (
			id,
			first_name,
			last_name,
			date_of_birth,
			phone_number
		)
	)
`;async function dt(){const{data:p,error:u}=await ve.from("member_lists").select(ct).order("name");if(u)throw u;return p||[]}async function mt(p){const{data:u,error:f}=await ve.from("member_lists").insert({name:p}).select().single();if(f)throw f;return u}async function ut(p,u){const{data:f,error:y}=await ve.from("member_lists").update({name:u,updated_at:new Date().toISOString()}).eq("id",p).select().single();if(y)throw y;return f}async function ft(p){const{error:u}=await ve.from("member_lists").delete().eq("id",p);if(u)throw u}async function Ye(p,u){const{data:f,error:y}=await ve.from("member_list_members").insert({list_id:p,member_id:u}).select("id, list_id, member_id, added_by, created_at").single();if(y)throw y;return f}async function vt(p,u){const{error:f}=await ve.from("member_list_members").delete().eq("list_id",p).eq("member_id",u);if(f)throw f}let ke=null;const bt=()=>{const p=ze(!1),u=ze([]),f=ze(null),y=async()=>{p.set(!1);const n=await dt();u.set(n);const x=Ue(f);!x&&n.length?f.set(n[0].id??null):x&&(n.some(F=>F.id===x)||f.set(n.length?n[0].id??null:null)),p.set(!0)};return ke={stores:{ready:p,lists:u,selectedListId:f},actions:{reload:y,selectList:n=>{f.set(n)},createListWithMembers:async(n,x)=>{const j=await mt(n);if(j.id)for(const F of x)await Ye(j.id,F);return await y(),Ue(u).find(F=>F.id===j.id)??null},renameList:async(n,x)=>{await ut(n,x),await y()},removeList:async n=>{await ft(n),await y()},addMember:async(n,x)=>{await Ye(n,x),await y()},removeMember:async(n,x)=>{await vt(n,x),await y()}}},ke},We=()=>ke||bt();var pt=_('<li class="list-group-item d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-primary" type="button">Add</button></li>'),_t=_('<ul class="list-group list-group-flush border rounded mt-2"></ul>'),gt=_('<p class="text-muted mt-2">No members match that search.</p>'),ht=_('<li class="list-group-item d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-link text-danger text-decoration-none" type="button">Remove</button></li>'),yt=_('<div class="mt-3"><p class="mb-2">Selected members:</p> <ul class="list-group list-group-flush border rounded"></ul></div>'),wt=_("<!> Creating...",1),Lt=_('<form class="d-flex flex-column gap-3"><div><label class="form-label" for="member-list-name">List name</label> <input id="member-list-name" class="form-control" type="text" required placeholder="e.g., Temple Preparation"/></div> <div><label class="form-label" for="member-list-members">Members (optional)</label> <input id="member-list-members" class="form-control" type="text" placeholder="Search members..."/> <!> <!></div> <div class="d-flex justify-content-end gap-2"><button class="btn btn-secondary" type="button" data-bs-dismiss="offcanvas">Cancel</button> <button class="btn btn-primary" type="submit"><!></button></div></form>');function xt(p,u){Ae(u,!1);const f=()=>oe(j,"$members",y),[y,ae]=Te(),A=h(),G=h();let S=h(!1),C=h(""),s=h([]),n=h("");const x=Ge(),{stores:{members:j}}=Oe(),{actions:{createListWithMembers:F}}=We();function be(a,d=[],t=6){if(!a.trim())return[];const b=a.toLowerCase();return e(A).filter(m=>{if(!m.id||d.includes(m.id))return!1;const L=m.first_name?.toLowerCase()??"",M=m.last_name?.toLowerCase()??"";return`${L} ${M}`.includes(b)}).slice(0,t)}function pe(a){!a.id||e(s).some(t=>t.id===a.id)||(l(s,[...e(s),a]),l(n,""))}function _e(a){l(s,e(s).filter(d=>d.id!==a))}async function le(a){if(a.preventDefault(),!e(C).trim())return;l(S,!0);const d=e(s).map(t=>t.id||0).filter(t=>!!t);try{await F(e(C).trim(),d),l(C,""),l(s,[]),l(n,""),x("listCreated")}catch(t){console.error("Failed to create list",t)}finally{l(S,!1)}}z(()=>f(),()=>{l(A,f()||[])}),z(()=>(e(n),e(s)),()=>{l(G,be(e(n),e(s).map(a=>a.id||0).filter(a=>!!a)))}),Fe(),Be();var J=Lt(),Y=o(J),q=v(o(Y),2);De(q),i(Y);var I=v(Y,2),T=v(o(I),2);De(T);var B=v(T,2);{var X=a=>{var d=_t();xe(d,5,()=>e(G),$e,(t,b)=>{var m=pt(),L=o(m),M=o(L);i(L);var O=v(L,2);i(m),ne(()=>fe(M,`${e(b),w(()=>e(b).first_name)??""} ${e(b),w(()=>e(b).last_name)??""}`)),te("click",O,()=>pe(e(b))),c(t,m)}),i(d),c(a,d)},Z=a=>{var d=Me(),t=se(d);{var b=m=>{var L=gt();c(m,L)};E(t,m=>{e(n),w(()=>e(n).trim())&&m(b)},!0)}c(a,d)};E(B,a=>{e(G),w(()=>e(G).length)?a(X):a(Z,!1)})}var ge=v(B,2);{var he=a=>{var d=yt(),t=v(o(d),2);xe(t,5,()=>e(s),$e,(b,m)=>{var L=ht(),M=o(L),O=o(M);i(M);var W=v(M,2);i(L),ne(()=>fe(O,`${e(m),w(()=>e(m).first_name)??""} ${e(m),w(()=>e(m).last_name)??""}`)),te("click",W,()=>{e(m)?.id&&_e(e(m)?.id)}),c(b,L)}),i(t),i(d),c(a,d)};E(ge,a=>{e(s),w(()=>e(s).length)&&a(he)})}i(I);var ce=v(I,2),$=v(o(ce),2),k=o($);{var N=a=>{var d=wt(),t=se(d);Le(t,{size:"sm"}),Je(),c(a,d)},P=a=>{var d=Ie("Create List");c(a,d)};E(k,a=>{e(S)?a(N):a(P,!1)})}i($),i(ce),i(J),ne(()=>$.disabled=e(S)),Ee(q,()=>e(C),a=>l(C,a)),Ee(T,()=>e(n),a=>l(n,a)),te("submit",J,Ke(le)),c(p,J),qe(),ae()}var $t=_("<!> Deleting...",1),Mt=_('<li class="list-group-item d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-primary" type="button">Add</button></li>'),St=_('<ul class="list-group list-group-flush border rounded mt-2"></ul>'),Ct=_('<p class="text-muted mt-2">No members match that search.</p>'),It=_('<li class="list-group-item d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-link text-danger text-decoration-none" type="button" aria-label="Remove member"><i class="bi bi-trash"></i></button></li>'),Dt=_('<ul class="list-group"></ul>'),Et=_('<p class="text-muted">No members in this list yet.</p>'),kt=_('<div class="d-flex flex-column gap-4"><div class="d-flex flex-column gap-4"><form class="d-flex flex-column gap-2"><input class="form-control" type="text" placeholder="List name"/> <div class="d-flex justify-content-between gap-2"><button class="btn btn-danger" aria-label="Delete list" type="button"><!></button> <div class="d-flex gap-2"><button class="btn btn-secondary" aria-label="Cancel" type="button" data-bs-dismiss="offcanvas"><!></button> <button class="btn btn-primary" aria-label="save" type="submit"><!></button></div></div></form></div> <div><h2 class="h6 mb-2">Add Member</h2> <input class="form-control" type="text" placeholder="Search members..."/> <!></div> <div><h2 class="h6">Members</h2> <!></div></div>'),jt=_('<p class="text-muted">Select a list to manage it.</p>');function Nt(p,u){Ae(u,!1);const f=()=>oe(be,"$lists",A),y=()=>oe(pe,"$selectedListId",A),ae=()=>oe(F,"$members",A),[A,G]=Te(),S=h(),C=h(),s=h(),n=h(),x=h(),j=h(),{stores:{members:F}}=Oe(),{stores:{lists:be,selectedListId:pe},actions:{addMember:_e,removeMember:le,renameList:J,removeList:Y}}=We(),q=Ge();let I=h(""),T=h(""),B=h(!1),X=h(!1),Z=h(null);function ge(t,b=[],m=6){if(!t.trim())return[];const L=t.toLowerCase();return e(x).filter(M=>{if(!M.id||b.includes(M.id))return!1;const O=M.first_name?.toLowerCase()??"",W=M.last_name?.toLowerCase()??"";return`${O} ${W}`.includes(L)}).slice(0,m)}async function he(t){e(s)&&(await _e(e(s).id,t),l(I,""))}async function ce(t){e(s)&&await le(e(s).id,t)}async function $(t){if(t.preventDefault(),!(!e(s)||!e(T).trim())){l(B,!0);try{await J(e(s).id,e(T).trim())}catch(b){console.error("Failed to rename list",b)}finally{l(B,!1),q("listRenamed")}}}async function k(){if(e(s)&&confirm("Are you sure you want to delete this member list?")){l(X,!0);try{await Y(e(s).id)}catch(t){console.error("Failed to delete list",t)}finally{l(X,!1),q("listDeleted")}}}z(()=>f(),()=>{l(S,f()||[])}),z(()=>y(),()=>{l(C,y())}),z(()=>(e(S),e(C)),()=>{l(s,e(S).find(t=>t.id===e(C))||null)}),z(()=>e(s),()=>{l(j,e(s)?.member_list_members?.map(t=>t.member_id)??[])}),z(()=>(e(s),e(I),e(j)),()=>{l(n,e(s)?ge(e(I),e(j)):[])}),z(()=>ae(),()=>{l(x,ae()||[])}),z(()=>(e(s),e(Z)),()=>{(e(s)?.id??null)!==e(Z)&&(l(Z,e(s)?.id??null),l(T,e(s)?.name??""))}),Fe(),Be();var N=Me(),P=se(N);{var a=t=>{var b=kt(),m=o(b),L=o(m),M=o(L);De(M);var O=v(M,2),W=o(O),R=o(W);{var H=r=>{var g=$t(),ie=se(g);Le(ie,{size:"sm"}),Je(),c(r,g)},de=r=>{var g=Ie("Delete List");c(r,g)};E(R,r=>{e(X)?r(H):r(de,!1)})}i(W);var Se=v(W,2),me=o(Se),ee=o(me);{var re=r=>{Le(r,{size:"sm"})},je=r=>{var g=Ie("Cancel");c(r,g)};E(ee,r=>{e(B)?r(re):r(je,!1)})}i(me);var U=v(me,2),K=o(U);{var ye=r=>{Le(r,{size:"sm"})},Ne=r=>{var g=Ie("Save");c(r,g)};E(K,r=>{e(B)?r(ye):r(Ne,!1)})}i(U),i(Se),i(O),i(L),i(m);var ue=v(m,2),we=v(o(ue),2);De(we);var Qe=v(we,2);{var Xe=r=>{var g=St();xe(g,5,()=>e(n),$e,(ie,D)=>{var V=Mt(),Q=o(V),Pe=o(Q);i(Q);var Re=v(Q,2);i(V),ne(()=>fe(Pe,`${e(D),w(()=>e(D).first_name)??""} ${e(D),w(()=>e(D).last_name)??""}`)),te("click",Re,()=>{e(D)?.id&&he(e(D)?.id)}),c(ie,V)}),i(g),c(r,g)},Ze=r=>{var g=Me(),ie=se(g);{var D=V=>{var Q=Ct();c(V,Q)};E(ie,V=>{e(I),w(()=>e(I).trim())&&V(D)},!0)}c(r,g)};E(Qe,r=>{e(n),w(()=>e(n).length)?r(Xe):r(Ze,!1)})}i(ue);var He=v(ue,2),et=v(o(He),2);{var tt=r=>{var g=Dt();xe(g,5,()=>(e(s),w(()=>e(s).member_list_members)),$e,(ie,D)=>{var V=It(),Q=o(V),Pe=o(Q);i(Q);var Re=v(Q,2);i(V),ne(()=>fe(Pe,`${e(D),w(()=>e(D).members?.first_name)??""} ${e(D),w(()=>e(D).members?.last_name)??""}`)),te("click",Re,()=>ce(e(D).member_id)),c(ie,V)}),i(g),c(r,g)},st=r=>{var g=Et();c(r,g)};E(et,r=>{e(s),w(()=>e(s).member_list_members?.length)?r(tt):r(st,!1)})}i(He),i(b),ne(()=>{W.disabled=e(X),me.disabled=e(B),U.disabled=e(B)}),Ee(M,()=>e(T),r=>l(T,r)),te("click",W,k),te("submit",L,Ke($)),Ee(we,()=>e(I),r=>l(I,r)),c(t,b)},d=t=>{var b=jt();c(t,b)};E(P,t=>{e(s)?t(a):t(d,!1)})}c(p,N),qe(),G()}var Pt=_('<div class="alert alert-warning mt-4">You do not have permission to manage member lists.</div>'),Rt=_('<button type="button" data-bs-toggle="offcanvas"><span> </span> <span class="badge bg-secondary rounded-pill"> </span></button>'),zt=_('<div class="list-group list-group-flush"></div>'),At=_('<p class="text-muted p-3 mb-0">No lists yet. Create one to get started.</p>'),Ft=_('<div class="p-4"><!></div>'),qt=_('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center w-100"><span>Lists</span> <div class="d-flex align-items-center gap-2"><button class="btn btn-primary btn-sm" aria-label="Create new list" type="button" data-bs-toggle="offcanvas"><i class="bi bi-plus"></i></button></div></div></div> <div class="card-body p-0"><!></div></div> <!> <!>',1);function Tt(p,u){Ae(u,!1);const f=()=>oe(F,"$lists",A),y=()=>oe(be,"$selectedListId",A),ae=()=>oe(j,"$ready",A),[A,G]=Te(),S=h(),C=h(),s=h(),{stores:{currentUserHasPermission:n}}=nt(),{actions:{reload:x}}=Oe(),{stores:{ready:j,lists:F,selectedListId:be},actions:{reload:pe,selectList:_e}}=We();let le=h(!1),J=!1;rt(()=>{const $=n.subscribe(k=>{const N=k(ot.ManageMemberLists);N&&!J&&(J=!0,x().catch(P=>console.error("Members reload failed",P)),pe().catch(P=>console.error("Member lists reload failed",P))),l(le,N)});return()=>{$()}});const Y="member-lists-create-drawer",q="member-lists-edit-drawer";function I($){if(typeof window>"u")return;const k=document.getElementById($);if(!k)return;window.bootstrap?.Offcanvas?.getInstance(k)?.hide()}function T(){I(q)}function B(){I(q)}function X(){I(Y)}z(()=>f(),()=>{l(S,f()||[])}),z(()=>y(),()=>{l(C,y())}),z(()=>(e(S),e(C)),()=>{l(s,e(S).find($=>$.id===e(C))||null)}),Fe(),Be();var Z=Me(),ge=se(Z);{var he=$=>{var k=Pt();c($,k)},ce=$=>{var k=qt(),N=se(k),P=o(N),a=o(P),d=v(o(a),2),t=o(d);Ce(t,"data-bs-target",`#${Y}`),Ce(t,"aria-controls",Y),i(d),i(a),i(P);var b=v(P,2),m=o(b);{var L=R=>{var H=Me(),de=se(H);{var Se=ee=>{var re=zt();xe(re,5,()=>e(S),$e,(je,U)=>{var K=Rt();Ce(K,"data-bs-target",`#${q}`),Ce(K,"aria-controls",q);var ye=o(K),Ne=o(ye,!0);i(ye);var ue=v(ye,2),we=o(ue,!0);i(ue),i(K),ne(()=>{lt(K,1,(e(U),e(C),w(()=>`list-group-item list-group-item-action d-flex justify-content-between align-items-center ${e(U).id===e(C)?"active":""}`))),fe(Ne,(e(U),w(()=>e(U).name))),fe(we,(e(U),w(()=>e(U).member_list_members?.length??0)))}),te("click",K,()=>_e(e(U).id??null)),c(je,K)}),i(re),c(ee,re)},me=ee=>{var re=At();c(ee,re)};E(de,ee=>{e(S),w(()=>e(S).length)?ee(Se):ee(me,!1)})}c(R,H)},M=R=>{var H=Ft(),de=o(H);Le(de,{}),i(H),c(R,H)};E(m,R=>{ae()?R(L):R(M,!1)})}i(b),i(N);var O=v(N,2);Ve(O,{title:"Create Member List",id:Y,children:(R,H)=>{xt(R,{$$events:{listCreated:X}})},$$slots:{default:!0}});var W=v(O,2);{let R=it(()=>(e(s),w(()=>e(s)?`Edit ${e(s).name}`:"Edit Member List")));Ve(W,{get title(){return e(R)},id:q,children:(H,de)=>{Nt(H,{$$events:{listDeleted:T,listRenamed:B}})},$$slots:{default:!0}})}c($,k)};E(ge,$=>{e(le)?$(ce,!1):$(he)})}c(p,Z),qe(),G()}function as(p){at(p,{pageTitle:"Member Lists",children:(u,f)=>{Tt(u,{})},$$slots:{default:!0}})}export{as as component};
