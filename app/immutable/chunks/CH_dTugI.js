const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./tUu8UEjF.js","./C2hsME61.js"])))=>i.map(i=>d[i]);
import{B as de,h as Ar,d as kr,K as Oa,bc as Fa,L as Ir,Y as Na,ac as Pa,b1 as Ya,a_ as La,N as Ba,G as An,p as Ut,ah as Ce,ai as dn,c as B,s as W,a as Ot,m as r,E as X,n as le,D as M,u as te,F as qe,r as L,C as Jn,ap as Vr,f as gt,as as Tn,R as lt,v as Ha}from"./SWWSvUpQ.js";import{b as Tr,d as za,f as ne,a as J,c as Wa,t as _n}from"./D8ekX_8E.js";import{_ as xn}from"./CmsKOCeN.js";import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{g as Dn,w as Jt,r as Zr,d as sn,c as $a,o as lr,a as Gr}from"./WW5OsAH7.js";import{p as se,i as me,e as Se,s as be,m as ja,u as qa,a as Cn,b as Xr}from"./CU3XCoqN.js";import{b as er,r as mt,s as Ue}from"./Cw9xNL90.js";import{t as yn,a as Pe,d as Yn,p as ln,z as fn,h as Ne,H as Cr,A as pt,e as Ze,b as cr,f as ur,I as Qa,i as jn,C as Ka,O as Mr}from"./iqPGsqox.js";import{i as Bt}from"./Bgyk9asy.js";import{S as en}from"./CzfM_xat.js";import{e as Sn,i as dr}from"./YJAcq9su.js";import{b as Mt,a as fr,c as qn}from"./CvxMDV_e.js";import{b as mn}from"./Dtu51PMB.js";import{b as Kt}from"./Cc3l00Qu.js";import{A as Va,a as bn}from"./CIAXqqbt.js";import{t as Qt}from"./r7-tBYgy.js";import{R as Ye}from"./DWcrPMiK.js";import{e as on}from"./Bdri6i3h.js";import{a as En,p as Rn}from"./Ky07Cr0D.js";import{s as Za,i as Ga}from"./Czyq2qEw.js";import{c as Xa}from"./-uppvFYH.js";import{a as Ja,b as Pt,f as Rr,h as ei,e as ti,V as ni}from"./C2hsME61.js";import{v as tr,D as nr}from"./Cq_N4N7o.js";import{f as ri}from"./JyKn6A7m.js";function wl(n,a,u=!1,i=!1,e=!1){var t=n,d="";de(()=>{var c=Oa;if(d===(d=a()??"")){Ar&&kr();return}if(c.nodes!==null&&(Fa(c.nodes.start,c.nodes.end),c.nodes=null),d!==""){if(Ar){Ir.data;for(var b=kr(),y=b;b!==null&&(b.nodeType!==Na||b.data!=="");)y=b,b=Pa(b);if(b===null)throw Ya(),La;Tr(Ir,y),t=Ba(b);return}var o=d+"";u?o=`<svg>${o}</svg>`:i&&(o=`<math>${o}</math>`);var l=za(o);if((u||i)&&(l=An(l)),Tr(An(l),l.lastChild),u||i)for(;An(l);)t.before(An(l));else t.before(l)}})}function gn(n,a){const u=a*7;return En(n,u)}function kn(n,a){const u=+yn(n),[i,e]=[+yn(a.start),+yn(a.end)].sort((t,d)=>t-d);return u>=i&&u<=e}function ai(n,a){const u=yn(n);return u.setHours(a),u}function ii(n,a){const u=yn(n);return u.setMinutes(a),u}function si(n,a){const u=di(a);return"formatToParts"in u?li(u,n):ci(u,n)}const oi={year:0,month:1,day:2,hour:3,minute:4,second:5};function li(n,a){try{const u=n.formatToParts(a),i=[];for(let e=0;e<u.length;e++){const t=oi[u[e].type];t!==void 0&&(i[t]=parseInt(u[e].value,10))}return i}catch(u){if(u instanceof RangeError)return[NaN];throw u}}function ci(n,a){const u=n.format(a),i=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(u);return[parseInt(i[3],10),parseInt(i[1],10),parseInt(i[2],10),parseInt(i[4],10),parseInt(i[5],10),parseInt(i[6],10)]}const Qn={},Ur=new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:"America/New_York",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),ui=Ur==="06/25/2014, 00:00:00"||Ur==="‎06‎/‎25‎/‎2014‎ ‎00‎:‎00‎:‎00";function di(n){return Qn[n]||(Qn[n]=ui?new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:n,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:n,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),Qn[n]}function vr(n,a,u,i,e,t,d){const c=new Date(0);return c.setUTCFullYear(n,a,u),c.setUTCHours(i,e,t,d),c}const Or=36e5,fi=6e4,Kn={timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-])(\d{2}):?(\d{2})$/};function mr(n,a,u){if(!n)return 0;let i=Kn.timezoneZ.exec(n);if(i)return 0;let e,t;if(i=Kn.timezoneHH.exec(n),i)return e=parseInt(i[1],10),Fr(e)?-(e*Or):NaN;if(i=Kn.timezoneHHMM.exec(n),i){e=parseInt(i[2],10);const d=parseInt(i[3],10);return Fr(e,d)?(t=Math.abs(e)*Or+d*fi,i[1]==="+"?-t:t):NaN}if(hi(n)){a=new Date(a||Date.now());const d=u?a:vi(a),c=rr(d,n);return-(u?c:mi(a,c,n))}return NaN}function vi(n){return vr(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())}function rr(n,a){const u=si(n,a),i=vr(u[0],u[1]-1,u[2],u[3]%24,u[4],u[5],0).getTime();let e=n.getTime();const t=e%1e3;return e-=t>=0?t:1e3+t,i-e}function mi(n,a,u){let e=n.getTime()-a;const t=rr(new Date(e),u);if(a===t)return a;e-=t-a;const d=rr(new Date(e),u);return t===d?t:Math.max(t,d)}function Fr(n,a){return-23<=n&&n<=23&&(a==null||0<=a&&a<=59)}const Nr={};function hi(n){if(Nr[n])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:n}),Nr[n]=!0,!0}catch{return!1}}function Pr(n){const a=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return a.setUTCFullYear(n.getFullYear()),+n-+a}const Jr=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,Vn=36e5,Yr=6e4,pi=2,ht={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:Jr};function ar(n,a={}){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(n===null)return new Date(NaN);const u=a.additionalDigits==null?pi:Number(a.additionalDigits);if(u!==2&&u!==1&&u!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]")return new Date(n.getTime());if(typeof n=="number"||Object.prototype.toString.call(n)==="[object Number]")return new Date(n);if(Object.prototype.toString.call(n)!=="[object String]")return new Date(NaN);const i=_i(n),{year:e,restDateString:t}=bi(i.date,u),d=gi(t,e);if(d===null||isNaN(d.getTime()))return new Date(NaN);if(d){const c=d.getTime();let b=0,y;if(i.time&&(b=yi(i.time),b===null||isNaN(b)))return new Date(NaN);if(i.timeZone||a.timeZone){if(y=mr(i.timeZone||a.timeZone,new Date(c+b)),isNaN(y))return new Date(NaN)}else y=Pr(new Date(c+b)),y=Pr(new Date(c+b+y));return new Date(c+b+y)}else return new Date(NaN)}function _i(n){const a={};let u=ht.dateTimePattern.exec(n),i;if(u?(a.date=u[1],i=u[3]):(u=ht.datePattern.exec(n),u?(a.date=u[1],i=u[2]):(a.date=null,i=n)),i){const e=ht.timeZone.exec(i);e?(a.time=i.replace(e[1],""),a.timeZone=e[1].trim()):a.time=i}return a}function bi(n,a){if(n){const u=ht.YYY[a],i=ht.YYYYY[a];let e=ht.YYYY.exec(n)||i.exec(n);if(e){const t=e[1];return{year:parseInt(t,10),restDateString:n.slice(t.length)}}if(e=ht.YY.exec(n)||u.exec(n),e){const t=e[1];return{year:parseInt(t,10)*100,restDateString:n.slice(t.length)}}}return{year:null}}function gi(n,a){if(a===null)return null;let u,i,e;if(!n||!n.length)return u=new Date(0),u.setUTCFullYear(a),u;let t=ht.MM.exec(n);if(t)return u=new Date(0),i=parseInt(t[1],10)-1,Br(a,i)?(u.setUTCFullYear(a,i),u):new Date(NaN);if(t=ht.DDD.exec(n),t){u=new Date(0);const d=parseInt(t[1],10);return Di(a,d)?(u.setUTCFullYear(a,0,d),u):new Date(NaN)}if(t=ht.MMDD.exec(n),t){u=new Date(0),i=parseInt(t[1],10)-1;const d=parseInt(t[2],10);return Br(a,i,d)?(u.setUTCFullYear(a,i,d),u):new Date(NaN)}if(t=ht.Www.exec(n),t)return e=parseInt(t[1],10)-1,Hr(e)?Lr(a,e):new Date(NaN);if(t=ht.WwwD.exec(n),t){e=parseInt(t[1],10)-1;const d=parseInt(t[2],10)-1;return Hr(e,d)?Lr(a,e,d):new Date(NaN)}return null}function yi(n){let a,u,i=ht.HH.exec(n);if(i)return a=parseFloat(i[1].replace(",",".")),Zn(a)?a%24*Vn:NaN;if(i=ht.HHMM.exec(n),i)return a=parseInt(i[1],10),u=parseFloat(i[2].replace(",",".")),Zn(a,u)?a%24*Vn+u*Yr:NaN;if(i=ht.HHMMSS.exec(n),i){a=parseInt(i[1],10),u=parseInt(i[2],10);const e=parseFloat(i[3].replace(",","."));return Zn(a,u,e)?a%24*Vn+u*Yr+e*1e3:NaN}return null}function Lr(n,a,u){a=a||0,u=u||0;const i=new Date(0);i.setUTCFullYear(n,0,4);const e=i.getUTCDay()||7,t=a*7+u+1-e;return i.setUTCDate(i.getUTCDate()+t),i}const wi=[31,28,31,30,31,30,31,31,30,31,30,31],xi=[31,29,31,30,31,30,31,31,30,31,30,31];function ea(n){return n%400===0||n%4===0&&n%100!==0}function Br(n,a,u){if(a<0||a>11)return!1;if(u!=null){if(u<1)return!1;const i=ea(n);if(i&&u>xi[a]||!i&&u>wi[a])return!1}return!0}function Di(n,a){if(a<1)return!1;const u=ea(n);return!(u&&a>366||!u&&a>365)}function Hr(n,a){return!(n<0||n>52||a!=null&&(a<0||a>6))}function Zn(n,a,u){return!(n<0||n>=25||a!=null&&(a<0||a>=60)||u!=null&&(u<0||u>=60))}function un(n,a,u){n=ar(n,u);const i=mr(a,n,!0),e=new Date(n.getTime()-i),t=new Date(0);return t.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),t.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),t}function tn(n,a,u){if(typeof n=="string"&&!n.match(Jr))return ar(n,{...u,timeZone:a});n=ar(n,u);const i=vr(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()).getTime(),e=mr(a,new Date(i));return new Date(i+e)}const ir=Jt([]);let Ct=null;async function nn(){return Ct||(Ct=(async()=>{const{data:n,error:a}=await Pe.from("calendar_events").select("*").order("start_time",{ascending:!0});if(a)throw Ct=null,a;const u=n||[];return ir.set(u),setTimeout(()=>{Ct=null},100),u})(),Ct)}async function Lt(n){let a=Dn(ir);return a.length||(await nn(),a=Dn(ir)),a.find(u=>u.id===n)}async function hr(n){const{data:a,error:u}=await Pe.from("calendar_events").insert([n]).select();if(u)throw u;return Ct=null,await nn(),a?a[0]:void 0}async function Ei(n){const{data:a,error:u}=await Pe.from("calendar_events").insert(n).select();if(u)throw u;return Ct=null,await nn(),a??[]}async function Rt(n,a){const{data:u,error:i}=await Pe.from("calendar_events").update(a).eq("id",n).select();if(i)throw i;return Ct=null,await nn(),u?u[0]:void 0}async function pr(n){const a=await Lt(n),{error:u}=await Pe.from("calendar_events").delete().eq("id",n);if(u)throw u;a?.attachments&&a.attachments.length>0&&await br(a.attachments),Ct=null,await nn()}const Si={bishop:{approval:"bishop_approval",timestamp:"bishop_approval_at",userId:"bishop_approval_by_user_id"},first_counselor:{approval:"first_counselor_approval",timestamp:"first_counselor_approval_at",userId:"first_counselor_approval_by_user_id"},second_counselor:{approval:"second_counselor_approval",timestamp:"second_counselor_approval_at",userId:"second_counselor_approval_by_user_id"}};async function ta(n,a,u,i){const e=Si[a],t=u?new Date().toISOString():null;return Rt(n,{[e.approval]:u,[e.timestamp]:t,[e.userId]:u?i??null:null})}async function na(n){return Rt(n,{is_published:!0})}async function ra(n){return Rt(n,{is_published:!1})}async function Ai(n=new Date){const a=n.toISOString(),{data:u,error:i}=await Pe.from("calendar_events").select("*").lt("start_time",a).eq("event_type","calendar_event");if(i)throw i;if(!u||u.length===0)return{deleted:0,skipped:0};const e=[],t=[];for(const c of u){if(c.recurrence_rule&&(!c.recurrence_end_date||c.recurrence_end_date&&new Date(c.recurrence_end_date)>=n)){t.push(c);continue}e.push(c)}let d=0;if(e.length>0){const c=e.map(b=>b.id).filter(b=>b!==void 0);if(c.length>0){const{data:b,error:y}=await Pe.from("calendar_events").delete().in("id",c).select("id");if(y)throw y;d=b?.length??0;for(const o of e)o.attachments&&o.attachments.length>0&&await br(o.attachments)}}return Ct=null,await nn(),{deleted:d,skipped:t.length}}async function aa(n,a){const u=n.name.split(".").pop()||"bin",i=a||"temp",t=`${crypto.randomUUID()}.${u}`,d=`${i}/${t}`,{error:c}=await Pe.storage.from("event-attachments").upload(d,n,{cacheControl:"3600",upsert:!1});if(c)throw c;const{data:{publicUrl:b}}=Pe.storage.from("event-attachments").getPublicUrl(d);return{id:crypto.randomUUID(),name:n.name,url:b,type:n.type,size:n.size,uploadedAt:new Date().toISOString()}}async function ia(n){const{error:a}=await Pe.storage.from("event-attachments").remove([n]);if(a)throw a}function _r(n){const a=n.match(/event-attachments\/(.+)$/);return a?a[1]:""}async function br(n){if(!n||n.length===0)return;const a=n.map(u=>_r(u.url)).filter(u=>u);if(a.length>0){const{error:u}=await Pe.storage.from("event-attachments").remove(a);if(u)throw u}}const xl=Object.freeze(Object.defineProperty({__proto__:null,createCalendarEvent:hr,createCalendarEvents:Ei,deleteCalendarEvent:pr,deleteEventAttachment:ia,deleteEventAttachments:br,deletePastCalendarEvents:Ai,extractStoragePath:_r,getAllCalendarEvents:nn,getCalendarEvent:Lt,publishCalendarEvent:na,unpublishCalendarEvent:ra,updateBishopricApproval:ta,updateCalendarEvent:Rt,uploadEventAttachment:aa},Symbol.toStringTag,{value:"Module"})),ki={all:{label:"All",key:"",sort_index:0,color_number:0},public:{label:"Public",key:"PUB",sort_index:0,color_number:1},church:{label:"Church",key:"CHU",sort_index:0,color_number:2},stake:{label:"Stake",key:"STK",sort_index:0,color_number:3},stakeReliefSociety:{label:"Stake | Relief Society",key:"SRS",sort_index:.1,color_number:5},stakeEldersQuorum:{label:"Stake | Elders Quorum",key:"SEQ",sort_index:.2,color_number:6},stakeYouth:{label:"Stake | Youth",key:"SYO",sort_index:.25,color_number:7},stakeYoungWomen:{label:"Stake | Young Women",key:"SYW",sort_index:.3,color_number:8},stakeYoungMen:{label:"Stake | Young Men",key:"SYM",sort_index:.4,color_number:12},stakePrimary:{label:"Stake | Primary",key:"SPR",sort_index:.5,color_number:16},stakeSundaySchool:{label:"Stake | Sunday School",key:"SSS",sort_index:.6,color_number:21},stakeYsa:{label:"Stake | YSA",key:"SYA",sort_index:.7,color_number:22},ward:{label:"Ward",key:"WRD",sort_index:1,color_number:4},reliefSociety:{label:"Relief Society",key:"RES",sort_index:2,color_number:5},eldersQuorum:{label:"Elders Quorum",key:"ELQ",sort_index:3,color_number:6},youth:{label:"Youth",key:"YOU",sort_index:4,color_number:7},youngWomen:{label:"Young Women",key:"YOW",sort_index:4,color_number:8},youngWomenPearls:{label:"Young Women | Pearls",key:"YWP",sort_index:5,color_number:9},youngWomenRubies:{label:"Young Women | Rubies",key:"YWR",sort_index:6,color_number:10},youngWomenDiamonds:{label:"Young Women | Diamonds",key:"YWD",sort_index:7,color_number:11},aaronicPriesthood:{label:"Young Men",key:"YOM",sort_index:8,color_number:12},aaronicPriesthoodDeacons:{label:"Young Men | Deacons",key:"YMD",sort_index:9,color_number:13},aaronicPriesthoodTeachers:{label:"Young Men | Teachers",key:"YMT",sort_index:10,color_number:14},aaronicPriesthoodPriests:{label:"Young Men | Priests",key:"YMP",sort_index:11,color_number:15},primary:{label:"Primary",key:"PRI",sort_index:12,color_number:16},primaryNursery:{label:"Primary | Nursery",key:"PRN",sort_index:13,color_number:17},primarySunbeams:{label:"Primary | Sunbeams",key:"PRS",sort_index:14,color_number:18},primaryCTR:{label:"Primary | CTR",key:"PRC",sort_index:15,color_number:19},primaryValiant:{label:"Primary | Valiant",key:"PRV",sort_index:16,color_number:20},sundaySchool:{label:"Sunday School",key:"SUS",sort_index:17,color_number:21},ysa:{label:"YSA",key:"YSA",sort_index:18,color_number:22}},Un=Object.values(ki).sort((n,a)=>n.sort_index-a.sort_index),Ii=n=>n?Un.find(a=>a.key===n):void 0,Ti=["STK","SRS","SEQ","SYO","SYW","SYM","SPR","SSS","SYA"],Ci=["WRD","RES","ELQ","YOU","YOW","YWP","YWR","YWD","YOM","YMD","YMT","YMP","PRI","PRN","PRS","PRC","PRV","SUS","YSA"],Mi={STK:Ti,WRD:Ci,YOU:["YOU","YOW","YWP","YWR","YWD","YOM","YMD","YMT","YMP"],YOM:["YOM","YMD","YMT","YMP"],YOW:["YOW","YWP","YWR","YWD"]},Ri=n=>{if(!n)return[];const a=n.trim();if(!a)return[];const u=Mi[a]??[a];return Array.from(new Set(u))},zr=(n,a)=>a?n?Ri(a).includes(n):!1:!0,Wr={bishop:"Bishop",first_counselor:"1st Counselor",second_counselor:"2nd Counselor"},gr=n=>{let a=0;return n.bishop_approval==="YES"&&a++,n.first_counselor_approval==="YES"&&a++,n.second_counselor_approval==="YES"&&a++,a},Ui=n=>gr(n)>0,Oi=n=>n.is_published?"published":gr(n)>0?"approved":n.bishop_approval==="NO"||n.first_counselor_approval==="NO"||n.second_counselor_approval==="NO"?"needs_review":"pending";let wn=null;const Fi=n=>n.replace(/<[^>]*>/g,"").toLowerCase(),$r=(n,a)=>{if(!a.trim())return!0;const u=a.toLowerCase(),i=(n.title||"").toLowerCase(),e=Fi(n.description||""),t=(n.location||"").toLowerCase();return i.includes(u)||e.includes(u)||t.includes(u)},Dl=(n,a)=>{if(!a.trim()||!n)return jr(n||"");const u=jr(n),i=new RegExp(`(${sa(a)})`,"gi");return u.replace(i,"<mark>$1</mark>")},El=(n,a)=>{if(!a.trim()||!n)return n||"";const u=new RegExp(`(${sa(a)})`,"gi");return n.replace(/(<[^>]*>)|([^<]+)/g,(i,e,t)=>e||(t?t.replace(u,"<mark>$1</mark>"):i))},jr=n=>{const a=typeof document<"u"?document.createElement("div"):null;return a?(a.textContent=n,a.innerHTML):n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},sa=n=>n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Ni=Yn()??null,Pi=Zr(!1),Gn=Ni?.stores.authenticated??Pi,Yi=()=>{const n=Jt(!1),a=Jt([]),u=Jt([]),i=Jt(""),e=Jt(""),t=Jt(!1),d=(E,U)=>!(!E.is_published||!U&&E.is_public===!1),c=sn([u,Gn],([E,U])=>{const g=new Date,I=on(gn(g,3),{weekStartsOn:1}),f=new Set(E.filter(m=>m?.meta_data?.organization?.length).filter(m=>d(m,U)).filter(m=>{if(m.event_type==="calendar_event"){const w=m.start_time?ln(m.start_time):null;return w?kn(w,{start:g,end:I}):!1}return!0}).map(m=>m.meta_data?.organization).filter(m=>m));return Array.from(f).map(m=>Un.find(w=>w.key===m)).filter(m=>m!==void 0)}),b=sn([i],([E])=>Un.find(U=>U.key===E)),y=sn([u,i,e,Gn],([E,U,g,I])=>E.filter(f=>f.event_type==="calendar_event").filter(f=>{const m=f?.meta_data;return U&&m?zr(m?.organization,U):!0}).filter(f=>$r(f,g)).filter(f=>d(f,I)).filter(f=>{const m=f.start_time?ln(f.start_time):null,w=Za();return m?Ga(m,w)||m.getTime()>=w.getTime():!1})),o=sn([u,i,e,Gn],([E,U,g,I])=>E.filter(f=>f.event_type==="announcement").filter(f=>{const m=f?.meta_data;return U&&m?zr(m?.organization,U):!0}).filter(f=>$r(f,g)).filter(f=>d(f,I))),l=sn([y],([E])=>E.filter(U=>{const g=U.start_time?ln(U.start_time):null;return g?kn(g,{start:fn(new Date,{weekStartsOn:1}),end:on(new Date,{weekStartsOn:1})}):!1})),s=()=>{const E=fn(new Date,{weekStartsOn:1}),U=on(new Date,{weekStartsOn:1});return`${Ne(E,"MMM d").toUpperCase()} – ${Ne(U,"MMM d").toUpperCase()}`},h=sn([y],([E])=>{const U=gn(fn(new Date,{weekStartsOn:1}),1),g=on(U,{weekStartsOn:1});return E.filter(I=>{const f=I.start_time?ln(I.start_time):null;return f?kn(f,{start:U,end:g}):!1})}),v=()=>{const E=gn(fn(new Date,{weekStartsOn:1}),1),U=on(E,{weekStartsOn:1});return`${Ne(E,"MMM d").toUpperCase()} – ${Ne(U,"MMM d").toUpperCase()}`},C=sn([y],([E])=>{const U=gn(fn(new Date,{weekStartsOn:1}),2),g=on(U,{weekStartsOn:1});return E.filter(I=>{const f=I.start_time?ln(I.start_time):null;return f?kn(f,{start:U,end:g}):!1})}),F=()=>{const E=gn(fn(new Date,{weekStartsOn:1}),2),U=on(E,{weekStartsOn:1});return`${Ne(E,"MMM d").toUpperCase()} – ${Ne(U,"MMM d").toUpperCase()}`},D=E=>{const U=[],g=new Date,I=new Date;I.setFullYear(g.getFullYear()+1);for(const f of E)if(f.recurrence_rule&&f.start_time&&f.end_time)try{const m=Ye.fromString(f.recurrence_rule),w=f.recurrence_end_date?m.all():m.between(g,I,!0),A=new Date(f.start_time),R=new Date(f.end_time).getTime()-A.getTime(),x=un(A,pt),O=x.getHours(),_=x.getMinutes(),p=x.getSeconds(),z=x.getMilliseconds(),T=f.recurrence_exceptions||[],Y=f.recurrence_overrides||{};w.forEach((Q,j)=>{const $=un(Q,pt),P=new Date($);P.setHours(O,_,p,z);const N=tn(P,pt),K=N,re=new Date(N.getTime()+R),G=Ne(Q,"yyyy-MM-dd"),V=Y[G];if(T.includes(G)&&!V)return;const ae={...f,id:void 0,start_time:K.toISOString(),end_time:re.toISOString(),meta_data:{...f.meta_data,recurring_instance:!0,recurring_parent_id:f.id,recurring_instance_index:j}};V&&(V.title!==void 0&&(ae.title=V.title),V.description!==void 0&&(ae.description=V.description),V.location!==void 0&&(ae.location=V.location),V.start_time!==void 0&&(ae.start_time=V.start_time),V.end_time!==void 0&&(ae.end_time=V.end_time),V.is_all_day!==void 0&&(ae.is_all_day=V.is_all_day),V.meta_data!==void 0&&(ae.meta_data={...ae.meta_data,...V.meta_data})),U.push(ae)})}catch(m){console.error("Failed to expand recurring event:",f.id,m),U.push(f)}else U.push(f);return U},H=E=>E.length?D(E).map(g=>({...g,start_time:g?.start_time?Cr(g.start_time):void 0,end_time:g.end_time?Cr(g.end_time):void 0})):[];return wn={stores:{ready:n,data:a,dbData:u,announcements:o,calendarEvents:y,calendarEventsThisWeek:l,calendarEventsNextWeek:h,calendarEventsNextNextWeek:C,currentOrganizations:c,organizationFilter:i,searchQuery:e,currentOrganizationFilter:b,weeksExpanded:t},actions:{reload:async()=>{n.set(!1);const E=await nn();u.set(H(E)),n.set(!0)},calendarEventsThisWeekLabel:s,calendarEventsNextWeekLabel:v,calendarEventsNextNextWeekLabel:F}},wn},Li=()=>wn?.stores&&Object.keys(wn.stores).length>0?wn:Yi();var Bi=ne('<div class="invalid-feedback d-block"> </div>'),Hi=ne("<option> </option>"),zi=ne('<div class="invalid-feedback d-block"> </div>'),Wi=ne('<div class="invalid-feedback d-block"> </div>'),$i=ne(`<div class="d-flex flex-column gap-4"><div class="d-flex flex-column gap-2"><div>Title*</div> <input type="text" placeholder="" required/> <!> <small class="fw-lighter fst-italic">Displayed publicly on the calendar and announcements page. e.g. Ward Conference, Ward BBQ
			Night</small></div> <div class="d-flex flex-column gap-2"><div>Type<span class="text-danger">*</span></div> <select class="form-select" aria-label="Select Type"><option>Calendar Event</option><option>Announcement</option></select> <small class="fw-lighter fst-italic">Calendar Event appears on calendar with date/time. Announcement shows as a notice without
			specific timing.</small></div> <div class="d-flex flex-column gap-2"><div>Organization*</div> <select aria-label="Select Organization"></select> <!> <small class="fw-lighter fst-italic">Displayed as a public badge on the event listing.</small></div> <div class="d-flex flex-column gap-2"><div>Visibility</div> <div class="form-check form-switch"><input class="form-check-input" type="checkbox"/> <label class="form-check-label">Public (visible without login)</label></div> <small class="fw-lighter fst-italic">Turn off to restrict this event/announcement to logged-in users only.</small></div> <div class="d-flex flex-column gap-2"><div>Description</div> <textarea rows="4" placeholder="Event description (optional)"></textarea> <!> <small class="fw-lighter fst-italic">Shown publicly when viewers expand the event details. Supports basic HTML formatting.</small></div></div>`);function ji(n,a){Ut(a,!1);const u=X(),i=X(),e=X();let t=se(a,"title",12,""),d=se(a,"eventType",12,"calendar_event"),c=se(a,"organization",12,""),b=se(a,"isPublic",12,!0),y=se(a,"description",12,""),o=se(a,"disabled",8,!1),l=se(a,"name",8,"event"),s=se(a,"validationErrors",24,()=>({})),h=X(),v=X();function C(){r(h)?.focus()}function F(){r(v)?.focus()}Ce(()=>le(s()),()=>{M(u,!!s().title)}),Ce(()=>le(s()),()=>{M(i,!!s().description)}),Ce(()=>le(s()),()=>{M(e,!!s().organization)}),dn();var D={focusTitle:C,focusDescription:F};Bt();var H=$i(),k=B(H),E=W(B(k),2);mt(E);let U;Kt(E,K=>M(h,K),()=>r(h));var g=W(E,2);{var I=K=>{var re=Bi(),G=B(re,!0);L(re),de(()=>be(G,(le(s()),te(()=>s().title)))),J(K,re)};me(g,K=>{le(s()),te(()=>s().title)&&K(I)})}qe(2),L(k);var f=W(k,2),m=W(B(f),2);de(()=>{d(),Jn(()=>{o()})});var w=B(m);w.value=w.__value="calendar_event";var A=W(w);A.value=A.__value="announcement",L(m),qe(2),L(f);var S=W(f,2),R=W(B(S),2);de(()=>{c(),Jn(()=>{r(e),o()})});let x;Sn(R,5,()=>Un,dr,(K,re)=>{var G=Hi(),V=B(G,!0);L(G);var ae={};de(()=>{be(V,(r(re),te(()=>r(re).label))),ae!==(ae=(r(re),te(()=>r(re).key)))&&(G.value=(G.__value=(r(re),te(()=>r(re).key)))??"")}),J(K,G)}),L(R);var O=W(R,2);{var _=K=>{var re=zi(),G=B(re,!0);L(re),de(()=>be(G,(le(s()),te(()=>s().organization)))),J(K,re)};me(O,K=>{le(s()),te(()=>s().organization)&&K(_)})}qe(2),L(S);var p=W(S,2),z=W(B(p),2),T=B(z);mt(T);var Y=W(T,2);L(z),qe(2),L(p);var Q=W(p,2),j=W(B(Q),2);Vr(j);let $;Kt(j,K=>M(v,K),()=>r(v));var P=W(j,2);{var N=K=>{var re=Wi(),G=B(re,!0);L(re),de(()=>be(G,(le(s()),te(()=>s().description)))),J(K,re)};me(P,K=>{le(s()),te(()=>s().description)&&K(N)})}return qe(2),L(Q),L(H),de(()=>{Ue(E,"name",`${l()??""}-title`),U=Ze(E,1,"form-control",null,U,{"is-invalid":r(u)}),E.disabled=o(),m.disabled=o(),x=Ze(R,1,"form-select",null,x,{"is-invalid":r(e)}),R.disabled=o(),Ue(T,"id",`${l()??""}-is-public`),T.disabled=o(),Ue(Y,"for",`${l()??""}-is-public`),Ue(j,"name",`${l()??""}-description`),$=Ze(j,1,"form-control",null,$,{"is-invalid":r(i)}),j.disabled=o()}),Se("focus",E,()=>r(h).select()),Mt(E,t),er(m,d),er(R,c),fr(T,b),Se("focus",j,()=>r(v).select()),Mt(j,y),J(n,H),mn(a,"focusTitle",C),mn(a,"focusDescription",F),Ot(D)}var qi=ne('<div class="invalid-feedback d-block"> </div>'),Qi=ne('<div class="invalid-feedback d-block"> </div>'),Ki=ne('<div class="invalid-feedback d-block"> </div>'),Vi=ne('<div class="d-flex flex-column gap-4 ps-4"><div class="d-flex flex-column gap-2"><div>Start time<span class="text-danger">*</span></div> <input type="time" required/> <!> <small class="fw-lighter fst-italic">What time does the event begin? Use 15-minute increments.</small></div> <div class="d-flex flex-column gap-2"><div>End time<span class="text-danger">*</span></div> <input type="time" required/> <!> <small class="fw-lighter fst-italic">What time does the event conclude?</small></div></div>'),Zi=ne('<div class="d-flex flex-column gap-4"><div class="d-flex flex-column gap-2"><div>Date<span class="text-danger">*</span></div> <input type="date" required/> <!> <small class="fw-lighter fst-italic">Select the date this event occurs. Past dates are not allowed.</small></div> <div class="d-flex flex-column gap-2"><div class="form-check d-flex align-items-center gap-2"><input class="form-check-input" type="checkbox"/> <label class="form-check-label">All Day Event</label></div> <small class="fw-lighter fst-italic ms-4">Check this if the event has no specific start/end time (e.g., all-day activity)</small></div> <!></div>');function Gi(n,a){Ut(a,!1);const u=X(),i=X(),e=X();let t=se(a,"dateInput",12,""),d=se(a,"startTimeInput",12,""),c=se(a,"endTimeInput",12,""),b=se(a,"isAllDay",12,!1),y=se(a,"disabled",8,!1),o=se(a,"name",8,"event"),l=se(a,"validationErrors",24,()=>({})),s=X(),h=X(),v=X();const C=new Date().toISOString().split("T")[0];function F(){r(s)?.focus()}function D(){r(h)?.focus()}function H(){r(v)?.focus()}Ce(()=>le(l()),()=>{M(u,!!l().dateInput)}),Ce(()=>le(l()),()=>{M(i,!!l().startTimeInput)}),Ce(()=>le(l()),()=>{M(e,!!l().endTimeInput)}),dn();var k={focusDate:F,focusStartTime:D,focusEndTime:H};Bt();var E=Zi(),U=B(E),g=W(B(U),2);mt(g);let I;Kt(g,_=>M(s,_),()=>r(s));var f=W(g,2);{var m=_=>{var p=qi(),z=B(p,!0);L(p),de(()=>be(z,(le(l()),te(()=>l().dateInput)))),J(_,p)};me(f,_=>{le(l()),te(()=>l().dateInput)&&_(m)})}qe(2),L(U);var w=W(U,2),A=B(w),S=B(A);mt(S);var R=W(S,2);L(A),qe(2),L(w);var x=W(w,2);{var O=_=>{var p=Vi(),z=B(p),T=W(B(z),2);mt(T),Ue(T,"step",900);let Y;Kt(T,G=>M(h,G),()=>r(h));var Q=W(T,2);{var j=G=>{var V=Qi(),ae=B(V,!0);L(V),de(()=>be(ae,(le(l()),te(()=>l().startTimeInput)))),J(G,V)};me(Q,G=>{le(l()),te(()=>l().startTimeInput)&&G(j)})}qe(2),L(z);var $=W(z,2),P=W(B($),2);mt(P),Ue(P,"step",900);let N;Kt(P,G=>M(v,G),()=>r(v));var K=W(P,2);{var re=G=>{var V=Ki(),ae=B(V,!0);L(V),de(()=>be(ae,(le(l()),te(()=>l().endTimeInput)))),J(G,V)};me(K,G=>{le(l()),te(()=>l().endTimeInput)&&G(re)})}qe(2),L($),L(p),de(()=>{Ue(T,"name",`${o()??""}-start-time`),Y=Ze(T,1,"form-control",null,Y,{"is-invalid":r(i)}),T.disabled=y(),Ue(P,"name",`${o()??""}-end-time`),N=Ze(P,1,"form-control",null,N,{"is-invalid":r(e)}),P.disabled=y()}),Se("focus",T,()=>r(h).select()),Mt(T,d),Se("focus",P,()=>r(v).select()),Mt(P,c),J(_,p)};me(x,_=>{b()||_(O)})}return L(E),de(()=>{Ue(g,"name",`${o()??""}-date`),I=Ze(g,1,"form-control",null,I,{"is-invalid":r(u)}),g.disabled=y(),Ue(g,"min",C),Ue(S,"id",`${o()??""}-all-day-check`),S.disabled=y(),Ue(R,"for",`${o()??""}-all-day-check`)}),Se("focus",g,()=>r(s).select()),Mt(g,t),fr(S,b),J(n,E),mn(a,"focusDate",F),mn(a,"focusStartTime",D),mn(a,"focusEndTime",H),Ot(k)}var Xi=ne('<div class="form-check"><input class="form-check-input" type="checkbox"/> <label class="form-check-label"> </label></div>'),Ji=ne('<div class="invalid-feedback d-block"> </div>'),es=ne('<div class="d-flex flex-column gap-2"><div class="form-label fw-semibold">Repeat on these days<span class="text-danger">*</span></div> <div class="d-flex flex-wrap gap-2"></div> <!> <small class="text-muted">Select at least one day when this event repeats</small></div>'),ts=ne('<div class="d-flex flex-column gap-2"><div class="form-label fw-semibold" role="group" aria-label="Monthly recurrence">Monthly recurrence</div> <div class="d-flex flex-column gap-2"><div class="form-check"><input class="form-check-input" type="radio"/> <label class="form-check-label"> </label></div> <div class="form-check"><input class="form-check-input" type="radio"/> <label class="form-check-label"> </label></div></div></div>'),ns=ne('<div class="invalid-feedback d-block"> </div>'),rs=ne('<div class="d-flex flex-column gap-3 ps-4"><div class="d-flex flex-column gap-2"><div class="form-label fw-semibold" role="group" aria-label="Repeat pattern">Repeat pattern</div> <div class="row g-2 align-items-center"><div class="col-auto"><span class="text-muted">Every</span></div> <div class="col-auto"><input type="number" class="form-control" min="1" max="99" style="width: 80px;"/></div> <div class="col-auto"><select class="form-select"><option> </option><option> </option><option> </option><option> </option></select></div></div></div> <!> <!> <div class="d-flex flex-column gap-2"><label class="form-label fw-semibold">Repeat until<span class="text-danger">*</span></label> <input type="date" required/> <!> <small class="text-muted">The last date this event will occur</small></div></div>'),as=ne('<div class="d-flex flex-column gap-3"><div class="form-check"><input class="form-check-input" type="checkbox"/> <label class="form-check-label fw-semibold">Make this a recurring event</label></div> <!></div>');function is(n,a){Ut(a,!1);const u=[],i=[];let e=se(a,"isRecurring",12,!1),t=se(a,"recurrenceFrequency",12,"weekly"),d=se(a,"recurrenceInterval",12,1),c=se(a,"recurringDays",28,()=>[]),b=se(a,"recurrenceEndDate",12,""),y=se(a,"monthlyType",12,"date"),o=se(a,"dateInput",8,""),l=se(a,"disabled",8,!1),s=se(a,"name",8,"event"),h=se(a,"validationErrors",24,()=>({}));const v=[{label:"Sun",value:0},{label:"Mon",value:1},{label:"Tue",value:2},{label:"Wed",value:3},{label:"Thu",value:4},{label:"Fri",value:5},{label:"Sat",value:6}];function C(I){if(!I)return"Same weekday of the month";try{const f=new Date(I),m=Ne(f,"EEEE"),w=Math.ceil(f.getDate()/7);return`${["","1st","2nd","3rd","4th","5th"][w]} ${m} of the month`}catch{return"Same weekday of the month"}}function F(I){if(!I)return 1;try{return I.split("-").map(Number)[2]}catch{return 1}}Bt();var D=as(),H=B(D),k=B(H);mt(k);var E=W(k,2);L(H);var U=W(H,2);{var g=I=>{var f=rs(),m=B(f),w=W(B(m),2),A=W(B(w),2),S=B(A);mt(S),L(A);var R=W(A,2),x=B(R);de(()=>{t(),Jn(()=>{l(),d()})});var O=B(x),_=B(O,!0);L(O),O.value=O.__value="daily";var p=W(O),z=B(p,!0);L(p),p.value=p.__value="weekly";var T=W(p),Y=B(T,!0);L(T),T.value=T.__value="monthly";var Q=W(T),j=B(Q,!0);L(Q),Q.value=Q.__value="yearly",L(x),L(R),L(w),L(m);var $=W(m,2);{var P=ke=>{var Ae=es(),ve=W(B(Ae),2);Sn(ve,5,()=>v,dr,(ie,fe)=>{var Ee=Xi(),he=B(Ee);mt(he);var ue,_e=W(he,2),pe=B(_e,!0);L(_e),L(Ee),de(()=>{Ue(he,"id",`${s()??""}-day-${r(fe),te(()=>r(fe).value)??""}`),he.disabled=l(),ue!==(ue=(r(fe),te(()=>r(fe).value)))&&(he.value=(he.__value=(r(fe),te(()=>r(fe).value)))??""),Ue(_e,"for",`${s()??""}-day-${r(fe),te(()=>r(fe).value)??""}`),be(pe,(r(fe),te(()=>r(fe).label)))}),qn(u,[],he,()=>(r(fe),te(()=>r(fe).value),c()),c),J(ie,Ee)}),L(ve);var Me=W(ve,2);{var ce=ie=>{var fe=Ji(),Ee=B(fe,!0);L(fe),de(()=>be(Ee,(le(h()),te(()=>h().recurringDays)))),J(ie,fe)};me(Me,ie=>{le(h()),te(()=>h().recurringDays)&&ie(ce)})}qe(2),L(Ae),J(ke,Ae)};me($,ke=>{t()==="weekly"&&ke(P)})}var N=W($,2);{var K=ke=>{var Ae=ts(),ve=W(B(Ae),2),Me=B(ve),ce=B(Me);mt(ce),ce.value=ce.__value="date";var ie=W(ce,2),fe=B(ie);L(ie),L(Me);var Ee=W(Me,2),he=B(Ee);mt(he),he.value=he.__value="weekday";var ue=W(he,2),_e=B(ue);L(ue),L(Ee),L(ve),L(Ae),de((pe,Re)=>{Ue(ce,"id",`${s()??""}-monthly-date`),ce.disabled=l(),Ue(ie,"for",`${s()??""}-monthly-date`),be(fe,`On day ${pe??""} of the month`),Ue(he,"id",`${s()??""}-monthly-weekday`),he.disabled=l(),Ue(ue,"for",`${s()??""}-monthly-weekday`),be(_e,`On the ${Re??""}`)},[()=>(le(o()),te(()=>F(o()))),()=>(le(o()),te(()=>C(o())))]),qn(i,[],ce,y,y),qn(i,[],he,y,y),J(ke,Ae)};me(N,ke=>{t()==="monthly"&&ke(K)})}var re=W(N,2),G=B(re),V=W(G,2);mt(V);let ae;var De=W(V,2);{var ge=ke=>{var Ae=ns(),ve=B(Ae,!0);L(Ae),de(()=>be(ve,(le(h()),te(()=>h().recurrenceEndDate)))),J(ke,Ae)};me(De,ke=>{le(h()),te(()=>h().recurrenceEndDate)&&ke(ge)})}qe(2),L(re),L(f),de(()=>{S.disabled=l(),x.disabled=l(),be(_,d()===1?"day":"days"),be(z,d()===1?"week":"weeks"),be(Y,d()===1?"month":"months"),be(j,d()===1?"year":"years"),Ue(G,"for",`${s()??""}-recurrence-end-date`),ae=Ze(V,1,"form-control",null,ae,{"is-invalid":!!h().recurrenceEndDate}),Ue(V,"id",`${s()??""}-recurrence-end-date`),V.disabled=l()}),Mt(S,d),er(x,t),Mt(V,b),J(I,f)};me(U,I=>{e()&&I(g)})}L(D),de(()=>{Ue(k,"id",`${s()??""}-is-recurring`),k.disabled=l(),Ue(E,"for",`${s()??""}-is-recurring`)}),fr(k,e),J(n,D),Ot()}var ss=ne('<div class="d-flex flex-column gap-2"><div>Location</div> <input type="text" class="form-control" placeholder="Event location (optional)"/> <small class="fw-lighter fst-italic">Displayed publicly on the event listing. e.g. Cultural Hall, Stake Center</small></div>');function os(n,a){Ut(a,!1);let u=se(a,"value",12,""),i=se(a,"disabled",8,!1),e=se(a,"name",8,"location"),t=X();function d(){r(t)?.focus()}var c={focus:d},b=ss(),y=W(B(b),2);return mt(y),Kt(y,o=>M(t,o),()=>r(t)),qe(2),L(b),de(()=>{Ue(y,"name",e()),y.disabled=i()}),Se("focus",y,()=>r(t).select()),Mt(y,u),J(n,b),mn(a,"focus",d),Ot(c)}var ls=ne('<input type="text" class="form-control form-control-sm"/> <small class="text-muted"> </small>',1),cs=ne('<div class="fw-semibold"> </div> <small class="text-muted"> </small>',1),us=ne('<button type="button" class="btn btn-sm btn-success" title="Save"><i class="bi bi-check-lg"></i></button> <button type="button" class="btn btn-sm btn-secondary" title="Cancel"><i class="bi bi-x-lg"></i></button>',1),ds=ne('<button type="button" class="btn btn-sm btn-outline-primary" title="Edit name"><i class="bi bi-pencil"></i></button> <button type="button" class="btn btn-sm btn-outline-danger" title="Delete"><i class="bi bi-trash"></i></button>',1),fs=ne('<div class="d-flex align-items-center gap-2 p-2 border rounded"><div class="flex-grow-1"><!></div> <!></div>'),vs=ne('<div class="d-flex flex-column gap-2 mb-2"></div>'),ms=ne('<div class="d-flex flex-column gap-2"><div>Attachments</div> <!> <div class="d-flex flex-column gap-2"><div class="d-flex gap-2 align-items-center"><input type="file" class="form-control" accept="image/*,application/pdf"/> <!></div> <small class="fw-lighter fst-italic">Publicly visible in the event details. Max 5MB per file. Supports: images, PDFs</small></div></div>');function hs(n,a){Ut(a,!1);let u=se(a,"attachments",24,()=>[]),i=se(a,"disabled",8,!1),e=se(a,"uploadingFile",8,!1);const t=$a();let d=X(),c=X(null),b=X("");const y=I=>{if(I===0)return"0 Bytes";const f=1024,m=["Bytes","KB","MB"],w=Math.floor(Math.log(I)/Math.log(f));return Math.round(I/Math.pow(f,w)*100)/100+" "+m[w]},o=I=>{const f=I.target;f.files&&f.files[0]&&(t("upload",f.files[0]),f.value="")},l=I=>{M(c,I.id),M(b,I.name)},s=I=>{r(b).trim()&&r(b)!==I.name&&t("edit",{attachment:I,newName:r(b).trim()}),M(c,null),M(b,"")},h=()=>{M(c,null),M(b,"")},v=I=>{t("remove",I)};Bt();var C=ms(),F=W(B(C),2);{var D=I=>{var f=vs();Sn(f,5,u,m=>m.id,(m,w)=>{var A=fs(),S=B(A),R=B(S);{var x=T=>{var Y=ls(),Q=gt(Y);mt(Q);var j=W(Q,2),$=B(j,!0);L(j),de(P=>{Q.disabled=i(),be($,P)},[()=>(r(w),te(()=>y(r(w).size)))]),Mt(Q,()=>r(b),P=>M(b,P)),Se("keydown",Q,P=>{P.key==="Enter"&&s(r(w)),P.key==="Escape"&&h()}),J(T,Y)},O=T=>{var Y=cs(),Q=gt(Y),j=B(Q,!0);L(Q);var $=W(Q,2),P=B($,!0);L($),de(N=>{be(j,(r(w),te(()=>r(w).name))),be(P,N)},[()=>(r(w),te(()=>y(r(w).size)))]),J(T,Y)};me(R,T=>{r(c),r(w),te(()=>r(c)===r(w).id)?T(x):T(O,!1)})}L(S);var _=W(S,2);{var p=T=>{var Y=us(),Q=gt(Y),j=W(Q,2);de(()=>{Q.disabled=i(),j.disabled=i()}),Se("click",Q,()=>s(r(w))),Se("click",j,h),J(T,Y)},z=T=>{var Y=ds(),Q=gt(Y),j=W(Q,2);de(()=>{Q.disabled=i(),j.disabled=i()}),Se("click",Q,()=>l(r(w))),Se("click",j,()=>v(r(w))),J(T,Y)};me(_,T=>{r(c),r(w),te(()=>r(c)===r(w).id)?T(p):T(z,!1)})}L(A),J(m,A)}),L(f),J(I,f)};me(F,I=>{le(u()),te(()=>u().length>0)&&I(D)})}var H=W(F,2),k=B(H),E=B(k);Kt(E,I=>M(d,I),()=>r(d));var U=W(E,2);{var g=I=>{en(I,{size:"sm"})};me(U,I=>{e()&&I(g)})}L(k),qe(2),L(H),L(C),de(()=>E.disabled=i()||e()),Se("change",E,o),J(n,C),Ot()}var ps=ne('<div class="modal svelte-xtxevo" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Edit Recurring Event</h5> <button type="button" class="btn-close" aria-label="Close"></button></div> <div class="modal-body"><p class="mb-3"><strong> </strong> is a recurring event.</p> <p class="mb-3">How would you like to edit it?</p> <div class="d-flex flex-column gap-2"><button type="button" class="btn btn-outline-primary text-start p-3"><div class="fw-bold">This occurrence only</div> <small class="text-muted"> </small></button> <button type="button" class="btn btn-outline-primary text-start p-3"><div class="fw-bold">This and future occurrences</div> <small class="text-muted"> </small></button> <button type="button" class="btn btn-outline-primary text-start p-3"><div class="fw-bold">All occurrences</div> <small class="text-muted">The entire series</small></button></div></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Cancel</button></div></div></div></div>');function _s(n,a){Ut(a,!1);const u=X();let i=se(a,"eventTitle",8),e=se(a,"occurrenceDate",8),t=se(a,"callback",8);function d(A){t()(A)}function c(){t()(null)}Ce(()=>(le(e()),Ne),()=>{M(u,(()=>{try{const[A,S,R]=e().split("-").map(Number),x=new Date(A,S-1,R);return Ne(x,"EEEE, MMMM d, yyyy")}catch{return e()}})())}),dn(),Bt();var b=ps(),y=B(b),o=B(y),l=B(o),s=W(B(l),2);L(l);var h=W(l,2),v=B(h),C=B(v),F=B(C);L(C),qe(),L(v);var D=W(v,4),H=B(D),k=W(B(H),2),E=B(k,!0);L(k),L(H);var U=W(H,2),g=W(B(U),2),I=B(g);L(g),L(U);var f=W(U,2);L(D),L(h);var m=W(h,2),w=B(m);L(m),L(o),L(y),L(b),de(()=>{be(F,`"${i()??""}"`),be(E,r(u)),be(I,`From ${r(u)??""} onwards`)}),Se("click",s,c),Se("click",H,()=>d("single")),Se("click",U,()=>d("future")),Se("click",f,()=>d("all")),Se("click",w,c),J(n,b),Ot()}var bs=ne('<div class="modal svelte-gu1ski" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-danger text-white"><h5 class="modal-title">Delete Recurring Event</h5> <button type="button" class="btn-close btn-close-white" aria-label="Close"></button></div> <div class="modal-body"><p class="mb-3"><strong> </strong> is a recurring event.</p> <p class="mb-3">What would you like to delete?</p> <div class="d-flex flex-column gap-2"><button type="button" class="btn btn-outline-danger text-start p-3"><div class="fw-bold">This occurrence only</div> <small class="text-muted"> </small></button> <button type="button" class="btn btn-outline-danger text-start p-3"><div class="fw-bold">This and future occurrences</div> <small class="text-muted"> </small></button> <button type="button" class="btn btn-outline-danger text-start p-3"><div class="fw-bold">All occurrences</div> <small class="text-muted">Delete the entire series</small></button></div></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Cancel</button></div></div></div></div>');function gs(n,a){Ut(a,!1);const u=X();let i=se(a,"eventTitle",8),e=se(a,"occurrenceDate",8),t=se(a,"callback",8);function d(A){t()(A)}function c(){t()(null)}Ce(()=>(le(e()),Ne),()=>{M(u,(()=>{try{const[A,S,R]=e().split("-").map(Number),x=new Date(A,S-1,R);return Ne(x,"EEEE, MMMM d, yyyy")}catch{return e()}})())}),dn(),Bt();var b=bs(),y=B(b),o=B(y),l=B(o),s=W(B(l),2);L(l);var h=W(l,2),v=B(h),C=B(v),F=B(C);L(C),qe(),L(v);var D=W(v,4),H=B(D),k=W(B(H),2),E=B(k,!0);L(k),L(H);var U=W(H,2),g=W(B(U),2),I=B(g);L(g),L(U);var f=W(U,2);L(D),L(h);var m=W(h,2),w=B(m);L(m),L(o),L(y),L(b),de(()=>{be(F,`"${i()??""}"`),be(E,r(u)),be(I,`From ${r(u)??""} onwards`)}),Se("click",s,c),Se("click",H,()=>d("single")),Se("click",U,()=>d("future")),Se("click",f,()=>d("all")),Se("click",w,c),J(n,b),Ot()}var ys=ne('<div class="modal fade" tabindex="-1" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title"> </h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div> <div class="modal-body"><p> </p> <div class="mb-3"><label for="cloneDate" class="form-label">Event Date</label> <input type="date" class="form-control" id="cloneDate"/></div></div> <div class="modal-footer"><button type="button"> </button> <button type="button"> </button></div></div></div></div>');function ws(n,a){Ut(a,!1);let u=se(a,"title",8,"Clone Event"),i=se(a,"message",8,"Select a date for the cloned event:"),e=se(a,"confirmButtonLabel",8,"Clone"),t=se(a,"confirmButtonCSS",8,"btn-primary"),d=se(a,"rejectButtonLabel",8,"Cancel"),c=se(a,"rejectButtonCSS",8,"btn-secondary"),b=se(a,"defaultDate",8,void 0),y=se(a,"callback",8,()=>{}),o=X(),l=X(b()||Ne(new Date,"yyyy-MM-dd")),s=!1,h;lr(()=>{const _=window.bootstrap.Modal;new _(r(o)).show(),r(o).addEventListener("hidden.bs.modal",()=>{s?y()(!0,h):y()(!1)})});function v(){s=!0,h=r(l),window.bootstrap.Modal.getInstance(r(o)).hide()}function C(){s=!1,window.bootstrap.Modal.getInstance(r(o)).hide()}Bt();var F=ys(),D=B(F),H=B(D),k=B(H),E=B(k),U=B(E,!0);L(E),qe(2),L(k);var g=W(k,2),I=B(g),f=B(I,!0);L(I);var m=W(I,2),w=W(B(m),2);mt(w),L(m),L(g);var A=W(g,2),S=B(A),R=B(S,!0);L(S);var x=W(S,2),O=B(x,!0);L(x),L(A),L(H),L(D),L(F),Kt(F,_=>M(o,_),()=>r(o)),de(()=>{be(U,u()),be(f,i()),Ze(S,1,`btn ${c()??""}`),be(R,d()),Ze(x,1,`btn ${t()??""}`),be(O,e())}),Mt(w,()=>r(l),_=>M(l,_)),Se("click",S,C),Se("click",x,v),J(n,F),Ot()}let In;function xs(n){if(typeof document>"u")return;const a=document.createElement("div");document.body.appendChild(a);const u={title:"Clone Event",message:"Select a date for the cloned event:",confirmButtonLabel:"Clone",confirmButtonCSS:"btn-primary",rejectButtonLabel:"Cancel",rejectButtonCSS:"btn-secondary",callback:()=>{console.log("callback")}};n.title&&(u.title=n.title),n.message&&(u.message=n.message),n.confirmButtonLabel&&(u.confirmButtonLabel=n.confirmButtonLabel),n.confirmButtonCSS&&(u.confirmButtonCSS=n.confirmButtonCSS),n.rejectButtonLabel&&(u.rejectButtonLabel=n.rejectButtonLabel),n.rejectButtonCSS&&(u.rejectButtonCSS=n.rejectButtonCSS),n.defaultDate&&(u.defaultDate=n.defaultDate),u.callback=(i,e)=>{console.log("Clone confirm result:",i,e),In&&(qa(In),In=void 0),a.remove(),n.callback&&typeof n.callback=="function"&&n.callback(i,e)},In=ja(ws,{target:a,props:u})}const Ds=Ja().shape({title:Pt().required("Title is required").min(3,"Title must be at least 3 characters").max(255,"Title cannot exceed 255 characters"),event_type:Pt().oneOf(["calendar_event","announcement"],"Invalid event type").required("Event type is required"),organization:Pt().required("Organization is required"),description:Pt().nullable().max(1e4,"Description is too long"),location:Pt().nullable().max(255,"Location cannot exceed 255 characters"),dateInput:Pt().when("event_type",{is:"calendar_event",then:n=>n.required("Date is required"),otherwise:n=>n.nullable()}),startTimeInput:Pt().when(["event_type","is_all_day"],{is:(n,a)=>n==="calendar_event"&&!a,then:n=>n.required("Start time is required"),otherwise:n=>n.nullable()}),endTimeInput:Pt().when(["event_type","is_all_day"],{is:(n,a)=>n==="calendar_event"&&!a,then:n=>n.required("End time is required"),otherwise:n=>n.nullable()}),isRecurring:Rr(),recurrenceFrequency:Pt().oneOf(["daily","weekly","monthly","yearly"]).nullable(),recurringDays:ei().of(ti().min(0).max(6)).when(["isRecurring","recurrenceFrequency"],{is:(n,a)=>n&&a==="weekly",then:n=>n.min(1,"Select at least one day for weekly recurring events").required(),otherwise:n=>n.nullable()}),hasEndDate:Rr(),recurrenceEndDate:Pt().when(["isRecurring","hasEndDate"],{is:(n,a)=>n&&a,then:n=>n.required("End date is required").test("is-future","End date must be in the future",function(a){if(!a)return!1;const u=new Date(a),i=new Date;return i.setHours(0,0,0,0),u>=i}),otherwise:n=>n.nullable()})});function Es(){const n=Jt({});async function a(e){try{return await Ds.validate(e,{abortEarly:!1}),n.set({}),!0}catch(t){if(t instanceof ni){const d={};return t.inner.forEach(c=>{c.path&&(d[c.path]=c.message)}),n.set(d),!1}return!1}}function u(){n.set({})}function i(){return Object.values(Dn(n)).filter(t=>t.length>0)}return{validationErrors:n,validate:a,clearErrors:u,getErrorMessages:i}}function yr(n){const{frequency:a,interval:u,recurringDays:i,recurrenceEndDate:e,hasEndDate:t,monthlyType:d,startTime:c}=n,b={0:Ye.SU,1:Ye.MO,2:Ye.TU,3:Ye.WE,4:Ye.TH,5:Ye.FR,6:Ye.SA},y={daily:Ye.DAILY,weekly:Ye.WEEKLY,monthly:Ye.MONTHLY,yearly:Ye.YEARLY},o=new Date(c),l=un(o,pt),s=new Date(l);s.setHours(12,0,0,0);const h=tn(s,pt),v={freq:y[a],interval:u,dtstart:h};if(t&&e){const F=new Date(`${e}T23:59:59.999`),D=tn(F,pt);v.until=D}if(a==="weekly"&&i.length>0)v.byweekday=i.map(F=>b[F]);else if(a==="monthly")if(d==="date")v.bymonthday=[s.getDate()];else{const F=Math.ceil(s.getDate()/7),D=s.getDay(),H=[Ye.SU,Ye.MO,Ye.TU,Ye.WE,Ye.TH,Ye.FR,Ye.SA];v.byweekday=[H[D].nth(F)]}else a==="yearly"&&(v.bymonth=[s.getMonth()+1],v.bymonthday=[s.getDate()]);return{recurrence_rule:new Ye(v).toString(),recurrence_end_date:t&&e?v.until.toISOString():void 0}}function oa(n,a){try{const i=Ye.fromString(n).origOptions,e={6:0,0:1,1:2,2:3,3:4,4:5,5:6},t={[Ye.DAILY]:"daily",[Ye.WEEKLY]:"weekly",[Ye.MONTHLY]:"monthly",[Ye.YEARLY]:"yearly"},d=(i.freq!==void 0?t[i.freq]:null)||"weekly",c=i.interval||1;let b=[],y="date";i.byweekday&&d==="weekly"&&(b=(Array.isArray(i.byweekday)?i.byweekday:[i.byweekday]).map(s=>{const h=typeof s=="number"?s:s.weekday;return e[h]})),d==="monthly"&&(i.bymonthday&&Array.isArray(i.bymonthday)&&i.bymonthday.length>0?y="date":i.byweekday&&(y="weekday"));let o="",l=!1;if(a){l=!0;const s=un(new Date(a),pt);o=Ne(s,"yyyy-MM-dd")}else if(i.until){l=!0;const s=un(i.until,pt);o=Ne(s,"yyyy-MM-dd")}return{frequency:d,interval:c,recurringDays:b,recurrenceEndDate:o,hasEndDate:l,monthlyType:y}}catch(u){return console.error("Failed to parse recurrence rule:",u),null}}function la(){return{recurrence_rule:void 0,recurrence_end_date:void 0}}function ca(){return{generateRecurrenceRule:yr,parseRecurrenceRule:oa,clearRecurrence:la}}const sr=Object.freeze(Object.defineProperty({__proto__:null,clearRecurrence:la,generateRecurrenceRule:yr,parseRecurrenceRule:oa,useRecurrenceLogic:ca},Symbol.toStringTag,{value:"Module"}));function Ss(n,a){return a.forEach(function(u){u&&typeof u!="string"&&!Array.isArray(u)&&Object.keys(u).forEach(function(i){if(i!=="default"&&!(i in n)){var e=Object.getOwnPropertyDescriptor(u,i);Object.defineProperty(n,i,e.get?e:{enumerable:!0,get:function(){return u[i]}})}})}),Object.freeze(n)}function ua(n,a){return new Promise(function(u,i){let e;return As(n).then(function(t){try{return e=t,u(new Blob([a.slice(0,2),e,a.slice(2)],{type:"image/jpeg"}))}catch(d){return i(d)}},i)})}const As=n=>new Promise((a,u)=>{const i=new FileReader;i.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let d=0;if(t.getUint16(d)!==65496)return u("not a valid JPEG");for(d+=2;;){const c=t.getUint16(d);if(c===65498)break;const b=t.getUint16(d+2);if(c===65505&&t.getUint32(d+4)===1165519206){const y=d+10;let o;switch(t.getUint16(y)){case 18761:o=!0;break;case 19789:o=!1;break;default:return u("TIFF header contains invalid endian")}if(t.getUint16(y+2,o)!==42)return u("TIFF header contains invalid version");const l=t.getUint32(y+4,o),s=y+l+2+12*t.getUint16(y+l,o);for(let h=y+l+2;h<s;h+=12)if(t.getUint16(h,o)==274){if(t.getUint16(h+2,o)!==3)return u("Orientation data type is invalid");if(t.getUint32(h+4,o)!==1)return u("Orientation data count is invalid");t.setUint16(h+8,1,o);break}return a(e.slice(d,d+2+b))}d+=2+b}return a(new Blob)}),i.readAsArrayBuffer(n)});var On={},ks={get exports(){return On},set exports(n){On=n}};(function(n){var a,u,i={};ks.exports=i,i.parse=function(e,t){for(var d=i.bin.readUshort,c=i.bin.readUint,b=0,y={},o=new Uint8Array(e),l=o.length-4;c(o,l)!=101010256;)l--;b=l,b+=4;var s=d(o,b+=4);d(o,b+=2);var h=c(o,b+=2),v=c(o,b+=4);b+=4,b=v;for(var C=0;C<s;C++){c(o,b),b+=4,b+=4,b+=4,c(o,b+=4),h=c(o,b+=4);var F=c(o,b+=4),D=d(o,b+=4),H=d(o,b+2),k=d(o,b+4);b+=6;var E=c(o,b+=8);b+=4,b+=D+H+k,i._readLocal(o,E,y,h,F,t)}return y},i._readLocal=function(e,t,d,c,b,y){var o=i.bin.readUshort,l=i.bin.readUint;l(e,t),o(e,t+=4),o(e,t+=2);var s=o(e,t+=2);l(e,t+=2),l(e,t+=4),t+=4;var h=o(e,t+=8),v=o(e,t+=2);t+=2;var C=i.bin.readUTF8(e,t,h);if(t+=h,t+=v,y)d[C]={size:b,csize:c};else{var F=new Uint8Array(e.buffer,t);if(s==0)d[C]=new Uint8Array(F.buffer.slice(t,t+c));else{if(s!=8)throw"unknown compression method: "+s;var D=new Uint8Array(b);i.inflateRaw(F,D),d[C]=D}}},i.inflateRaw=function(e,t){return i.F.inflate(e,t)},i.inflate=function(e,t){return e[0],e[1],i.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},i.deflate=function(e,t){t==null&&(t={level:6});var d=0,c=new Uint8Array(50+Math.floor(1.1*e.length));c[d]=120,c[d+1]=156,d+=2,d=i.F.deflateRaw(e,c,d,t.level);var b=i.adler(e,0,e.length);return c[d+0]=b>>>24&255,c[d+1]=b>>>16&255,c[d+2]=b>>>8&255,c[d+3]=b>>>0&255,new Uint8Array(c.buffer,0,d+4)},i.deflateRaw=function(e,t){t==null&&(t={level:6});var d=new Uint8Array(50+Math.floor(1.1*e.length)),c=i.F.deflateRaw(e,d,c,t.level);return new Uint8Array(d.buffer,0,c)},i.encode=function(e,t){t==null&&(t=!1);var d=0,c=i.bin.writeUint,b=i.bin.writeUshort,y={};for(var o in e){var l=!i._noNeed(o)&&!t,s=e[o],h=i.crc.crc(s,0,s.length);y[o]={cpr:l,usize:s.length,crc:h,file:l?i.deflateRaw(s):s}}for(var o in y)d+=y[o].file.length+30+46+2*i.bin.sizeUTF8(o);d+=22;var v=new Uint8Array(d),C=0,F=[];for(var o in y){var D=y[o];F.push(C),C=i._writeHeader(v,C,o,D,0)}var H=0,k=C;for(var o in y)D=y[o],F.push(C),C=i._writeHeader(v,C,o,D,1,F[H++]);var E=C-k;return c(v,C,101010256),C+=4,b(v,C+=4,H),b(v,C+=2,H),c(v,C+=2,E),c(v,C+=4,k),C+=4,C+=2,v.buffer},i._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},i._writeHeader=function(e,t,d,c,b,y){var o=i.bin.writeUint,l=i.bin.writeUshort,s=c.file;return o(e,t,b==0?67324752:33639248),t+=4,b==1&&(t+=2),l(e,t,20),l(e,t+=2,0),l(e,t+=2,c.cpr?8:0),o(e,t+=2,0),o(e,t+=4,c.crc),o(e,t+=4,s.length),o(e,t+=4,c.usize),l(e,t+=4,i.bin.sizeUTF8(d)),l(e,t+=2,0),t+=2,b==1&&(t+=2,t+=2,o(e,t+=6,y),t+=4),t+=i.bin.writeUTF8(e,t,d),b==0&&(e.set(s,t),t+=s.length),t},i.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var d=t,c=0;c<8;c++)1&d?d=3988292384^d>>>1:d>>>=1;e[t]=d}return e}(),update:function(e,t,d,c){for(var b=0;b<c;b++)e=i.crc.table[255&(e^t[d+b])]^e>>>8;return e},crc:function(e,t,d){return 4294967295^i.crc.update(4294967295,e,t,d)}},i.adler=function(e,t,d){for(var c=1,b=0,y=t,o=t+d;y<o;){for(var l=Math.min(y+5552,o);y<l;)b+=c+=e[y++];c%=65521,b%=65521}return b<<16|c},i.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255,e[t+2]=d>>16&255,e[t+3]=d>>24&255},readASCII:function(e,t,d){for(var c="",b=0;b<d;b++)c+=String.fromCharCode(e[t+b]);return c},writeASCII:function(e,t,d){for(var c=0;c<d.length;c++)e[t+c]=d.charCodeAt(c)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,d){for(var c,b="",y=0;y<d;y++)b+="%"+i.bin.pad(e[t+y].toString(16));try{c=decodeURIComponent(b)}catch{return i.bin.readASCII(e,t,d)}return c},writeUTF8:function(e,t,d){for(var c=d.length,b=0,y=0;y<c;y++){var o=d.charCodeAt(y);if(!(4294967168&o))e[t+b]=o,b++;else if(!(4294965248&o))e[t+b]=192|o>>6,e[t+b+1]=128|o>>0&63,b+=2;else if(!(4294901760&o))e[t+b]=224|o>>12,e[t+b+1]=128|o>>6&63,e[t+b+2]=128|o>>0&63,b+=3;else{if(4292870144&o)throw"e";e[t+b]=240|o>>18,e[t+b+1]=128|o>>12&63,e[t+b+2]=128|o>>6&63,e[t+b+3]=128|o>>0&63,b+=4}}return b},sizeUTF8:function(e){for(var t=e.length,d=0,c=0;c<t;c++){var b=e.charCodeAt(c);if(!(4294967168&b))d++;else if(!(4294965248&b))d+=2;else if(!(4294901760&b))d+=3;else{if(4292870144&b)throw"e";d+=4}}return d}},i.F={},i.F.deflateRaw=function(e,t,d,c){var b=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][c],y=i.F.U,o=i.F._goodIndex;i.F._hash;var l=i.F._putsE,s=0,h=d<<3,v=0,C=e.length;if(c==0){for(;s<C;)l(t,h,s+(A=Math.min(65535,C-s))==C?1:0),h=i.F._copyExact(e,s,A,t,h+8),s+=A;return h>>>3}var F=y.lits,D=y.strt,H=y.prev,k=0,E=0,U=0,g=0,I=0,f=0;for(C>2&&(D[f=i.F._hash(e,0)]=0),s=0;s<C;s++){if(I=f,s+1<C-2){f=i.F._hash(e,s+1);var m=s+1&32767;H[m]=D[f],D[f]=m}if(v<=s){(k>14e3||E>26697)&&C-s>100&&(v<s&&(F[k]=s-v,k+=2,v=s),h=i.F._writeBlock(s==C-1||v==C?1:0,F,k,g,e,U,s-U,t,h),k=E=g=0,U=s);var w=0;s<C-2&&(w=i.F._bestMatch(e,s,H,I,Math.min(b[2],C-s),b[3]));var A=w>>>16,S=65535&w;if(w!=0){S=65535&w;var R=o(A=w>>>16,y.of0);y.lhst[257+R]++;var x=o(S,y.df0);y.dhst[x]++,g+=y.exb[R]+y.dxb[x],F[k]=A<<23|s-v,F[k+1]=S<<16|R<<8|x,k+=2,v=s+A}else y.lhst[e[s]]++;E++}}for(U==s&&e.length!=0||(v<s&&(F[k]=s-v,k+=2,v=s),h=i.F._writeBlock(1,F,k,g,e,U,s-U,t,h),k=0,E=0,k=E=g=0,U=s);7&h;)h++;return h>>>3},i.F._bestMatch=function(e,t,d,c,b,y){var o=32767&t,l=d[o],s=o-l+32768&32767;if(l==o||c!=i.F._hash(e,t-s))return 0;for(var h=0,v=0,C=Math.min(32767,t);s<=C&&--y!=0&&l!=o;){if(h==0||e[t+h]==e[t+h-s]){var F=i.F._howLong(e,t,s);if(F>h){if(v=s,(h=F)>=b)break;s+2<F&&(F=s+2);for(var D=0,H=0;H<F-2;H++){var k=t-s+H+32768&32767,E=k-d[k]+32768&32767;E>D&&(D=E,l=k)}}}s+=(o=l)-(l=d[o])+32768&32767}return h<<16|v},i.F._howLong=function(e,t,d){if(e[t]!=e[t-d]||e[t+1]!=e[t+1-d]||e[t+2]!=e[t+2-d])return 0;var c=t,b=Math.min(e.length,t+258);for(t+=3;t<b&&e[t]==e[t-d];)t++;return t-c},i.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},i.saved=0,i.F._writeBlock=function(e,t,d,c,b,y,o,l,s){var h,v,C,F,D,H,k,E,U,g=i.F.U,I=i.F._putsF,f=i.F._putsE;g.lhst[256]++,v=(h=i.F.getTrees())[0],C=h[1],F=h[2],D=h[3],H=h[4],k=h[5],E=h[6],U=h[7];var m=32+(s+3&7?8-(s+3&7):0)+(o<<3),w=c+i.F.contSize(g.fltree,g.lhst)+i.F.contSize(g.fdtree,g.dhst),A=c+i.F.contSize(g.ltree,g.lhst)+i.F.contSize(g.dtree,g.dhst);A+=14+3*k+i.F.contSize(g.itree,g.ihst)+(2*g.ihst[16]+3*g.ihst[17]+7*g.ihst[18]);for(var S=0;S<286;S++)g.lhst[S]=0;for(S=0;S<30;S++)g.dhst[S]=0;for(S=0;S<19;S++)g.ihst[S]=0;var R=m<w&&m<A?0:w<A?1:2;if(I(l,s,e),I(l,s+1,R),s+=3,R==0){for(;7&s;)s++;s=i.F._copyExact(b,y,o,l,s)}else{var x,O;if(R==1&&(x=g.fltree,O=g.fdtree),R==2){i.F.makeCodes(g.ltree,v),i.F.revCodes(g.ltree,v),i.F.makeCodes(g.dtree,C),i.F.revCodes(g.dtree,C),i.F.makeCodes(g.itree,F),i.F.revCodes(g.itree,F),x=g.ltree,O=g.dtree,f(l,s,D-257),f(l,s+=5,H-1),f(l,s+=5,k-4),s+=4;for(var _=0;_<k;_++)f(l,s+3*_,g.itree[1+(g.ordr[_]<<1)]);s+=3*k,s=i.F._codeTiny(E,g.itree,l,s),s=i.F._codeTiny(U,g.itree,l,s)}for(var p=y,z=0;z<d;z+=2){for(var T=t[z],Y=T>>>23,Q=p+(8388607&T);p<Q;)s=i.F._writeLit(b[p++],x,l,s);if(Y!=0){var j=t[z+1],$=j>>16,P=j>>8&255,N=255&j;f(l,s=i.F._writeLit(257+P,x,l,s),Y-g.of0[P]),s+=g.exb[P],I(l,s=i.F._writeLit(N,O,l,s),$-g.df0[N]),s+=g.dxb[N],p+=Y}}s=i.F._writeLit(256,x,l,s)}return s},i.F._copyExact=function(e,t,d,c,b){var y=b>>>3;return c[y]=d,c[y+1]=d>>>8,c[y+2]=255-c[y],c[y+3]=255-c[y+1],y+=4,c.set(new Uint8Array(e.buffer,t,d),y),b+(d+4<<3)},i.F.getTrees=function(){for(var e=i.F.U,t=i.F._hufTree(e.lhst,e.ltree,15),d=i.F._hufTree(e.dhst,e.dtree,15),c=[],b=i.F._lenCodes(e.ltree,c),y=[],o=i.F._lenCodes(e.dtree,y),l=0;l<c.length;l+=2)e.ihst[c[l]]++;for(l=0;l<y.length;l+=2)e.ihst[y[l]]++;for(var s=i.F._hufTree(e.ihst,e.itree,7),h=19;h>4&&e.itree[1+(e.ordr[h-1]<<1)]==0;)h--;return[t,d,s,b,o,h,c,y]},i.F.getSecond=function(e){for(var t=[],d=0;d<e.length;d+=2)t.push(e[d+1]);return t},i.F.nonZero=function(e){for(var t="",d=0;d<e.length;d+=2)e[d+1]!=0&&(t+=(d>>1)+",");return t},i.F.contSize=function(e,t){for(var d=0,c=0;c<t.length;c++)d+=t[c]*e[1+(c<<1)];return d},i.F._codeTiny=function(e,t,d,c){for(var b=0;b<e.length;b+=2){var y=e[b],o=e[b+1];c=i.F._writeLit(y,t,d,c);var l=y==16?2:y==17?3:7;y>15&&(i.F._putsE(d,c,o,l),c+=l)}return c},i.F._lenCodes=function(e,t){for(var d=e.length;d!=2&&e[d-1]==0;)d-=2;for(var c=0;c<d;c+=2){var b=e[c+1],y=c+3<d?e[c+3]:-1,o=c+5<d?e[c+5]:-1,l=c==0?-1:e[c-1];if(b==0&&y==b&&o==b){for(var s=c+5;s+2<d&&e[s+2]==b;)s+=2;(h=Math.min(s+1-c>>>1,138))<11?t.push(17,h-3):t.push(18,h-11),c+=2*h-2}else if(b==l&&y==b&&o==b){for(s=c+5;s+2<d&&e[s+2]==b;)s+=2;var h=Math.min(s+1-c>>>1,6);t.push(16,h-3),c+=2*h-2}else t.push(b,0)}return d>>>1},i.F._hufTree=function(e,t,d){var c=[],b=e.length,y=t.length,o=0;for(o=0;o<y;o+=2)t[o]=0,t[o+1]=0;for(o=0;o<b;o++)e[o]!=0&&c.push({lit:o,f:e[o]});var l=c.length,s=c.slice(0);if(l==0)return 0;if(l==1){var h=c[0].lit;return s=h==0?1:0,t[1+(h<<1)]=1,t[1+(s<<1)]=1,1}c.sort(function(E,U){return E.f-U.f});var v=c[0],C=c[1],F=0,D=1,H=2;for(c[0]={lit:-1,f:v.f+C.f,l:v,r:C,d:0};D!=l-1;)v=F!=D&&(H==l||c[F].f<c[H].f)?c[F++]:c[H++],C=F!=D&&(H==l||c[F].f<c[H].f)?c[F++]:c[H++],c[D++]={lit:-1,f:v.f+C.f,l:v,r:C};var k=i.F.setDepth(c[D-1],0);for(k>d&&(i.F.restrictDepth(s,d,k),k=d),o=0;o<l;o++)t[1+(s[o].lit<<1)]=s[o].d;return k},i.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(i.F.setDepth(e.l,t+1),i.F.setDepth(e.r,t+1))},i.F.restrictDepth=function(e,t,d){var c=0,b=1<<d-t,y=0;for(e.sort(function(l,s){return s.d==l.d?l.f-s.f:s.d-l.d}),c=0;c<e.length&&e[c].d>t;c++){var o=e[c].d;e[c].d=t,y+=b-(1<<d-o)}for(y>>>=d-t;y>0;)(o=e[c].d)<t?(e[c].d++,y-=1<<t-o-1):c++;for(;c>=0;c--)e[c].d==t&&y<0&&(e[c].d--,y++);y!=0&&console.log("debt left")},i.F._goodIndex=function(e,t){var d=0;return t[16|d]<=e&&(d|=16),t[8|d]<=e&&(d|=8),t[4|d]<=e&&(d|=4),t[2|d]<=e&&(d|=2),t[1|d]<=e&&(d|=1),d},i.F._writeLit=function(e,t,d,c){return i.F._putsF(d,c,t[e<<1]),c+t[1+(e<<1)]},i.F.inflate=function(e,t){var d=Uint8Array;if(e[0]==3&&e[1]==0)return t||new d(0);var c=i.F,b=c._bitsF,y=c._bitsE,o=c._decodeTiny,l=c.makeCodes,s=c.codes2map,h=c._get17,v=c.U,C=t==null;C&&(t=new d(e.length>>>2<<3));for(var F,D,H=0,k=0,E=0,U=0,g=0,I=0,f=0,m=0,w=0;H==0;)if(H=b(e,w,1),k=b(e,w+1,2),w+=3,k!=0){if(C&&(t=i.F._check(t,m+(1<<17))),k==1&&(F=v.flmap,D=v.fdmap,I=511,f=31),k==2){E=y(e,w,5)+257,U=y(e,w+5,5)+1,g=y(e,w+10,4)+4,w+=14;for(var A=0;A<38;A+=2)v.itree[A]=0,v.itree[A+1]=0;var S=1;for(A=0;A<g;A++){var R=y(e,w+3*A,3);v.itree[1+(v.ordr[A]<<1)]=R,R>S&&(S=R)}w+=3*g,l(v.itree,S),s(v.itree,S,v.imap),F=v.lmap,D=v.dmap,w=o(v.imap,(1<<S)-1,E+U,e,w,v.ttree);var x=c._copyOut(v.ttree,0,E,v.ltree);I=(1<<x)-1;var O=c._copyOut(v.ttree,E,U,v.dtree);f=(1<<O)-1,l(v.ltree,x),s(v.ltree,x,F),l(v.dtree,O),s(v.dtree,O,D)}for(;;){var _=F[h(e,w)&I];w+=15&_;var p=_>>>4;if(!(p>>>8))t[m++]=p;else{if(p==256)break;var z=m+p-254;if(p>264){var T=v.ldef[p-257];z=m+(T>>>3)+y(e,w,7&T),w+=7&T}var Y=D[h(e,w)&f];w+=15&Y;var Q=Y>>>4,j=v.ddef[Q],$=(j>>>4)+b(e,w,15&j);for(w+=15&j,C&&(t=i.F._check(t,m+(1<<17)));m<z;)t[m]=t[m++-$],t[m]=t[m++-$],t[m]=t[m++-$],t[m]=t[m++-$];m=z}}}else{7&w&&(w+=8-(7&w));var P=4+(w>>>3),N=e[P-4]|e[P-3]<<8;C&&(t=i.F._check(t,m+N)),t.set(new d(e.buffer,e.byteOffset+P,N),m),w=P+N<<3,m+=N}return t.length==m?t:t.slice(0,m)},i.F._check=function(e,t){var d=e.length;if(t<=d)return e;var c=new Uint8Array(Math.max(d<<1,t));return c.set(e,0),c},i.F._decodeTiny=function(e,t,d,c,b,y){for(var o=i.F._bitsE,l=i.F._get17,s=0;s<d;){var h=e[l(c,b)&t];b+=15&h;var v=h>>>4;if(v<=15)y[s]=v,s++;else{var C=0,F=0;v==16?(F=3+o(c,b,2),b+=2,C=y[s-1]):v==17?(F=3+o(c,b,3),b+=3):v==18&&(F=11+o(c,b,7),b+=7);for(var D=s+F;s<D;)y[s]=C,s++}}return b},i.F._copyOut=function(e,t,d,c){for(var b=0,y=0,o=c.length>>>1;y<d;){var l=e[y+t];c[y<<1]=0,c[1+(y<<1)]=l,l>b&&(b=l),y++}for(;y<o;)c[y<<1]=0,c[1+(y<<1)]=0,y++;return b},i.F.makeCodes=function(e,t){for(var d,c,b,y,o=i.F.U,l=e.length,s=o.bl_count,h=0;h<=t;h++)s[h]=0;for(h=1;h<l;h+=2)s[e[h]]++;var v=o.next_code;for(d=0,s[0]=0,c=1;c<=t;c++)d=d+s[c-1]<<1,v[c]=d;for(b=0;b<l;b+=2)(y=e[b+1])!=0&&(e[b]=v[y],v[y]++)},i.F.codes2map=function(e,t,d){for(var c=e.length,b=i.F.U.rev15,y=0;y<c;y+=2)if(e[y+1]!=0)for(var o=y>>1,l=e[y+1],s=o<<4|l,h=t-l,v=e[y]<<h,C=v+(1<<h);v!=C;)d[b[v]>>>15-t]=s,v++},i.F.revCodes=function(e,t){for(var d=i.F.U.rev15,c=15-t,b=0;b<e.length;b+=2){var y=e[b]<<t-e[b+1];e[b]=d[y]>>>c}},i.F._putsE=function(e,t,d){d<<=7&t;var c=t>>>3;e[c]|=d,e[c+1]|=d>>>8},i.F._putsF=function(e,t,d){d<<=7&t;var c=t>>>3;e[c]|=d,e[c+1]|=d>>>8,e[c+2]|=d>>>16},i.F._bitsE=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<d)-1},i.F._bitsF=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<d)-1},i.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},i.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},i.F.U=(a=Uint16Array,u=Uint32Array,{next_code:new a(16),bl_count:new a(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new a(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new u(32),flmap:new a(512),fltree:[],fdmap:new a(32),fdtree:[],lmap:new a(32768),ltree:[],ttree:[],dmap:new a(32768),dtree:[],imap:new a(512),itree:[],rev15:new a(32768),lhst:new u(286),dhst:new u(30),ihst:new u(19),lits:new u(15e3),strt:new a(65536),prev:new a(32768)}),function(){for(var e=i.F.U,t=0;t<32768;t++){var d=t;d=(4278255360&(d=(4042322160&(d=(3435973836&(d=(2863311530&d)>>>1|(1431655765&d)<<1))>>>2|(858993459&d)<<2))>>>4|(252645135&d)<<4))>>>8|(16711935&d)<<8,e.rev15[t]=(d>>>16|d<<16)>>>17}function c(b,y,o){for(;y--!=0;)b.push(0,o)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];c(e.fltree,144,8),c(e.fltree,112,9),c(e.fltree,24,7),c(e.fltree,8,8),i.F.makeCodes(e.fltree,9),i.F.codes2map(e.fltree,9,e.flmap),i.F.revCodes(e.fltree,9),c(e.fdtree,32,5),i.F.makeCodes(e.fdtree,5),i.F.codes2map(e.fdtree,5,e.fdmap),i.F.revCodes(e.fdtree,5),c(e.itree,19,0),c(e.ltree,286,0),c(e.dtree,30,0),c(e.ttree,320,0)}()})();var Is=Ss({__proto__:null,default:On},[On]);const Tt=function(){var n={nextZero(o,l){for(;o[l]!=0;)l++;return l},readUshort:(o,l)=>o[l]<<8|o[l+1],writeUshort(o,l,s){o[l]=s>>8&255,o[l+1]=255&s},readUint:(o,l)=>16777216*o[l]+(o[l+1]<<16|o[l+2]<<8|o[l+3]),writeUint(o,l,s){o[l]=s>>24&255,o[l+1]=s>>16&255,o[l+2]=s>>8&255,o[l+3]=255&s},readASCII(o,l,s){let h="";for(let v=0;v<s;v++)h+=String.fromCharCode(o[l+v]);return h},writeASCII(o,l,s){for(let h=0;h<s.length;h++)o[l+h]=s.charCodeAt(h)},readBytes(o,l,s){const h=[];for(let v=0;v<s;v++)h.push(o[l+v]);return h},pad:o=>o.length<2?`0${o}`:o,readUTF8(o,l,s){let h,v="";for(let C=0;C<s;C++)v+=`%${n.pad(o[l+C].toString(16))}`;try{h=decodeURIComponent(v)}catch{return n.readASCII(o,l,s)}return h}};function a(o,l,s,h){const v=l*s,C=t(h),F=Math.ceil(l*C/8),D=new Uint8Array(4*v),H=new Uint32Array(D.buffer),{ctype:k}=h,{depth:E}=h,U=n.readUshort;if(k==6){const T=v<<2;if(E==8)for(var g=0;g<T;g+=4)D[g]=o[g],D[g+1]=o[g+1],D[g+2]=o[g+2],D[g+3]=o[g+3];if(E==16)for(g=0;g<T;g++)D[g]=o[g<<1]}else if(k==2){const T=h.tabs.tRNS;if(T==null){if(E==8)for(g=0;g<v;g++){var I=3*g;H[g]=255<<24|o[I+2]<<16|o[I+1]<<8|o[I]}if(E==16)for(g=0;g<v;g++)I=6*g,H[g]=255<<24|o[I+4]<<16|o[I+2]<<8|o[I]}else{var f=T[0];const Y=T[1],Q=T[2];if(E==8)for(g=0;g<v;g++){var m=g<<2;I=3*g,H[g]=255<<24|o[I+2]<<16|o[I+1]<<8|o[I],o[I]==f&&o[I+1]==Y&&o[I+2]==Q&&(D[m+3]=0)}if(E==16)for(g=0;g<v;g++)m=g<<2,I=6*g,H[g]=255<<24|o[I+4]<<16|o[I+2]<<8|o[I],U(o,I)==f&&U(o,I+2)==Y&&U(o,I+4)==Q&&(D[m+3]=0)}}else if(k==3){const T=h.tabs.PLTE,Y=h.tabs.tRNS,Q=Y?Y.length:0;if(E==1)for(var w=0;w<s;w++){var A=w*F,S=w*l;for(g=0;g<l;g++){m=S+g<<2;var R=3*(x=o[A+(g>>3)]>>7-((7&g)<<0)&1);D[m]=T[R],D[m+1]=T[R+1],D[m+2]=T[R+2],D[m+3]=x<Q?Y[x]:255}}if(E==2)for(w=0;w<s;w++)for(A=w*F,S=w*l,g=0;g<l;g++)m=S+g<<2,R=3*(x=o[A+(g>>2)]>>6-((3&g)<<1)&3),D[m]=T[R],D[m+1]=T[R+1],D[m+2]=T[R+2],D[m+3]=x<Q?Y[x]:255;if(E==4)for(w=0;w<s;w++)for(A=w*F,S=w*l,g=0;g<l;g++)m=S+g<<2,R=3*(x=o[A+(g>>1)]>>4-((1&g)<<2)&15),D[m]=T[R],D[m+1]=T[R+1],D[m+2]=T[R+2],D[m+3]=x<Q?Y[x]:255;if(E==8)for(g=0;g<v;g++){var x;m=g<<2,R=3*(x=o[g]),D[m]=T[R],D[m+1]=T[R+1],D[m+2]=T[R+2],D[m+3]=x<Q?Y[x]:255}}else if(k==4){if(E==8)for(g=0;g<v;g++){m=g<<2;var O=o[_=g<<1];D[m]=O,D[m+1]=O,D[m+2]=O,D[m+3]=o[_+1]}if(E==16)for(g=0;g<v;g++){var _;m=g<<2,O=o[_=g<<2],D[m]=O,D[m+1]=O,D[m+2]=O,D[m+3]=o[_+2]}}else if(k==0)for(f=h.tabs.tRNS?h.tabs.tRNS:-1,w=0;w<s;w++){const T=w*F,Y=w*l;if(E==1)for(var p=0;p<l;p++){var z=(O=255*(o[T+(p>>>3)]>>>7-(7&p)&1))==255*f?0:255;H[Y+p]=z<<24|O<<16|O<<8|O}else if(E==2)for(p=0;p<l;p++)z=(O=85*(o[T+(p>>>2)]>>>6-((3&p)<<1)&3))==85*f?0:255,H[Y+p]=z<<24|O<<16|O<<8|O;else if(E==4)for(p=0;p<l;p++)z=(O=17*(o[T+(p>>>1)]>>>4-((1&p)<<2)&15))==17*f?0:255,H[Y+p]=z<<24|O<<16|O<<8|O;else if(E==8)for(p=0;p<l;p++)z=(O=o[T+p])==f?0:255,H[Y+p]=z<<24|O<<16|O<<8|O;else if(E==16)for(p=0;p<l;p++)O=o[T+(p<<1)],z=U(o,T+(p<<1))==f?0:255,H[Y+p]=z<<24|O<<16|O<<8|O}return D}function u(o,l,s,h){const v=t(o),C=Math.ceil(s*v/8),F=new Uint8Array((C+1+o.interlace)*h);return l=o.tabs.CgBI?e(l,F):i(l,F),o.interlace==0?l=d(l,o,0,s,h):o.interlace==1&&(l=function(H,k){const E=k.width,U=k.height,g=t(k),I=g>>3,f=Math.ceil(E*g/8),m=new Uint8Array(U*f);let w=0;const A=[0,0,4,0,2,0,1],S=[0,4,0,2,0,1,0],R=[8,8,8,4,4,2,2],x=[8,8,4,4,2,2,1];let O=0;for(;O<7;){const p=R[O],z=x[O];let T=0,Y=0,Q=A[O];for(;Q<U;)Q+=p,Y++;let j=S[O];for(;j<E;)j+=z,T++;const $=Math.ceil(T*g/8);d(H,k,w,T,Y);let P=0,N=A[O];for(;N<U;){let K=S[O],re=w+P*$<<3;for(;K<E;){var _;if(g==1&&(_=(_=H[re>>3])>>7-(7&re)&1,m[N*f+(K>>3)]|=_<<7-((7&K)<<0)),g==2&&(_=(_=H[re>>3])>>6-(7&re)&3,m[N*f+(K>>2)]|=_<<6-((3&K)<<1)),g==4&&(_=(_=H[re>>3])>>4-(7&re)&15,m[N*f+(K>>1)]|=_<<4-((1&K)<<2)),g>=8){const G=N*f+K*I;for(let V=0;V<I;V++)m[G+V]=H[(re>>3)+V]}re+=g,K+=z}P++,N+=p}T*Y!=0&&(w+=Y*(1+$)),O+=1}return m}(l,o)),l}function i(o,l){return e(new Uint8Array(o.buffer,2,o.length-6),l)}var e=function(){const o={H:{}};return o.H.N=function(l,s){const h=Uint8Array;let v,C,F=0,D=0,H=0,k=0,E=0,U=0,g=0,I=0,f=0;if(l[0]==3&&l[1]==0)return s||new h(0);const m=o.H,w=m.b,A=m.e,S=m.R,R=m.n,x=m.A,O=m.Z,_=m.m,p=s==null;for(p&&(s=new h(l.length>>>2<<5));F==0;)if(F=w(l,f,1),D=w(l,f+1,2),f+=3,D!=0){if(p&&(s=o.H.W(s,I+(1<<17))),D==1&&(v=_.J,C=_.h,U=511,g=31),D==2){H=A(l,f,5)+257,k=A(l,f+5,5)+1,E=A(l,f+10,4)+4,f+=14;let T=1;for(var z=0;z<38;z+=2)_.Q[z]=0,_.Q[z+1]=0;for(z=0;z<E;z++){const j=A(l,f+3*z,3);_.Q[1+(_.X[z]<<1)]=j,j>T&&(T=j)}f+=3*E,R(_.Q,T),x(_.Q,T,_.u),v=_.w,C=_.d,f=S(_.u,(1<<T)-1,H+k,l,f,_.v);const Y=m.V(_.v,0,H,_.C);U=(1<<Y)-1;const Q=m.V(_.v,H,k,_.D);g=(1<<Q)-1,R(_.C,Y),x(_.C,Y,v),R(_.D,Q),x(_.D,Q,C)}for(;;){const T=v[O(l,f)&U];f+=15&T;const Y=T>>>4;if(!(Y>>>8))s[I++]=Y;else{if(Y==256)break;{let Q=I+Y-254;if(Y>264){const K=_.q[Y-257];Q=I+(K>>>3)+A(l,f,7&K),f+=7&K}const j=C[O(l,f)&g];f+=15&j;const $=j>>>4,P=_.c[$],N=(P>>>4)+w(l,f,15&P);for(f+=15&P;I<Q;)s[I]=s[I++-N],s[I]=s[I++-N],s[I]=s[I++-N],s[I]=s[I++-N];I=Q}}}}else{7&f&&(f+=8-(7&f));const T=4+(f>>>3),Y=l[T-4]|l[T-3]<<8;p&&(s=o.H.W(s,I+Y)),s.set(new h(l.buffer,l.byteOffset+T,Y),I),f=T+Y<<3,I+=Y}return s.length==I?s:s.slice(0,I)},o.H.W=function(l,s){const h=l.length;if(s<=h)return l;const v=new Uint8Array(h<<1);return v.set(l,0),v},o.H.R=function(l,s,h,v,C,F){const D=o.H.e,H=o.H.Z;let k=0;for(;k<h;){const E=l[H(v,C)&s];C+=15&E;const U=E>>>4;if(U<=15)F[k]=U,k++;else{let g=0,I=0;U==16?(I=3+D(v,C,2),C+=2,g=F[k-1]):U==17?(I=3+D(v,C,3),C+=3):U==18&&(I=11+D(v,C,7),C+=7);const f=k+I;for(;k<f;)F[k]=g,k++}}return C},o.H.V=function(l,s,h,v){let C=0,F=0;const D=v.length>>>1;for(;F<h;){const H=l[F+s];v[F<<1]=0,v[1+(F<<1)]=H,H>C&&(C=H),F++}for(;F<D;)v[F<<1]=0,v[1+(F<<1)]=0,F++;return C},o.H.n=function(l,s){const h=o.H.m,v=l.length;let C,F,D,H;const k=h.j;for(var E=0;E<=s;E++)k[E]=0;for(E=1;E<v;E+=2)k[l[E]]++;const U=h.K;for(C=0,k[0]=0,F=1;F<=s;F++)C=C+k[F-1]<<1,U[F]=C;for(D=0;D<v;D+=2)H=l[D+1],H!=0&&(l[D]=U[H],U[H]++)},o.H.A=function(l,s,h){const v=l.length,C=o.H.m.r;for(let F=0;F<v;F+=2)if(l[F+1]!=0){const D=F>>1,H=l[F+1],k=D<<4|H,E=s-H;let U=l[F]<<E;const g=U+(1<<E);for(;U!=g;)h[C[U]>>>15-s]=k,U++}},o.H.l=function(l,s){const h=o.H.m.r,v=15-s;for(let C=0;C<l.length;C+=2){const F=l[C]<<s-l[C+1];l[C]=h[F]>>>v}},o.H.M=function(l,s,h){h<<=7&s;const v=s>>>3;l[v]|=h,l[v+1]|=h>>>8},o.H.I=function(l,s,h){h<<=7&s;const v=s>>>3;l[v]|=h,l[v+1]|=h>>>8,l[v+2]|=h>>>16},o.H.e=function(l,s,h){return(l[s>>>3]|l[1+(s>>>3)]<<8)>>>(7&s)&(1<<h)-1},o.H.b=function(l,s,h){return(l[s>>>3]|l[1+(s>>>3)]<<8|l[2+(s>>>3)]<<16)>>>(7&s)&(1<<h)-1},o.H.Z=function(l,s){return(l[s>>>3]|l[1+(s>>>3)]<<8|l[2+(s>>>3)]<<16)>>>(7&s)},o.H.i=function(l,s){return(l[s>>>3]|l[1+(s>>>3)]<<8|l[2+(s>>>3)]<<16|l[3+(s>>>3)]<<24)>>>(7&s)},o.H.m=function(){const l=Uint16Array,s=Uint32Array;return{K:new l(16),j:new l(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new l(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new s(32),J:new l(512),_:[],h:new l(32),$:[],w:new l(32768),C:[],v:[],d:new l(32768),D:[],u:new l(512),Q:[],r:new l(32768),s:new s(286),Y:new s(30),a:new s(19),t:new s(15e3),k:new l(65536),g:new l(32768)}}(),function(){const l=o.H.m;for(var s=0;s<32768;s++){let v=s;v=(2863311530&v)>>>1|(1431655765&v)<<1,v=(3435973836&v)>>>2|(858993459&v)<<2,v=(4042322160&v)>>>4|(252645135&v)<<4,v=(4278255360&v)>>>8|(16711935&v)<<8,l.r[s]=(v>>>16|v<<16)>>>17}function h(v,C,F){for(;C--!=0;)v.push(0,F)}for(s=0;s<32;s++)l.q[s]=l.S[s]<<3|l.T[s],l.c[s]=l.p[s]<<4|l.z[s];h(l._,144,8),h(l._,112,9),h(l._,24,7),h(l._,8,8),o.H.n(l._,9),o.H.A(l._,9,l.J),o.H.l(l._,9),h(l.$,32,5),o.H.n(l.$,5),o.H.A(l.$,5,l.h),o.H.l(l.$,5),h(l.Q,19,0),h(l.C,286,0),h(l.D,30,0),h(l.v,320,0)}(),o.H.N}();function t(o){return[1,null,3,1,2,null,4][o.ctype]*o.depth}function d(o,l,s,h,v){let C=t(l);const F=Math.ceil(h*C/8);let D,H;C=Math.ceil(C/8);let k=o[s],E=0;if(k>1&&(o[s]=[0,0,1][k-2]),k==3)for(E=C;E<F;E++)o[E+1]=o[E+1]+(o[E+1-C]>>>1)&255;for(let U=0;U<v;U++)if(D=s+U*F,H=D+U+1,k=o[H-1],E=0,k==0)for(;E<F;E++)o[D+E]=o[H+E];else if(k==1){for(;E<C;E++)o[D+E]=o[H+E];for(;E<F;E++)o[D+E]=o[H+E]+o[D+E-C]}else if(k==2)for(;E<F;E++)o[D+E]=o[H+E]+o[D+E-F];else if(k==3){for(;E<C;E++)o[D+E]=o[H+E]+(o[D+E-F]>>>1);for(;E<F;E++)o[D+E]=o[H+E]+(o[D+E-F]+o[D+E-C]>>>1)}else{for(;E<C;E++)o[D+E]=o[H+E]+c(0,o[D+E-F],0);for(;E<F;E++)o[D+E]=o[H+E]+c(o[D+E-C],o[D+E-F],o[D+E-C-F])}return o}function c(o,l,s){const h=o+l-s,v=h-o,C=h-l,F=h-s;return v*v<=C*C&&v*v<=F*F?o:C*C<=F*F?l:s}function b(o,l,s){s.width=n.readUint(o,l),l+=4,s.height=n.readUint(o,l),l+=4,s.depth=o[l],l++,s.ctype=o[l],l++,s.compress=o[l],l++,s.filter=o[l],l++,s.interlace=o[l],l++}function y(o,l,s,h,v,C,F,D,H){const k=Math.min(l,v),E=Math.min(s,C);let U=0,g=0;for(let O=0;O<E;O++)for(let _=0;_<k;_++)if(F>=0&&D>=0?(U=O*l+_<<2,g=(D+O)*v+F+_<<2):(U=(-D+O)*l-F+_<<2,g=O*v+_<<2),H==0)h[g]=o[U],h[g+1]=o[U+1],h[g+2]=o[U+2],h[g+3]=o[U+3];else if(H==1){var I=o[U+3]*.00392156862745098,f=o[U]*I,m=o[U+1]*I,w=o[U+2]*I,A=h[g+3]*(1/255),S=h[g]*A,R=h[g+1]*A,x=h[g+2]*A;const p=1-I,z=I+A*p,T=z==0?0:1/z;h[g+3]=255*z,h[g+0]=(f+S*p)*T,h[g+1]=(m+R*p)*T,h[g+2]=(w+x*p)*T}else if(H==2)I=o[U+3],f=o[U],m=o[U+1],w=o[U+2],A=h[g+3],S=h[g],R=h[g+1],x=h[g+2],I==A&&f==S&&m==R&&w==x?(h[g]=0,h[g+1]=0,h[g+2]=0,h[g+3]=0):(h[g]=f,h[g+1]=m,h[g+2]=w,h[g+3]=I);else if(H==3){if(I=o[U+3],f=o[U],m=o[U+1],w=o[U+2],A=h[g+3],S=h[g],R=h[g+1],x=h[g+2],I==A&&f==S&&m==R&&w==x)continue;if(I<220&&A>20)return!1}return!0}return{decode:function(l){const s=new Uint8Array(l);let h=8;const v=n,C=v.readUshort,F=v.readUint,D={tabs:{},frames:[]},H=new Uint8Array(s.length);let k,E=0,U=0;const g=[137,80,78,71,13,10,26,10];for(var I=0;I<8;I++)if(s[I]!=g[I])throw"The input is not a PNG file!";for(;h<s.length;){const O=v.readUint(s,h);h+=4;const _=v.readASCII(s,h,4);if(h+=4,_=="IHDR")b(s,h,D);else if(_=="iCCP"){for(var f=h;s[f]!=0;)f++;v.readASCII(s,h,f-h),s[f+1];const p=s.slice(f+2,h+O);let z=null;try{z=i(p)}catch{z=e(p)}D.tabs[_]=z}else if(_=="CgBI")D.tabs[_]=s.slice(h,h+4);else if(_=="IDAT"){for(I=0;I<O;I++)H[E+I]=s[h+I];E+=O}else if(_=="acTL")D.tabs[_]={num_frames:F(s,h),num_plays:F(s,h+4)},k=new Uint8Array(s.length);else if(_=="fcTL"){U!=0&&((x=D.frames[D.frames.length-1]).data=u(D,k.slice(0,U),x.rect.width,x.rect.height),U=0);const p={x:F(s,h+12),y:F(s,h+16),width:F(s,h+4),height:F(s,h+8)};let z=C(s,h+22);z=C(s,h+20)/(z==0?100:z);const T={rect:p,delay:Math.round(1e3*z),dispose:s[h+24],blend:s[h+25]};D.frames.push(T)}else if(_=="fdAT"){for(I=0;I<O-4;I++)k[U+I]=s[h+I+4];U+=O-4}else if(_=="pHYs")D.tabs[_]=[v.readUint(s,h),v.readUint(s,h+4),s[h+8]];else if(_=="cHRM")for(D.tabs[_]=[],I=0;I<8;I++)D.tabs[_].push(v.readUint(s,h+4*I));else if(_=="tEXt"||_=="zTXt"){D.tabs[_]==null&&(D.tabs[_]={});var m=v.nextZero(s,h),w=v.readASCII(s,h,m-h),A=h+O-m-1;if(_=="tEXt")R=v.readASCII(s,m+1,A);else{var S=i(s.slice(m+2,m+2+A));R=v.readUTF8(S,0,S.length)}D.tabs[_][w]=R}else if(_=="iTXt"){D.tabs[_]==null&&(D.tabs[_]={}),m=0,f=h,m=v.nextZero(s,f),w=v.readASCII(s,f,m-f);const p=s[f=m+1];var R;s[f+1],f+=2,m=v.nextZero(s,f),v.readASCII(s,f,m-f),f=m+1,m=v.nextZero(s,f),v.readUTF8(s,f,m-f),A=O-((f=m+1)-h),p==0?R=v.readUTF8(s,f,A):(S=i(s.slice(f,f+A)),R=v.readUTF8(S,0,S.length)),D.tabs[_][w]=R}else if(_=="PLTE")D.tabs[_]=v.readBytes(s,h,O);else if(_=="hIST"){const p=D.tabs.PLTE.length/3;for(D.tabs[_]=[],I=0;I<p;I++)D.tabs[_].push(C(s,h+2*I))}else if(_=="tRNS")D.ctype==3?D.tabs[_]=v.readBytes(s,h,O):D.ctype==0?D.tabs[_]=C(s,h):D.ctype==2&&(D.tabs[_]=[C(s,h),C(s,h+2),C(s,h+4)]);else if(_=="gAMA")D.tabs[_]=v.readUint(s,h)/1e5;else if(_=="sRGB")D.tabs[_]=s[h];else if(_=="bKGD")D.ctype==0||D.ctype==4?D.tabs[_]=[C(s,h)]:D.ctype==2||D.ctype==6?D.tabs[_]=[C(s,h),C(s,h+2),C(s,h+4)]:D.ctype==3&&(D.tabs[_]=s[h]);else if(_=="IEND")break;h+=O,v.readUint(s,h),h+=4}var x;return U!=0&&((x=D.frames[D.frames.length-1]).data=u(D,k.slice(0,U),x.rect.width,x.rect.height)),D.data=u(D,H,D.width,D.height),delete D.compress,delete D.interlace,delete D.filter,D},toRGBA8:function(l){const s=l.width,h=l.height;if(l.tabs.acTL==null)return[a(l.data,s,h,l).buffer];const v=[];l.frames[0].data==null&&(l.frames[0].data=l.data);const C=s*h*4,F=new Uint8Array(C),D=new Uint8Array(C),H=new Uint8Array(C);for(let E=0;E<l.frames.length;E++){const U=l.frames[E],g=U.rect.x,I=U.rect.y,f=U.rect.width,m=U.rect.height,w=a(U.data,f,m,l);if(E!=0)for(var k=0;k<C;k++)H[k]=F[k];if(U.blend==0?y(w,f,m,F,s,h,g,I,0):U.blend==1&&y(w,f,m,F,s,h,g,I,1),v.push(F.buffer.slice(0)),U.dispose!=0){if(U.dispose==1)y(D,f,m,F,s,h,g,I,0);else if(U.dispose==2)for(k=0;k<C;k++)F[k]=H[k]}}return v},_paeth:c,_copyTile:y,_bin:n}}();(function(){const{_copyTile:n}=Tt,{_bin:a}=Tt,u=Tt._paeth;var i={table:function(){const f=new Uint32Array(256);for(let m=0;m<256;m++){let w=m;for(let A=0;A<8;A++)1&w?w=3988292384^w>>>1:w>>>=1;f[m]=w}return f}(),update(f,m,w,A){for(let S=0;S<A;S++)f=i.table[255&(f^m[w+S])]^f>>>8;return f},crc:(f,m,w)=>4294967295^i.update(4294967295,f,m,w)};function e(f,m,w,A){m[w]+=f[0]*A>>4,m[w+1]+=f[1]*A>>4,m[w+2]+=f[2]*A>>4,m[w+3]+=f[3]*A>>4}function t(f){return Math.max(0,Math.min(255,f))}function d(f,m){const w=f[0]-m[0],A=f[1]-m[1],S=f[2]-m[2],R=f[3]-m[3];return w*w+A*A+S*S+R*R}function c(f,m,w,A,S,R,x){x==null&&(x=1);const O=A.length,_=[];for(var p=0;p<O;p++){const N=A[p];_.push([N>>>0&255,N>>>8&255,N>>>16&255,N>>>24&255])}for(p=0;p<O;p++){let N=4294967295;for(var z=0,T=0;T<O;T++){var Y=d(_[p],_[T]);T!=p&&Y<N&&(N=Y,z=T)}}const Q=new Uint32Array(S.buffer),j=new Int16Array(m*w*4),$=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(p=0;p<$.length;p++)$[p]=255*(($[p]+.5)/16-.5);for(let N=0;N<w;N++)for(let K=0;K<m;K++){var P;p=4*(N*m+K),x!=2?P=[t(f[p]+j[p]),t(f[p+1]+j[p+1]),t(f[p+2]+j[p+2]),t(f[p+3]+j[p+3])]:(Y=$[4*(3&N)+(3&K)],P=[t(f[p]+Y),t(f[p+1]+Y),t(f[p+2]+Y),t(f[p+3]+Y)]),z=0;let re=16777215;for(T=0;T<O;T++){const ae=d(P,_[T]);ae<re&&(re=ae,z=T)}const G=_[z],V=[P[0]-G[0],P[1]-G[1],P[2]-G[2],P[3]-G[3]];x==1&&(K!=m-1&&e(V,j,p+4,7),N!=w-1&&(K!=0&&e(V,j,p+4*m-4,3),e(V,j,p+4*m,5),K!=m-1&&e(V,j,p+4*m+4,1))),R[p>>2]=z,Q[p>>2]=A[z]}}function b(f,m,w,A,S){S==null&&(S={});const{crc:R}=i,x=a.writeUint,O=a.writeUshort,_=a.writeASCII;let p=8;const z=f.frames.length>1;let T,Y=!1,Q=33+(z?20:0);if(S.sRGB!=null&&(Q+=13),S.pHYs!=null&&(Q+=21),S.iCCP!=null&&(T=pako.deflate(S.iCCP),Q+=21+T.length+4),f.ctype==3){for(var j=f.plte.length,$=0;$<j;$++)f.plte[$]>>>24!=255&&(Y=!0);Q+=8+3*j+4+(Y?8+1*j+4:0)}for(var P=0;P<f.frames.length;P++)z&&(Q+=38),Q+=(G=f.frames[P]).cimg.length+12,P!=0&&(Q+=4);Q+=12;const N=new Uint8Array(Q),K=[137,80,78,71,13,10,26,10];for($=0;$<8;$++)N[$]=K[$];if(x(N,p,13),p+=4,_(N,p,"IHDR"),p+=4,x(N,p,m),p+=4,x(N,p,w),p+=4,N[p]=f.depth,p++,N[p]=f.ctype,p++,N[p]=0,p++,N[p]=0,p++,N[p]=0,p++,x(N,p,R(N,p-17,17)),p+=4,S.sRGB!=null&&(x(N,p,1),p+=4,_(N,p,"sRGB"),p+=4,N[p]=S.sRGB,p++,x(N,p,R(N,p-5,5)),p+=4),S.iCCP!=null){const V=13+T.length;x(N,p,V),p+=4,_(N,p,"iCCP"),p+=4,_(N,p,"ICC profile"),p+=11,p+=2,N.set(T,p),p+=T.length,x(N,p,R(N,p-(V+4),V+4)),p+=4}if(S.pHYs!=null&&(x(N,p,9),p+=4,_(N,p,"pHYs"),p+=4,x(N,p,S.pHYs[0]),p+=4,x(N,p,S.pHYs[1]),p+=4,N[p]=S.pHYs[2],p++,x(N,p,R(N,p-13,13)),p+=4),z&&(x(N,p,8),p+=4,_(N,p,"acTL"),p+=4,x(N,p,f.frames.length),p+=4,x(N,p,S.loop!=null?S.loop:0),p+=4,x(N,p,R(N,p-12,12)),p+=4),f.ctype==3){for(x(N,p,3*(j=f.plte.length)),p+=4,_(N,p,"PLTE"),p+=4,$=0;$<j;$++){const V=3*$,ae=f.plte[$],De=255&ae,ge=ae>>>8&255,ke=ae>>>16&255;N[p+V+0]=De,N[p+V+1]=ge,N[p+V+2]=ke}if(p+=3*j,x(N,p,R(N,p-3*j-4,3*j+4)),p+=4,Y){for(x(N,p,j),p+=4,_(N,p,"tRNS"),p+=4,$=0;$<j;$++)N[p+$]=f.plte[$]>>>24&255;p+=j,x(N,p,R(N,p-j-4,j+4)),p+=4}}let re=0;for(P=0;P<f.frames.length;P++){var G=f.frames[P];z&&(x(N,p,26),p+=4,_(N,p,"fcTL"),p+=4,x(N,p,re++),p+=4,x(N,p,G.rect.width),p+=4,x(N,p,G.rect.height),p+=4,x(N,p,G.rect.x),p+=4,x(N,p,G.rect.y),p+=4,O(N,p,A[P]),p+=2,O(N,p,1e3),p+=2,N[p]=G.dispose,p++,N[p]=G.blend,p++,x(N,p,R(N,p-30,30)),p+=4);const V=G.cimg;x(N,p,(j=V.length)+(P==0?0:4)),p+=4;const ae=p;_(N,p,P==0?"IDAT":"fdAT"),p+=4,P!=0&&(x(N,p,re++),p+=4),N.set(V,p),p+=j,x(N,p,R(N,ae,p-ae)),p+=4}return x(N,p,0),p+=4,_(N,p,"IEND"),p+=4,x(N,p,R(N,p-4,4)),p+=4,N.buffer}function y(f,m,w){for(let A=0;A<f.frames.length;A++){const S=f.frames[A];S.rect.width;const R=S.rect.height,x=new Uint8Array(R*S.bpl+R);S.cimg=h(S.img,R,S.bpp,S.bpl,x,m,w)}}function o(f,m,w,A,S){const R=S[0],x=S[1],O=S[2],_=S[3],p=S[4],z=S[5];let T=6,Y=8,Q=255;for(var j=0;j<f.length;j++){const Me=new Uint8Array(f[j]);for(var $=Me.length,P=0;P<$;P+=4)Q&=Me[P+3]}const N=Q!=255,K=function(ce,ie,fe,Ee,he,ue){const _e=[];for(var pe=0;pe<ce.length;pe++){const Fe=new Uint8Array(ce[pe]),$e=new Uint32Array(Fe.buffer);var Re;let je=0,ct=0,Ge=ie,ut=fe,Ht=Ee?1:0;if(pe!=0){const hn=ue||Ee||pe==1||_e[pe-2].dispose!=0?1:2;let ee=0,oe=1e9;for(let Ie=0;Ie<hn;Ie++){var Be=new Uint8Array(ce[pe-1-Ie]);const Qe=new Uint32Array(ce[pe-1-Ie]);let yt=ie,Xe=fe,Te=-1,St=-1;for(let At=0;At<fe;At++)for(let kt=0;kt<ie;kt++)$e[Oe=At*ie+kt]!=Qe[Oe]&&(kt<yt&&(yt=kt),kt>Te&&(Te=kt),At<Xe&&(Xe=At),At>St&&(St=At));Te==-1&&(yt=Xe=Te=St=0),he&&((1&yt)==1&&yt--,(1&Xe)==1&&Xe--);const rn=(Te-yt+1)*(St-Xe+1);rn<oe&&(oe=rn,ee=Ie,je=yt,ct=Xe,Ge=Te-yt+1,ut=St-Xe+1)}Be=new Uint8Array(ce[pe-1-ee]),ee==1&&(_e[pe-1].dispose=2),Re=new Uint8Array(Ge*ut*4),n(Be,ie,fe,Re,Ge,ut,-je,-ct,0),Ht=n(Fe,ie,fe,Re,Ge,ut,-je,-ct,3)?1:0,Ht==1?s(Fe,ie,fe,Re,{x:je,y:ct,width:Ge,height:ut}):n(Fe,ie,fe,Re,Ge,ut,-je,-ct,0)}else Re=Fe.slice(0);_e.push({rect:{x:je,y:ct,width:Ge,height:ut},img:Re,blend:Ht,dispose:0})}if(Ee)for(pe=0;pe<_e.length;pe++){if((Et=_e[pe]).blend==1)continue;const Fe=Et.rect,$e=_e[pe-1].rect,je=Math.min(Fe.x,$e.x),ct=Math.min(Fe.y,$e.y),Ge={x:je,y:ct,width:Math.max(Fe.x+Fe.width,$e.x+$e.width)-je,height:Math.max(Fe.y+Fe.height,$e.y+$e.height)-ct};_e[pe-1].dispose=1,pe-1!=0&&l(ce,ie,fe,_e,pe-1,Ge,he),l(ce,ie,fe,_e,pe,Ge,he)}let ze=0;if(ce.length!=1)for(var Oe=0;Oe<_e.length;Oe++){var Et;ze+=(Et=_e[Oe]).rect.width*Et.rect.height}return _e}(f,m,w,R,x,O),re={},G=[],V=[];if(A!=0){const Me=[];for(P=0;P<K.length;P++)Me.push(K[P].img.buffer);const ce=function(he){let ue=0;for(var _e=0;_e<he.length;_e++)ue+=he[_e].byteLength;const pe=new Uint8Array(ue);let Re=0;for(_e=0;_e<he.length;_e++){const Be=new Uint8Array(he[_e]),ze=Be.length;for(let Oe=0;Oe<ze;Oe+=4){let Et=Be[Oe],Fe=Be[Oe+1],$e=Be[Oe+2];const je=Be[Oe+3];je==0&&(Et=Fe=$e=0),pe[Re+Oe]=Et,pe[Re+Oe+1]=Fe,pe[Re+Oe+2]=$e,pe[Re+Oe+3]=je}Re+=ze}return pe.buffer}(Me),ie=C(ce,A);for(P=0;P<ie.plte.length;P++)G.push(ie.plte[P].est.rgba);let fe=0;for(P=0;P<K.length;P++){const Ee=(De=K[P]).img.length;var ae=new Uint8Array(ie.inds.buffer,fe>>2,Ee>>2);V.push(ae);const he=new Uint8Array(ie.abuf,fe,Ee);z&&c(De.img,De.rect.width,De.rect.height,G,he,ae),De.img.set(he),fe+=Ee}}else for(j=0;j<K.length;j++){var De=K[j];const Me=new Uint32Array(De.img.buffer);var ge=De.rect.width;for($=Me.length,ae=new Uint8Array($),V.push(ae),P=0;P<$;P++){const ce=Me[P];if(P!=0&&ce==Me[P-1])ae[P]=ae[P-1];else if(P>ge&&ce==Me[P-ge])ae[P]=ae[P-ge];else{let ie=re[ce];if(ie==null&&(re[ce]=ie=G.length,G.push(ce),G.length>=300))break;ae[P]=ie}}}const ke=G.length;for(ke<=256&&p==0&&(Y=ke<=2?1:ke<=4?2:ke<=16?4:8,Y=Math.max(Y,_)),j=0;j<K.length;j++){(De=K[j]).rect.x,De.rect.y,ge=De.rect.width;const Me=De.rect.height;let ce=De.img;new Uint32Array(ce.buffer);let ie=4*ge,fe=4;if(ke<=256&&p==0){ie=Math.ceil(Y*ge/8);var Ae=new Uint8Array(ie*Me);const Ee=V[j];for(let he=0;he<Me;he++){P=he*ie;const ue=he*ge;if(Y==8)for(var ve=0;ve<ge;ve++)Ae[P+ve]=Ee[ue+ve];else if(Y==4)for(ve=0;ve<ge;ve++)Ae[P+(ve>>1)]|=Ee[ue+ve]<<4-4*(1&ve);else if(Y==2)for(ve=0;ve<ge;ve++)Ae[P+(ve>>2)]|=Ee[ue+ve]<<6-2*(3&ve);else if(Y==1)for(ve=0;ve<ge;ve++)Ae[P+(ve>>3)]|=Ee[ue+ve]<<7-1*(7&ve)}ce=Ae,T=3,fe=1}else if(N==0&&K.length==1){Ae=new Uint8Array(ge*Me*3);const Ee=ge*Me;for(P=0;P<Ee;P++){const he=3*P,ue=4*P;Ae[he]=ce[ue],Ae[he+1]=ce[ue+1],Ae[he+2]=ce[ue+2]}ce=Ae,T=2,fe=3,ie=3*ge}De.img=ce,De.bpl=ie,De.bpp=fe}return{ctype:T,depth:Y,plte:G,frames:K}}function l(f,m,w,A,S,R,x){const O=Uint8Array,_=Uint32Array,p=new O(f[S-1]),z=new _(f[S-1]),T=S+1<f.length?new O(f[S+1]):null,Y=new O(f[S]),Q=new _(Y.buffer);let j=m,$=w,P=-1,N=-1;for(let re=0;re<R.height;re++)for(let G=0;G<R.width;G++){const V=R.x+G,ae=R.y+re,De=ae*m+V,ge=Q[De];ge==0||A[S-1].dispose==0&&z[De]==ge&&(T==null||T[4*De+3]!=0)||(V<j&&(j=V),V>P&&(P=V),ae<$&&($=ae),ae>N&&(N=ae))}P==-1&&(j=$=P=N=0),x&&((1&j)==1&&j--,(1&$)==1&&$--),R={x:j,y:$,width:P-j+1,height:N-$+1};const K=A[S];K.rect=R,K.blend=1,K.img=new Uint8Array(R.width*R.height*4),A[S-1].dispose==0?(n(p,m,w,K.img,R.width,R.height,-R.x,-R.y,0),s(Y,m,w,K.img,R)):n(Y,m,w,K.img,R.width,R.height,-R.x,-R.y,0)}function s(f,m,w,A,S){n(f,m,w,A,S.width,S.height,-S.x,-S.y,2)}function h(f,m,w,A,S,R,x){const O=[];let _,p=[0,1,2,3,4];R!=-1?p=[R]:(m*A>5e5||w==1)&&(p=[0]),x&&(_={level:0});const z=Is;for(var T=0;T<p.length;T++){for(let j=0;j<m;j++)v(S,f,j,A,w,p[T]);O.push(z.deflate(S,_))}let Y,Q=1e9;for(T=0;T<O.length;T++)O[T].length<Q&&(Y=T,Q=O[T].length);return O[Y]}function v(f,m,w,A,S,R){const x=w*A;let O=x+w;if(f[O]=R,O++,R==0)if(A<500)for(var _=0;_<A;_++)f[O+_]=m[x+_];else f.set(new Uint8Array(m.buffer,x,A),O);else if(R==1){for(_=0;_<S;_++)f[O+_]=m[x+_];for(_=S;_<A;_++)f[O+_]=m[x+_]-m[x+_-S]+256&255}else if(w==0){for(_=0;_<S;_++)f[O+_]=m[x+_];if(R==2)for(_=S;_<A;_++)f[O+_]=m[x+_];if(R==3)for(_=S;_<A;_++)f[O+_]=m[x+_]-(m[x+_-S]>>1)+256&255;if(R==4)for(_=S;_<A;_++)f[O+_]=m[x+_]-u(m[x+_-S],0,0)+256&255}else{if(R==2)for(_=0;_<A;_++)f[O+_]=m[x+_]+256-m[x+_-A]&255;if(R==3){for(_=0;_<S;_++)f[O+_]=m[x+_]+256-(m[x+_-A]>>1)&255;for(_=S;_<A;_++)f[O+_]=m[x+_]+256-(m[x+_-A]+m[x+_-S]>>1)&255}if(R==4){for(_=0;_<S;_++)f[O+_]=m[x+_]+256-u(0,m[x+_-A],0)&255;for(_=S;_<A;_++)f[O+_]=m[x+_]+256-u(m[x+_-S],m[x+_-A],m[x+_-S-A])&255}}}function C(f,m){const w=new Uint8Array(f),A=w.slice(0),S=new Uint32Array(A.buffer),R=F(A,m),x=R[0],O=R[1],_=w.length,p=new Uint8Array(_>>2);let z;if(w.length<2e7)for(var T=0;T<_;T+=4)z=D(x,Y=w[T]*(1/255),Q=w[T+1]*(1/255),j=w[T+2]*(1/255),$=w[T+3]*(1/255)),p[T>>2]=z.ind,S[T>>2]=z.est.rgba;else for(T=0;T<_;T+=4){var Y=w[T]*.00392156862745098,Q=w[T+1]*(1/255),j=w[T+2]*(1/255),$=w[T+3]*(1/255);for(z=x;z.left;)z=H(z.est,Y,Q,j,$)<=0?z.left:z.right;p[T>>2]=z.ind,S[T>>2]=z.est.rgba}return{abuf:A.buffer,inds:p,plte:O}}function F(f,m,w){w==null&&(w=1e-4);const A=new Uint32Array(f.buffer),S={i0:0,i1:f.length,bst:null,est:null,tdst:0,left:null,right:null};S.bst=U(f,S.i0,S.i1),S.est=g(S.bst);const R=[S];for(;R.length<m;){let O=0,_=0;for(var x=0;x<R.length;x++)R[x].est.L>O&&(O=R[x].est.L,_=x);if(O<w)break;const p=R[_],z=k(f,A,p.i0,p.i1,p.est.e,p.est.eMq255);if(p.i0>=z||p.i1<=z){p.est.L=0;continue}const T={i0:p.i0,i1:z,bst:null,est:null,tdst:0,left:null,right:null};T.bst=U(f,T.i0,T.i1),T.est=g(T.bst);const Y={i0:z,i1:p.i1,bst:null,est:null,tdst:0,left:null,right:null};for(Y.bst={R:[],m:[],N:p.bst.N-T.bst.N},x=0;x<16;x++)Y.bst.R[x]=p.bst.R[x]-T.bst.R[x];for(x=0;x<4;x++)Y.bst.m[x]=p.bst.m[x]-T.bst.m[x];Y.est=g(Y.bst),p.left=T,p.right=Y,R[_]=T,R.push(Y)}for(R.sort((O,_)=>_.bst.N-O.bst.N),x=0;x<R.length;x++)R[x].ind=x;return[S,R]}function D(f,m,w,A,S){if(f.left==null)return f.tdst=function(T,Y,Q,j,$){const P=Y-T[0],N=Q-T[1],K=j-T[2],re=$-T[3];return P*P+N*N+K*K+re*re}(f.est.q,m,w,A,S),f;const R=H(f.est,m,w,A,S);let x=f.left,O=f.right;R>0&&(x=f.right,O=f.left);const _=D(x,m,w,A,S);if(_.tdst<=R*R)return _;const p=D(O,m,w,A,S);return p.tdst<_.tdst?p:_}function H(f,m,w,A,S){const{e:R}=f;return R[0]*m+R[1]*w+R[2]*A+R[3]*S-f.eMq}function k(f,m,w,A,S,R){for(A-=4;w<A;){for(;E(f,w,S)<=R;)w+=4;for(;E(f,A,S)>R;)A-=4;if(w>=A)break;const x=m[w>>2];m[w>>2]=m[A>>2],m[A>>2]=x,w+=4,A-=4}for(;E(f,w,S)>R;)w-=4;return w+4}function E(f,m,w){return f[m]*w[0]+f[m+1]*w[1]+f[m+2]*w[2]+f[m+3]*w[3]}function U(f,m,w){const A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S=[0,0,0,0],R=w-m>>2;for(let x=m;x<w;x+=4){const O=f[x]*.00392156862745098,_=f[x+1]*(1/255),p=f[x+2]*(1/255),z=f[x+3]*(1/255);S[0]+=O,S[1]+=_,S[2]+=p,S[3]+=z,A[0]+=O*O,A[1]+=O*_,A[2]+=O*p,A[3]+=O*z,A[5]+=_*_,A[6]+=_*p,A[7]+=_*z,A[10]+=p*p,A[11]+=p*z,A[15]+=z*z}return A[4]=A[1],A[8]=A[2],A[9]=A[6],A[12]=A[3],A[13]=A[7],A[14]=A[11],{R:A,m:S,N:R}}function g(f){const{R:m}=f,{m:w}=f,{N:A}=f,S=w[0],R=w[1],x=w[2],O=w[3],_=A==0?0:1/A,p=[m[0]-S*S*_,m[1]-S*R*_,m[2]-S*x*_,m[3]-S*O*_,m[4]-R*S*_,m[5]-R*R*_,m[6]-R*x*_,m[7]-R*O*_,m[8]-x*S*_,m[9]-x*R*_,m[10]-x*x*_,m[11]-x*O*_,m[12]-O*S*_,m[13]-O*R*_,m[14]-O*x*_,m[15]-O*O*_],z=p,T=I;let Y=[Math.random(),Math.random(),Math.random(),Math.random()],Q=0,j=0;if(A!=0)for(let P=0;P<16&&(Y=T.multVec(z,Y),j=Math.sqrt(T.dot(Y,Y)),Y=T.sml(1/j,Y),!(P!=0&&Math.abs(j-Q)<1e-9));P++)Q=j;const $=[S*_,R*_,x*_,O*_];return{Cov:p,q:$,e:Y,L:Q,eMq255:T.dot(T.sml(255,$),Y),eMq:T.dot(Y,$),rgba:(Math.round(255*$[3])<<24|Math.round(255*$[2])<<16|Math.round(255*$[1])<<8|Math.round(255*$[0])<<0)>>>0}}var I={multVec:(f,m)=>[f[0]*m[0]+f[1]*m[1]+f[2]*m[2]+f[3]*m[3],f[4]*m[0]+f[5]*m[1]+f[6]*m[2]+f[7]*m[3],f[8]*m[0]+f[9]*m[1]+f[10]*m[2]+f[11]*m[3],f[12]*m[0]+f[13]*m[1]+f[14]*m[2]+f[15]*m[3]],dot:(f,m)=>f[0]*m[0]+f[1]*m[1]+f[2]*m[2]+f[3]*m[3],sml:(f,m)=>[f*m[0],f*m[1],f*m[2],f*m[3]]};Tt.encode=function(m,w,A,S,R,x,O){S==null&&(S=0),O==null&&(O=!1);const _=o(m,w,A,S,[!1,!1,!1,0,O,!1]);return y(_,-1),b(_,w,A,R,x)},Tt.encodeLL=function(m,w,A,S,R,x,O,_){const p={ctype:0+(S==1?0:2)+(R==0?0:4),depth:x,frames:[]},z=(S+R)*x,T=z*w;for(let Y=0;Y<m.length;Y++)p.frames.push({rect:{x:0,y:0,width:w,height:A},img:new Uint8Array(m[Y]),blend:0,dispose:1,bpp:Math.ceil(z/8),bpl:Math.ceil(T/8)});return y(p,0,!0),b(p,w,A,O,_)},Tt.encode.compress=o,Tt.encode.dither=c,Tt.quantize=C,Tt.quantize.getKDtree=F,Tt.quantize.getNearest=D})();const da={toArrayBuffer(n,a){const u=n.width,i=n.height,e=u<<2,t=n.getContext("2d").getImageData(0,0,u,i),d=new Uint32Array(t.data.buffer),c=(32*u+31)/32<<2,b=c*i,y=122+b,o=new ArrayBuffer(y),l=new DataView(o),s=1<<20;let h,v,C,F,D=s,H=0,k=0,E=0;function U(f){l.setUint16(k,f,!0),k+=2}function g(f){l.setUint32(k,f,!0),k+=4}function I(f){k+=f}U(19778),g(y),I(4),g(122),g(108),g(u),g(-i>>>0),U(1),U(32),g(3),g(b),g(2835),g(2835),I(8),g(16711680),g(65280),g(255),g(4278190080),g(1466527264),function f(){for(;H<i&&D>0;){for(F=122+H*c,h=0;h<e;)D--,v=d[E++],C=v>>>24,l.setUint32(F+h,v<<8|C),h+=4;H++}E<d.length?(D=s,setTimeout(f,da._dly)):a(o)}()},toBlob(n,a){this.toArrayBuffer(n,u=>{a(new Blob([u],{type:"image/bmp"}))})},_dly:9};var bt={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Ts={[bt.CHROME]:16384,[bt.FIREFOX]:11180,[bt.DESKTOP_SAFARI]:16384,[bt.IE]:8192,[bt.IOS]:4096,[bt.ETC]:8192};const wr=typeof window<"u",fa=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Fn=wr&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Cs=(wr||fa)&&(Fn&&Fn.getOriginalSymbol(window,"File")||typeof File<"u"&&File),va=(wr||fa)&&(Fn&&Fn.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function xr(n,a,u=Date.now()){return new Promise(i=>{const e=n.split(","),t=e[0].match(/:(.*?);/)[1],d=globalThis.atob(e[1]);let c=d.length;const b=new Uint8Array(c);for(;c--;)b[c]=d.charCodeAt(c);const y=new Blob([b],{type:t});y.name=a,y.lastModified=u,i(y)})}function ma(n){return new Promise((a,u)=>{const i=new va;i.onload=()=>a(i.result),i.onerror=e=>u(e),i.readAsDataURL(n)})}function ha(n){return new Promise((a,u)=>{const i=new Image;i.onload=()=>a(i),i.onerror=e=>u(e),i.src=n})}function cn(){if(cn.cachedResult!==void 0)return cn.cachedResult;let n=bt.ETC;const{userAgent:a}=navigator;return/Chrom(e|ium)/i.test(a)?n=bt.CHROME:/iP(ad|od|hone)/i.test(a)&&/WebKit/i.test(a)?n=bt.IOS:/Safari/i.test(a)?n=bt.DESKTOP_SAFARI:/Firefox/i.test(a)?n=bt.FIREFOX:(/MSIE/i.test(a)||document.documentMode)&&(n=bt.IE),cn.cachedResult=n,cn.cachedResult}function pa(n,a){const u=cn(),i=Ts[u];let e=n,t=a,d=e*t;const c=e>t?t/e:e/t;for(;d>i*i;){const b=(i+e)/2,y=(i+t)/2;b<y?(t=y,e=y*c):(t=b*c,e=b),d=e*t}return{width:e,height:t}}function Ln(n,a){let u,i;try{if(u=new OffscreenCanvas(n,a),i=u.getContext("2d"),i===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{u=document.createElement("canvas"),i=u.getContext("2d")}return u.width=n,u.height=a,[u,i]}function _a(n,a){const{width:u,height:i}=pa(n.width,n.height),[e,t]=Ln(u,i);return a&&/jpe?g/.test(a)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(n,0,0,e.width,e.height),e}function Mn(){return Mn.cachedResult!==void 0||(Mn.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Mn.cachedResult}function Nn(n,a={}){return new Promise(function(u,i){let e,t;var d=function(){try{return t=_a(e,a.fileType||n.type),u([e,t])}catch(b){return i(b)}},c=function(b){try{var y=function(o){try{throw o}catch(l){return i(l)}};try{let o;return ma(n).then(function(l){try{return o=l,ha(o).then(function(s){try{return e=s,function(){try{return d()}catch(h){return i(h)}}()}catch(h){return y(h)}},y)}catch(s){return y(s)}},y)}catch(o){y(o)}}catch(o){return i(o)}};try{if(Mn()||[bt.DESKTOP_SAFARI,bt.MOBILE_SAFARI].includes(cn()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(n).then(function(b){try{return e=b,d()}catch{return c()}},c)}catch{c()}})}function Pn(n,a,u,i,e=1){return new Promise(function(t,d){let c;if(a==="image/png"){let y,o,l;return y=n.getContext("2d"),{data:o}=y.getImageData(0,0,n.width,n.height),l=Tt.encode([o.buffer],n.width,n.height,4096*e),c=new Blob([l],{type:a}),c.name=u,c.lastModified=i,b.call(this)}{let y=function(){return b.call(this)};if(a==="image/bmp")return new Promise(o=>da.toBlob(n,o)).then(function(o){try{return c=o,c.name=u,c.lastModified=i,y.call(this)}catch(l){return d(l)}}.bind(this),d);{let o=function(){return y.call(this)};if(typeof OffscreenCanvas=="function"&&n instanceof OffscreenCanvas)return n.convertToBlob({type:a,quality:e}).then(function(l){try{return c=l,c.name=u,c.lastModified=i,o.call(this)}catch(s){return d(s)}}.bind(this),d);{let l;return l=n.toDataURL(a,e),xr(l,u,i).then(function(s){try{return c=s,o.call(this)}catch(h){return d(h)}}.bind(this),d)}}}function b(){return t(c)}})}function Yt(n){n.width=0,n.height=0}function vn(){return new Promise(function(n,a){let u,i,e,t;return vn.cachedResult!==void 0?n(vn.cachedResult):xr("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(d){try{return u=d,Nn(u).then(function(c){try{return i=c[1],Pn(i,u.type,u.name,u.lastModified).then(function(b){try{return e=b,Yt(i),Nn(e).then(function(y){try{return t=y[0],vn.cachedResult=t.width===1&&t.height===2,n(vn.cachedResult)}catch(o){return a(o)}},a)}catch(y){return a(y)}},a)}catch(b){return a(b)}},a)}catch(c){return a(c)}},a)})}function ba(n){return new Promise((a,u)=>{const i=new va;i.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return a(-2);const d=t.byteLength;let c=2;for(;c<d;){if(t.getUint16(c+2,!1)<=8)return a(-1);const b=t.getUint16(c,!1);if(c+=2,b==65505){if(t.getUint32(c+=2,!1)!=1165519206)return a(-1);const y=t.getUint16(c+=6,!1)==18761;c+=t.getUint32(c+4,y);const o=t.getUint16(c,y);c+=2;for(let l=0;l<o;l++)if(t.getUint16(c+12*l,y)==274)return a(t.getUint16(c+12*l+8,y))}else{if((65280&b)!=65280)break;c+=t.getUint16(c,!1)}}return a(-1)},i.onerror=e=>u(e),i.readAsArrayBuffer(n)})}function ga(n,a){const{width:u}=n,{height:i}=n,{maxWidthOrHeight:e}=a;let t,d=n;return isFinite(e)&&(u>e||i>e)&&([d,t]=Ln(u,i),u>i?(d.width=e,d.height=i/u*e):(d.width=u/i*e,d.height=e),t.drawImage(n,0,0,d.width,d.height),Yt(n)),d}function ya(n,a){const{width:u}=n,{height:i}=n,[e,t]=Ln(u,i);switch(a>4&&a<9?(e.width=i,e.height=u):(e.width=u,e.height=i),a){case 2:t.transform(-1,0,0,1,u,0);break;case 3:t.transform(-1,0,0,-1,u,i);break;case 4:t.transform(1,0,0,-1,0,i);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,i,0);break;case 7:t.transform(0,-1,-1,0,i,u);break;case 8:t.transform(0,-1,1,0,0,u)}return t.drawImage(n,0,0,u,i),Yt(n),e}function qr(n,a,u=0){return new Promise(function(i,e){let t,d,c,b,y,o,l,s,h,v,C,F,D,H,k,E,U,g,I,f;function m(A=5){if(a.signal&&a.signal.aborted)throw a.signal.reason;t+=A,a.onProgress(Math.min(t,100))}function w(A){if(a.signal&&a.signal.aborted)throw a.signal.reason;t=Math.min(Math.max(A,t),100),a.onProgress(t)}return t=u,d=a.maxIteration||10,c=1024*a.maxSizeMB*1024,m(),Nn(n,a).then(function(A){try{return[,b]=A,m(),y=ga(b,a),m(),new Promise(function(S,R){var x;if(!(x=a.exifOrientation))return ba(n).then(function(_){try{return x=_,O.call(this)}catch(p){return R(p)}}.bind(this),R);function O(){return S(x)}return O.call(this)}).then(function(S){try{return o=S,m(),vn().then(function(R){try{return l=R?y:ya(y,o),m(),s=a.initialQuality||1,h=a.fileType||n.type,Pn(l,h,n.name,n.lastModified,s).then(function(x){try{{let _=function(){if(d--&&(k>c||k>D)){let z,T;return z=f?.95*I.width:I.width,T=f?.95*I.height:I.height,[U,g]=Ln(z,T),g.drawImage(I,0,0,z,T),s*=h==="image/png"?.85:.95,Pn(U,h,n.name,n.lastModified,s).then(function(Y){try{return E=Y,Yt(I),I=U,k=E.size,w(Math.min(99,Math.floor((H-k)/(H-c)*100))),_}catch(Q){return e(Q)}},e)}return[1]},p=function(){return Yt(I),Yt(U),Yt(y),Yt(l),Yt(b),w(100),i(E)};if(v=x,m(),C=v.size>c,F=v.size>n.size,!C&&!F)return w(100),i(v);var O;return D=n.size,H=v.size,k=H,I=l,f=!a.alwaysKeepResolution&&C,(O=function(z){for(;z;){if(z.then)return void z.then(O,e);try{if(z.pop){if(z.length)return z.pop()?p.call(this):z;z=_}else z=z.call(this)}catch(T){return e(T)}}}.bind(this))(_)}}catch(_){return e(_)}}.bind(this),e)}catch(x){return e(x)}}.bind(this),e)}catch(R){return e(R)}}.bind(this),e)}catch(S){return e(S)}}.bind(this),e)})}const Ms=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Xn;function Rs(n,a){return new Promise((u,i)=>{Xn||(Xn=function(d){const c=[];return c.push(d),URL.createObjectURL(new Blob(c))}(Ms));const e=new Worker(Xn);e.addEventListener("message",function(d){if(a.signal&&a.signal.aborted)e.terminate();else if(d.data.progress===void 0){if(d.data.error)return i(new Error(d.data.error)),void e.terminate();u(d.data.file),e.terminate()}else a.onProgress(d.data.progress)}),e.addEventListener("error",i),a.signal&&a.signal.addEventListener("abort",()=>{i(a.signal.reason),e.terminate()}),e.postMessage({file:n,imageCompressionLibUrl:a.libURL,options:{...a,onProgress:void 0,signal:void 0}})})}function ot(n,a){return new Promise(function(u,i){let e,t,d,c,b,y;if(e={...a},d=0,{onProgress:c}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,b=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=h=>{d=h,typeof c=="function"&&c(d)},!(n instanceof Blob||n instanceof Cs))return i(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(n.type))return i(new Error("The file given is not an image"));if(y=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!b||typeof Worker!="function"||y)return qr(n,e).then(function(h){try{return t=h,s.call(this)}catch(v){return i(v)}}.bind(this),i);var o=function(){try{return s.call(this)}catch(h){return i(h)}}.bind(this),l=function(h){try{return qr(n,e).then(function(v){try{return t=v,o()}catch(C){return i(C)}},i)}catch(v){return i(v)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Rs(n,e).then(function(h){try{return t=h,o()}catch{return l()}},l)}catch{l()}function s(){try{t.name=n.name,t.lastModified=n.lastModified}catch{}try{e.preserveExif&&n.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===n.type)&&(t=ua(n,t))}catch{}return u(t)}})}ot.getDataUrlFromFile=ma,ot.getFilefromDataUrl=xr,ot.loadImage=ha,ot.drawImageInCanvas=_a,ot.drawFileInCanvas=Nn,ot.canvasToFile=Pn,ot.getExifOrientation=ba,ot.handleMaxWidthOrHeight=ga,ot.followExifOrientation=ya,ot.cleanupCanvasMemory=Yt,ot.isAutoOrientationInBrowser=vn,ot.approximateBelowMaximumCanvasSizeOfBrowser=pa,ot.copyExifWithoutOrientation=ua,ot.getBrowserName=cn,ot.version="2.0.2";const Us={maxSizeMB:.8,maxWidthOrHeight:2400,initialQuality:.9,useWebWorker:!0,compressionThresholdMB:1};async function Os(n,a,u={},i){const e={...Us,...u};try{let t=n;if(n.type.startsWith("image/")&&n.size>e.compressionThresholdMB*1024*1024){i?.("Compressing image...");try{const b=await ot(n,{maxSizeMB:e.maxSizeMB,maxWidthOrHeight:e.maxWidthOrHeight,initialQuality:e.initialQuality,useWebWorker:e.useWebWorker});t=b;const y=(n.size/(1024*1024)).toFixed(2),o=(b.size/(1024*1024)).toFixed(2),l=((1-b.size/n.size)*100).toFixed(0);console.log(`Image compressed: ${y}MB → ${o}MB (${l}% smaller)`)}catch(b){console.warn("Image compression failed, uploading original:",b)}}return i?.("Uploading file..."),{success:!0,attachment:await aa(t,a)}}catch(t){return console.error("File upload failed:",t),{success:!1,error:t instanceof Error?t.message:"Upload failed"}}}async function Fs(n){try{const a=_r(n.url);return await ia(a),!0}catch(a){return console.error("Failed to remove attachment:",a),!1}}function Ns(n,a,u){return n.map(i=>i.id===a?{...i,name:u}:i)}function Ps(n,a=5){const u=n.type.startsWith("image/"),i=a*1024*1024;if(!u&&n.size>i){const e=(n.size/1048576).toFixed(2);return{valid:!1,error:`Non-image files must be under ${a}MB (selected file is ${e}MB)`}}return{valid:!0}}function Ys(n){return{uploadAttachment:(a,u,i)=>Os(a,u,n,i),removeAttachment:Fs,updateAttachmentName:Ns,validateFile:Ps}}const Ls=`${cr}/functions/v1/calendar-event-changes`;async function Dr(n,a,u){if(!(!n||typeof fetch>"u"))try{const i=await fetch(Ls,{method:"POST",headers:ur(!0,{useAuthToken:!0}),body:JSON.stringify({event_id:n,old_event:a,new_event:u})});if(!i.ok){const e=await i.text();console.error("Failed to send change notification:",e)}}catch(i){console.error("Error sending change notification:",i)}}function Qr(n,a){const[u,i]=a.split(":").map(Number);let e=ai(n,u);return e=ii(e,i),e}function Kr(n){return Array.from(new Set(n)).sort((a,u)=>a-u)}function Bs(n,a){if(a.includes(n))return 0;const u=a.find(i=>i>n);return u!==void 0?u-n:7-n+a[0]}function Hs(n,a,u){const i=new Date(n),e=un(i,pt),t=e.getDay(),d=Bs(t,u);if(d===0)return{start_time:n,end_time:a};const c=En(e,d),b=tn(c,pt);let y=a;if(a){const o=un(new Date(a),pt),l=En(o,d);y=tn(l,pt).toISOString()}return{start_time:b.toISOString(),end_time:y}}function wa({eventItem:n,dateInput:a,startTimeInput:u,endTimeInput:i,attachments:e,isRecurring:t,recurrenceFrequency:d,recurrenceInterval:c,recurringDays:b,recurrenceEndDate:y,hasEndDate:o,monthlyType:l}){const s=!n.id,h={...n.meta_data??{}};if(n.organization){h.organization=n.organization;const g=Ii(n.organization);g?.label&&(h.organization_label=g.label)}const v=Yn(),C=v?Dn(v.stores.currentUser):void 0;if(s){const g=v?Dn(v.stores.userOrganizations):void 0,I=C?.displayName||C?.username,f=C?.id;I&&!h.submitted_by_name&&(h.submitted_by_name=I),f&&!h.submitted_by_user_id&&(h.submitted_by_user_id=f);const m=g?Array.from(g):[];m.length&&!h.submitted_by_organizations&&(h.submitted_by_organizations=m),h.submitted_at||(h.submitted_at=new Date().toISOString())}else{const g=C?.displayName||C?.username;g&&(h.edited_by_name=g),C?.id&&(h.edited_by_user_id=C.id),h.edited_at=new Date().toISOString()}const F=Object.keys(h).length?h:void 0,D={title:n.title,description:n.description,location:n.location,is_public:n.is_public??!0,event_type:n.event_type,meta_data:F,attachments:e.length>0?e:null};if(n.event_type!=="calendar_event")return{...D,start_time:void 0,end_time:void 0,is_all_day:void 0,recurrence_rule:void 0,recurrence_end_date:void 0};const H=a?Rn(a,"yyyy-MM-dd",new Date):new Date;let k,E;if(n.is_all_day){const g=tn(H,pt);k=g.toISOString(),E=g.toISOString()}else{const g=new Date(H.getTime()),I=new Date(H.getTime()),f=u?Qr(g,u):H,m=i?Qr(I,i):H;k=tn(f,pt).toISOString(),E=tn(m,pt).toISOString()}const U={...D,start_time:k,end_time:E,is_all_day:n.is_all_day};if(t&&U.start_time){if(d==="weekly"&&b.length>0){const I=Kr(b),f=Hs(U.start_time,U.end_time,I);U.start_time=f.start_time,U.end_time=f.end_time}if(d==="daily"||d==="yearly"||d==="weekly"&&b.length>0||d==="monthly"){const{recurrence_rule:I,recurrence_end_date:f}=yr({frequency:d,interval:c,recurringDays:d==="weekly"?Kr(b):[],recurrenceEndDate:y,hasEndDate:o,monthlyType:l,startTime:U.start_time});U.recurrence_rule=I,U.recurrence_end_date=f}else U.recurrence_rule=void 0,U.recurrence_end_date=void 0}else U.recurrence_rule=void 0,U.recurrence_end_date=void 0;return U}async function zs({id:n,...a}){const u=wa(a);if(n){const e=await Lt(n);a.eventItem.bishop_approval==="NO"&&Object.assign(u,{bishop_approval:null,bishop_approval_at:null,bishop_approval_by_user_id:null,first_counselor_approval:null,first_counselor_approval_at:null,first_counselor_approval_by_user_id:null,second_counselor_approval:null,second_counselor_approval_at:null,second_counselor_approval_by_user_id:null});const d=await Rt(n,u);return d&&e&&Dr(n,e,d),{action:"update",event:d}}return{action:"create",event:await hr(u)}}async function Ws(n){await pr(n)}function $s({event:n,newDate:a}){const u=n.start_time?new Date(n.start_time):new Date,i=n.end_time?new Date(n.end_time):new Date,[e,t,d]=a.split("-").map(Number),c=new Date(u);c.setFullYear(e,t-1,d);const b=new Date(i);return b.setFullYear(e,t-1,d),{...n,id:void 0,title:`CLONED - ${n.title}`,start_time:c.toISOString(),end_time:b.toISOString(),attachments:[],recurrence_rule:void 0,recurrence_end_date:void 0}}async function js(n,a,u){const i=await Lt(n);if(!i)throw new Error("Event not found");const e=i.recurrence_exceptions||[];e.includes(a)||e.push(a);const t=i.recurrence_overrides||{};t[a]={title:u.title,description:u.description,location:u.location,start_time:u.start_time,end_time:u.end_time,is_all_day:u.is_all_day,meta_data:u.meta_data},await Rt(n,{recurrence_exceptions:e,recurrence_overrides:t})}async function qs(n,a,u){const i=await Lt(n);if(!i||!i.recurrence_rule||!i.start_time)throw new Error("Event not found or is not recurring");const{parseRecurrenceRule:e,generateRecurrenceRule:t}=await xn(async()=>{const{parseRecurrenceRule:E,generateRecurrenceRule:U}=await Promise.resolve().then(()=>sr);return{parseRecurrenceRule:E,generateRecurrenceRule:U}},void 0,import.meta.url),d=e(i.recurrence_rule,i.recurrence_end_date);if(!d)throw new Error("Failed to parse recurrence rule");const c=Ne(new Date(i.start_time),"yyyy-MM-dd"),b=Rn(a,"yyyy-MM-dd",new Date),y=Rn(c,"yyyy-MM-dd",new Date);if(b<=y)return await Rt(n,u),n;const o=En(b,-1),l=Ne(o,"yyyy-MM-dd"),{recurrence_rule:s,recurrence_end_date:h}=t({frequency:d.frequency,interval:d.interval,recurringDays:d.recurringDays,recurrenceEndDate:l,hasEndDate:!0,monthlyType:d.monthlyType,startTime:i.start_time});await Rt(n,{recurrence_rule:s,recurrence_end_date:h});const v=await Lt(n);v&&Dr(n,i,v);const C=d.hasEndDate?d.recurrenceEndDate:"",{recurrence_rule:F,recurrence_end_date:D}=t({frequency:d.frequency,interval:d.interval,recurringDays:d.recurringDays,recurrenceEndDate:C,hasEndDate:d.hasEndDate,monthlyType:d.monthlyType,startTime:u.start_time||i.start_time}),H={...u,recurrence_rule:F,recurrence_end_date:D};return(await hr(H))?.id||0}async function Qs(n,a){const u=await Lt(n);if(!u)throw new Error("Event not found");const i={title:a.title,description:a.description,location:a.location,event_type:a.event_type,meta_data:a.meta_data,attachments:a.attachments,is_all_day:a.is_all_day,start_time:u.start_time,end_time:u.end_time,recurrence_rule:u.recurrence_rule,recurrence_end_date:u.recurrence_end_date,recurrence_exceptions:[],recurrence_overrides:{}};await Rt(n,i);const e=await Lt(n);e&&Dr(n,u,e)}async function Ks(n,a){const u=await Lt(n);if(!u)throw new Error("Event not found");const i=u.recurrence_exceptions||[];i.includes(a)||i.push(a);const e=u.recurrence_overrides||{};e[a]&&delete e[a],await Rt(n,{recurrence_exceptions:i,recurrence_overrides:e})}async function Vs(n,a){const u=await Lt(n);if(!u||!u.recurrence_rule||!u.start_time)throw new Error("Event not found or is not recurring");const i=Rn(a,"yyyy-MM-dd",new Date),e=En(i,-1),t=Ne(e,"yyyy-MM-dd"),{parseRecurrenceRule:d}=await xn(async()=>{const{parseRecurrenceRule:l}=await Promise.resolve().then(()=>sr);return{parseRecurrenceRule:l}},void 0,import.meta.url),c=d(u.recurrence_rule,u.recurrence_end_date);if(!c)throw new Error("Failed to parse recurrence rule");const{generateRecurrenceRule:b}=await xn(async()=>{const{generateRecurrenceRule:l}=await Promise.resolve().then(()=>sr);return{generateRecurrenceRule:l}},void 0,import.meta.url),{recurrence_rule:y,recurrence_end_date:o}=b({frequency:c.frequency,interval:c.interval,recurringDays:c.recurringDays,recurrenceEndDate:t,hasEndDate:!0,monthlyType:c.monthlyType,startTime:u.start_time});await Rt(n,{recurrence_rule:y,recurrence_end_date:o})}async function Zs(n){await pr(n)}function Gs(){return{saveEvent:zs,deleteEventById:Ws,cloneEventForDate:$s,buildEventPayload:wa,saveSingleInstance:js,saveFutureInstances:qs,saveAllInstances:Qs,deleteSingleInstance:Ks,deleteFutureInstances:Vs,deleteAllInstances:Zs}}var Xs=ne('<div class="d-flex justify-content-center py-3"><!></div>'),Js=ne('<div class="text-muted text-center py-3 small">No messages yet</div>'),eo=ne('<div class="message-meta text-muted mt-1 text-end svelte-12d50yj"><div> </div> <div> </div></div>'),to=ne('<div class="message-meta text-muted mt-1 text-end svelte-12d50yj"> </div>'),no=ne('<i class="bi bi-trash"></i>'),ro=ne('<button type="button" class="btn btn-link btn-sm text-danger p-0 mt-1 delete-btn d-block ms-auto svelte-12d50yj" title="Delete message"><!></button>'),ao=ne('<div><div><div class="message-text svelte-12d50yj"> </div> <!> <!></div></div>'),io=ne('<i class="bi bi-send"></i>'),so=ne('<div class="messages-container svelte-12d50yj"><!></div> <div class="input-area d-flex gap-2 pt-2 svelte-12d50yj"><textarea class="form-control svelte-12d50yj" rows="2" placeholder="Type a message..."></textarea> <button type="button" class="btn btn-primary btn-sm align-self-end" title="Send message"><!></button></div>',1),oo=ne("<div><!></div>");function or(n,a){Ut(a,!1);let u=se(a,"comments",24,()=>[]),i=se(a,"currentUserId",8),e=se(a,"onSend",8),t=se(a,"onDelete",8),d=se(a,"loading",8,!1),c=se(a,"disabled",8,!1),b=se(a,"fullHeight",8,!1),y=X(""),o=X(!1),l=X(null),s=X();function h(){r(s)&&requestAnimationFrame(()=>{Tn(s,r(s).scrollTop=r(s).scrollHeight)})}function v(f){try{return ri(ln(f),{addSuffix:!0})}catch{return""}}function C(f){return f.user_id===i()}async function F(){const f=r(y).trim();if(!(!f||r(o)||c())){M(o,!0);try{await e()(f),M(y,""),h()}catch(m){console.error("Failed to send message:",m)}finally{M(o,!1)}}}async function D(f){if(!(r(l)||c())){M(l,f);try{await t()(f)}catch(m){console.error("Failed to delete message:",m)}finally{M(l,null)}}}function H(f){f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),F())}Ce(()=>le(u()),()=>{u().length&&h()}),dn(),Bt();var k=oo();let E;var U=B(k);{var g=f=>{var m=Xs(),w=B(m);en(w,{size:"sm"}),L(m),J(f,m)},I=f=>{var m=so(),w=gt(m),A=B(w);{var S=Y=>{var Q=Js();J(Y,Q)},R=Y=>{var Q=Wa(),j=gt(Q);Sn(j,1,u,$=>$.id,($,P)=>{const N=lt(()=>(r(P),te(()=>C(r(P)))));var K=ao();let re;var G=B(K);let V;var ae=B(G),De=B(ae,!0);L(ae);var ge=W(ae,2);{var ke=ce=>{var ie=eo(),fe=B(ie),Ee=B(fe,!0);L(fe);var he=W(fe,2),ue=B(he,!0);L(he),L(ie),de(_e=>{be(Ee,(r(P),te(()=>r(P).user_display_name))),be(ue,_e)},[()=>(r(P),te(()=>v(r(P).created_at)))]),J(ce,ie)},Ae=ce=>{var ie=to(),fe=B(ie,!0);L(ie),de(Ee=>be(fe,Ee),[()=>(r(P),te(()=>v(r(P).created_at)))]),J(ce,ie)};me(ge,ce=>{r(N)?ce(Ae,!1):ce(ke)})}var ve=W(ge,2);{var Me=ce=>{var ie=ro(),fe=B(ie);{var Ee=ue=>{en(ue,{size:"xs"})},he=ue=>{var _e=no();J(ue,_e)};me(fe,ue=>{r(l),r(P),te(()=>r(l)===r(P).id)?ue(Ee):ue(he,!1)})}L(ie),de(()=>ie.disabled=(r(l),r(P),te(()=>r(l)===r(P).id))),Se("click",ie,()=>D(r(P).id)),J(ce,ie)};me(ve,ce=>{r(N)&&ce(Me)})}L(G),L(K),de(()=>{re=Ze(K,1,"d-flex mb-2",null,re,{"justify-content-end":r(N),"justify-content-start":!r(N)}),V=Ze(G,1,"message-bubble svelte-12d50yj",null,V,{own:r(N),other:!r(N)}),be(De,(r(P),te(()=>r(P).message)))}),J($,K)}),J(Y,Q)};me(A,Y=>{le(u()),te(()=>u().length===0)?Y(S):Y(R,!1)})}L(w),Kt(w,Y=>M(s,Y),()=>r(s));var x=W(w,2),O=B(x);Vr(O);var _=W(O,2),p=B(_);{var z=Y=>{en(Y,{size:"xs"})},T=Y=>{var Q=io();J(Y,Q)};me(p,Y=>{r(o)?Y(z):Y(T,!1)})}L(_),L(x),de(Y=>{O.disabled=c()||r(o),_.disabled=Y},[()=>(le(c()),r(o),r(y),te(()=>c()||r(o)||!r(y).trim()))]),Mt(O,()=>r(y),Y=>M(y,Y)),Se("keydown",O,H),Se("click",_,F),J(f,m)};me(U,f=>{d()?f(g):f(I,!1)})}L(k),de(()=>E=Ze(k,1,"chat-thread d-flex flex-column svelte-12d50yj",null,E,{"chat-thread-full":b()})),J(n,k),Ot()}async function lo(n){const{data:a,error:u}=await Pe.from("event_bishopric_comments").select("*").eq("event_id",n).order("created_at",{ascending:!0});if(u)throw u;return a??[]}async function co(n,a,u,i){const{data:e,error:t}=await Pe.from("event_bishopric_comments").insert([{event_id:n,user_id:a,user_display_name:u,message:i}]).select().single();if(t)throw t;return e}async function uo(n){const{error:a}=await Pe.from("event_bishopric_comments").delete().eq("id",n);if(a)throw a}async function xa(n){const{data:a,error:u}=await Pe.from("event_submitter_comments").select("*").eq("event_id",n).order("created_at",{ascending:!0});if(u)throw u;return a??[]}async function Da(n,a,u,i){const{data:e,error:t}=await Pe.from("event_submitter_comments").insert([{event_id:n,user_id:a,user_display_name:u,message:i}]).select().single();if(t)throw t;return e}async function Ea(n){const{error:a}=await Pe.from("event_submitter_comments").delete().eq("id",n);if(a)throw a}const fo=`${cr}/functions/v1/calendar-approval-reply`;async function Sa(n){if(!(typeof fetch>"u"))try{const a=await fetch(fo,{method:"POST",headers:ur(!0,{useAuthToken:!0}),body:JSON.stringify(n)});a.ok||console.error("Failed to send approval reply notification:",await a.text())}catch(a){console.error("Error sending approval reply notification:",a)}}function vo(n,a,u){return Sa({event_id:n,action:"vote",role:a,status:u})}function mo(n,a){return Sa({event_id:n,action:a})}var ho=ne("<span> </span>"),po=ne('<div class="alert alert-info mb-0" role="alert">Save this event or announcement before requesting bishopric approvals.</div>'),_o=ne('<span class="badge bg-secondary-subtle text-secondary-emphasis"> </span>'),bo=ne('<span class="badge bg-secondary-subtle text-secondary-emphasis"> </span>'),go=ne('<div class="card"><button type="button" class="btn btn-link text-start text-decoration-none d-flex align-items-center gap-3 p-3 w-100 chat-toggle svelte-jfsv9u"><i class="bi bi-chat-dots"></i> <div class="d-flex flex-column align-items-start"><span class="fw-semibold">Bishopric Discussion</span> <small class="text-muted">Private notes between bishopric members</small></div> <div class="ms-auto d-flex align-items-center gap-2"><!> <i class="bi bi-chevron-right"></i></div></button></div> <!> <div class="card"><button type="button" class="btn btn-link text-start text-decoration-none d-flex align-items-center gap-3 p-3 w-100 chat-toggle svelte-jfsv9u"><i class="bi bi-chat-left-dots"></i> <div class="d-flex flex-column align-items-start"><span class="fw-semibold">Discussion with Submitter</span> <small class="text-muted"> </small></div> <div class="ms-auto d-flex align-items-center gap-2"><!> <i class="bi bi-chevron-right"></i></div></button></div> <!>',1),yo=ne('<small class="text-muted"> </small>'),wo=ne("<span><!></span>"),xo=ne('<div class="decision-buttons d-grid gap-2 gap-md-3 svelte-jfsv9u"><button type="button"><i class="bi bi-check-circle-fill"></i> <div><div class="action-label svelte-jfsv9u">Approve</div> <small class="text-muted">Vote to approve</small></div></button> <button type="button"><i class="bi bi-pencil-square"></i> <div><div class="action-label svelte-jfsv9u">Request Changes</div> <small class="text-muted">Ask submitter to revise</small></div></button> <button type="button"><i class="bi bi-hourglass-split"></i> <div><div class="action-label svelte-jfsv9u">Mark Pending</div> <small class="text-muted">No decision yet</small></div></button> <!></div>'),Do=ne("<span> </span>"),Eo=ne('<div class="list-group-item"><div class="d-flex flex-column gap-2"><div><div class="fw-semibold"> </div> <!></div> <div><!></div></div></div>'),So=ne('<i class="bi bi-globe-americas"></i>'),Ao=ne('<button type="button" class="btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center gap-2"><!> Unpublish</button>'),ko=ne('<i class="bi bi-globe"></i>'),Io=ne('<small class="text-muted text-center">At least one approval required to publish</small>'),To=ne('<button type="button" class="btn btn-success w-100 d-flex align-items-center justify-content-center gap-2"><!> Publish to Ward</button> <!>',1),Co=ne('<div class="card-footer text-danger small"> </div>'),Mo=ne('<!> <div class="card"><div class="list-group list-group-flush"></div> <div class="publish-section d-flex flex-column gap-2 p-3 svelte-jfsv9u"><div class="d-flex justify-content-between align-items-center"><span class="text-muted small fw-semibold"> </span></div> <!></div> <!></div>',1),Ro=ne('<div class="d-flex flex-column gap-3"><div class="d-flex flex-wrap align-items-center justify-content-between gap-2"><h3 class="h5 mb-0">Bishopric Approval</h3> <!></div> <!></div>');function Uo(n,a){Ut(a,!1);const u=()=>Cn(w,"$currentUserStore",i),[i,e]=Xr(),t=X(),d=X(),c=X(),b=X(),y=X(),o=X(),l=X(),s=X(),h=X(),v=X(),C=X(),F=X(),D=X(),H=X();let k=se(a,"eventItem",12),E=se(a,"disabled",8,!1),U=se(a,"reloadEvents",8,null);const g={bishop:"bishopric-bishop",first_counselor:"bishopric-first-counselor",second_counselor:"bishopric-second-counselor"},I={pending:{text:"Pending Approval",class:"bg-warning-subtle text-warning-emphasis"},approved:{text:"Approved",class:"bg-success-subtle text-success-emphasis"},needs_review:{text:"Needs Review",class:"bg-info-subtle text-info-emphasis"},published:{text:"Published",class:"bg-primary-subtle text-primary-emphasis"}},f=Yn()??null,m=Zr(Qa),w=f?.stores.currentUser??m,A=["bishop","first_counselor","second_counselor"];let S=X(""),R=X(null),x=X(!1),O=X([]),_=X(!1),p=!1;const z=`bishopric-chat-${tr()}`;let T=X(null),Y=X([]),Q=X(!1),j=!1;const $=`submitter-chat-${tr()}`;let P=null;lr(async()=>{typeof window<"u"&&(P=(await xn(()=>import("./tUu8UEjF.js").then(oe=>oe.o),__vite__mapDeps([0,1]),import.meta.url)).default)});function N(){if(!P)return;const ee=document.getElementById(z);if(!ee)return;P.getOrCreateInstance(ee).show()}function K(){if(!P)return;const ee=document.getElementById($);if(!ee)return;P.getOrCreateInstance(ee).show()}function re(ee){const oe=g[ee];return r(t)?.roles?.includes(oe)??!1}function G(ee){if(!ee)return null;try{return Ne(ln(ee),"MMM d, yyyy 'at' h:mm a")}catch(oe){return console.error("Failed to format timestamp",oe),null}}async function V(){typeof U()=="function"&&await U()()}async function ae(ee,oe){const Ie=k()?.id;if(Ie!=null){M(S,""),M(R,ee);try{const Qe=await ta(Ie,ee,oe,r(t)?.id);Qe&&(k({...k(),bishop_approval:Qe.bishop_approval,first_counselor_approval:Qe.first_counselor_approval,second_counselor_approval:Qe.second_counselor_approval,bishop_approval_at:Qe.bishop_approval_at,first_counselor_approval_at:Qe.first_counselor_approval_at,second_counselor_approval_at:Qe.second_counselor_approval_at,bishop_approval_by_user_id:Qe.bishop_approval_by_user_id,first_counselor_approval_by_user_id:Qe.first_counselor_approval_by_user_id,second_counselor_approval_by_user_id:Qe.second_counselor_approval_by_user_id,is_published:Qe.is_published}),vo(Ie,ee,oe)),await V()}catch(Qe){console.error("Failed to update approval",Qe),M(S,"Unable to update approval. Please try again.")}finally{M(R,null)}}}async function De(ee){await ae(ee,null)}async function ge(){const ee=k()?.id;if(ee!=null){M(S,""),M(x,!0);try{const oe=r(o)?"unpublished":"published",Ie=r(o)?await ra(ee):await na(ee);Ie&&(k({...k(),is_published:Ie.is_published}),mo(ee,oe)),await V()}catch(oe){console.error("Failed to update publish status",oe),M(S,"Unable to update publish status. Please try again.")}finally{M(x,!1)}}}let ke=null,Ae=null;function ve(){M(O,[]),p=!1,M(_,!1),M(Y,[]),j=!1,M(Q,!1)}Gr(()=>{ce(),ue()});function Me(ee){const oe=ee??k()?.id??null;if(ke||!oe)return;const Ie=typeof window<"u"?localStorage.getItem("authToken"):null;Ie&&Pe.realtime.setAuth(Ie),ke=Pe.channel(`bishopric-comments-${oe}`).on("postgres_changes",{event:"*",schema:"public",table:"event_bishopric_comments",filter:`event_id=eq.${oe}`},()=>{ie(oe)}).subscribe()}function ce(){ke&&(Pe.removeChannel(ke),ke=null)}async function ie(ee){const oe=ee??k()?.id??null;if(oe){p||M(_,!0);try{const Ie=await lo(oe);oe===(k()?.id??null)&&(M(O,Ie),p=!0)}catch(Ie){console.error("Failed to load bishopric comments:",Ie)}finally{oe===(k()?.id??null)&&M(_,!1)}}}async function fe(ee){if(!k()?.id||!r(t)?.id)return;const oe=r(t).displayName||r(t).username||"Unknown";await co(k().id,r(t).id,oe,ee),await ie()}async function Ee(ee){await uo(ee),await ie()}function he(ee){const oe=ee??k()?.id??null;if(Ae||!oe)return;const Ie=typeof window<"u"?localStorage.getItem("authToken"):null;Ie&&Pe.realtime.setAuth(Ie),Ae=Pe.channel(`submitter-comments-${oe}`).on("postgres_changes",{event:"*",schema:"public",table:"event_submitter_comments",filter:`event_id=eq.${oe}`},()=>{_e(oe)}).subscribe()}function ue(){Ae&&(Pe.removeChannel(Ae),Ae=null)}async function _e(ee){const oe=ee??k()?.id??null;if(oe){j||M(Q,!0);try{const Ie=await xa(oe);oe===(k()?.id??null)&&(M(Y,Ie),j=!0)}catch(Ie){console.error("Failed to load submitter comments:",Ie)}finally{oe===(k()?.id??null)&&M(Q,!1)}}}async function pe(ee){if(!k()?.id||!r(t)?.id)return;const oe=r(t).displayName||r(t).username||"Unknown";await Da(k().id,r(t).id,oe,ee),await _e()}async function Re(ee){await Ea(ee),await _e()}function Be(ee){return ee==="YES"?{text:"Approved",class:"bg-success-subtle text-success-emphasis"}:ee==="NO"?{text:"Requested Changes",class:"bg-info-subtle text-info-emphasis"}:{text:"No Input Yet",class:"bg-secondary-subtle text-secondary-emphasis"}}const ze="btn btn-sm action-btn w-100 text-start d-flex align-items-center gap-2";function Oe(ee){return`${ze} ${ee==="YES"?"btn-success text-white":"btn-outline-success"}`}function Et(ee){return`${ze} ${ee==="NO"?"btn-info text-dark":"btn-outline-info"}`}function Fe(ee){const oe=ee==null;return`${ze} ${oe?"btn-secondary text-white":"btn-outline-secondary"}`}Ce(()=>u(),()=>{M(t,u())}),Ce(()=>le(k()),()=>{M(d,Oi(k()))}),Ce(()=>r(d),()=>{M(c,I[r(d)])}),Ce(()=>le(k()),()=>{M(b,gr(k()))}),Ce(()=>le(k()),()=>{M(y,Ui(k()))}),Ce(()=>le(k()),()=>{M(o,k()?.is_published??!1)}),Ce(()=>le(k()),()=>{M(l,{bishop:k()?.bishop_approval,first_counselor:k()?.first_counselor_approval,second_counselor:k()?.second_counselor_approval})}),Ce(()=>le(k()),()=>{M(s,{bishop:k()?.bishop_approval_at,first_counselor:k()?.first_counselor_approval_at,second_counselor:k()?.second_counselor_approval_at})}),Ce(()=>r(t),()=>{M(h,r(t)?.roles?.includes("bishopric-bishop")??!1)}),Ce(()=>r(t),()=>{M(v,r(t)?.roles?.includes("bishopric-first-counselor")??!1)}),Ce(()=>r(t),()=>{M(C,r(t)?.roles?.includes("bishopric-second-counselor")??!1)}),Ce(()=>(r(h),r(v),r(C)),()=>{M(F,r(h)||r(v)||r(C))}),Ce(()=>{},()=>{M(D,A)}),Ce(()=>(le(k()),r(T)),()=>{const ee=k()?.id??null;ee&&ee!==r(T)?(M(T,ee),ve(),ce(),ue(),ie(ee),_e(ee),Me(ee),he(ee)):!ee&&r(T)!==null&&(M(T,null),ve(),ce(),ue())}),Ce(()=>le(k()),()=>{M(H,k()?.meta_data?.submitted_by_name??"Submitter")}),dn(),Bt();var $e=Ro(),je=B($e),ct=W(B(je),2);{var Ge=ee=>{var oe=ho(),Ie=B(oe,!0);L(oe),de(()=>{Ze(oe,1,(r(c),te(()=>`badge ${r(c).class}`)),"svelte-jfsv9u"),be(Ie,(r(c),te(()=>r(c).text)))}),J(ee,oe)};me(ct,ee=>{le(k()),te(()=>k()?.id)&&ee(Ge)})}L(je);var ut=W(je,2);{var Ht=ee=>{var oe=po();J(ee,oe)},hn=ee=>{var oe=Mo(),Ie=gt(oe);{var Qe=Je=>{var we=go(),We=gt(we),_t=B(We),xt=W(B(_t),4),et=B(xt);{var zt=Ve=>{var rt=_o(),Wt=B(rt,!0);L(rt),de(()=>be(Wt,(r(O),te(()=>r(O).length)))),J(Ve,rt)};me(et,Ve=>{r(O),te(()=>r(O).length>0)&&Ve(zt)})}qe(2),L(xt),L(_t),L(We);var Vt=W(We,2);{let Ve=lt(()=>(le(k()),te(()=>k()?.title||"Event")));nr(Vt,{get id(){return z},subtitle:"Discussion",get title(){return r(Ve)},className:"chat-drawer-stacked",bodyClass:"overflow-hidden d-flex flex-column",children:(rt,Wt)=>{{let It=lt(()=>(r(t),te(()=>r(t)?.id??-1)));or(rt,{get comments(){return r(O)},get currentUserId(){return r(It)},onSend:fe,onDelete:Ee,get loading(){return r(_)},fullHeight:!0,get disabled(){return E()}})}},$$slots:{default:!0}})}var Ke=W(Vt,2),wt=B(Ke),Zt=W(B(wt),2),an=W(B(Zt),2),pn=B(an,!0);L(an),L(Zt);var nt=W(Zt,2),tt=B(nt);{var dt=Ve=>{var rt=bo(),Wt=B(rt,!0);L(rt),de(()=>be(Wt,(r(Y),te(()=>r(Y).length)))),J(Ve,rt)};me(tt,Ve=>{r(Y),te(()=>r(Y).length>0)&&Ve(dt)})}qe(2),L(nt),L(wt),L(Ke);var Dt=W(Ke,2);{let Ve=lt(()=>(le(k()),te(()=>k()?.title||"Event")));nr(Dt,{get id(){return $},subtitle:"Discussion with Submitter",get title(){return r(Ve)},className:"chat-drawer-stacked",bodyClass:"overflow-hidden d-flex flex-column",children:(rt,Wt)=>{{let It=lt(()=>(r(t),te(()=>r(t)?.id??-1)));or(rt,{get comments(){return r(Y)},get currentUserId(){return r(It)},onSend:pe,onDelete:Re,get loading(){return r(Q)},fullHeight:!0,get disabled(){return E()}})}},$$slots:{default:!0}})}de(()=>{Ue(_t,"aria-controls",z),Ue(wt,"aria-controls",$),be(pn,r(H))}),Se("click",_t,N),Se("click",wt,K),J(Je,we)};me(Ie,Je=>{r(F)&&Je(Qe)})}var yt=W(Ie,2),Xe=B(yt);Sn(Xe,5,()=>r(D),dr,(Je,we)=>{var We=Eo(),_t=B(We),xt=B(_t),et=B(xt),zt=B(et,!0);L(et);var Vt=W(et,2);{var Ke=nt=>{var tt=yo(),dt=B(tt,!0);L(tt),de(Dt=>be(dt,Dt),[()=>(r(s),r(we),te(()=>G(r(s)[r(we)])))]),J(nt,tt)};me(Vt,nt=>{r(s),r(we),te(()=>r(s)[r(we)])&&nt(Ke)})}L(xt);var wt=W(xt,2),Zt=B(wt);{var an=nt=>{var tt=xo(),dt=B(tt),Dt=W(dt,2),Ve=W(Dt,2),rt=W(Ve,2);{var Wt=It=>{var $t=wo(),Gt=B($t);en(Gt,{size:"xs"}),L($t),J(It,$t)};me(rt,It=>{r(R)===r(we)&&It(Wt)})}L(tt),de((It,$t,Gt)=>{Ze(dt,1,It,"svelte-jfsv9u"),dt.disabled=E()||r(R)===r(we),Ze(Dt,1,$t,"svelte-jfsv9u"),Dt.disabled=E()||r(R)===r(we),Ze(Ve,1,Gt,"svelte-jfsv9u"),Ve.disabled=E()||r(R)===r(we)},[()=>jn((r(l),r(we),te(()=>Oe(r(l)[r(we)])))),()=>jn((r(l),r(we),te(()=>Et(r(l)[r(we)])))),()=>jn((r(l),r(we),te(()=>Fe(r(l)[r(we)]))))]),Se("click",dt,()=>ae(r(we),"YES")),Se("click",Dt,()=>ae(r(we),"NO")),Se("click",Ve,()=>De(r(we))),J(nt,tt)},pn=nt=>{const tt=lt(()=>(r(l),r(we),te(()=>Be(r(l)[r(we)]))));var dt=Do(),Dt=B(dt,!0);L(dt),de(()=>{Ze(dt,1,(le(r(tt)),te(()=>`badge ${r(tt).class}`)),"svelte-jfsv9u"),be(Dt,(le(r(tt)),te(()=>r(tt).text)))}),J(nt,dt)};me(Zt,nt=>{r(we),te(()=>re(r(we)))?nt(an):nt(pn,!1)})}L(wt),L(_t),L(We),de(()=>be(zt,(le(Wr),r(we),te(()=>Wr[r(we)])))),J(Je,We)}),L(Xe);var Te=W(Xe,2),St=B(Te),rn=B(St),At=B(rn);L(rn),L(St);var kt=W(St,2);{var Bn=Je=>{var we=Ao(),We=B(we);{var _t=et=>{en(et,{size:"xs"})},xt=et=>{var zt=So();J(et,zt)};me(We,et=>{r(x)?et(_t):et(xt,!1)})}qe(),L(we),de(()=>we.disabled=E()||r(x)),Se("click",we,ge),J(Je,we)},Hn=Je=>{var we=To(),We=gt(we),_t=B(We);{var xt=Ke=>{en(Ke,{size:"xs"})},et=Ke=>{var wt=ko();J(Ke,wt)};me(_t,Ke=>{r(x)?Ke(xt):Ke(et,!1)})}qe(),L(We);var zt=W(We,2);{var Vt=Ke=>{var wt=Io();J(Ke,wt)};me(zt,Ke=>{r(y)||Ke(Vt)})}de(()=>{We.disabled=E()||r(x)||!r(y),Ue(We,"title",r(y)?"":"At least one approval required to publish")}),Se("click",We,ge),J(Je,we)};me(kt,Je=>{r(o)?Je(Bn):Je(Hn,!1)})}L(Te);var zn=W(Te,2);{var Wn=Je=>{var we=Co(),We=B(we,!0);L(we),de(()=>be(We,r(S))),J(Je,we)};me(zn,Je=>{r(S)&&Je(Wn)})}L(yt),de(()=>be(At,`Approvals: ${r(b)??""} of 3`)),J(ee,oe)};me(ut,ee=>{le(k()),te(()=>!k()?.id)?ee(Ht):ee(hn,!1)})}L($e),J(n,$e),Ot(),e()}const Oo=`${cr}/functions/v1/calendar-approval-notify`;async function Fo(n,a){if(!(!n||typeof fetch>"u"))try{const u=await fetch(Oo,{method:"POST",headers:ur(!0,{useAuthToken:!0}),body:JSON.stringify({event_id:n,reason:a})});if(!u.ok){const i=await u.text();console.error("Failed to send approval notification:",i)}}catch(u){console.error("Error sending approval notification:",u)}}var No=ne('<div class="alert alert-info d-flex align-items-center gap-2 mb-0" role="alert"><i class="bi bi-arrow-repeat"></i> <div><strong>Recurring Event</strong> <div class="small">Changes to this event will apply to all future occurrences.</div></div></div>'),Po=ne('<button class="btn btn-primary btn-sm"><i class="bi bi-files"></i> <span class="ms-1">Clone</span></button>'),Yo=ne('<div class="alert alert-info d-flex align-items-start gap-2 mb-0" role="alert"><i class="bi bi-info-circle mt-1 fs-5"></i> <div><strong>Submission Workflow</strong> <ol class="mb-0 mt-2 ps-3"><li>Fill out event details below</li> <li>Click "Create" to submit for review</li> <li>Bishopric will review and provide feedback</li> <li>Events appear on the calendar once approved and published</li></ol></div></div>'),Lo=ne("<!> <!>",1),Bo=ne("<!> <!> <!> <!>",1),Ho=ne('<span class="badge bg-secondary-subtle text-secondary-emphasis"> </span>'),zo=ne('<div class="card"><button type="button" class="btn btn-link text-start text-decoration-none d-flex align-items-center gap-3 p-3 w-100 submitter-chat-toggle svelte-1ujj5ue"><i class="bi bi-chat-left-dots"></i> <div class="d-flex flex-column align-items-start"><span class="fw-semibold">Discussion with Bishopric</span> <small class="text-muted">Ask questions or respond to feedback</small></div> <div class="ms-auto d-flex align-items-center gap-2"><!> <i class="bi bi-chevron-right"></i></div></button></div> <!>',1),Wo=ne('<div class="alert alert-info small mb-0 d-flex align-items-start gap-2"><i class="bi bi-info-circle mt-1"></i> <span>All submissions require bishopric approval before they appear on the public calendar.</span></div> <!>',1),$o=ne('<button class="btn btn-danger position-relative"><span>Delete</span></button>'),jo=ne("<span>Save</span>"),qo=ne("<span>Create</span>"),Qo=ne('<span class="position-absolute top-0 start-100 translate-middle p-2 bg-danger border border-light rounded-circle"><span class="visually-hidden">Item not saved</span></span>'),Ko=ne('<button class="btn btn-primary position-relative"><!> <!></button>'),Vo=ne('<div class="d-flex flex-column gap-4"><!> <div class="d-flex justify-content-between align-items-center gap-3 flex-wrap"><h2 class="h5 mb-0">Event Details</h2> <!></div> <!> <p class="text-muted small mb-0"><span class="text-danger">*</span> Required field</p> <!> <!> <div class="d-flex justify-content-between align-items-center gap-2 flex-row"><div class="d-flex flex-row gap-2"><!></div> <div class="d-flex flex-row gap-2"><button class="btn btn-secondary position-relative">Cancel</button> <!></div></div> <div class="d-flex justify-content-end align-items-center gap-2 flex-row"><small> </small> <span><!></span></div> <!></div> <!> <!>',1);function Sl(n,a){Ut(a,!1);const u=()=>Cn(H,"$userOrganizations",t),i=()=>Cn(k,"$currentUser",t),e=()=>Cn(E,"$validationErrors",t),[t,d]=Xr(),c=X(),b=X(),y=X(),o=X(),l=X();let s=se(a,"name",8,""),h=se(a,"drawerId",8,""),v=se(a,"eventItem",12,Ka),C=se(a,"canDelete",8,!0),F=se(a,"canCreate",8,!0);const{actions:{reload:D}}=Li(),{stores:{userOrganizations:H,currentUser:k}}=Yn(),{validationErrors:E,validate:U,getErrorMessages:g,clearErrors:I}=Es(),{parseRecurrenceRule:f}=ca(),{uploadAttachment:m,removeAttachment:w,updateAttachmentName:A,validateFile:S}=Ys(),{saveEvent:R,deleteEventById:x,cloneEventForDate:O,buildEventPayload:_,saveSingleInstance:p,saveFutureInstances:z,saveAllInstances:T,deleteSingleInstance:Y,deleteFutureInstances:Q,deleteAllInstances:j}=Gs();let $=X(!1),P=X(!1),N=X(!1),K=X("weekly"),re=X(1),G=X([]),V=X(""),ae=X(!0),De=X("date"),ge=X([]),ke=X(!1),Ae=X(!1),ve=X(void 0),Me=X(void 0),ce=X(!1),ie=X(null),fe=X(!1),Ee=X(null),he=X(0),ue=X({title:"",description:"",start_time:"",end_time:"",location:"",is_all_day:!1,event_type:"announcement"}),_e=X({message:"",type:"info"}),pe=X(""),Re=X(""),Be=X(""),ze=X({dateInput:"",startTimeInput:"",endTimeInput:"",isRecurring:!1,recurrenceFrequency:"weekly",recurrenceInterval:1,recurringDays:[],recurrenceEndDate:"",hasEndDate:!0,monthlyType:"date"}),Oe=X(!1);const Et=(Z,q)=>Z.length===q.length&&Z.every((ye,xe)=>ye===q[xe]);let Fe=X([]),$e=X(!1),je=X(!1);const ct=`submitter-chat-form-${tr()}`;let Ge=X(null),ut=null,Ht=null;lr(async()=>{typeof window<"u"&&(Ht=(await xn(()=>import("./tUu8UEjF.js").then(q=>q.o),__vite__mapDeps([0,1]),import.meta.url)).default)}),Gr(()=>{oe()});function hn(){if(!Ht)return;const Z=document.getElementById(ct);if(!Z)return;Ht.getOrCreateInstance(Z).show()}function ee(Z){const q=Z??v()?.id??null;if(ut||!q)return;const ye=typeof window<"u"?localStorage.getItem("authToken"):null;ye&&Pe.realtime.setAuth(ye),ut=Pe.channel(`submitter-comments-form-${q}`).on("postgres_changes",{event:"*",schema:"public",table:"event_submitter_comments",filter:`event_id=eq.${q}`},()=>{Ie(q)}).subscribe()}function oe(){ut&&(Pe.removeChannel(ut),ut=null)}async function Ie(Z){const q=Z??v()?.id??null;if(q){r(je)||M($e,!0);try{const ye=await xa(q);q===(v()?.id??null)&&(M(Fe,ye),M(je,!0))}catch(ye){console.error("Failed to load submitter comments:",ye)}finally{q===(v()?.id??null)&&M($e,!1)}}}async function Qe(Z){if(!v()?.id||!i()?.id)return;const q=i().displayName||i().username||"Unknown";await Da(v().id,i().id,q,Z),await Ie()}async function yt(Z){await Ea(Z),await Ie()}const Xe=()=>{const Z=`[data-bs-target="#${h()}"]`,q=document.querySelector(Z);q&&q.click()},Te=(Z,q=0,ye="info")=>{Tn(_e,r(_e).message=Z),Tn(_e,r(_e).type=ye),q&&setTimeout(()=>{Tn(_e,r(_e).message="")},q)},St=async Z=>{const q=Z.detail;if(!q)return;const ye=S(q);if(!ye.valid){Te(ye.error??"Invalid file selected",7e3,"danger");return}M(P,!0);try{const xe=await m(q,r(c)??"temp",at=>Te(at));if(!xe.success||!xe.attachment)throw new Error(xe.error??"Upload failed");M(ge,[...r(ge),xe.attachment]),M(ke,!0),Te("File uploaded!",3e3,"success")}catch(xe){console.error("File upload failed:",xe),Te("Failed to upload file. Please try again.",7e3,"danger")}finally{M(P,!1)}},rn=Z=>{const{attachment:q,newName:ye}=Z.detail;M(ge,A(r(ge),q.id,ye)),M(ke,!0),Te("Attachment name updated!",3e3,"success")},At=async Z=>{const q=Z.detail;if(q){M(P,!0);try{if(!await w(q))throw new Error("Failed to remove attachment");M(ge,r(ge).filter(xe=>xe.id!==q.id)),M(ke,!0),Te("Attachment removed!",3e3,"success")}catch(ye){console.error("Failed to remove attachment:",ye),Te("Failed to remove attachment. Please try again.",7e3,"danger")}finally{M(P,!1)}}},kt=async()=>{if(!r(c)){Te("ID is not defined",0,"danger");return}try{await x(r(c)),await D(),Qt("set_calendar_event_success","interaction","Delete Calendar Event Successful",1),setTimeout(()=>{M($,!1),M(ue,{...v(),id:r(c)}),Te("Event Deleted",3e3,"success"),Xe()},800)}catch(Z){Qt("set_calendar_event_failed","interaction","Delete Calendar Event Failed",1),setTimeout(()=>{M($,!1),console.error("Delete failed:",Z),Te("Failed to delete event. Please try again.",7e3,"danger")},800)}},Bn=()=>!!v().recurrence_rule,Hn=async()=>{const Z=r(c)||v().meta_data?.recurring_parent_id;if(Z&&r(Ae)&&r(Me)&&r(ve)){if(M(Ee,null),M(fe,!0),await new Promise(q=>{const ye=setInterval(()=>{r(fe)||(clearInterval(ye),q())},50)}),!r(Ee))return;M($,!0);try{r(Ee)==="single"?await Y(Z,r(ve)):r(Ee)==="future"?await Q(Z,r(ve)):r(Ee)==="all"&&await j(Z),await D(),Qt("set_calendar_event_success","interaction","Delete Calendar Event Successful",1),setTimeout(()=>{M($,!1),M(ue,{...v(),id:r(c)}),Te("Event Deleted",3e3,"success"),Xe()},800)}catch(q){Qt("set_calendar_event_failed","interaction","Delete Calendar Event Failed",1),setTimeout(()=>{M($,!1),console.error("Delete failed:",q),Te("Failed to delete event. Please try again.",7e3,"danger")},800)}}else M($,!0),Xa({title:"Delete Confirmation",message:Bn()?"This recurring event and every occurrence, past and future, will be removed. You won't be able to undo this. Continue?":"Are you sure you want to do this? You won't be able to undo this.",confirmButtonLabel:"Yes",confirmButtonCSS:"btn-danger",callback:q=>{q?kt():M($,!1)}})},zn=Z=>{if(r(c))try{const q=O({event:v(),newDate:Z});Qt("clone_calendar_event_form_loaded","interaction","Clone Calendar Event Form Loaded",1),Te("Event cloned. Review and click Create to save.",5e3,"success"),v(q),M(pe,q.start_time?Ne(new Date(q.start_time),"yyyy-MM-dd"):""),M(Re,q.start_time?Ne(new Date(q.start_time),"HH:mm"):""),M(Be,q.end_time?Ne(new Date(q.end_time),"HH:mm"):""),M(ge,[]),M(N,!1),M(G,[]),M(V,""),M(ae,!0),M(ke,!0),M(he,void 0),M(ue,{...q}),M(ze,{dateInput:r(pe),startTimeInput:r(Re),endTimeInput:r(Be),isRecurring:!1,recurrenceFrequency:"weekly",recurrenceInterval:1,recurringDays:[],recurrenceEndDate:"",hasEndDate:!0,monthlyType:"date"})}catch(q){console.error("Clone failed:",q),Te("Failed to clone event. Please try again.",7e3,"danger")}},Wn=()=>{xs({title:"Clone Event",message:"Select a date for the cloned event:",confirmButtonLabel:"Clone",confirmButtonCSS:"btn-primary",defaultDate:r(pe),callback:(Z,q)=>{Z&&q&&zn(q)}})},Je=async()=>{if(r(c)&&!r(y)){Te("Sorry nothing has changed, therefore, there is nothing to save.",7e3);return}if(!await U({title:v().title,event_type:v().event_type,organization:v().organization??"",description:v().description,location:v().location,is_all_day:v().is_all_day,dateInput:r(pe),startTimeInput:r(Re),endTimeInput:r(Be),isRecurring:r(N),recurrenceFrequency:r(K),recurringDays:r(N)?r(G):[],recurrenceEndDate:r(N)?r(V):void 0,hasEndDate:r(ae)})){const ye=g();ye.length&&Te(ye.join(". ")+".  Please address accordingly.",0,"danger");return}const q=r(c)||v().meta_data?.recurring_parent_id;if(q&&r(Ae)&&r(Me)&&r(ve)){if(M(ie,null),M(ce,!0),await new Promise(xe=>{const at=setInterval(()=>{r(ce)||(clearInterval(at),xe())},100)}),!r(ie)||r($))return;Te("Saving ..."),M($,!0);const ye=_({eventItem:v(),dateInput:r(pe),startTimeInput:r(Re),endTimeInput:r(Be),attachments:r(ge),isRecurring:r(b)&&r(N),recurrenceFrequency:r(K),recurrenceInterval:r(re),recurringDays:r(N)?r(G):[],recurrenceEndDate:r(N)?r(V):"",hasEndDate:r(ae),monthlyType:r(De)});try{let xe;r(ie)==="single"?await p(q,r(ve),ye):r(ie)==="future"?xe=await z(q,r(ve),ye):r(ie)==="all"&&await T(q,ye),await D(),await Ha(),Qt("set_calendar_event_success","interaction",`Set Calendar Event Successful ${v().title}`,1),M($,!1),xe&&v({...v(),id:xe}),v(v().attachments=r(ge),!0),M(ue,{...v(),id:xe||q}),M(ke,!1),Te("Saved",3e3,"success"),Xe()}catch(xe){Qt("set_calendar_event_failed","interaction",`Set Calendar Event Failed ${v().title}`,1),setTimeout(()=>{M($,!1),console.error("Save failed:",xe),Te("Failed to save event. Please try again.",7e3,"danger")},800)}}else{if(r($))return;Te("Saving ..."),M($,!0);const ye=!!r(c)&&(v().bishop_approval==="NO"||v().first_counselor_approval==="NO"||v().second_counselor_approval==="NO");try{const xe=await R({id:r(c),eventItem:v(),dateInput:r(pe),startTimeInput:r(Re),endTimeInput:r(Be),attachments:r(ge),isRecurring:r(b)&&r(N),recurrenceFrequency:r(K),recurrenceInterval:r(re),recurringDays:r(N)?r(G):[],recurrenceEndDate:r(N)?r(V):"",hasEndDate:r(ae),monthlyType:r(De)});let at=null;xe.action==="create"?at="created":ye&&(at="resubmitted"),xe.event&&v({...v(),...xe.event}),v(v().attachments=r(ge),!0),await D();const jt=xe.event?.id??r(c);at&&jt&&Fo(jt,at),Qt("set_calendar_event_success","interaction",`Set Calendar Event Successful ${v().title}`,1),setTimeout(()=>{M($,!1),M(ue,{...v(),id:r(c)}),M(ke,!1),Te("Saved",3e3,"success"),Xe()},800)}catch(xe){Qt("set_calendar_event_failed","interaction",`Set Calendar Event Failed ${v().title}`,1),setTimeout(()=>{M($,!1),console.error("Save failed:",xe),Te("Failed to save event. Please try again.",7e3,"danger")},800)}}};Ce(()=>le(v()),()=>{M(c,v().id)}),Ce(()=>le(v()),()=>{M(b,v().event_type==="calendar_event")}),Ce(()=>(r(b),r(N),r(G),r(V)),()=>{!r(b)&&(r(N)||r(G).length>0||r(V))&&(M(N,!1),M(K,"weekly"),M(re,1),M(G,[]),M(V,""),M(ae,!0),M(De,"date"))}),Ce(()=>(le(v()),r(he),r(ue),r(ke),r(pe),r(Re),r(Be),r(N),r(K),r(re),r(G),r(V),r(ae),r(De)),()=>{if(v()?.id!==r(he)||v()?.start_time!==r(ue).start_time||v()?.meta_data?.recurring_instance_index!==r(ue).meta_data?.recurring_instance_index){M($,!0);const Z=r(ke),q=v();setTimeout(()=>{const ye=q.event_type==="calendar_event";if(M(pe,ye&&q.start_time?Ne(new Date(q.start_time),"yyyy-MM-dd"):""),M(Re,ye&&q.start_time?Ne(new Date(q.start_time),"HH:mm"):""),M(Be,ye&&q.end_time?Ne(new Date(q.end_time),"HH:mm"):""),Z||M(ge,q.attachments?[...q.attachments]:[]),q.meta_data?.recurring_instance&&q.start_time?(M(Me,q.recurrence_rule),M(Ae,!0),M(ve,Ne(new Date(q.start_time),"yyyy-MM-dd"))):(M(Me,void 0),M(Ae,!1),M(ve,void 0)),q.recurrence_rule){const xe=f(q.recurrence_rule,q.recurrence_end_date);xe?(M(N,!0),M(K,xe.frequency),M(re,xe.interval),M(G,xe.recurringDays),M(V,xe.recurrenceEndDate),M(ae,xe.hasEndDate),M(De,xe.monthlyType)):(M(N,!1),M(K,"weekly"),M(re,1),M(G,[]),M(V,""),M(ae,!0),M(De,"date"))}else M(N,!1),M(K,"weekly"),M(re,1),M(G,[]),M(V,""),M(ae,!0),M(De,"date");M(he,q.id),M(ue,{...q}),M($,!1),M(ke,!1),I(),M(ze,{dateInput:r(pe),startTimeInput:r(Re),endTimeInput:r(Be),isRecurring:r(N),recurrenceFrequency:r(K),recurrenceInterval:r(re),recurringDays:[...r(G)],recurrenceEndDate:r(V),hasEndDate:r(ae),monthlyType:r(De)})},200)}}),Ce(()=>(r(ue),le(v()),r(ge),r(pe),r(ze),r(Re),r(Be),r(N),r(K),r(re),r(G),r(V),r(ae),r(De)),()=>{M(y,r(ue).title!==v().title||r(ue).start_time!==v().start_time||r(ue).end_time!==v().end_time||r(ue).description!==v().description||r(ue).location!==v().location||r(ue).is_public!==v().is_public||r(ue).organization!==v().organization||r(ue).is_all_day!==v().is_all_day||JSON.stringify(r(ge))!==JSON.stringify(v().attachments||[])||r(ue).recurrence_rule!==v().recurrence_rule||r(ue).recurrence_end_date!==v().recurrence_end_date||r(pe)!==r(ze).dateInput||r(Re)!==r(ze).startTimeInput||r(Be)!==r(ze).endTimeInput||r(N)!==r(ze).isRecurring||r(K)!==r(ze).recurrenceFrequency||r(re)!==r(ze).recurrenceInterval||!Et(r(G),r(ze).recurringDays)||r(V)!==r(ze).recurrenceEndDate||r(ae)!==r(ze).hasEndDate||r(De)!==r(ze).monthlyType)}),Ce(()=>(u(),Mr),()=>{M(Oe,u().has(Mr.Bishopric))}),Ce(()=>(le(v()),i()),()=>{M(o,!!v()?.id&&!!i()?.id&&v().meta_data?.submitted_by_user_id===i().id)}),Ce(()=>(r(o),r(Oe)),()=>{M(l,r(o)&&!r(Oe))}),Ce(()=>(r(l),le(v()),r(Ge)),()=>{const Z=r(l)?v()?.id??null:null;Z&&Z!==r(Ge)?(M(Ge,Z),M(Fe,[]),M(je,!1),M($e,!1),oe(),Ie(Z),ee(Z)):!Z&&r(Ge)!==null&&(M(Ge,null),M(Fe,[]),M(je,!1),M($e,!1),oe())}),dn(),Bt();var we=Vo(),We=gt(we),_t=B(We);{var xt=Z=>{var q=No();J(Z,q)};me(_t,Z=>{le(v()),r(c),te(()=>v().recurrence_rule&&r(c))&&Z(xt)})}var et=W(_t,2),zt=W(B(et),2);{var Vt=Z=>{var q=Po();de(()=>q.disabled=r($)||r(P)),Se("click",q,Wn),J(Z,q)};me(zt,Z=>{r(c)&&Z(Vt)})}L(et);var Ke=W(et,2);{var wt=Z=>{var q=Yo();J(Z,q)};me(Ke,Z=>{!r(Oe)&&!r(c)&&Z(wt)})}var Zt=W(Ke,4);Va(Zt,{get id(){return`${s()??""}-accordion`},children:(Z,q)=>{var ye=Bo(),xe=gt(ye);bn(xe,{get id(){return`${s()??""}-basic-info`},collapsed:!1,$$slots:{heading:(Le,Ft)=>{var st=_n("Basic Information");J(Le,st)},body:(Le,Ft)=>{{let st=lt(()=>r($)||r(P));ji(Le,{get disabled(){return r(st)},get name(){return s()},get validationErrors(){return e()},get title(){return v().title},set title(ft){v(v().title=ft,!0)},get eventType(){return v().event_type},set eventType(ft){v(v().event_type=ft,!0)},get organization(){return v().organization},set organization(ft){v(v().organization=ft,!0)},get isPublic(){return v().is_public},set isPublic(ft){v(v().is_public=ft,!0)},get description(){return v().description},set description(ft){v(v().description=ft,!0)},$$legacy:!0})}}}});var at=W(xe,2);{var jt=Le=>{var Ft=Lo(),st=gt(Ft);bn(st,{get id(){return`${s()??""}-datetime`},collapsed:!1,$$slots:{heading:(vt,qt)=>{var Nt=_n("Date & Time");J(vt,Nt)},body:(vt,qt)=>{{let Nt=lt(()=>r($)||r(P));Gi(vt,{get disabled(){return r(Nt)},get name(){return s()},get validationErrors(){return e()},get dateInput(){return r(pe)},set dateInput(He){M(pe,He)},get startTimeInput(){return r(Re)},set startTimeInput(He){M(Re,He)},get endTimeInput(){return r(Be)},set endTimeInput(He){M(Be,He)},get isAllDay(){return v().is_all_day},set isAllDay(He){v(v().is_all_day=He,!0)},$$legacy:!0})}}}});var ft=W(st,2);bn(ft,{get id(){return`${s()??""}-recurring`},collapsed:!0,$$slots:{heading:(vt,qt)=>{var Nt=_n("Recurring Settings");J(vt,Nt)},body:(vt,qt)=>{{let Nt=lt(()=>r($)||r(P));is(vt,{get disabled(){return r(Nt)},get name(){return s()},get validationErrors(){return e()},get isRecurring(){return r(N)},set isRecurring(He){M(N,He)},get recurrenceFrequency(){return r(K)},set recurrenceFrequency(He){M(K,He)},get recurrenceInterval(){return r(re)},set recurrenceInterval(He){M(re,He)},get recurringDays(){return r(G)},set recurringDays(He){M(G,He)},get recurrenceEndDate(){return r(V)},set recurrenceEndDate(He){M(V,He)},get monthlyType(){return r(De)},set monthlyType(He){M(De,He)},get dateInput(){return r(pe)},set dateInput(He){M(pe,He)},$$legacy:!0})}}}}),J(Le,Ft)};me(at,Le=>{r(b)&&Le(jt)})}var Xt=W(at,2);bn(Xt,{get id(){return`${s()??""}-location`},collapsed:!0,$$slots:{heading:(Le,Ft)=>{var st=_n("Location");J(Le,st)},body:(Le,Ft)=>{{let st=lt(()=>r($)||r(P)),ft=lt(()=>`${s()}-location`);os(Le,{get disabled(){return r(st)},get name(){return r(ft)},get value(){return v().location},set value(vt){v(v().location=vt,!0)},$$legacy:!0})}}}});var it=W(Xt,2);bn(it,{get id(){return`${s()??""}-attachments`},collapsed:!0,$$slots:{heading:(Le,Ft)=>{var st=_n("Attachments");J(Le,st)},body:(Le,Ft)=>{{let st=lt(()=>r($)||r(P));hs(Le,{get attachments(){return r(ge)},get uploadingFile(){return r(P)},get disabled(){return r(st)},$$events:{upload:St,edit:rn,remove:At}})}}}}),J(Z,ye)},$$slots:{default:!0}});var an=W(Zt,2);{var pn=Z=>{var q=Wo(),ye=W(gt(q),2);{var xe=at=>{var jt=zo(),Xt=gt(jt),it=B(Xt),Le=W(B(it),4),Ft=B(Le);{var st=vt=>{var qt=Ho(),Nt=B(qt,!0);L(qt),de(()=>be(Nt,(r(Fe),te(()=>r(Fe).length)))),J(vt,qt)};me(Ft,vt=>{r(Fe),te(()=>r(Fe).length>0)&&vt(st)})}qe(2),L(Le),L(it),L(Xt);var ft=W(Xt,2);{let vt=lt(()=>(le(v()),te(()=>v()?.title||"Event")));nr(ft,{get id(){return ct},subtitle:"Discussion with Bishopric",get title(){return r(vt)},className:"submitter-chat-drawer-stacked",bodyClass:"overflow-hidden d-flex flex-column",children:(qt,Nt)=>{{let He=lt(()=>(i(),te(()=>i()?.id??-1))),Ua=lt(()=>r($)||r(P));or(qt,{get comments(){return r(Fe)},get currentUserId(){return r(He)},onSend:Qe,onDelete:yt,get loading(){return r($e)},fullHeight:!0,get disabled(){return r(Ua)}})}},$$slots:{default:!0}})}de(()=>Ue(it,"aria-controls",ct)),Se("click",it,hn),J(at,jt)};me(ye,at=>{r(l)&&at(xe)})}J(Z,q)};me(an,Z=>{r(Oe)||Z(pn)})}var nt=W(an,2),tt=B(nt),dt=B(tt);{var Dt=Z=>{var q=$o();de(()=>q.disabled=r($)||r(P)),Se("click",q,Hn),J(Z,q)};me(dt,Z=>{(r(c)||r(Ae))&&C()&&Z(Dt)})}L(tt);var Ve=W(tt,2),rt=B(Ve),Wt=W(rt,2);{var It=Z=>{var q=Ko(),ye=B(q);{var xe=it=>{var Le=jo();J(it,Le)},at=it=>{var Le=qo();J(it,Le)};me(ye,it=>{r(c)||r(Ae)?it(xe):it(at,!1)})}var jt=W(ye,2);{var Xt=it=>{var Le=Qo();J(it,Le)};me(jt,it=>{r(y)&&it(Xt)})}L(q),de(()=>q.disabled=r($)||r(P)),Se("click",q,Je),J(Z,q)};me(Wt,Z=>{(r(c)||r(Ae)||F())&&Z(It)})}L(Ve),L(nt);var $t=W(nt,2),Gt=B($t),Aa=B(Gt,!0);L(Gt);var $n=W(Gt,2);let Er;var ka=B($n);en(ka,{size:"xs"}),L($n),L($t);var Ia=W($t,2);{var Ta=Z=>{{let q=lt(()=>r($)||r(P));Uo(Z,{get disabled(){return r(q)},get reloadEvents(){return D},get eventItem(){return v()},set eventItem(ye){v(ye)},$$legacy:!0})}};me(Ia,Z=>{r(Oe),le(v()),te(()=>r(Oe)&&!v()?.is_published)&&Z(Ta)})}L(We);var Sr=W(We,2);{var Ca=Z=>{_s(Z,{get eventTitle(){return le(v()),te(()=>v().title)},get occurrenceDate(){return r(ve)},callback:q=>{M(ie,q),M(ce,!1)}})};me(Sr,Z=>{r(ce)&&r(ve)&&Z(Ca)})}var Ma=W(Sr,2);{var Ra=Z=>{gs(Z,{get eventTitle(){return le(v()),te(()=>v().title)},get occurrenceDate(){return r(ve)},callback:q=>{M(Ee,q),M(fe,!1)}})};me(Ma,Z=>{r(fe)&&r(ve)&&Z(Ra)})}de(()=>{rt.disabled=r($)||r(P),Ze(Gt,1,`fw-lighter fst-italic text-${r(_e),te(()=>r(_e).type)??""}`,"svelte-1ujj5ue"),be(Aa,(r(_e),te(()=>r(_e).message))),Er=Ze($n,1,"",null,Er,{"d-none":!r($)})}),Se("click",rt,Xe),J(n,we),Ot(),d()}export{Uo as B,Sl as C,Oi as a,Ii as b,Dl as c,El as d,ki as e,Ei as f,Li as g,wl as h,tn as i,gn as j,Ai as k,gr as l,zr as m,xl as n,un as t};
