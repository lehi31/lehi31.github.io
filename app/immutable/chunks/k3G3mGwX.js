import{t as j,j as ut,k as dt,K as Gt,bb as Kt,L as ft,Y as Qt,ac as Jt,b1 as Xt,a_ as er,N as tr,G as Te,p as rr,ai as J,D as E,E as B,w as P,g as o,aj as nr,c as T,s as V,u as y,r as S,a as ar,f as pt,R as Fe}from"./CPOcesE7.js";import{b as _t,d as sr,f as I,a as M,c as mt}from"./YsHTGu5k.js";import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{p as Be,b as or,i as G,a as ir,s as X,e as je}from"./CCh4w6lW.js";import{e as cr,i as lr}from"./DAwrR-3T.js";import{t as be,v as ur,w as dr,s as L,g as Ct,D as It,p as ue,k as le,f as K,x as vt,A as ze,c as ee,h as Ze}from"./BFZC0Q67.js";import{i as fr}from"./C2Q_9cr2.js";import{w as ne,g as gt,r as nt,d as te}from"./DHXte27T.js";import{S as pr}from"./Dz8rHJy-.js";import{R as _r}from"./DV727CfP.js";import{s as mr,i as vr}from"./ProE_VhZ.js";function yn(e,t,r=!1,n=!1,a=!1){var s=e,c="";j(()=>{var u=Gt;if(c===(c=t()??"")){ut&&dt();return}if(u.nodes!==null&&(Kt(u.nodes.start,u.nodes.end),u.nodes=null),c!==""){if(ut){ft.data;for(var f=dt(),D=f;f!==null&&(f.nodeType!==Qt||f.data!=="");)D=f,f=Jt(f);if(f===null)throw Xt(),er;_t(ft,D),s=tr(f);return}var w=c+"";r?w=`<svg>${w}</svg>`:n&&(w=`<math>${w}</math>`);var O=sr(w);if((r||n)&&(O=Te(O)),_t(Te(O),O.lastChild),r||n)for(;Te(O);)s.before(Te(O));else s.before(O)}})}function gr(e,t){const r=be(e);return isNaN(t)?ur(e,NaN):(t&&r.setDate(r.getDate()+t),r)}function ge(e,t){const r=t*7;return gr(e,r)}function re(e,t){const r=dr(),n=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,a=be(e),s=a.getDay(),c=(s<n?-7:0)+6-(s-n);return a.setDate(a.getDate()+c),a.setHours(23,59,59,999),a}function ke(e,t){const r=+be(e),[n,a]=[+be(t.start),+be(t.end)].sort((s,c)=>s-c);return r>=n&&r<=a}function br(e,t){const r=xr(t);return"formatToParts"in r?yr(r,e):Dr(r,e)}const hr={year:0,month:1,day:2,hour:3,minute:4,second:5};function yr(e,t){try{const r=e.formatToParts(t),n=[];for(let a=0;a<r.length;a++){const s=hr[r[a].type];s!==void 0&&(n[s]=parseInt(r[a].value,10))}return n}catch(r){if(r instanceof RangeError)return[NaN];throw r}}function Dr(e,t){const r=e.format(t),n=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(r);return[parseInt(n[3],10),parseInt(n[1],10),parseInt(n[2],10),parseInt(n[4],10),parseInt(n[5],10),parseInt(n[6],10)]}const qe={},bt=new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:"America/New_York",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),wr=bt==="06/25/2014, 00:00:00"||bt==="‎06‎/‎25‎/‎2014‎ ‎00‎:‎00‎:‎00";function xr(e){return qe[e]||(qe[e]=wr?new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),qe[e]}function at(e,t,r,n,a,s,c){const u=new Date(0);return u.setUTCFullYear(e,t,r),u.setUTCHours(n,a,s,c),u}const ht=36e5,Sr=6e4,Ve={timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-])(\d{2}):?(\d{2})$/};function st(e,t,r){if(!e)return 0;let n=Ve.timezoneZ.exec(e);if(n)return 0;let a,s;if(n=Ve.timezoneHH.exec(e),n)return a=parseInt(n[1],10),yt(a)?-(a*ht):NaN;if(n=Ve.timezoneHHMM.exec(e),n){a=parseInt(n[2],10);const c=parseInt(n[3],10);return yt(a,c)?(s=Math.abs(a)*ht+c*Sr,n[1]==="+"?-s:s):NaN}if(Nr(e)){t=new Date(t||Date.now());const c=r?t:Tr(t),u=Xe(c,e);return-(r?u:kr(t,u,e))}return NaN}function Tr(e){return at(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function Xe(e,t){const r=br(e,t),n=at(r[0],r[1]-1,r[2],r[3]%24,r[4],r[5],0).getTime();let a=e.getTime();const s=a%1e3;return a-=s>=0?s:1e3+s,n-a}function kr(e,t,r){let a=e.getTime()-t;const s=Xe(new Date(a),r);if(t===s)return t;a-=s-t;const c=Xe(new Date(a),r);return s===c?s:Math.max(s,c)}function yt(e,t){return-23<=e&&e<=23&&(t==null||0<=t&&t<=59)}const Dt={};function Nr(e){if(Dt[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),Dt[e]=!0,!0}catch{return!1}}function wt(e){const t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+e-+t}const Et=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,Ge=36e5,xt=6e4,Mr=2,k={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:Et};function et(e,t={}){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(e===null)return new Date(NaN);const r=t.additionalDigits==null?Mr:Number(t.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]")return new Date(e.getTime());if(typeof e=="number"||Object.prototype.toString.call(e)==="[object Number]")return new Date(e);if(Object.prototype.toString.call(e)!=="[object String]")return new Date(NaN);const n=Or(e),{year:a,restDateString:s}=Yr(n.date,r),c=Cr(s,a);if(c===null||isNaN(c.getTime()))return new Date(NaN);if(c){const u=c.getTime();let f=0,D;if(n.time&&(f=Ir(n.time),f===null||isNaN(f)))return new Date(NaN);if(n.timeZone||t.timeZone){if(D=st(n.timeZone||t.timeZone,new Date(u+f)),isNaN(D))return new Date(NaN)}else D=wt(new Date(u+f)),D=wt(new Date(u+f+D));return new Date(u+f+D)}else return new Date(NaN)}function Or(e){const t={};let r=k.dateTimePattern.exec(e),n;if(r?(t.date=r[1],n=r[3]):(r=k.datePattern.exec(e),r?(t.date=r[1],n=r[2]):(t.date=null,n=e)),n){const a=k.timeZone.exec(n);a?(t.time=n.replace(a[1],""),t.timeZone=a[1].trim()):t.time=n}return t}function Yr(e,t){if(e){const r=k.YYY[t],n=k.YYYYY[t];let a=k.YYYY.exec(e)||n.exec(e);if(a){const s=a[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(a=k.YY.exec(e)||r.exec(e),a){const s=a[1];return{year:parseInt(s,10)*100,restDateString:e.slice(s.length)}}}return{year:null}}function Cr(e,t){if(t===null)return null;let r,n,a;if(!e||!e.length)return r=new Date(0),r.setUTCFullYear(t),r;let s=k.MM.exec(e);if(s)return r=new Date(0),n=parseInt(s[1],10)-1,Tt(t,n)?(r.setUTCFullYear(t,n),r):new Date(NaN);if(s=k.DDD.exec(e),s){r=new Date(0);const c=parseInt(s[1],10);return Ar(t,c)?(r.setUTCFullYear(t,0,c),r):new Date(NaN)}if(s=k.MMDD.exec(e),s){r=new Date(0),n=parseInt(s[1],10)-1;const c=parseInt(s[2],10);return Tt(t,n,c)?(r.setUTCFullYear(t,n,c),r):new Date(NaN)}if(s=k.Www.exec(e),s)return a=parseInt(s[1],10)-1,kt(a)?St(t,a):new Date(NaN);if(s=k.WwwD.exec(e),s){a=parseInt(s[1],10)-1;const c=parseInt(s[2],10)-1;return kt(a,c)?St(t,a,c):new Date(NaN)}return null}function Ir(e){let t,r,n=k.HH.exec(e);if(n)return t=parseFloat(n[1].replace(",",".")),Ke(t)?t%24*Ge:NaN;if(n=k.HHMM.exec(e),n)return t=parseInt(n[1],10),r=parseFloat(n[2].replace(",",".")),Ke(t,r)?t%24*Ge+r*xt:NaN;if(n=k.HHMMSS.exec(e),n){t=parseInt(n[1],10),r=parseInt(n[2],10);const a=parseFloat(n[3].replace(",","."));return Ke(t,r,a)?t%24*Ge+r*xt+a*1e3:NaN}return null}function St(e,t,r){t=t||0,r=r||0;const n=new Date(0);n.setUTCFullYear(e,0,4);const a=n.getUTCDay()||7,s=t*7+r+1-a;return n.setUTCDate(n.getUTCDate()+s),n}const Er=[31,28,31,30,31,30,31,31,30,31,30,31],Ur=[31,29,31,30,31,30,31,31,30,31,30,31];function Ut(e){return e%400===0||e%4===0&&e%100!==0}function Tt(e,t,r){if(t<0||t>11)return!1;if(r!=null){if(r<1)return!1;const n=Ut(e);if(n&&r>Ur[t]||!n&&r>Er[t])return!1}return!0}function Ar(e,t){if(t<1)return!1;const r=Ut(e);return!(r&&t>366||!r&&t>365)}function kt(e,t){return!(e<0||e>52||t!=null&&(t<0||t>6))}function Ke(e,t,r){return!(e<0||e>=25||t!=null&&(t<0||t>=60)||r!=null&&(r<0||r>=60))}function Nt(e,t,r){e=et(e,r);const n=st(t,e,!0),a=new Date(e.getTime()-n),s=new Date(0);return s.setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()),s.setHours(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),s}function Pr(e,t,r){if(typeof e=="string"&&!e.match(Et))return et(e,{...r,timeZone:t});e=et(e,r);const n=at(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()).getTime(),a=st(t,new Date(n));return new Date(n+a)}const tt=ne([]);let R=null;async function ae(){return R||(R=(async()=>{const{data:e,error:t}=await L.from("calendar_events").select("*").order("start_time",{ascending:!0});if(t)throw R=null,t;const r=e||[];return tt.set(r),setTimeout(()=>{R=null},100),r})(),R)}async function At(e){let t=gt(tt);return t.length||(await ae(),t=gt(tt)),t.find(r=>r.id===e)}async function Rr(e){const{data:t,error:r}=await L.from("calendar_events").insert([e]).select();if(r)throw r;return R=null,await ae(),t?t[0]:void 0}async function Pt(e,t){const{data:r,error:n}=await L.from("calendar_events").update(t).eq("id",e).select();if(n)throw n;return R=null,await ae(),r?r[0]:void 0}async function Lr(e){const t=await At(e),{error:r}=await L.from("calendar_events").delete().eq("id",e);if(r)throw r;t?.attachments&&t.attachments.length>0&&await ot(t.attachments),R=null,await ae()}const Hr={bishop:{approval:"bishop_approval",timestamp:"bishop_approval_at",userId:"bishop_approval_by_user_id"},first_counselor:{approval:"first_counselor_approval",timestamp:"first_counselor_approval_at",userId:"first_counselor_approval_by_user_id"},second_counselor:{approval:"second_counselor_approval",timestamp:"second_counselor_approval_at",userId:"second_counselor_approval_by_user_id"}};async function Rt(e,t,r,n){const a=Hr[t],s=r?new Date().toISOString():null;return Pt(e,{[a.approval]:r,[a.timestamp]:s,[a.userId]:r?n??null:null})}async function $r(e=new Date){const t=e.toISOString(),{data:r,error:n}=await L.from("calendar_events").select("*").lt("start_time",t).eq("event_type","calendar_event");if(n)throw n;if(!r||r.length===0)return{deleted:0,skipped:0};const a=[],s=[];for(const u of r){if(u.recurrence_rule&&(!u.recurrence_end_date||u.recurrence_end_date&&new Date(u.recurrence_end_date)>=e)){s.push(u);continue}a.push(u)}let c=0;if(a.length>0){const u=a.map(f=>f.id).filter(f=>f!==void 0);if(u.length>0){const{data:f,error:D}=await L.from("calendar_events").delete().in("id",u).select("id");if(D)throw D;c=f?.length??0;for(const w of a)w.attachments&&w.attachments.length>0&&await ot(w.attachments)}}return R=null,await ae(),{deleted:c,skipped:s.length}}async function Wr(e,t){const r=e.name.split(".").pop()||"bin",n=t||"temp",s=`${crypto.randomUUID()}.${r}`,c=`${n}/${s}`,{error:u}=await L.storage.from("event-attachments").upload(c,e,{cacheControl:"3600",upsert:!1});if(u)throw u;const{data:{publicUrl:f}}=L.storage.from("event-attachments").getPublicUrl(c);return{id:crypto.randomUUID(),name:e.name,url:f,type:e.type,size:e.size,uploadedAt:new Date().toISOString()}}async function Fr(e){const{error:t}=await L.storage.from("event-attachments").remove([e]);if(t)throw t}function Lt(e){const t=e.match(/event-attachments\/(.+)$/);return t?t[1]:""}async function ot(e){if(!e||e.length===0)return;const t=e.map(r=>Lt(r.url)).filter(r=>r);if(t.length>0){const{error:r}=await L.storage.from("event-attachments").remove(t);if(r)throw r}}const Dn=Object.freeze(Object.defineProperty({__proto__:null,createCalendarEvent:Rr,deleteCalendarEvent:Lr,deleteEventAttachment:Fr,deleteEventAttachments:ot,deletePastCalendarEvents:$r,extractStoragePath:Lt,getAllCalendarEvents:ae,getCalendarEvent:At,updateBishopricApproval:Rt,updateCalendarEvent:Pt,uploadEventAttachment:Wr},Symbol.toStringTag,{value:"Module"})),Br={all:{label:"All",key:"",sort_index:0,color_number:0},public:{label:"Public",key:"PUB",sort_index:0,color_number:1},church:{label:"Church",key:"CHU",sort_index:0,color_number:2},stake:{label:"Stake",key:"STK",sort_index:0,color_number:3},ward:{label:"Ward",key:"WRD",sort_index:1,color_number:4},reliefSociety:{label:"Relief Society",key:"RES",sort_index:2,color_number:5},eldersQuorum:{label:"Elders Quorum",key:"ELQ",sort_index:3,color_number:6},youth:{label:"Youth",key:"YOU",sort_index:4,color_number:7},youngWomen:{label:"Young Women",key:"YOW",sort_index:4,color_number:8},youngWomenPearls:{label:"Young Women | Pearls",key:"YWP",sort_index:5,color_number:9},youngWomenRubies:{label:"Young Women | Rubies",key:"YWR",sort_index:6,color_number:10},youngWomenDiamonds:{label:"Young Women | Diamonds",key:"YWD",sort_index:7,color_number:11},aaronicPriesthood:{label:"Young Men",key:"YOM",sort_index:8,color_number:12},aaronicPriesthoodDeacons:{label:"Young Men | Deacons",key:"YMD",sort_index:9,color_number:13},aaronicPriesthoodTeachers:{label:"Young Men | Teachers",key:"YMT",sort_index:10,color_number:14},aaronicPriesthoodPriests:{label:"Young Men | Priests",key:"YMP",sort_index:11,color_number:15},primary:{label:"Primary",key:"PRI",sort_index:12,color_number:16},primaryNursery:{label:"Primary | Nursery",key:"PRN",sort_index:13,color_number:17},primarySunbeams:{label:"Primary | Sunbeams",key:"PRS",sort_index:14,color_number:18},primaryCTR:{label:"Primary | CTR",key:"PRC",sort_index:15,color_number:19},primaryValiant:{label:"Primary | Valiant",key:"PRV",sort_index:16,color_number:20},sundaySchool:{label:"Sunday School",key:"SUS",sort_index:17,color_number:21}},rt=Object.values(Br).sort((e,t)=>e.sort_index-t.sort_index),wn=e=>e?rt.find(t=>t.key===e):void 0,Mt={bishop:"Bishop",first_counselor:"1st Counselor",second_counselor:"2nd Counselor"},jr=e=>e.bishop_approval==="YES"?"approved":e.bishop_approval==="NO"?"needs_review":"pending";let he=null;const zr=e=>e.replace(/<[^>]*>/g,"").toLowerCase(),Ot=(e,t)=>{if(!t.trim())return!0;const r=t.toLowerCase(),n=(e.title||"").toLowerCase(),a=zr(e.description||""),s=(e.location||"").toLowerCase();return n.includes(r)||a.includes(r)||s.includes(r)},xn=(e,t)=>{if(!t.trim()||!e)return Yt(e||"");const r=Yt(e),n=new RegExp(`(${Ht(t)})`,"gi");return r.replace(n,"<mark>$1</mark>")},Sn=(e,t)=>{if(!t.trim()||!e)return e||"";const r=new RegExp(`(${Ht(t)})`,"gi");return e.replace(/(<[^>]*>)|([^<]+)/g,(n,a,s)=>a||(s?s.replace(r,"<mark>$1</mark>"):n))},Yt=e=>{const t=typeof document<"u"?document.createElement("div"):null;return t?(t.textContent=e,t.innerHTML):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},Ht=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),$t=Ct()??null,Zr=nt(!1),qr=nt(It),Qe=$t?.stores.authenticated??Zr,Je=$t?.stores.currentUser??qr,Vr=()=>{const e=ne(!1),t=ne([]),r=ne([]),n=ne(""),a=ne(""),s=ne(!1),c=["bishopric-bishop","bishopric-first-counselor","bishopric-second-counselor"],u=(p,d,m)=>{if(p.bishop_approval==="YES")return!(!d&&p.is_public===!1);if(m.roles?.some(b=>c.includes(b))??!1)return!0;const _=p.meta_data?.submitted_by_user_id;return!!(_&&m.id&&_===m.id)},f=te([r,Qe,Je],([p,d,m])=>{const x=new Date,_=re(ge(x,3),{weekStartsOn:1}),b=p.filter(h=>h?.meta_data?.category?.length).filter(h=>u(h,d,m)).filter(h=>{if(h.event_type==="calendar_event"){const Y=h.start_time?ue(h.start_time):null;return Y?ke(Y,{start:x,end:_}):!1}return!0}).map(h=>rt.find(Y=>Y.key===h.meta_data?.category)).filter(h=>h!==void 0);return Array.from(new Set(b))}),D=te([n],([p])=>rt.find(d=>d.key===p)),w=te([r,n,a,Qe,Je],([p,d,m,x,_])=>p.filter(b=>b.event_type==="calendar_event").filter(b=>{const h=b?.meta_data;return d&&h?h?.category===d:!0}).filter(b=>Ot(b,m)).filter(b=>u(b,x,_)).filter(b=>{const h=b.start_time?ue(b.start_time):null,Y=mr();return h?vr(h,Y)||h.getTime()>=Y.getTime():!1})),O=te([r,n,a,Qe,Je],([p,d,m,x,_])=>p.filter(b=>b.event_type==="announcement").filter(b=>{const h=b?.meta_data;return d&&h?h?.category===d:!0}).filter(b=>Ot(b,m)).filter(b=>u(b,x,_))),N=te([w],([p])=>p.filter(d=>{const m=d.start_time?ue(d.start_time):null;return m?ke(m,{start:le(new Date,{weekStartsOn:1}),end:re(new Date,{weekStartsOn:1})}):!1})),de=()=>{const p=le(new Date,{weekStartsOn:1}),d=re(new Date,{weekStartsOn:1});return`${K(p,"MMM d").toUpperCase()} – ${K(d,"MMM d").toUpperCase()}`},ye=te([w],([p])=>{const d=ge(le(new Date,{weekStartsOn:1}),1),m=re(d,{weekStartsOn:1});return p.filter(x=>{const _=x.start_time?ue(x.start_time):null;return _?ke(_,{start:d,end:m}):!1})}),Ne=()=>{const p=ge(le(new Date,{weekStartsOn:1}),1),d=re(p,{weekStartsOn:1});return`${K(p,"MMM d").toUpperCase()} – ${K(d,"MMM d").toUpperCase()}`},De=te([w],([p])=>{const d=ge(le(new Date,{weekStartsOn:1}),2),m=re(d,{weekStartsOn:1});return p.filter(x=>{const _=x.start_time?ue(x.start_time):null;return _?ke(_,{start:d,end:m}):!1})}),Me=()=>{const p=ge(le(new Date,{weekStartsOn:1}),2),d=re(p,{weekStartsOn:1});return`${K(p,"MMM d").toUpperCase()} – ${K(d,"MMM d").toUpperCase()}`},Oe=p=>{const d=[],m=new Date,x=new Date;x.setFullYear(m.getFullYear()+1);for(const _ of p)if(_.recurrence_rule&&_.start_time&&_.end_time)try{const b=_r.fromString(_.recurrence_rule),h=_.recurrence_end_date?b.all():b.between(m,x,!0),Y=new Date(_.start_time),Ce=new Date(_.end_time).getTime()-Y.getTime(),Q=Nt(Y,ze),we=Q.getHours(),Ie=Q.getMinutes(),fe=Q.getSeconds(),Ee=Q.getMilliseconds(),Ue=_.recurrence_exceptions||[],Ae=_.recurrence_overrides||{};h.forEach((oe,pe)=>{const Pe=Nt(oe,ze),xe=new Date(Pe);xe.setHours(we,Ie,fe,Ee);const Se=Pr(xe,ze),Re=Se,Le=new Date(Se.getTime()+Ce),l=K(oe,"yyyy-MM-dd"),i=Ae[l];if(Ue.includes(l)&&!i)return;const g={..._,id:void 0,start_time:Re.toISOString(),end_time:Le.toISOString(),meta_data:{category:_.meta_data?.category||"",..._.meta_data,recurring_instance:!0,recurring_parent_id:_.id,recurring_instance_index:pe}};i&&(i.title!==void 0&&(g.title=i.title),i.description!==void 0&&(g.description=i.description),i.location!==void 0&&(g.location=i.location),i.start_time!==void 0&&(g.start_time=i.start_time),i.end_time!==void 0&&(g.end_time=i.end_time),i.is_all_day!==void 0&&(g.is_all_day=i.is_all_day),i.meta_data!==void 0&&(g.meta_data={...g.meta_data,...i.meta_data})),d.push(g)})}catch(b){console.error("Failed to expand recurring event:",_.id,b),d.push(_)}else d.push(_);return d},Ye=p=>p.length?Oe(p).map(m=>({...m,start_time:m?.start_time?vt(m.start_time):void 0,end_time:m.end_time?vt(m.end_time):void 0})):[];return he={stores:{ready:e,data:t,dbData:r,announcements:O,calendarEvents:w,calendarEventsThisWeek:N,calendarEventsNextWeek:ye,calendarEventsNextNextWeek:De,currentCategories:f,categoryFilter:n,searchQuery:a,currentCategoryFilter:D,weeksExpanded:s},actions:{reload:async()=>{e.set(!1);const p=await ae();r.set(Ye(p)),e.set(!0)},calendarEventsThisWeekLabel:de,calendarEventsNextWeekLabel:Ne,calendarEventsNextNextWeekLabel:Me}},he},Tn=()=>he?.stores&&Object.keys(he.stores).length>0?he:Vr();var Gr=I("<span> </span>"),Kr=I('<div class="alert alert-info mb-0" role="alert">Save this event or announcement before requesting bishopric approvals.</div>'),Qr=I('<small class="text-muted"> </small>'),Jr=I("<span><!></span>"),Xr=I('<div class="decision-buttons d-grid gap-2 gap-md-3 svelte-rko3uy"><button type="button"><i class="bi bi-check-circle-fill"></i> <div><div class="action-label svelte-rko3uy">Approve</div> <small class="text-muted">Publishes to ward</small></div></button> <button type="button"><i class="bi bi-pencil-square"></i> <div><div class="action-label svelte-rko3uy">Request Changes</div> <small class="text-muted">Ask submitter to revise</small></div></button> <button type="button"><i class="bi bi-hourglass-split"></i> <div><div class="action-label svelte-rko3uy">Mark Pending</div> <small class="text-muted">No decision yet</small></div></button> <!></div>'),en=I("<span> </span>"),tn=I("<span> </span>"),rn=I("<span> </span>"),nn=I('<div class="list-group-item"><div class="d-flex flex-column gap-2"><div><div class="fw-semibold"> </div> <!></div> <div><!></div></div></div>'),an=I('<div class="card-footer text-danger small"> </div>'),sn=I('<div class="card"><div class="list-group list-group-flush"></div> <!></div>'),on=I('<div class="d-flex flex-column gap-3"><div class="d-flex flex-wrap align-items-center justify-content-between gap-2"><h3 class="h5 mb-0">Bishopric Approval</h3> <!></div> <!></div>');function kn(e,t){rr(t,!1);const r=()=>or(it,"$currentUserStore",n),[n,a]=ir(),s=B(),c=B(),u=B(),f=B(),D=B(),w=B(),O=B();let N=Be(t,"eventItem",12),de=Be(t,"disabled",8,!1),ye=Be(t,"reloadEvents",8,null);const Ne={bishop:"bishopric-bishop",first_counselor:"bishopric-first-counselor",second_counselor:"bishopric-second-counselor"},De={bishop:{status:"bishop_approval",timestamp:"bishop_approval_at"},first_counselor:{status:"first_counselor_approval",timestamp:"first_counselor_approval_at"},second_counselor:{status:"second_counselor_approval",timestamp:"second_counselor_approval_at"}},Me={pending:{text:"Pending Approval",class:"bg-warning-subtle text-warning-emphasis"},approved:{text:"Approved",class:"bg-success-subtle text-success-emphasis"},needs_review:{text:"Needs Review",class:"bg-info-subtle text-info-emphasis"}},Oe=Ct()??null,Ye=nt(It),it=Oe?.stores.currentUser??Ye,p=["bishop","first_counselor","second_counselor"];let d=B(""),m=B(null);function x(l){const i=Ne[l];return o(s)?.roles?.includes(i)??!1}function _(l){if(!l)return null;try{return K(ue(l),"MMM d, yyyy 'at' h:mm a")}catch(i){return console.error("Failed to format timestamp",i),null}}async function b(){typeof ye()=="function"&&await ye()()}async function h(l,i){if(N()?.id){E(d,""),E(m,l);try{const g=await Rt(N().id,l,i,o(s)?.id);g&&N({...N(),bishop_approval:g.bishop_approval,first_counselor_approval:g.first_counselor_approval,second_counselor_approval:g.second_counselor_approval,bishop_approval_at:g.bishop_approval_at,first_counselor_approval_at:g.first_counselor_approval_at,second_counselor_approval_at:g.second_counselor_approval_at,bishop_approval_by_user_id:g.bishop_approval_by_user_id,first_counselor_approval_by_user_id:g.first_counselor_approval_by_user_id,second_counselor_approval_by_user_id:g.second_counselor_approval_by_user_id}),await b()}catch(g){console.error("Failed to update approval",g),E(d,"Unable to update approval. Please try again.")}finally{E(m,null)}}}async function Y(l){await h(l,null)}const se=l=>{const{status:i}=De[l];return N()?.[i]},Ce=l=>{const{timestamp:i}=De[l];return N()?.[i]};function Q(l){return _(Ce(l))}function we(l){const i=se(l);return i==="YES"?{text:"Recommends Approval",class:"bg-success-subtle text-success-emphasis"}:i==="NO"?{text:"Recommends Changes",class:"bg-info-subtle text-info-emphasis"}:{text:"No Input Yet",class:"bg-secondary-subtle text-secondary-emphasis"}}function Ie(){const l=se("bishop");return l==="YES"?{text:"Approved",class:"bg-success-subtle text-success-emphasis"}:l==="NO"?{text:"Requested Changes",class:"bg-info-subtle text-info-emphasis"}:{text:"Pending",class:"bg-warning-subtle text-warning-emphasis"}}const fe="btn btn-sm action-btn w-100 text-start d-flex align-items-center gap-2";function Ee(l){const i=se(l)==="YES";return`${fe} ${i?"btn-success text-white":"btn-outline-success"}`}function Ue(l){const i=se(l)==="NO";return`${fe} ${i?"btn-info text-dark":"btn-outline-info"}`}function Ae(l){const i=se(l),g=i==null;return`${fe} ${g?"btn-secondary text-white":"btn-outline-secondary"}`}J(()=>r(),()=>{E(s,r())}),J(()=>P(N()),()=>{E(c,jr(N()))}),J(()=>o(c),()=>{E(u,Me[o(c)])}),J(()=>o(s),()=>{E(f,o(s)?.roles?.includes("bishopric-bishop")??!1)}),J(()=>o(s),()=>{E(D,o(s)?.roles?.includes("bishopric-first-counselor")??!1)}),J(()=>o(s),()=>{E(w,o(s)?.roles?.includes("bishopric-second-counselor")??!1)}),J(()=>(o(f),o(D),o(w)),()=>{E(O,o(f)?p:p.filter(l=>l==="bishop"||l==="first_counselor"&&o(D)||l==="second_counselor"&&o(w)))}),nr(),fr();var oe=on(),pe=T(oe),Pe=V(T(pe),2);{var xe=l=>{var i=Gr(),g=T(i,!0);S(i),j(()=>{ee(i,1,(o(u),y(()=>`badge ${o(u).class}`)),"svelte-rko3uy"),X(g,(o(u),y(()=>o(u).text)))}),M(l,i)};G(Pe,l=>{P(N()),y(()=>N()?.id)&&l(xe)})}S(pe);var Se=V(pe,2);{var Re=l=>{var i=Kr();M(l,i)},Le=l=>{var i=sn(),g=T(i);cr(g,5,()=>o(O),lr,(_e,v)=>{var me=nn(),ct=T(me),He=T(ct),$e=T(He),Bt=T($e,!0);S($e);var jt=V($e,2);{var zt=U=>{var A=Qr(),z=T(A,!0);S(A),j(Z=>X(z,Z),[()=>(o(v),y(()=>Q(o(v))))]),M(U,A)};G(jt,U=>{o(v),y(()=>Q(o(v)))&&U(zt)})}S(He);var lt=V(He,2),Zt=T(lt);{var qt=U=>{var A=Xr(),z=T(A),Z=V(z,2),ie=V(Z,2),q=V(ie,2);{var H=C=>{var $=Jr(),ve=T($);pr(ve,{size:"xs"}),S($),M(C,$)};G(q,C=>{o(m)===o(v)&&C(H)})}S(A),j((C,$,ve)=>{ee(z,1,C,"svelte-rko3uy"),z.disabled=de()||o(m)===o(v),ee(Z,1,$,"svelte-rko3uy"),Z.disabled=de()||o(m)===o(v),ee(ie,1,ve,"svelte-rko3uy"),ie.disabled=de()||o(m)===o(v)},[()=>Ze((o(v),y(()=>Ee(o(v))))),()=>Ze((o(v),y(()=>Ue(o(v))))),()=>Ze((o(v),y(()=>Ae(o(v)))))]),je("click",z,()=>h(o(v),"YES")),je("click",Z,()=>h(o(v),"NO")),je("click",ie,()=>Y(o(v))),M(U,A)},Vt=U=>{var A=mt(),z=pt(A);{var Z=q=>{const H=Fe(()=>(o(v),y(()=>we(o(v)))));var C=en(),$=T(C,!0);S(C),j(()=>{ee(C,1,(P(o(H)),y(()=>`badge ${o(H).class}`)),"svelte-rko3uy"),X($,(P(o(H)),y(()=>o(H).text)))}),M(q,C)},ie=q=>{var H=mt(),C=pt(H);{var $=ce=>{const W=Fe(()=>y(Ie));var F=tn(),We=T(F,!0);S(F),j(()=>{ee(F,1,(P(o(W)),y(()=>`badge ${o(W).class}`)),"svelte-rko3uy"),X(We,(P(o(W)),y(()=>o(W).text)))}),M(ce,F)},ve=ce=>{const W=Fe(()=>(o(v),y(()=>we(o(v)))));var F=rn(),We=T(F,!0);S(F),j(()=>{ee(F,1,(P(o(W)),y(()=>`badge ${o(W).class}`)),"svelte-rko3uy"),X(We,(P(o(W)),y(()=>o(W).text)))}),M(ce,F)};G(C,ce=>{!o(f)&&o(v)==="bishop"?ce($):ce(ve,!1)},!0)}M(q,H)};G(z,q=>{o(f)&&o(v)!=="bishop"?q(Z):q(ie,!1)},!0)}M(U,A)};G(Zt,U=>{o(v),y(()=>x(o(v)))?U(qt):U(Vt,!1)})}S(lt),S(ct),S(me),j(()=>X(Bt,(P(Mt),o(v),y(()=>Mt[o(v)])))),M(_e,me)}),S(g);var Wt=V(g,2);{var Ft=_e=>{var v=an(),me=T(v,!0);S(v),j(()=>X(me,o(d))),M(_e,v)};G(Wt,_e=>{o(d)&&_e(Ft)})}S(i),M(l,i)};G(Se,l=>{P(N()),y(()=>!N()?.id)?l(Re):l(Le,!1)})}S(oe),M(e,oe),ar(),a()}export{kn as B,rt as D,jr as a,wn as b,ge as c,$r as d,re as e,gr as f,Tn as g,yn as h,xn as i,Sn as j,Pr as k,Lt as l,Fr as m,Lr as n,At as o,Pt as p,Rr as q,Dn as r,Nt as t,Wr as u};
