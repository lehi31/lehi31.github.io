const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Dyw_Uc2C.js","./SWWSvUpQ.js","./DIeogL5L.js","./D8ekX_8E.js","./CmsKOCeN.js","./NZTpNUN0.js","./69_IOA4Y.js","./WW5OsAH7.js","./CU3XCoqN.js","./YJAcq9su.js","./D_Y_6C-o.js","./DChAo5Ia.js","./B7nNokYU.js","./BUApaBEI.js","./Bgyk9asy.js","./YfgjUUfO.js","../assets/Spinner.DTjfhZ6-.css","./BdzY7iSj.js","./mnkQx8ai.js","./CvxMDV_e.js","./Cc3l00Qu.js","./Bombw66Y.js","./BNfpV3E5.js","./DAGGzALr.js","./gVEd_n7t.js","./BBLLGwrG.js","../assets/BishopricApprovalSection.DRGo_BHg.css"])))=>i.map(i=>d[i]);
import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{o as Ze,w as ga,g as Ve}from"./WW5OsAH7.js";import{h as ha,d as Ea,bb as wa,P as xa,p as pe,ah as H,ai as $e,B as A,a as fe,n as u,m as t,E as S,s as o,c as r,D as I,r as a,u as n,f as ct,R as Zt,F as me,C as Ne}from"./SWWSvUpQ.js";import{B as ka,p as St,i as E,s as U,e as bt,b as Fe,a as Dt,d as Ma,j as Da}from"./CU3XCoqN.js";import{e as se,i as we}from"./YJAcq9su.js";import{f as m,a as i,c as Nt,t as le}from"./D8ekX_8E.js";import{s as zt,e as Ca,b as Oa,i as Ia,d as $a}from"./D_Y_6C-o.js";import{t as xe,c as Ye,i as dt,p as yt,f as oe,e as ke,O as Me,P as Lt,y as Aa,A as ye,z as Sa}from"./DChAo5Ia.js";import{s as De}from"./CdEA5IGF.js";import{i as be}from"./Bgyk9asy.js";import{C as Xe,c as ta}from"./DWQQkJQZ.js";import{b as ee,h as Te,g as ea,C as aa,c as za,f as ge,m as He,d as he}from"./Dyw_Uc2C.js";import{S as Ce}from"./YfgjUUfO.js";import{v as Oe,D as Ie}from"./BdzY7iSj.js";import{_ as Ke}from"./CmsKOCeN.js";import{R as _e}from"./BNfpV3E5.js";import{P as Ta}from"./BgB8pT2-.js";import{p as Fa}from"./BWgkI1Tu.js";import{c as Ra,e as Ua}from"./Bombw66Y.js";import{i as Ee}from"./DZcPXvPR.js";import{e as Pa}from"./DAGGzALr.js";import{a as We}from"./gVEd_n7t.js";function La(k,c,e){ha&&Ea();var d=new ka(k),D=!wa();xa(()=>{var L=c();D&&L!==null&&typeof L=="object"&&(L={}),d.ensure(L,e)})}function na(k,c){const e=xe(k);if(isNaN(c))return Ye(k,NaN);if(!c)return e;const d=e.getDate(),D=Ye(k,e.getTime());D.setMonth(e.getMonth()+c+1,0);const L=D.getDate();return d>=L?D:(e.setFullYear(D.getFullYear(),D.getMonth(),d),e)}function qe(k){const c=xe(k);return c.setDate(1),c.setHours(0,0,0,0),c}function je(k,c){const e=xe(k),d=xe(c);return e.getFullYear()===d.getFullYear()&&e.getMonth()===d.getMonth()}function Qe(k){return Ee(k,Ra(k))}function Ba(k,c){return na(k,-1)}var Va=m('<div class="event-header-image svelte-lu3xbf"><img class="svelte-lu3xbf"/></div>'),Na=m("<span> </span>"),Ya=m('<button type="button" class="btn btn-sm btn-primary"><i class="bi bi-pencil"></i> Edit</button>'),Ha=m('<p class="section-content svelte-lu3xbf"><span class="badge bg-secondary">All Day Event</span></p>'),Ka=m('<p class="section-content svelte-lu3xbf"> </p>'),Wa=m('<p class="section-content svelte-lu3xbf"><strong> </strong></p> <!>',1),qa=m('<p class="section-content text-muted svelte-lu3xbf"><i class="bi bi-arrow-repeat"></i> <!></p>'),ja=m('<p class="section-content text-muted svelte-lu3xbf"><i class="bi bi-arrow-repeat"></i> Part of recurring event series</p>'),Qa=m('<div class="event-section svelte-lu3xbf"><h6 class="section-label svelte-lu3xbf"><i class="bi bi-geo-alt"></i> Location</h6> <p class="section-content svelte-lu3xbf"> </p></div>'),Ja=m('<div class="event-section svelte-lu3xbf"><h6 class="section-label svelte-lu3xbf"><i class="bi bi-card-text"></i> Description</h6> <div class="section-content event-description svelte-lu3xbf"><!></div></div>'),Ga=m('<div class="attachment-image-container svelte-lu3xbf"><button type="button" class="attachment-image-button svelte-lu3xbf"><img class="attachment-image svelte-lu3xbf"/></button> <div class="attachment-image-label svelte-lu3xbf"><small class="text-muted"> </small></div></div>'),Za=m('<button type="button" class="btn btn-outline-secondary attachment-file-button svelte-lu3xbf"><i class="bi bi-file-pdf"></i> <span class="text-truncate svelte-lu3xbf"> </span> <small class="text-muted"> </small></button>'),Xa=m('<div class="event-section svelte-lu3xbf"><h6 class="section-label svelte-lu3xbf"><i class="bi bi-paperclip"></i> Attachments</h6> <div class="attachments-grid svelte-lu3xbf"></div></div>'),tn=m('<p class="metadata-item svelte-lu3xbf"><i class="bi bi-clock-history"></i> Posted <!> <!></p>'),en=m('<p class="metadata-item svelte-lu3xbf"><i class="bi bi-pencil-square"></i> Last edited <!> <!></p>'),an=m('<div class="event-section event-metadata svelte-lu3xbf"><!> <!></div>'),nn=m('<div class="event-details-view svelte-lu3xbf"><div class="event-header svelte-lu3xbf"><div class="event-header-content svelte-lu3xbf"><!> <div class="event-header-text svelte-lu3xbf"><h3 class="event-title svelte-lu3xbf"> </h3> <!></div></div> <!></div> <div class="event-section svelte-lu3xbf"><h6 class="section-label svelte-lu3xbf"><i class="bi bi-calendar-event"></i> Date & Time</h6> <!> <!></div> <!> <!> <!> <!></div>');function ra(k,c){pe(c,!1);const e=S(),d=S(),D=S(),L=S(),at=S(),Y=S(),q=S(),ut=S(),J=S();let y=St(c,"event",8),W=St(c,"onEdit",8,null),gt=St(c,"canEdit",8,!1);const mt=s=>s.startsWith("image/"),xt=s=>s<1024?s+" B":s<1024*1024?(s/1024).toFixed(1)+" KB":(s/(1024*1024)).toFixed(1)+" MB",nt=s=>{window.open(s,"_blank")},G=s=>{if(!s)return"";try{return dt(yt(s),"MMM d, yyyy 'at' h:mm a")}catch{return""}},j=s=>{try{const l=_e.fromString(s).origOptions,g=l.interval||1,w=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],z=["","1st","2nd","3rd","4th","5th"];if(l.freq===_e.DAILY)return g===1?"Repeats daily":`Repeats every ${g} days`;if(l.freq===_e.WEEKLY){if(l.byweekday){const C=(Array.isArray(l.byweekday)?l.byweekday:[l.byweekday]).map(_=>{const M=typeof _=="number"?_:_.weekday,T=M===6?0:M+1;return w[T]});return g===1?C.length===1?`Repeats every ${C[0]}`:`Repeats on ${C.join(", ")}`:`Repeats every ${g} weeks on ${C.join(", ")}`}return g===1?"Repeats weekly":`Repeats every ${g} weeks`}if(l.freq===_e.MONTHLY){if(l.byweekday){const C=(Array.isArray(l.byweekday)?l.byweekday:[l.byweekday])[0];if(C&&typeof C=="object"&&"n"in C&&"weekday"in C){const _=C.weekday,M=_===6?0:_+1,T=C.n,V=z[T]||`${T}th`;return g===1?`Repeats on the ${V} ${w[M]} of the month`:`Repeats on the ${V} ${w[M]} every ${g} months`}}if(l.bymonthday){const x=Array.isArray(l.bymonthday)?l.bymonthday[0]:l.bymonthday,C=x===1?"st":x===2?"nd":x===3?"rd":"th";return g===1?`Repeats on the ${x}${C} of the month`:`Repeats on the ${x}${C} every ${g} months`}return g===1?"Repeats monthly":`Repeats every ${g} months`}if(l.freq===_e.YEARLY){if(l.bymonth&&l.bymonthday){const x=["","January","February","March","April","May","June","July","August","September","October","November","December"],C=Array.isArray(l.bymonth)?l.bymonth[0]:l.bymonth,_=Array.isArray(l.bymonthday)?l.bymonthday[0]:l.bymonthday,M=_===1?"st":_===2?"nd":_===3?"rd":"th";return g===1?`Repeats every ${x[C]} ${_}${M}`:`Repeats every ${g} years on ${x[C]} ${_}${M}`}return g===1?"Repeats yearly":`Repeats every ${g} years`}return"Repeats"}catch{return"Repeats"}};H(()=>u(y()),()=>{I(e,ee(y()?.meta_data?.organization??""))}),H(()=>u(y()),()=>{I(d,y().meta_data?.submitted_at??y().created_at)}),H(()=>t(d),()=>{I(D,G(t(d)))}),H(()=>u(y()),()=>{I(L,y().meta_data?.submitted_by_name)}),H(()=>(t(D),t(L)),()=>{I(at,!!(t(D)||t(L)))}),H(()=>u(y()),()=>{I(Y,G(y().meta_data?.edited_at))}),H(()=>u(y()),()=>{I(q,y().meta_data?.edited_by_name)}),H(()=>(t(Y),t(q)),()=>{I(ut,!!(t(Y)||t(q)))}),H(()=>u(y()),()=>{I(J,y().attachments?.find(s=>mt(s.type)))}),$e(),be();var It=nn(),Yt=r(It),rt=r(Yt),ae=r(rt);{var qt=s=>{var f=Va(),l=r(f);a(f),A(()=>{zt(l,"src",(t(J),n(()=>t(J).url))),zt(l,"alt",(t(J),n(()=>t(J).name)))}),i(s,f)};E(ae,s=>{t(J)&&s(qt)})}var jt=o(ae,2),Tt=r(jt),Xt=r(Tt,!0);a(Tt);var Ht=o(Tt,2);{var Ft=s=>{var f=Na(),l=r(f,!0);a(f),A(()=>{oe(f,1,`badge rounded-pill bg-color-${t(e),n(()=>t(e).color_number)??""}`,"svelte-lu3xbf"),U(l,(t(e),n(()=>t(e).label)))}),i(s,f)};E(Ht,s=>{t(e),n(()=>t(e)?.label)&&s(Ft)})}a(jt),a(rt);var Bt=o(rt,2);{var Kt=s=>{var f=Ya();bt("click",f,function(...l){W()?.apply(this,l)}),i(s,f)};E(Bt,s=>{gt()&&W()&&s(Kt)})}a(Yt);var kt=o(Yt,2),$t=o(r(kt),2);{var B=s=>{var f=Wa(),l=ct(f),g=r(l),w=r(g,!0);a(g),a(l);var z=o(l,2);{var x=_=>{var M=Ha();i(_,M)},C=_=>{var M=Nt(),T=ct(M);{var V=O=>{var F=Ka(),v=r(F);a(F),A((p,R)=>U(v,`${p??""} - ${R??""}`),[()=>(u(dt),u(yt),u(y()),n(()=>dt(yt(y().start_time),"h:mm a"))),()=>(u(dt),u(yt),u(y()),n(()=>dt(yt(y().end_time),"h:mm a")))]),i(O,F)};E(T,O=>{u(y()),n(()=>y().start_time&&y().end_time)&&O(V)},!0)}i(_,M)};E(z,_=>{u(y()),n(()=>y().is_all_day)?_(x):_(C,!1)})}A(_=>U(w,_),[()=>(u(dt),u(yt),u(y()),n(()=>dt(yt(y().start_time),"EEEE, MMMM d, yyyy")))]),i(s,f)};E($t,s=>{u(y()),n(()=>y().start_time)&&s(B)})}var Q=o($t,2);{var ht=s=>{var f=qa(),l=o(r(f)),g=o(l);{var w=z=>{var x=le();A(C=>U(x,`until ${C??""}`),[()=>(u(dt),u(yt),u(y()),n(()=>dt(yt(y().recurrence_end_date),"MMM d, yyyy")))]),i(z,x)};E(g,z=>{u(y()),n(()=>y().recurrence_end_date)&&z(w)})}a(f),A(z=>U(l,` ${z??""} `),[()=>(u(y()),n(()=>j(y().recurrence_rule)))]),i(s,f)},_t=s=>{var f=Nt(),l=ct(f);{var g=w=>{var z=ja();i(w,z)};E(l,w=>{u(y()),n(()=>y()?.meta_data?.recurring_instance)&&w(g)},!0)}i(s,f)};E(Q,s=>{u(y()),n(()=>y().recurrence_rule)?s(ht):s(_t,!1)})}a(kt);var Rt=o(kt,2);{var X=s=>{var f=Qa(),l=o(r(f),2),g=r(l,!0);a(l),a(f),A(()=>U(g,(u(y()),n(()=>y().location)))),i(s,f)};E(Rt,s=>{u(y()),n(()=>y().location)&&s(X)})}var tt=o(Rt,2);{var Et=s=>{var f=Ja(),l=o(r(f),2),g=r(l);Te(g,()=>(u(y()),n(()=>y().description))),a(l),a(f),i(s,f)};E(tt,s=>{u(y()),n(()=>y().description)&&s(Et)})}var ot=o(tt,2);{var Ct=s=>{var f=Xa(),l=o(r(f),2);se(l,5,()=>(u(y()),n(()=>y().attachments)),g=>g.id,(g,w)=>{var z=Nt(),x=ct(z);{var C=M=>{var T=Ga(),V=r(T),O=r(V);a(V);var F=o(V,2),v=r(F),p=r(v,!0);a(v),a(F),a(T),A(()=>{zt(V,"title",`Open ${t(w),n(()=>t(w).name)??""}`),zt(O,"src",(t(w),n(()=>t(w).url))),zt(O,"alt",(t(w),n(()=>t(w).name))),U(p,(t(w),n(()=>t(w).name)))}),bt("click",V,()=>nt(t(w).url)),i(M,T)},_=M=>{var T=Za(),V=o(r(T),2),O=r(V,!0);a(V);var F=o(V,2),v=r(F);a(F),a(T),A(p=>{zt(T,"title",`Open ${t(w),n(()=>t(w).name)??""}`),U(O,(t(w),n(()=>t(w).name))),U(v,`(${p??""})`)},[()=>(t(w),n(()=>xt(t(w).size)))]),bt("click",T,()=>nt(t(w).url)),i(M,T)};E(x,M=>{t(w),n(()=>mt(t(w).type))?M(C):M(_,!1)})}i(g,z)}),a(l),a(f),i(s,f)};E(ot,s=>{u(y()),n(()=>y().attachments&&y().attachments.length>0)&&s(Ct)})}var b=o(ot,2);{var h=s=>{var f=an(),l=r(f);{var g=x=>{var C=tn(),_=o(r(C),2);{var M=O=>{var F=le();A(()=>U(F,t(D))),i(O,F)};E(_,O=>{t(D)&&O(M)})}var T=o(_,2);{var V=O=>{var F=le();A(()=>U(F,`by ${t(L)??""}`)),i(O,F)};E(T,O=>{t(L)&&O(V)})}a(C),i(x,C)};E(l,x=>{t(at)&&x(g)})}var w=o(l,2);{var z=x=>{var C=en(),_=o(r(C),2);{var M=O=>{var F=le();A(()=>U(F,t(Y))),i(O,F)};E(_,O=>{t(Y)&&O(M)})}var T=o(_,2);{var V=O=>{var F=le();A(()=>U(F,`by ${t(q)??""}`)),i(O,F)};E(T,O=>{t(q)&&O(V)})}a(C),i(x,C)};E(w,x=>{t(ut)&&x(z)})}a(f),i(s,f)};E(b,s=>{(t(at)||t(ut))&&s(h)})}a(It),A(()=>U(Xt,(u(y()),n(()=>y().title)))),i(k,It),fe()}var rn=m('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add announcement"><i class="bi bi-plus"></i> <span class="d-none d-md-inline ms-1">Add Announcement</span></button>'),sn=m("<span> </span>"),on=m('<span class="announcement-location svelte-1yokbat"><i class="bi bi-geo-alt"></i> </span>'),ln=m('<div class="announcement-thumbnail-container svelte-1yokbat"><img class="announcement-thumbnail svelte-1yokbat"/></div>'),vn=m('<div class="announcement-actions svelte-1yokbat"><button type="button" class="btn btn-sm btn-primary" title="Edit announcement"><i class="bi bi-pencil"></i></button></div>'),cn=m('<li class="list-group-item list-group-item-action d-flex align-items-center gap-3"><span></span> <button type="button" class="announcement-details-button svelte-1yokbat"><div class="announcement-title svelte-1yokbat"> </div> <div class="announcement-meta svelte-1yokbat"><!> <!></div></button> <!> <!></li>'),dn=m('<div class="announcements-footer svelte-1yokbat"><small> </small> <button class="btn btn-primary btn-sm">More</button></div>'),un=m('<div class="announcements-list-container svelte-1yokbat"><ul class="list-group list-group-flush"></ul></div> <!>',1),mn=m('<div class="no-announcements svelte-1yokbat"><!></div>'),_n=m('<div class="announcements-container svelte-1yokbat"><div class="announcements-header svelte-1yokbat"><h2 class="announcements-title svelte-1yokbat">Announcements</h2> <div class="announcements-actions svelte-1yokbat"><!></div></div> <!></div>'),pn=m('<div class="d-flex flex-column gap-4"><!></div>'),fn=m("<!> <!> <!>",1);function Yr(k,c){pe(c,!1);const e=()=>Dt(ae,"$searchQuery",J),d=()=>Dt(rt,"$announcements",J),D=()=>Dt(xt,"$currentUser",J),L=()=>Dt(It,"$userOrganizations",J),at=()=>Dt(nt,"$currentUserHasPermission",J),Y=()=>Dt(j,"$currentUserIsRoot",J),q=()=>Dt(G,"$currentUserIsAdmin",J),ut=()=>Dt(Yt,"$ready",J),[J,y]=Fe(),W=S(),gt=S(),mt=S(),{stores:{currentUser:xt,currentUserHasPermission:nt,currentUserIsAdmin:G,currentUserIsRoot:j,userOrganizations:It}}=ke(),{stores:{ready:Yt,announcements:rt,searchQuery:ae},actions:{reload:qt}}=ea(),jt={title:"Announcement",description:"",location:"",event_type:"announcement",is_public:!0},Tt=Oe(),Xt=Oe();let Ht=S(!1),Ft=S(!1),Bt=S(),Kt=S(!1),kt=S(!1),$t=S(!1),B=S(new Set),Q=S(""),ht=S({...jt}),_t=S({...jt});const Rt=5,X=5;let tt=S(Rt);function Et(){I(tt,t(tt)+X)}const ot=_=>ta(_,{currentUserId:t(Bt),isPrivileged:t(Ft),canEditOwnOrgEvents:t($t),userOrganizations:t(B)}),Ct=_=>_.startsWith("image/");Ze(async()=>{await qt()});const b=_=>{I(Q,"Announcement Form"),I(ht,{..._,organization:_?.meta_data?.organization??""})},h=_=>{I(_t,_);const M=document.getElementById(Xt);M&&new window.bootstrap.Offcanvas(M).show()},s=_=>{b(_);const M=document.getElementById(Tt);M&&new window.bootstrap.Offcanvas(M).show()},f=()=>{const _=document.getElementById(Xt);if(_){const M=window.bootstrap.Offcanvas.getInstance(_);M&&M.hide()}b(t(_t)),setTimeout(()=>{const M=document.getElementById(Tt);M&&new window.bootstrap.Offcanvas(M).show()},300)};H(()=>(e(),d(),t(tt)),()=>{I(W,e()?d()??[]:(d()??[]).slice(0,t(tt)))}),H(()=>(e(),d(),t(tt)),()=>{I(gt,!e()&&(d()?.length??0)>t(tt))}),H(()=>D(),()=>{I(Bt,D()?.id)}),H(()=>t(Bt),()=>{I(kt,!!t(Bt))}),H(()=>L(),()=>{I(B,L())}),H(()=>(t(B),Me),()=>{I(Kt,t(B).has(Me.Bishopric))}),H(()=>(at(),Lt),()=>{I($t,at()(Lt.EditOwnOrgEvents))}),H(()=>(Y(),q(),t(Kt),at(),Lt),()=>{I(Ft,Y()||q()||t(Kt)||at()(Lt.EditAllEvents))}),H(()=>(t(Ft),at(),t($t),t(kt)),()=>{I(Ht,t(Ft)||at()(Lt.CreateEvents)||t($t)||t(kt))}),H(()=>(at(),Lt),()=>{I(mt,at()(Lt.DeleteEvents))}),$e(),be();var l=fn(),g=ct(l);Ie(g,{get title(){return t(Q)},get id(){return Tt},children:(_,M)=>{Xe(_,{get eventItem(){return t(ht)},get drawerId(){return Tt},name:"announcement-item-form",get canDelete(){return t(mt)}})},$$slots:{default:!0}});var w=o(g,2);Ie(w,{title:"Announcement Details",get id(){return Xt},children:(_,M)=>{{let T=Zt(()=>(t(_t),n(()=>ot(t(_t)))));ra(_,{get event(){return t(_t)},get canEdit(){return t(T)},onEdit:f})}},$$slots:{default:!0}});var z=o(w,2);{var x=_=>{var M=_n(),T=r(M),V=o(r(T),2),O=r(V);{var F=K=>{var it=rn();A(()=>{zt(it,"data-bs-target",`#${Tt??""}`),zt(it,"aria-controls",Tt)}),bt("click",it,()=>b({...jt,event_type:"announcement"})),i(K,it)};E(O,K=>{t(Ht)&&K(F)})}a(V),a(T);var v=o(T,2);{var p=K=>{var it=un(),Wt=ct(it),ne=r(Wt);se(ne,5,()=>t(W),Z=>Z.id,(Z,N)=>{const pt=Zt(()=>(t(N),n(()=>t(N).attachments?.find(wt=>Ct(wt.type))))),$=Zt(()=>(u(ee),t(N),n(()=>ee(t(N)?.meta_data?.organization??""))));var P=cn(),lt=r(P),Vt=o(lt,2),Ot=r(Vt),Pt=r(Ot,!0);a(Ot);var Qt=o(Ot,2),te=r(Qt);{var At=wt=>{var ft=sn(),Jt=r(ft,!0);a(ft),A(()=>{oe(ft,1,`badge rounded-pill bg-color-${u(t($)),n(()=>t($).color_number)??""}`,"svelte-1yokbat"),U(Jt,(u(t($)),n(()=>t($).label)))}),i(wt,ft)};E(te,wt=>{u(t($)),n(()=>t($)?.label)&&wt(At)})}var ve=o(te,2);{var ce=wt=>{var ft=on(),Jt=o(r(ft));a(ft),A(()=>U(Jt,` ${t(N),n(()=>t(N).location)??""}`)),i(wt,ft)};E(ve,wt=>{t(N),n(()=>t(N).location)&&wt(ce)})}a(Qt),a(Vt);var st=o(Vt,2);{var de=wt=>{var ft=ln(),Jt=r(ft);a(ft),A(()=>{zt(Jt,"src",(u(t(pt)),n(()=>t(pt).url))),zt(Jt,"alt",(u(t(pt)),n(()=>t(pt).name)))}),i(wt,ft)};E(st,wt=>{t(pt)&&wt(de)})}var re=o(st,2);{var ue=wt=>{var ft=vn(),Jt=r(ft);a(ft),bt("click",Jt,De(()=>s(t(N)))),i(wt,ft)};E(re,wt=>{t(N),n(()=>ot(t(N)))&&wt(ue)})}a(P),A(()=>{oe(lt,1,`announcement-color-indicator bg-color-${u(t($)),n(()=>t($)?.color_number??0)??""}`,"svelte-1yokbat"),U(Pt,(t(N),n(()=>t(N).title)))}),bt("click",Vt,()=>h(t(N))),i(Z,P)}),a(ne),a(Wt);var Ut=o(Wt,2);{var Mt=Z=>{var N=dn(),pt=r(N),$=r(pt);a(pt);var P=o(pt,2);a(N),A(()=>U($,`Showing ${t(tt)??""} of ${d(),n(()=>d()?.length??0)??""}`)),bt("click",P,Et),i(Z,N)};E(Ut,Z=>{t(gt)&&Z(Mt)})}i(K,it)},R=K=>{var it=Nt(),Wt=ct(it);{var ne=Ut=>{var Mt=mn(),Z=r(Mt);{var N=$=>{var P=le("No announcements match your search.");i($,P)},pt=$=>{var P=le("There are no announcements yet.");i($,P)};E(Z,$=>{e()?$(N):$(pt,!1)})}a(Mt),i(Ut,Mt)};E(Wt,Ut=>{d(),n(()=>d()?.length===0)&&Ut(ne)},!0)}i(K,it)};E(v,K=>{t(W),n(()=>t(W).length)?K(p):K(R,!1)})}a(M),i(_,M)},C=_=>{var M=pn(),T=r(M);Ce(T,{}),a(M),i(_,M)};E(z,_=>{ut()?_(x):_(C,!1)})}i(k,l),fe(),y()}const sa={},oa={};for(const k of Object.values(aa))k.key&&(sa[k.label.toLowerCase()]=k.key,oa[k.key]=k.label);const bn=new Set(Object.values(aa).map(k=>k.key).filter(Boolean));function yn(k){const c=k.trim();if(c)return bn.has(c.toUpperCase())?c.toUpperCase():sa[c.toLowerCase()]}async function gn(k){return new Promise((c,e)=>{Ta.parse(k,{header:!0,skipEmptyLines:!0,complete:d=>{const D=d.data,L=d.meta.fields||[];c({data:D,columns:L})},error:d=>e(d)})})}function hn(k){return k.map(c=>{const e=c.toLowerCase().trim();return e==="title"||e==="event"||e==="event name"||e==="name"?{csvColumn:c,eventField:"title"}:e==="description"||e==="details"||e==="notes"?{csvColumn:c,eventField:"description"}:e==="start date"||e==="start_date"||e==="date"||e==="event date"?{csvColumn:c,eventField:"start_date"}:e==="start time"||e==="start_time"||e==="time"||e==="event time"?{csvColumn:c,eventField:"start_time"}:e==="end date"||e==="end_date"?{csvColumn:c,eventField:"end_date"}:e==="end time"||e==="end_time"?{csvColumn:c,eventField:"end_time"}:e==="location"||e==="place"||e==="venue"?{csvColumn:c,eventField:"location"}:e==="organization"||e==="group"||e==="organization"||e==="org"?{csvColumn:c,eventField:"organization"}:e==="all day"||e==="all_day"||e==="is_all_day"||e==="allday"?{csvColumn:c,eventField:"is_all_day"}:{csvColumn:c,eventField:null}})}function ie(k,c,e){const d=c.find(D=>D.eventField===e);return d?(k[d.csvColumn]||"").trim():""}function Je(k){const c=["yyyy-MM-dd","MM/dd/yyyy","M/d/yyyy","MM-dd-yyyy","M-d-yyyy","MM/dd/yy","M/d/yy","yyyy/MM/dd","MMM d, yyyy","MMMM d, yyyy","MMM d yyyy","d MMM yyyy"];for(const e of c){const d=Fa(k,e,new Date);if(Aa(d))return d}return null}function Ge(k){const c=k.match(/^(\d{1,2}):(\d{2})$/);if(c){const d=parseInt(c[1],10),D=parseInt(c[2],10);if(d>=0&&d<=23&&D>=0&&D<=59)return{hours:d,minutes:D}}const e=k.match(/^(\d{1,2})(?::(\d{2}))?\s*(am|pm)$/i);if(e){let d=parseInt(e[1],10);const D=e[2]?parseInt(e[2],10):0,L=e[3].toLowerCase();if(d>=1&&d<=12&&D>=0&&D<=59)return L==="pm"&&d!==12&&(d+=12),L==="am"&&d===12&&(d=0),{hours:d,minutes:D}}return null}function En(k){const c=k.toLowerCase().trim();return["true","yes","1","y","x"].includes(c)}function wn(k,c,e){const d=[],D=ie(k,c,"title"),L=ie(k,c,"description"),at=ie(k,c,"start_date"),Y=ie(k,c,"start_time"),q=ie(k,c,"end_date"),ut=ie(k,c,"end_time"),J=ie(k,c,"location"),y=ie(k,c,"organization"),W=ie(k,c,"is_all_day");if(!D)return d.push({row:e,field:"title",message:"Title is required"}),{event:null,errors:d};if(D.length<3)return d.push({row:e,field:"title",message:"Title must be at least 3 characters"}),{event:null,errors:d};if(D.length>255)return d.push({row:e,field:"title",message:"Title cannot exceed 255 characters"}),{event:null,errors:d};if(!at)return d.push({row:e,field:"start_date",message:"Start date is required"}),{event:null,errors:d};const gt=Je(at);if(!gt)return d.push({row:e,field:"start_date",message:`Invalid date format: "${at}"`}),{event:null,errors:d};const mt=W?En(W):!Y;let xt;if(!mt&&Y){const rt=Ge(Y);if(!rt)return d.push({row:e,field:"start_time",message:`Invalid time format: "${Y}"`}),{event:null,errors:d};gt.setHours(rt.hours,rt.minutes,0,0),xt=ge(gt,ye)}else gt.setHours(0,0,0,0),xt=ge(gt,ye);let nt;const G=q?Je(q):new Date(gt);if(G&&!mt&&ut){const rt=Ge(ut);if(!rt)return d.push({row:e,field:"end_time",message:`Invalid time format: "${ut}"`}),{event:null,errors:d};G.setHours(rt.hours,rt.minutes,0,0),nt=ge(G,ye)}else if(!mt&&Y)nt=new Date(xt.getTime()+60*60*1e3);else{const rt=G||new Date(gt);rt.setHours(23,59,59,0),nt=ge(rt,ye)}let j;if(y&&(j=yn(y),!j))return d.push({row:e,field:"organization",message:`Unknown organization: "${y}"`}),{event:null,errors:d};if(J&&J.length>255)return d.push({row:e,field:"location",message:"Location cannot exceed 255 characters"}),{event:null,errors:d};const It={};if(j){It.organization=j;const rt=oa[j];rt&&(It.organization_label=rt)}return{event:{title:D,event_type:"calendar_event",start_time:xt.toISOString(),end_time:nt.toISOString(),is_all_day:mt,is_public:!0,is_published:!1,meta_data:It,...L?{description:L}:{},...J?{location:J}:{}},errors:[]}}async function xn(k,c){const e={success:0,validationErrors:0,errors:[]},d=[];for(let Y=0;Y<k.length;Y++){const{event:q,errors:ut}=wn(k[Y],c,Y+1);if(ut.length>0){e.validationErrors++,e.errors.push(...ut);continue}q&&d.push(q)}const D=ke(),L=D?Ve(D.stores.currentUser):void 0,at=D?Ve(D.stores.userOrganizations):void 0;if(L){const Y=L.displayName||L.username,q=L.id,ut=at?Array.from(at):[],J=new Date().toISOString();for(const y of d){const W=y.meta_data||{};Y&&(W.submitted_by_name=Y),q&&(W.submitted_by_user_id=q),ut.length&&(W.submitted_by_organizations=ut),W.submitted_at=J,y.meta_data=W}}return d.length>0&&(await za(d),e.success=d.length),e}function kn(){const k=ga({step:"upload",csvData:[],csvColumns:[],columnMappings:[],importResult:null});return{state:k,parseCsvFile:gn,autoDetectMappings:hn,importEvents:xn,reset:()=>k.set({step:"upload",csvData:[],csvColumns:[],columnMappings:[],importResult:null})}}var Mn=m(`<p class="text-muted small mb-3">Upload a CSV file to bulk-import calendar events. Need a starting point? <a href="/sample-events.csv" download="">Download sample CSV template</a>.</p> <div class="mb-3"><label for="csvFile" class="form-label">Select CSV File</label> <input type="file" class="form-control" id="csvFile" accept=".csv"/></div> <div class="alert alert-warning small mb-3 d-flex align-items-start gap-2"><i class="bi bi-info-circle mt-1"></i> <span>All imported events require <strong>bishopric approval</strong> before they appear on the
							public calendar.</span></div> <div class="alert alert-info small mb-0"><strong>Format Guide:</strong> <ul class="mb-0 mt-1"><li><strong>Required columns:</strong> Title, Date</li> <li><strong>Optional columns:</strong> Start Time, End Time, Location, Category, Description</li> <li>Dates: YYYY-MM-DD, MM/DD/YYYY, Jan 1, 2025, etc.</li> <li>Times: 7:00 PM, 19:00, etc. (omit for all-day events)</li> <li>Categories: Ward, Relief Society, Elders Quorum, Youth, Young Women, Young Men,
								Primary, etc.</li></ul></div>`,1),Dn=m('<tr><td> </td><td><select class="form-select form-select-sm"><option>-- Skip --</option><option>Title</option><option>Description</option><option>Start Date</option><option>Start Time</option><option>End Date</option><option>End Time</option><option>Location</option><option>Category</option><option>All Day</option></select></td></tr>'),Cn=m('<h6>Map CSV Columns to Event Fields</h6> <p class="text-muted"> </p> <table class="table table-sm"><thead><tr><th>CSV Column</th><th>Maps To</th></tr></thead><tbody></tbody></table>',1),On=m('<div class="text-center py-5"><!> <p class="mt-3">Importing events...</p></div>'),In=m("<li><strong> </strong> rows had validation errors</li>"),$n=m(`<div class="alert alert-info small">Imported events are <strong>unpublished</strong> and will need bishopric approval before
							they appear on the public calendar.</div>`),An=m("<li> </li>"),Sn=m("<li><em> </em></li>"),zn=m('<div class="alert alert-warning"><h6>Validation Errors:</h6> <ul class="mb-0" style="max-height: 200px; overflow-y: auto;"><!> <!></ul></div>'),Tn=m('<div class="alert alert-success"><h6>Import Complete</h6> <ul class="mb-0"><li><strong> </strong> events imported successfully</li> <!></ul></div> <!> <!>',1),Fn=m('<button type="button" class="btn btn-secondary">Cancel</button>'),Rn=m('<button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-primary"> </button>',1),Un=m('<button type="button" class="btn btn-secondary" disabled>Cancel</button> <button type="button" class="btn btn-primary" disabled><!> Importing...</button>',1),Pn=m('<button type="button" class="btn btn-primary">Done</button>'),Ln=m('<div class="modal-backdrop fade show"></div>'),Bn=m('<div tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Import Events from CSV</h5> <button type="button" class="btn-close" aria-label="Close import modal"></button></div> <div class="modal-body"><!></div> <div class="modal-footer"><!></div></div></div></div> <!>',1);function Vn(k,c){pe(c,!1);const e=()=>Dt(q,"$state",d),[d,D]=Fe();let L=St(c,"isOpen",8,!1),at=St(c,"onClose",8),Y=St(c,"onComplete",8);const{state:q,parseCsvFile:ut,autoDetectMappings:J,importEvents:y,reset:W}=kn();async function gt(B){const Q=B.target.files?.[0];if(Q)try{const{data:ht,columns:_t}=await ut(Q),Rt=J(_t);q.update(X=>({...X,step:"mapping",csvData:ht,csvColumns:_t,columnMappings:Rt}))}catch(ht){console.error("Failed to parse CSV:",ht),alert("Failed to parse CSV file. Please check the file format.")}}async function mt(){q.update(B=>({...B,step:"importing"}));try{const B=await y(e().csvData,e().columnMappings);q.update(Q=>({...Q,step:"complete",importResult:B})),Y()()}catch(B){console.error("Failed to import events:",B),alert("Failed to import events. Please try again."),q.update(Q=>({...Q,step:"mapping"}))}}function xt(){W(),at()()}be();var nt=Bn(),G=ct(nt);let j;var It=r(G),Yt=r(It),rt=r(Yt),ae=o(r(rt),2);ae.__click=xt,a(rt);var qt=o(rt,2),jt=r(qt);{var Tt=B=>{var Q=Mn(),ht=o(ct(Q),2),_t=o(r(ht),2);_t.__change=gt,a(ht),me(4),i(B,Q)},Xt=B=>{var Q=Nt(),ht=ct(Q);{var _t=X=>{var tt=Cn(),Et=o(ct(tt),2),ot=r(Et);a(Et);var Ct=o(Et,2),b=o(r(Ct));se(b,5,()=>(e(),n(()=>e().columnMappings)),we,(h,s,f)=>{var l=Dn(),g=r(l),w=r(g,!0);a(g);var z=o(g),x=r(z);A(()=>{t(s),Ne(()=>{})});var C=r(x);C.value=(C.__value=null)??"";var _=o(C);_.value=_.__value="title";var M=o(_);M.value=M.__value="description";var T=o(M);T.value=T.__value="start_date";var V=o(T);V.value=V.__value="start_time";var O=o(V);O.value=O.__value="end_date";var F=o(O);F.value=F.__value="end_time";var v=o(F);v.value=v.__value="location";var p=o(v);p.value=p.__value="category";var R=o(p);R.value=R.__value="is_all_day",a(x),a(z),a(l),A(()=>U(w,(t(s),n(()=>t(s).csvColumn)))),Oa(x,()=>t(s).eventField,K=>(t(s).eventField=K,Ne(()=>e()),Da(d,"$state"))),i(h,l)}),a(b),a(Ct),A(()=>U(ot,`Found ${e(),n(()=>e().csvData.length)??""} rows in CSV`)),i(X,tt)},Rt=X=>{var tt=Nt(),Et=ct(tt);{var ot=b=>{var h=On(),s=r(h);Ce(s,{}),me(2),a(h),i(b,h)},Ct=b=>{var h=Nt(),s=ct(h);{var f=l=>{var g=Tn(),w=ct(g),z=o(r(w),2),x=r(z),C=r(x),_=r(C,!0);a(C),me(),a(x);var M=o(x,2);{var T=p=>{var R=In(),K=r(R),it=r(K,!0);a(K),me(),a(R),A(()=>U(it,(e(),n(()=>e().importResult.validationErrors)))),i(p,R)};E(M,p=>{e(),n(()=>e().importResult?.validationErrors&&e().importResult.validationErrors>0)&&p(T)})}a(z),a(w);var V=o(w,2);{var O=p=>{var R=$n();i(p,R)};E(V,p=>{e(),n(()=>e().importResult?.success&&e().importResult.success>0)&&p(O)})}var F=o(V,2);{var v=p=>{var R=zn(),K=o(r(R),2),it=r(K);se(it,1,()=>(e(),n(()=>e().importResult.errors.slice(0,10))),we,(Ut,Mt)=>{var Z=An(),N=r(Z);a(Z),A(()=>U(N,`Row ${t(Mt),n(()=>t(Mt).row)??""}: ${t(Mt),n(()=>t(Mt).message)??""}`)),i(Ut,Z)});var Wt=o(it,2);{var ne=Ut=>{var Mt=Sn(),Z=r(Mt),N=r(Z);a(Z),a(Mt),A(()=>U(N,`... and ${e(),n(()=>e().importResult.errors.length-10)??""} more errors`)),i(Ut,Mt)};E(Wt,Ut=>{e(),n(()=>e().importResult.errors.length>10)&&Ut(ne)})}a(K),a(R),i(p,R)};E(F,p=>{e(),n(()=>e().importResult?.errors&&e().importResult.errors.length>0)&&p(v)})}A(()=>U(_,(e(),n(()=>e().importResult?.success||0)))),i(l,g)};E(s,l=>{e(),n(()=>e().step==="complete")&&l(f)},!0)}i(b,h)};E(Et,b=>{e(),n(()=>e().step==="importing")?b(ot):b(Ct,!1)},!0)}i(X,tt)};E(ht,X=>{e(),n(()=>e().step==="mapping")?X(_t):X(Rt,!1)},!0)}i(B,Q)};E(jt,B=>{e(),n(()=>e().step==="upload")?B(Tt):B(Xt,!1)})}a(qt);var Ht=o(qt,2),Ft=r(Ht);{var Bt=B=>{var Q=Fn();Q.__click=xt,i(B,Q)},Kt=B=>{var Q=Nt(),ht=ct(Q);{var _t=X=>{var tt=Rn(),Et=ct(tt);Et.__click=xt;var ot=o(Et,2);ot.__click=mt;var Ct=r(ot);a(ot),A(()=>U(Ct,`Import ${e(),n(()=>e().csvData.length)??""} Events`)),i(X,tt)},Rt=X=>{var tt=Nt(),Et=ct(tt);{var ot=b=>{var h=Un(),s=o(ct(h),2),f=r(s);Ce(f,{size:"sm"}),me(),a(s),i(b,h)},Ct=b=>{var h=Nt(),s=ct(h);{var f=l=>{var g=Pn();g.__click=xt,i(l,g)};E(s,l=>{e(),n(()=>e().step==="complete")&&l(f)},!0)}i(b,h)};E(Et,b=>{e(),n(()=>e().step==="importing")?b(ot):b(Ct,!1)},!0)}i(X,tt)};E(ht,X=>{e(),n(()=>e().step==="mapping")?X(_t):X(Rt,!1)},!0)}i(B,Q)};E(Ft,B=>{e(),n(()=>e().step==="upload")?B(Bt):B(Kt,!1)})}a(Ht),a(Yt),a(It),a(G);var kt=o(G,2);{var $t=B=>{var Q=Ln();i(B,Q)};E(kt,B=>{L()&&B($t)})}A(()=>{j=oe(G,1,"modal fade",null,j,{show:L()}),Ca(G,`display: ${L()?"block":"none"}`)}),i(k,nt),fe(),D()}Ma(["click","change"]);var Nn=m("<option> </option>"),Yn=m('<select class="form-select form-select-sm organization-filter svelte-14mpkul" aria-label="Filter calendar by organization"><option>All Organizations</option><!></select>'),Hn=m('<div class="calendar-day-header svelte-14mpkul"><span class="d-none d-md-inline"> </span> <span class="d-md-none"> </span></div>'),Kn=m('<button type="button"><span class="event-title svelte-14mpkul"> </span></button>'),Wn=m('<div class="more-events svelte-14mpkul"> </div>'),qn=m('<div role="button" tabindex="0"><div class="day-number svelte-14mpkul"> </div> <div class="day-events svelte-14mpkul"><!> <!></div></div>'),jn=m("<span> </span>"),Qn=m('<span class="badge bg-secondary">All Day</span>'),Jn=m('<span class="event-time svelte-14mpkul"> </span>'),Gn=m('<span class="event-location svelte-14mpkul"><i class="bi bi-geo-alt"></i> </span>'),Zn=m('<div class="event-thumbnail-container svelte-14mpkul"><img class="event-thumbnail svelte-14mpkul"/></div>'),Xn=m('<div class="event-actions svelte-14mpkul"><button type="button" class="btn btn-sm btn-primary" title="Edit event"><i class="bi bi-pencil"></i></button></div>'),tr=m('<li class="list-group-item list-group-item-action d-flex align-items-center gap-3"><span></span> <button type="button" class="event-details-button svelte-14mpkul"><div class="event-title-full svelte-14mpkul"> </div> <div class="event-meta svelte-14mpkul"><!> <!> <!></div></button> <!> <!></li>'),er=m('<div class="card mt-3"><div class="card-header d-flex justify-content-between align-items-center"><h6 class="mb-0 fw-semibold"> </h6> <button type="button" class="btn btn-sm btn-primary" aria-label="Close"><i class="bi bi-x-lg"></i></button></div> <ul class="list-group list-group-flush"></ul></div>'),ar=m('<div class="month-calendar svelte-14mpkul"><div class="calendar-header svelte-14mpkul"><h5 class="month-title svelte-14mpkul"> </h5> <div class="calendar-controls svelte-14mpkul"><div class="calendar-nav svelte-14mpkul"><button type="button" class="btn btn-sm btn-primary" aria-label="Previous month"><i class="bi bi-chevron-left"></i></button> <button type="button" class="btn btn-sm btn-primary" aria-label="Go to today">Today</button> <button type="button" class="btn btn-sm btn-primary" aria-label="Next month"><i class="bi bi-chevron-right"></i></button></div> <!></div></div> <div class="calendar-grid svelte-14mpkul"><!> <!></div> <!></div>');function nr(k,c){pe(c,!1);const e=S(),d=S(),D=S(),L=S();let at=St(c,"events",24,()=>[]),Y=St(c,"onEventClick",8,()=>{}),q=St(c,"onEventEdit",8,null),ut=St(c,"canEditEvent",8,null),J=St(c,"organizationFilter",8,""),y=St(c,"onOrganizationFilterChange",8,()=>{}),W=St(c,"availableOrganizations",24,()=>[]),gt=St(c,"visibleMonth",24,()=>new Date),mt=St(c,"onVisibleMonthChange",8,()=>{});const xt=b=>{const h=qe(new Date(b));return h.setHours(0,0,0,0),h};let nt=S(xt(gt()));const G=(b,h=!0)=>{const s=xt(b);s.getTime()!==t(nt).getTime()&&(I(nt,s),h&&mt()(new Date(s)))};let j=S(null);const It=b=>{t(j)&&Ee(t(j),b)?I(j,null):I(j,b)},Yt=()=>{G(new Date)},rt=()=>{G(Ba(t(nt)))},ae=()=>{G(na(t(nt),1))},qt=b=>{const h=dt(b,"yyyy-MM-dd");return t(L)[h]||[]},jt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Tt=["S","M","T","W","T","F","S"],Xt=b=>b.startsWith("image/");H(()=>u(gt()),()=>{G(gt(),!1)}),H(()=>t(j),()=>{I(e,t(j)?qt(t(j)):[])}),H(()=>(t(e),yt),()=>{I(d,t(e).slice().sort((b,h)=>{const s=b.is_all_day?0:1,f=h.is_all_day?0:1;if(s!==f)return s-f;const l=b.start_time?yt(b.start_time).getTime():0,g=h.start_time?yt(h.start_time).getTime():0;return l-g}))}),H(()=>(t(nt),We),()=>{I(D,(()=>{const b=qe(t(nt)),h=Ua(t(nt)),s=Sa(b,{weekStartsOn:0}),f=Pa(h,{weekStartsOn:0}),l=[];let g=s;for(;g<=f;)l.push(g),g=We(g,1);return l})())}),H(()=>(u(at()),dt),()=>{I(L,at().reduce((b,h)=>{if(!h.start_time)return b;const s=yt(h.start_time),f=dt(s,"yyyy-MM-dd");return b[f]||(b[f]=[]),b[f].push(h),b},{}))}),$e(),be();var Ht=ar(),Ft=r(Ht),Bt=r(Ft),Kt=r(Bt,!0);a(Bt);var kt=o(Bt,2),$t=r(kt),B=r($t),Q=o(B,2),ht=o(Q,2);a($t);var _t=o($t,2);{var Rt=b=>{var h=Yn(),s=r(h);s.value=s.__value="";var f=o(s);se(f,1,W,we,(g,w)=>{var z=Nn(),x=r(z,!0);a(z);var C={};A(()=>{U(x,(t(w),n(()=>t(w).label))),C!==(C=(t(w),n(()=>t(w).key)))&&(z.value=(z.__value=(t(w),n(()=>t(w).key)))??"")}),i(g,z)}),a(h);var l;Ia(h),A(()=>{l!==(l=J())&&(h.value=(h.__value=J())??"",$a(h,J()))}),bt("change",h,g=>y()(g.currentTarget.value)),i(b,h)};E(_t,b=>{u(W()),n(()=>W().length>0)&&b(Rt)})}a(kt),a(Ft);var X=o(Ft,2),tt=r(X);se(tt,1,()=>jt,we,(b,h,s)=>{var f=Hn(),l=r(f),g=r(l,!0);a(l);var w=o(l,2),z=r(w,!0);a(w),a(f),A(()=>{U(g,t(h)),U(z,n(()=>Tt[s]))}),i(b,f)});var Et=o(tt,2);se(Et,1,()=>t(D),b=>dt(b,"yyyy-MM-dd"),(b,h)=>{const s=Zt(()=>(t(h),n(()=>qt(t(h))))),f=Zt(()=>(u(je),t(h),t(nt),n(()=>je(t(h),t(nt))))),l=Zt(()=>(u(Qe),t(h),n(()=>Qe(t(h))))),g=Zt(()=>(t(j),u(Ee),t(h),n(()=>t(j)&&Ee(t(j),t(h)))));var w=qn();let z;var x=r(w),C=r(x,!0);a(x);var _=o(x,2),M=r(_);se(M,1,()=>(u(t(s)),n(()=>t(s).slice(0,3))),O=>O.id??O.start_time,(O,F)=>{var v=Kn(),p=r(v),R=r(p,!0);a(p),a(v),A(K=>{oe(v,1,`event-badge bg-color-${K??""}`,"svelte-14mpkul"),zt(v,"title",(t(F),n(()=>t(F).title))),U(R,(t(F),n(()=>t(F).title)))},[()=>(u(ee),t(F),n(()=>ee(t(F)?.meta_data?.organization??"")?.color_number??0))]),bt("click",v,De(()=>Y()(t(F)))),i(O,v)});var T=o(M,2);{var V=O=>{var F=Wn(),v=r(F);a(F),A(()=>U(v,`+${u(t(s)),n(()=>t(s).length-3)??""} more`)),i(O,F)};E(T,O=>{u(t(s)),n(()=>t(s).length>3)&&O(V)})}a(_),a(w),A(O=>{z=oe(w,1,"calendar-day svelte-14mpkul",null,z,{"other-month":!t(f),today:t(l),selected:t(g),"has-events":t(s).length>0}),U(C,O)},[()=>(u(dt),t(h),n(()=>dt(t(h),"d")))]),bt("click",w,()=>It(t(h))),bt("keydown",w,O=>{(O.key==="Enter"||O.key===" ")&&(O.preventDefault(),It(t(h)))}),i(b,w)}),a(X);var ot=o(X,2);{var Ct=b=>{var h=er(),s=r(h),f=r(s),l=r(f,!0);a(f);var g=o(f,2);a(s);var w=o(s,2);se(w,5,()=>t(d),z=>z.id??z.start_time,(z,x)=>{const C=Zt(()=>(t(x),n(()=>t(x).attachments?.find($=>Xt($.type))))),_=Zt(()=>(u(ee),t(x),n(()=>ee(t(x)?.meta_data?.organization??""))));var M=tr(),T=r(M),V=o(T,2),O=r(V),F=r(O,!0);a(O);var v=o(O,2),p=r(v);{var R=$=>{var P=jn(),lt=r(P,!0);a(P),A(()=>{oe(P,1,`badge rounded-pill bg-color-${u(t(_)),n(()=>t(_).color_number)??""}`,"svelte-14mpkul"),U(lt,(u(t(_)),n(()=>t(_).label)))}),i($,P)};E(p,$=>{u(t(_)),n(()=>t(_)?.label)&&$(R)})}var K=o(p,2);{var it=$=>{var P=Qn();i($,P)},Wt=$=>{var P=Nt(),lt=ct(P);{var Vt=Ot=>{var Pt=Jn(),Qt=r(Pt,!0);a(Pt),A(te=>U(Qt,te),[()=>(u(dt),u(yt),t(x),n(()=>dt(yt(t(x).start_time),"h:mm a")))]),i(Ot,Pt)};E(lt,Ot=>{t(x),n(()=>t(x).start_time)&&Ot(Vt)},!0)}i($,P)};E(K,$=>{t(x),n(()=>t(x).is_all_day)?$(it):$(Wt,!1)})}var ne=o(K,2);{var Ut=$=>{var P=Gn(),lt=o(r(P));a(P),A(()=>U(lt,` ${t(x),n(()=>t(x).location)??""}`)),i($,P)};E(ne,$=>{t(x),n(()=>t(x).location)&&$(Ut)})}a(v),a(V);var Mt=o(V,2);{var Z=$=>{var P=Zn(),lt=r(P);a(P),A(()=>{zt(lt,"src",(u(t(C)),n(()=>t(C).url))),zt(lt,"alt",(u(t(C)),n(()=>t(C).name)))}),i($,P)};E(Mt,$=>{t(C)&&$(Z)})}var N=o(Mt,2);{var pt=$=>{var P=Xn(),lt=r(P);a(P),bt("click",lt,De(()=>q()&&q()(t(x)))),i($,P)};E(N,$=>{u(ut()),u(q()),t(x),n(()=>ut()&&q()&&ut()(t(x)))&&$(pt)})}a(M),A(()=>{oe(T,1,`event-color-indicator bg-color-${u(t(_)),n(()=>t(_)?.color_number??0)??""}`,"svelte-14mpkul"),U(F,(t(x),n(()=>t(x).title)))}),bt("click",V,()=>Y()(t(x))),i(z,M)}),a(w),a(h),A(z=>U(l,z),[()=>(u(dt),t(j),n(()=>dt(t(j),"EEEE, MMMM d, yyyy")))]),bt("click",g,()=>I(j,null)),i(b,h)};E(ot,b=>{t(j),t(e),n(()=>t(j)&&t(e).length>0)&&b(Ct)})}a(Ht),A(b=>U(Kt,b),[()=>(u(dt),t(nt),n(()=>dt(t(nt),"MMMM yyyy")))]),bt("click",B,rt),bt("click",Q,Yt),bt("click",ht,ae),i(k,Ht),fe()}var rr=m('<div class="dropdown"><button class="btn btn-sm btn-primary dropdown-toggle" type="button" id="addEventDropdown" data-bs-toggle="dropdown" aria-label="Add event actions" aria-expanded="false"><i class="bi bi-plus"></i> <span class="d-none d-md-inline ms-1">Add Event</span></button> <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="addEventDropdown"><li><button class="dropdown-item" type="button" data-bs-toggle="offcanvas"><i class="bi bi-calendar-plus me-2"></i>Create Event</button></li> <li><button class="dropdown-item" type="button"><i class="bi bi-file-earmark-arrow-up me-2"></i>Import CSV</button></li></ul></div>'),sr=m("<span> </span>"),or=m('<span class="event-date svelte-1p8xa6u"> </span>'),ir=m('<span class="badge bg-secondary">All Day</span>'),lr=m('<span class="event-time svelte-1p8xa6u"> </span>'),vr=m('<span class="event-location svelte-1p8xa6u"><i class="bi bi-geo-alt"></i> <!></span>'),cr=m('<div class="event-thumbnail-container svelte-1p8xa6u"><img class="event-thumbnail svelte-1p8xa6u"/></div>'),dr=m('<div class="event-actions svelte-1p8xa6u"><button type="button" class="btn btn-sm btn-primary" title="Edit event"><i class="bi bi-pencil"></i></button></div>'),ur=m('<li class="list-group-item list-group-item-action d-flex align-items-center gap-3"><span></span> <button type="button" class="event-details-button svelte-1p8xa6u"><div class="event-title-full svelte-1p8xa6u"><!></div> <div class="event-meta svelte-1p8xa6u"><!> <!> <!> <!></div></button> <!> <!></li>'),mr=m('<div class="search-results svelte-1p8xa6u"><div class="search-results-header svelte-1p8xa6u"><h6 class="search-results-title svelte-1p8xa6u"> </h6></div> <ul class="list-group list-group-flush"></ul></div>'),_r=m('<div class="search-no-results svelte-1p8xa6u"> </div>'),pr=m("<!> <!>",1),fr=m('<div class="no-events svelte-1p8xa6u"><!></div>'),br=m('<div class="d-flex flex-column gap-2"><div class="calendar-header svelte-1p8xa6u"><h2 class="calendar-title svelte-1p8xa6u">Events</h2> <div class="calendar-actions svelte-1p8xa6u"><!></div></div> <!></div>'),yr=m('<div class="d-flex flex-column gap-4"><!></div>'),gr=m("<!> <!> <!> <!>",1);function Hr(k,c){pe(c,!1);const e=()=>Dt(Ht,"$dbData",W),d=()=>Dt(Bt,"$authenticated",W),D=()=>Dt(Xt,"$searchQuery",W),L=()=>Dt(It,"$currentUser",W),at=()=>Dt(qt,"$userOrganizations",W),Y=()=>Dt(Yt,"$currentUserHasPermission",W),q=()=>Dt(ae,"$currentUserIsRoot",W),ut=()=>Dt(rt,"$currentUserIsAdmin",W),J=()=>Dt(jt,"$ready",W),y=()=>Dt(Tt,"$calendarEvents",W),[W,gt]=Fe(),mt=S(),xt=S(),nt=S(),G=S(),j=S(),{stores:{currentUser:It,currentUserHasPermission:Yt,currentUserIsAdmin:rt,currentUserIsRoot:ae,userOrganizations:qt}}=ke(),{stores:{ready:jt,calendarEvents:Tt,searchQuery:Xt,dbData:Ht},actions:{reload:Ft}}=ea(),{stores:{authenticated:Bt}}=ke(),Kt={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0};let kt=St(c,"formId",24,Oe),$t=St(c,"detailsId",24,Oe),B=S(!1),Q=S(!1),ht=S(),_t=S(!1),Rt=S(!1),X=S(new Set),tt=S(""),Et=S({...Kt}),ot=S({...Kt}),Ct=S(!1),b=S(""),h=S(new Date);const s=v=>ta(v,{currentUserId:t(ht),isPrivileged:t(Q),canEditOwnOrgEvents:t(Rt),userOrganizations:t(X)}),f=v=>v.startsWith("image/");function l(){Ft()}Ze(async()=>{await Ft()});const g=async v=>{if(I(tt,"Item Form"),v?.meta_data?.recurring_instance&&v?.meta_data?.recurring_parent_id){const{getCalendarEvent:p}=await Ke(async()=>{const{getCalendarEvent:K}=await import("./Dyw_Uc2C.js").then(it=>it.y);return{getCalendarEvent:K}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url),R=await p(v.meta_data.recurring_parent_id);if(R){I(Et,{...R,organization:R?.meta_data?.organization,start_time:v.start_time,end_time:v.end_time,meta_data:{...R.meta_data,recurring_instance:!0,recurring_parent_id:v.meta_data.recurring_parent_id,recurring_instance_index:v.meta_data.recurring_instance_index}});return}}I(Et,{...v,organization:v?.meta_data?.organization})},w=async v=>{if(v?.meta_data?.recurring_instance&&v?.meta_data?.recurring_parent_id){const{getCalendarEvent:R}=await Ke(async()=>{const{getCalendarEvent:it}=await import("./Dyw_Uc2C.js").then(Wt=>Wt.y);return{getCalendarEvent:it}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url),K=await R(v.meta_data.recurring_parent_id);K?I(ot,{...K,start_time:v.start_time,end_time:v.end_time,meta_data:{...K.meta_data,recurring_instance:!0,recurring_parent_id:v.meta_data.recurring_parent_id,recurring_instance_index:v.meta_data.recurring_instance_index}}):I(ot,v)}else I(ot,v);const p=document.getElementById($t());p&&new window.bootstrap.Offcanvas(p).show()},z=async v=>{await g(v);const p=document.getElementById(kt());p&&new window.bootstrap.Offcanvas(p).show()},x=async()=>{const v=document.getElementById($t());if(v){const p=window.bootstrap.Offcanvas.getInstance(v);p&&p.hide()}await g(t(ot)),setTimeout(()=>{const p=document.getElementById(kt());p&&new window.bootstrap.Offcanvas(p).show()},300)};H(()=>(e(),d(),yt),()=>{I(mt,(e()??[]).filter(v=>v.event_type==="calendar_event").filter(v=>!(!v.is_published||!d()&&v.is_public===!1)).filter(v=>{if(!v.start_time)return!1;const p=yt(v.start_time),R=new Date;return R.setHours(0,0,0,0),p>=R}))}),H(()=>(t(mt),ee),()=>{I(xt,(()=>{const v=new Set(t(mt).filter(p=>p?.meta_data?.organization).map(p=>p.meta_data?.organization).filter(p=>p));return Array.from(v).map(p=>ee(p||"")).filter(p=>p!==void 0).sort((p,R)=>p.sort_index-R.sort_index)})())}),H(()=>(t(b),t(mt),He),()=>{I(nt,t(b)?t(mt).filter(v=>He(v?.meta_data?.organization,t(b))):t(mt))}),H(()=>(D(),t(mt)),()=>{I(G,D()?t(mt).filter(v=>{const p=D().toLowerCase(),R=(v.title||"").toLowerCase(),K=(v.description||"").replace(/<[^>]*>/g,"").toLowerCase(),it=(v.location||"").toLowerCase();return R.includes(p)||K.includes(p)||it.includes(p)}):[])}),H(()=>L(),()=>{I(ht,L()?.id)}),H(()=>at(),()=>{I(X,at())}),H(()=>(t(X),Me),()=>{I(_t,t(X).has(Me.Bishopric))}),H(()=>(Y(),Lt),()=>{I(Rt,Y()(Lt.EditOwnOrgEvents))}),H(()=>(q(),ut(),t(_t),Y(),Lt),()=>{I(Q,q()||ut()||t(_t)||Y()(Lt.EditAllEvents))}),H(()=>(Y(),Lt),()=>{I(B,Y()(Lt.CreateEvents))}),H(()=>(Y(),Lt),()=>{I(j,Y()(Lt.DeleteEvents))}),$e(),be();var C=gr(),_=ct(C);Ie(_,{get title(){return t(tt)},get id(){return kt()},children:(v,p)=>{Xe(v,{get eventItem(){return t(Et)},get drawerId(){return kt()},name:"event-item-form",get canDelete(){return t(j)}})},$$slots:{default:!0}});var M=o(_,2);Ie(M,{title:"Event Details",get id(){return $t()},children:(v,p)=>{{let R=Zt(()=>(t(ot),n(()=>s(t(ot)))));ra(v,{get event(){return t(ot)},get canEdit(){return t(R)},onEdit:x})}},$$slots:{default:!0}});var T=o(M,2);Vn(T,{get isOpen(){return t(Ct)},onClose:()=>I(Ct,!1),onComplete:l});var V=o(T,2);{var O=v=>{var p=br(),R=r(p),K=o(r(R),2),it=r(K);{var Wt=Z=>{var N=rr(),pt=o(r(N),2),$=r(pt),P=r($);a($);var lt=o($,2),Vt=r(lt);a(lt),a(pt),a(N),A(()=>{zt(P,"data-bs-target",`#${kt()??""}`),zt(P,"aria-controls",kt())}),bt("click",P,()=>g({...Kt,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),bt("click",Vt,()=>I(Ct,!0)),i(Z,N)};E(it,Z=>{t(B)&&Z(Wt)})}a(K),a(R);var ne=o(R,2);{var Ut=Z=>{var N=pr(),pt=ct(N);{var $=Ot=>{var Pt=Nt(),Qt=ct(Pt);La(Qt,()=>t(b),te=>{nr(te,{get events(){return t(nt)},onEventClick:At=>w(At),onEventEdit:At=>z(At),canEditEvent:At=>s(At),get organizationFilter(){return t(b)},onOrganizationFilterChange:At=>I(b,At),get availableOrganizations(){return t(xt)},get visibleMonth(){return t(h)},onVisibleMonthChange:At=>I(h,new Date(At))})}),i(Ot,Pt)};E(pt,Ot=>{D()||Ot($)})}var P=o(pt,2);{var lt=Ot=>{var Pt=mr(),Qt=r(Pt),te=r(Qt),At=r(te);a(te),a(Qt);var ve=o(Qt,2);se(ve,5,()=>t(G),ce=>ce.id??ce.start_time,(ce,st)=>{const de=Zt(()=>(t(st),n(()=>t(st).attachments?.find(et=>f(et.type))))),re=Zt(()=>(u(ee),t(st),n(()=>ee(t(st)?.meta_data?.organization??""))));var ue=ur(),wt=r(ue),ft=o(wt,2),Jt=r(ft),ia=r(Jt);Te(ia,()=>(u(he),t(st),D(),n(()=>he(t(st).title,D())))),a(Jt);var Re=o(Jt,2),Ue=r(Re);{var la=et=>{var vt=sr(),Gt=r(vt,!0);a(vt),A(()=>{oe(vt,1,`badge rounded-pill bg-color-${u(t(re)),n(()=>t(re).color_number)??""}`,"svelte-1p8xa6u"),U(Gt,(u(t(re)),n(()=>t(re).label)))}),i(et,vt)};E(Ue,et=>{u(t(re)),n(()=>t(re)?.label)&&et(la)})}var Pe=o(Ue,2);{var va=et=>{var vt=or(),Gt=r(vt,!0);a(vt),A(Ae=>U(Gt,Ae),[()=>(u(dt),u(yt),t(st),n(()=>dt(yt(t(st).start_time),"MMM d, yyyy")))]),i(et,vt)};E(Pe,et=>{t(st),n(()=>t(st).start_time)&&et(va)})}var Le=o(Pe,2);{var ca=et=>{var vt=ir();i(et,vt)},da=et=>{var vt=Nt(),Gt=ct(vt);{var Ae=Se=>{var ze=lr(),ba=r(ze,!0);a(ze),A(ya=>U(ba,ya),[()=>(u(dt),u(yt),t(st),n(()=>dt(yt(t(st).start_time),"h:mm a")))]),i(Se,ze)};E(Gt,Se=>{t(st),n(()=>t(st).start_time)&&Se(Ae)},!0)}i(et,vt)};E(Le,et=>{t(st),n(()=>t(st).is_all_day)?et(ca):et(da,!1)})}var ua=o(Le,2);{var ma=et=>{var vt=vr(),Gt=o(r(vt),2);Te(Gt,()=>(u(he),t(st),D(),n(()=>he(t(st).location,D())))),a(vt),i(et,vt)};E(ua,et=>{t(st),n(()=>t(st).location)&&et(ma)})}a(Re),a(ft);var Be=o(ft,2);{var _a=et=>{var vt=cr(),Gt=r(vt);a(vt),A(()=>{zt(Gt,"src",(u(t(de)),n(()=>t(de).url))),zt(Gt,"alt",(u(t(de)),n(()=>t(de).name)))}),i(et,vt)};E(Be,et=>{t(de)&&et(_a)})}var pa=o(Be,2);{var fa=et=>{var vt=dr(),Gt=r(vt);a(vt),bt("click",Gt,De(()=>z(t(st)))),i(et,vt)};E(pa,et=>{t(st),n(()=>s(t(st)))&&et(fa)})}a(ue),A(()=>oe(wt,1,`event-color-indicator bg-color-${u(t(re)),n(()=>t(re)?.color_number??0)??""}`,"svelte-1p8xa6u")),bt("click",ft,()=>w(t(st))),i(ce,ue)}),a(ve),a(Pt),A(()=>U(At,`${t(G),n(()=>t(G).length)??""} event${t(G),n(()=>t(G).length===1?"":"s")??""} matching "${D()??""}"`)),i(Ot,Pt)},Vt=Ot=>{var Pt=Nt(),Qt=ct(Pt);{var te=At=>{var ve=_r(),ce=r(ve);a(ve),A(()=>U(ce,`No events match your search for "${D()??""}"`)),i(At,ve)};E(Qt,At=>{D()&&At(te)},!0)}i(Ot,Pt)};E(P,Ot=>{D(),t(G),n(()=>D()&&t(G).length>0)?Ot(lt):Ot(Vt,!1)})}i(Z,N)},Mt=Z=>{var N=fr(),pt=r(N);{var $=lt=>{var Vt=le("No events match your search.");i(lt,Vt)},P=lt=>{var Vt=le("There are no upcoming events scheduled.");i(lt,Vt)};E(pt,lt=>{D()?lt($):lt(P,!1)})}a(N),i(Z,N)};E(ne,Z=>{y(),n(()=>y()?.length)?Z(Ut):Z(Mt,!1)})}a(p),i(v,p)},F=v=>{var p=yr(),R=r(p);Ce(R,{}),a(p),i(v,p)};E(V,v=>{J()?v(O):v(F,!1)})}i(k,C),fe(),gt()}export{Yr as A,ra as C,Hr as E,qe as s};
