import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{d as Tt,o as Wt,g as Ut}from"./DUiJaq3B.js";import{p as St,ai as $,d as e,aj as It,f as Te,a as Mt,E as u,s as o,D as d,c as a,r as t,t as k,u as n,F as oe}from"./DkHtKwEy.js";import{p as $t,b as m,i as b,a as Pt,e as me,s as M}from"./DJ88wS1R.js";import{e as ue,i as lt}from"./CKczAFpg.js";import{f as i,a as s,t as Ot,c as wt}from"./B190dNFg.js";import{s as Q}from"./CaNs3-ti.js";import{d as Ft,p as Xe,O as vt,P,i as it,e as ot}from"./njcIKE7L.js";import{i as Ct}from"./CrhaOPk_.js";import{S as jt}from"./D-POLfBO.js";import{g as Qt,d as Xt}from"./RiQfZcyh.js";import{A as zt,E as kt,c as Bt,a as Jt}from"./CBvw1v64.js";import{v as Rt,D as Ht}from"./CJye0tFo.js";import{s as Dt}from"./BI9c9igq.js";var Yt=i('<button class="btn btn-sm btn-outline-danger" type="button"><!></button>'),Zt=i('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add event"><i class="bi bi-plus"></i></button>'),Gt=i('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),ea=i('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),ta=i('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),aa=i("<span> </span>"),ra=i('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),sa=i('<ul class="list-group"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">This Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),na=i('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),ia=i('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),la=i('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),oa=i("<span> </span>"),va=i('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),ca=i('<ul class="list-group border-top-0 mt-3"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">Next Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),da=i('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),ua=i('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),ma=i('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),ga=i("<span> </span>"),fa=i('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),_a=i('<ul class="list-group border-top-0"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">The Following Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),pa=i('<div class="d-flex flex-column gap-4"><div><div class="d-flex justify-content-between align-items-center gap-3 flex-wrap mb-2"><h5 class="mb-0">Events</h5> <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end"><!> <!></div></div> <!> <!> <!></div></div>'),ba=i('<div class="d-flex flex-column gap-4"><!></div>'),ya=i("<!> <!>",1);function Ra(ct,ge){St(ge,!1);const Ue=()=>m(tt,"$currentUser",A),Oe=()=>m(yt,"$userOrganizations",A),D=()=>m(ye,"$currentUserHasPermission",A),fe=()=>m(Fe,"$currentUserIsRoot",A),We=()=>m(at,"$currentUserIsAdmin",A),Je=()=>m(et,"$calendarEventsThisWeek",A),_e=()=>m(bt,"$calendarEventsNextWeek",A),Ye=()=>m(se,"$calendarEventsNextNextWeek",A),Ze=()=>m(ft,"$ready",A),re=()=>m(W,"$hasPastEvents",A),C=()=>m(Ne,"$pastEventsCount",A),Se=()=>m(pe,"$searchQuery",A),te=()=>m(_t,"$categoryFilter",A),y=()=>m(pt,"$currentCategoryFilter",A),[A,dt]=Pt(),Ge=u();let ut=$t(ge,"showThisWeek",8,!0),mt=$t(ge,"showNextWeek",8,!0),gt=$t(ge,"showNextNextWeek",8,!0);const{stores:{ready:ft,categoryFilter:_t,currentCategoryFilter:pt,calendarEventsNextWeek:bt,calendarEventsThisWeek:et,calendarEventsNextNextWeek:se,calendarEvents:Ie,searchQuery:pe},actions:{reload:ve,calendarEventsThisWeekLabel:Me,calendarEventsNextWeekLabel:Pe,calendarEventsNextNextWeekLabel:be}}=Qt(),{stores:{currentUserHasPermission:ye,currentUser:tt,currentUserIsAdmin:at,currentUserIsRoot:Fe,userOrganizations:yt}}=Ft();let xe=u(!1),ce=u(!1),he=u(),Ce=u(!1),je=u(!1),w=u(!1),ae=u(new Set);const Qe={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0},O=Rt();let ze=u(""),rt=u({...Qe});const Ee=l=>{d(ze,"Event Item"),d(rt,{...l,category:l?.meta_data?.category})},$e=l=>{if(!l||!l.length)return[];const _=new Map;for(const r of l){if(!r.start_time)continue;const U=Xe(r.start_time);if(Number.isNaN(U.getTime()))continue;const J=it(U,"yyyy-MM-dd");let Y=_.get(J);Y||(Y={key:J,displayDay:it(U,"EEE"),displayDate:it(U,"MMM d"),events:[]},_.set(J,Y)),Y.events.push(r)}return Array.from(_.values()).sort((r,U)=>r.key<U.key?-1:r.key>U.key?1:0).map(r=>({...r,events:r.events.slice().sort((U,J)=>{const Y=U.is_all_day?0:1,nt=J.is_all_day?0:1;if(Y!==nt)return Y-nt;const ht=U.start_time?Xe(U.start_time).getTime():Number.MAX_SAFE_INTEGER,Et=J.start_time?Xe(J.start_time).getTime():Number.MAX_SAFE_INTEGER;return ht-Et})}))};let we=u([]),ke=u([]),De=u([]),T=u(!1);const W=Tt(Ie,l=>{if(!l||!l.length)return!1;const _=Dt().getTime();return l.some(r=>r.event_type==="calendar_event"&&r.start_time&&Xe(r.start_time).getTime()<_)}),Ne=Tt(Ie,l=>{if(!l||!l.length)return 0;const _=Dt().getTime();return l.filter(r=>r.event_type==="calendar_event"&&r.start_time&&Xe(r.start_time).getTime()<_).length}),de=l=>Bt(l,{currentUserId:e(he),isPrivileged:e(ce),canEditOwnOrgEvents:e(w),userOrganizations:e(ae)}),ne=async()=>{if(!e(xe)||!Ut(Fe)||!Ut(W))return;const l=Dt(),_=it(l,"MMM d, yyyy");if(confirm(`Delete all events that occurred before ${_}?`)){d(T,!0);try{const r=await Xt(l);await ve(),r.deleted>0&&console.info(`Deleted ${r.deleted} past events.`),r.skipped>0&&console.info(`Skipped ${r.skipped} recurring events with active future instances.`),r.deleted===0&&r.skipped===0&&console.info("No past events matched the delete criteria.")}catch(r){console.error("Failed to delete past events",r),alert("Failed to delete past events. Please try again.")}finally{d(T,!1)}}};Wt(async()=>{await ve()}),$(()=>Ue(),()=>{d(he,Ue()?.id)}),$(()=>Oe(),()=>{d(ae,Oe())}),$(()=>e(he),()=>{d(je,!!e(he))}),$(()=>(e(ae),vt),()=>{d(Ce,e(ae).has(vt.Bishopric))}),$(()=>(D(),P),()=>{d(w,D()(P.EditOwnOrgEvents))}),$(()=>(fe(),We(),e(Ce),D(),P),()=>{d(ce,fe()||We()||e(Ce)||D()(P.EditAllEvents))}),$(()=>(e(ce),D(),e(w),e(je)),()=>{d(xe,e(ce)||D()(P.CreateEvents)||e(w)||e(je))}),$(()=>(D(),P),()=>{d(Ge,D()(P.DeleteEvents))}),$(()=>Je(),()=>{d(we,$e(Je()))}),$(()=>_e(),()=>{d(ke,$e(_e()))}),$(()=>Ye(),()=>{d(De,$e(Ye()))}),It(),Ct();var V=ya(),X=Te(V);Ht(X,{get title(){return e(ze)},get id(){return O},children:(l,_)=>{zt(l,{get eventItem(){return e(rt)},get drawerId(){return O},name:"event-item-form",get canDelete(){return e(Ge)}})},$$slots:{default:!0}});var Ae=o(X,2);{var st=l=>{var _=pa(),r=a(_),U=a(r),J=o(a(U),2),Y=a(J);{var nt=E=>{var p=Yt(),F=a(p);{var Z=j=>{var ee=Ot("Deletingâ€¦");s(j,ee)},G=j=>{var ee=Ot();k(()=>M(ee,`Delete Past Events (${C()??""})`)),s(j,ee)};b(F,j=>{e(T)?j(Z):j(G,!1)})}t(p),k(()=>p.disabled=e(T)),me("click",p,ne),s(E,p)};b(Y,E=>{fe()&&re()&&E(nt)})}var ht=o(Y,2);{var Et=E=>{var p=Zt();k(()=>{Q(p,"data-bs-target",`#${O??""}`),Q(p,"aria-controls",O)}),me("click",p,()=>Ee({...Qe,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),s(E,p)};b(ht,E=>{e(xe)&&E(Et)})}t(J),t(U);var Nt=o(U,2);{var Lt=E=>{var p=sa(),F=a(p),Z=a(F),G=o(a(Z),2),j=a(G,!0);t(G),t(Z),t(F);var ee=o(F,2);{var Be=v=>{var x=wt(),S=Te(x);ue(S,1,()=>e(we),lt,(z,c)=>{var g=ta(),f=a(g),N=a(f),B=a(N),He=a(B,!0);t(B);var ie=o(B,2),Le=a(ie,!0);t(ie),t(N);var le=o(N,2);ue(le,7,()=>(e(c),n(()=>e(c).events)),(I,h)=>`${I.id??"new"}-${I.start_time}-${h}`,(I,h)=>{var R=ea(),H=a(R),qe=a(H);kt(qe,{get item(){return e(h)},showDate:!1,get searchQuery(){return Se()}}),t(H);var Ke=o(H,2);{var Ve=L=>{var q=Gt(),K=a(q);t(q),k(()=>{Q(K,"data-bs-target",`#${O??""}`),Q(K,"aria-controls",O)}),me("click",K,()=>Ee(e(h))),s(L,q)};b(Ke,L=>{e(h),n(()=>de(e(h)))&&L(Ve)})}t(R),s(I,R)}),t(le),t(f),t(g),k(()=>{M(He,(e(c),n(()=>e(c).displayDay))),M(Le,(e(c),n(()=>e(c).displayDate)))}),s(z,g)}),s(v,x)},Re=v=>{var x=ra(),S=a(x),z=o(a(S));{var c=g=>{var f=aa(),N=a(f,!0);t(f),k(()=>{ot(f,1,`ms-1 me-1 badge rounded-pill bg-color-${y(),n(()=>y().color_number)??""}`,"svelte-19k62y7"),M(N,(y(),n(()=>y().label)))}),s(g,f)};b(z,g=>{te(),y(),n(()=>te()&&y()?.label?.length)&&g(c)})}oe(),t(S),t(x),s(v,x)};b(ee,v=>{e(we),n(()=>e(we).length)?v(Be):v(Re,!1)})}oe(2),t(p),k(v=>M(j,v),[()=>n(Me)]),s(E,p)};b(Nt,E=>{ut()&&E(Lt)})}var At=o(Nt,2);{var qt=E=>{var p=ca(),F=a(p),Z=a(F),G=o(a(Z),2),j=a(G,!0);t(G),t(Z),t(F);var ee=o(F,2);{var Be=v=>{var x=wt(),S=Te(x);ue(S,1,()=>e(ke),lt,(z,c)=>{var g=la(),f=a(g),N=a(f),B=a(N),He=a(B,!0);t(B);var ie=o(B,2),Le=a(ie,!0);t(ie),t(N);var le=o(N,2);ue(le,7,()=>(e(c),n(()=>e(c).events)),(I,h)=>`${I.id??"new"}-${I.start_time}-${h}`,(I,h)=>{var R=ia(),H=a(R),qe=a(H);kt(qe,{get item(){return e(h)},showDate:!1,get searchQuery(){return Se()}}),t(H);var Ke=o(H,2);{var Ve=L=>{var q=na(),K=a(q);t(q),k(()=>{Q(K,"data-bs-target",`#${O??""}`),Q(K,"aria-controls",O)}),me("click",K,()=>Ee(e(h))),s(L,q)};b(Ke,L=>{e(h),n(()=>de(e(h)))&&L(Ve)})}t(R),s(I,R)}),t(le),t(f),t(g),k(()=>{M(He,(e(c),n(()=>e(c).displayDay))),M(Le,(e(c),n(()=>e(c).displayDate)))}),s(z,g)}),s(v,x)},Re=v=>{var x=va(),S=a(x),z=o(a(S));{var c=g=>{var f=oa(),N=a(f,!0);t(f),k(()=>{ot(f,1,`ms-1 me-1 badge rounded-pill bg-color-${y(),n(()=>y().color_number)??""}`,"svelte-19k62y7"),M(N,(y(),n(()=>y().label)))}),s(g,f)};b(z,g=>{te(),y(),n(()=>te()&&y()?.label?.length)&&g(c)})}oe(),t(S),t(x),s(v,x)};b(ee,v=>{e(ke),n(()=>e(ke).length)?v(Be):v(Re,!1)})}oe(2),t(p),k(v=>M(j,v),[()=>n(Pe)]),s(E,p)};b(At,E=>{mt()&&E(qt)})}var Kt=o(At,2);{var Vt=E=>{var p=_a(),F=a(p),Z=a(F),G=o(a(Z),2),j=a(G,!0);t(G),t(Z),t(F);var ee=o(F,2);{var Be=v=>{var x=wt(),S=Te(x);ue(S,1,()=>e(De),lt,(z,c)=>{var g=ma(),f=a(g),N=a(f),B=a(N),He=a(B,!0);t(B);var ie=o(B,2),Le=a(ie,!0);t(ie),t(N);var le=o(N,2);ue(le,7,()=>(e(c),n(()=>e(c).events)),(I,h)=>`${I.id??"new"}-${I.start_time}-${h}`,(I,h)=>{var R=ua(),H=a(R),qe=a(H);kt(qe,{get item(){return e(h)},showDate:!1,get searchQuery(){return Se()}}),t(H);var Ke=o(H,2);{var Ve=L=>{var q=da(),K=a(q);t(q),k(()=>{Q(K,"data-bs-target",`#${O??""}`),Q(K,"aria-controls",O)}),me("click",K,()=>Ee(e(h))),s(L,q)};b(Ke,L=>{e(h),n(()=>de(e(h)))&&L(Ve)})}t(R),s(I,R)}),t(le),t(f),t(g),k(()=>{M(He,(e(c),n(()=>e(c).displayDay))),M(Le,(e(c),n(()=>e(c).displayDate)))}),s(z,g)}),s(v,x)},Re=v=>{var x=fa(),S=a(x),z=o(a(S));{var c=g=>{var f=ga(),N=a(f,!0);t(f),k(()=>{ot(f,1,`ms-1 me-1 badge rounded-pill bg-color-${y(),n(()=>y().color_number)??""}`,"svelte-19k62y7"),M(N,(y(),n(()=>y().label)))}),s(g,f)};b(z,g=>{te(),y(),n(()=>te()&&y()?.label?.length)&&g(c)})}oe(),t(S),t(x),s(v,x)};b(ee,v=>{e(De),n(()=>e(De).length)?v(Be):v(Re,!1)})}oe(2),t(p),k(v=>M(j,v),[()=>n(be)]),s(E,p)};b(Kt,E=>{gt()&&E(Vt)})}t(r),t(_),s(l,_)},xt=l=>{var _=ba(),r=a(_);jt(r,{}),t(_),s(l,_)};b(Ae,l=>{Ze()?l(st):l(xt,!1)})}s(ct,V),Mt(),dt()}var xa=i('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add announcement"><i class="bi bi-plus"></i></button>'),ha=i('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit announcement"><i class="bi bi-pencil-square"></i></button>'),Ea=i('<li class="list-group-item"><div class="d-flex justify-content-between"><!> <div><!></div></div></li>'),$a=i('<!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li>',1),wa=i("<span> </span>"),ka=i('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> announcements</div></li>'),Da=i('<div class="d-flex flex-column gap-4"><div><div class="d-flex justify-content-between align-items-center mb-2"><h5 class="mb-0">Announcements</h5> <div class="d-flex align-items-center gap-2"><!></div></div> <ul class="list-group"><!></ul></div></div>'),Na=i("<!> <!>",1);function Ha(ct,ge){St(ge,!1);const Ue=()=>m(y,"$currentUser",C),Oe=()=>m(ut,"$userOrganizations",C),D=()=>m(A,"$currentUserHasPermission",C),fe=()=>m(Ge,"$currentUserIsRoot",C),We=()=>m(dt,"$currentUserIsAdmin",C),Je=()=>m(mt,"$ready",C),_e=()=>m(_t,"$announcements",C),Ye=()=>m(pt,"$searchQuery",C),Ze=()=>m(gt,"$categoryFilter",C),re=()=>m(ft,"$currentCategoryFilter",C),[C,Se]=Pt(),te=u(),{stores:{currentUser:y,currentUserHasPermission:A,currentUserIsAdmin:dt,currentUserIsRoot:Ge,userOrganizations:ut}}=Ft(),{stores:{ready:mt,categoryFilter:gt,currentCategoryFilter:ft,announcements:_t,searchQuery:pt},actions:{reload:bt}}=Qt(),et={title:"Announcement",description:"",location:"",event_type:"announcement",is_public:!0},se=Rt();let Ie=u(!1),pe=u(!1),ve=u(),Me=u(!1),Pe=u(!1),be=u(!1),ye=u(new Set),tt=u(""),at=u({...et});const Fe=w=>{d(tt,"Announcement Form"),d(at,{...w,category:w?.meta_data?.category})},yt=w=>Bt(w,{currentUserId:e(ve),isPrivileged:e(pe),canEditOwnOrgEvents:e(be),userOrganizations:e(ye)});Wt(async()=>{await bt()}),$(()=>Ue(),()=>{d(ve,Ue()?.id)}),$(()=>Oe(),()=>{d(ye,Oe())}),$(()=>e(ve),()=>{d(Pe,!!e(ve))}),$(()=>(e(ye),vt),()=>{d(Me,e(ye).has(vt.Bishopric))}),$(()=>(D(),P),()=>{d(be,D()(P.EditOwnOrgEvents))}),$(()=>(fe(),We(),e(Me),D(),P),()=>{d(pe,fe()||We()||e(Me)||D()(P.EditAllEvents))}),$(()=>(e(pe),D(),e(be),e(Pe)),()=>{d(Ie,e(pe)||D()(P.CreateEvents)||e(be)||e(Pe))}),$(()=>(D(),P),()=>{d(te,D()(P.DeleteEvents))}),It(),Ct();var xe=Na(),ce=Te(xe);Ht(ce,{get title(){return e(tt)},get id(){return se},children:(w,ae)=>{zt(w,{get eventItem(){return e(at)},get drawerId(){return se},name:"announcement-item-form",get canDelete(){return e(te)}})},$$slots:{default:!0}});var he=o(ce,2);{var Ce=w=>{var ae=Da(),Qe=a(ae),O=a(Qe),ze=o(a(O),2),rt=a(ze);{var Ee=T=>{var W=xa();k(()=>{Q(W,"data-bs-target",`#${se??""}`),Q(W,"aria-controls",se)}),me("click",W,()=>Fe({...et,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),s(T,W)};b(rt,T=>{e(Ie)&&T(Ee)})}t(ze),t(O);var $e=o(O,2),we=a($e);{var ke=T=>{var W=$a(),Ne=Te(W);ue(Ne,1,_e,lt,(de,ne)=>{var V=Ea(),X=a(V),Ae=a(X);Jt(Ae,{get item(){return e(ne)},get searchQuery(){return Ye()}});var st=o(Ae,2),xt=a(st);{var l=_=>{var r=ha();k(()=>{Q(r,"data-bs-target",`#${se??""}`),Q(r,"aria-controls",se)}),me("click",r,()=>Fe(e(ne))),s(_,r)};b(xt,_=>{e(ne),n(()=>yt(e(ne)))&&_(l)})}t(st),t(X),t(V),s(de,V)}),oe(2),s(T,W)},De=T=>{var W=ka(),Ne=a(W),de=o(a(Ne));{var ne=V=>{var X=wa(),Ae=a(X,!0);t(X),k(()=>{ot(X,1,`ms-1 me-1 badge rounded-pill bg-color-${re(),n(()=>re().color_number)??""}`),M(Ae,(re(),n(()=>re().label)))}),s(V,X)};b(de,V=>{Ze(),re(),n(()=>Ze()&&re()?.label?.length)&&V(ne)})}oe(),t(Ne),t(W),s(T,W)};b(we,T=>{_e(),n(()=>_e()?.length)?T(ke):T(De,!1)})}t($e),t(Qe),t(ae),s(w,ae)},je=w=>{jt(w,{})};b(he,w=>{Je()?w(Ce):w(je,!1)})}s(ct,xe),Mt(),Se()}export{Ha as A,Ra as E};
