import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{d as Tt,o as Wt,g as Ut}from"./CuVcyAaV.js";import{p as zt,ai as $,m as e,aj as St,f as Te,a as It,E as u,s as o,D as d,c as a,r as t,B as k,u as n,F as oe}from"./BWCcv1pC.js";import{p as $t,b as f,i as b,a as Mt,e as fe,s as I}from"./KiCntiD6.js";import{e as ue,i as it}from"./CvOYN50o.js";import{f as l,a as s,t as Ot,c as wt}from"./DqgkBxsg.js";import{s as j}from"./Cr7RMNF9.js";import{d as Pt,p as Xe,O as vt,P as M,i as lt,e as ot}from"./DIMYr76u.js";import{i as Ft}from"./BeNQ5BU7.js";import{S as Ct}from"./BcK536Nn.js";import{g as jt,d as Xt}from"./CtZbhpTB.js";import{C as Qt,E as kt,c as Bt,A as Jt}from"./gFD_4vyj.js";import{v as Rt,D as Ht}from"./3yKqEbcX.js";import{s as Dt}from"./FxrDbUvO.js";var Yt=l('<button class="btn btn-sm btn-outline-danger" type="button"><!></button>'),Zt=l('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add event"><i class="bi bi-plus"></i></button>'),Gt=l('<div class="event-actions svelte-fzou33"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),ea=l('<div class="daily-event-row svelte-fzou33"><div class="event-content svelte-fzou33"><!></div> <!></div>'),ta=l('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-fzou33"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),aa=l("<span> </span>"),ra=l('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),sa=l('<ul class="list-group"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">This Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/calendar">More</a></li></ul>'),na=l('<div class="event-actions svelte-fzou33"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),la=l('<div class="daily-event-row svelte-fzou33"><div class="event-content svelte-fzou33"><!></div> <!></div>'),ia=l('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-fzou33"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),oa=l("<span> </span>"),va=l('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),ca=l('<ul class="list-group border-top-0 mt-3"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">Next Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/calendar">More</a></li></ul>'),da=l('<div class="event-actions svelte-fzou33"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),ua=l('<div class="daily-event-row svelte-fzou33"><div class="event-content svelte-fzou33"><!></div> <!></div>'),fa=l('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-fzou33"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),ma=l("<span> </span>"),ga=l('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),_a=l('<ul class="list-group border-top-0"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">The Following Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/calendar">More</a></li></ul>'),pa=l('<div class="d-flex flex-column gap-4"><div><div class="d-flex justify-content-between align-items-center gap-3 flex-wrap mb-2"><h5 class="mb-0">Events</h5> <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end"><!> <!></div></div> <!> <!> <!></div></div>'),ba=l('<div class="d-flex flex-column gap-4"><!></div>'),ya=l("<!> <!>",1);function Ra(ct,me){zt(me,!1);const Ue=()=>f(tt,"$currentUser",A),Oe=()=>f(yt,"$userOrganizations",A),D=()=>f(ye,"$currentUserHasPermission",A),ge=()=>f(Pe,"$currentUserIsRoot",A),We=()=>f(at,"$currentUserIsAdmin",A),Je=()=>f(et,"$calendarEventsThisWeek",A),_e=()=>f(bt,"$calendarEventsNextWeek",A),Ye=()=>f(se,"$calendarEventsNextNextWeek",A),Ze=()=>f(gt,"$ready",A),re=()=>f(W,"$hasPastEvents",A),F=()=>f(Ne,"$pastEventsCount",A),ze=()=>f(pe,"$searchQuery",A),te=()=>f(_t,"$categoryFilter",A),y=()=>f(pt,"$currentCategoryFilter",A),[A,dt]=Mt(),Ge=u();let ut=$t(me,"showThisWeek",8,!0),ft=$t(me,"showNextWeek",8,!0),mt=$t(me,"showNextNextWeek",8,!0);const{stores:{ready:gt,categoryFilter:_t,currentCategoryFilter:pt,calendarEventsNextWeek:bt,calendarEventsThisWeek:et,calendarEventsNextNextWeek:se,calendarEvents:Se,searchQuery:pe},actions:{reload:ve,calendarEventsThisWeekLabel:Ie,calendarEventsNextWeekLabel:Me,calendarEventsNextNextWeekLabel:be}}=jt(),{stores:{currentUserHasPermission:ye,currentUser:tt,currentUserIsAdmin:at,currentUserIsRoot:Pe,userOrganizations:yt}}=Pt();let xe=u(!1),ce=u(!1),he=u(),Fe=u(!1),Ce=u(!1),w=u(!1),ae=u(new Set);const je={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0},O=Rt();let Qe=u(""),rt=u({...je});const Ee=i=>{d(Qe,"Event Item"),d(rt,{...i,category:i?.meta_data?.category})},$e=i=>{if(!i||!i.length)return[];const _=new Map;for(const r of i){if(!r.start_time)continue;const U=Xe(r.start_time);if(Number.isNaN(U.getTime()))continue;const J=lt(U,"yyyy-MM-dd");let Y=_.get(J);Y||(Y={key:J,displayDay:lt(U,"EEE"),displayDate:lt(U,"MMM d"),events:[]},_.set(J,Y)),Y.events.push(r)}return Array.from(_.values()).sort((r,U)=>r.key<U.key?-1:r.key>U.key?1:0).map(r=>({...r,events:r.events.slice().sort((U,J)=>{const Y=U.is_all_day?0:1,nt=J.is_all_day?0:1;if(Y!==nt)return Y-nt;const ht=U.start_time?Xe(U.start_time).getTime():Number.MAX_SAFE_INTEGER,Et=J.start_time?Xe(J.start_time).getTime():Number.MAX_SAFE_INTEGER;return ht-Et})}))};let we=u([]),ke=u([]),De=u([]),T=u(!1);const W=Tt(Se,i=>{if(!i||!i.length)return!1;const _=Dt().getTime();return i.some(r=>r.event_type==="calendar_event"&&r.start_time&&Xe(r.start_time).getTime()<_)}),Ne=Tt(Se,i=>{if(!i||!i.length)return 0;const _=Dt().getTime();return i.filter(r=>r.event_type==="calendar_event"&&r.start_time&&Xe(r.start_time).getTime()<_).length}),de=i=>Bt(i,{currentUserId:e(he),isPrivileged:e(ce),canEditOwnOrgEvents:e(w),userOrganizations:e(ae)}),ne=async()=>{if(!e(xe)||!Ut(Pe)||!Ut(W))return;const i=Dt(),_=lt(i,"MMM d, yyyy");if(confirm(`Delete all events that occurred before ${_}?`)){d(T,!0);try{const r=await Xt(i);await ve(),r.deleted>0&&console.info(`Deleted ${r.deleted} past events.`),r.skipped>0&&console.info(`Skipped ${r.skipped} recurring events with active future instances.`),r.deleted===0&&r.skipped===0&&console.info("No past events matched the delete criteria.")}catch(r){console.error("Failed to delete past events",r),alert("Failed to delete past events. Please try again.")}finally{d(T,!1)}}};Wt(async()=>{await ve()}),$(()=>Ue(),()=>{d(he,Ue()?.id)}),$(()=>Oe(),()=>{d(ae,Oe())}),$(()=>e(he),()=>{d(Ce,!!e(he))}),$(()=>(e(ae),vt),()=>{d(Fe,e(ae).has(vt.Bishopric))}),$(()=>(D(),M),()=>{d(w,D()(M.EditOwnOrgEvents))}),$(()=>(ge(),We(),e(Fe),D(),M),()=>{d(ce,ge()||We()||e(Fe)||D()(M.EditAllEvents))}),$(()=>(e(ce),D(),e(w),e(Ce)),()=>{d(xe,e(ce)||D()(M.CreateEvents)||e(w)||e(Ce))}),$(()=>(D(),M),()=>{d(Ge,D()(M.DeleteEvents))}),$(()=>Je(),()=>{d(we,$e(Je()))}),$(()=>_e(),()=>{d(ke,$e(_e()))}),$(()=>Ye(),()=>{d(De,$e(Ye()))}),St(),Ft();var V=ya(),X=Te(V);Ht(X,{get title(){return e(Qe)},get id(){return O},children:(i,_)=>{Qt(i,{get eventItem(){return e(rt)},get drawerId(){return O},name:"event-item-form",get canDelete(){return e(Ge)}})},$$slots:{default:!0}});var Ae=o(X,2);{var st=i=>{var _=pa(),r=a(_),U=a(r),J=o(a(U),2),Y=a(J);{var nt=E=>{var p=Yt(),P=a(p);{var Z=C=>{var ee=Ot("Deletingâ€¦");s(C,ee)},G=C=>{var ee=Ot();k(()=>I(ee,`Delete Past Events (${F()??""})`)),s(C,ee)};b(P,C=>{e(T)?C(Z):C(G,!1)})}t(p),k(()=>p.disabled=e(T)),fe("click",p,ne),s(E,p)};b(Y,E=>{ge()&&re()&&E(nt)})}var ht=o(Y,2);{var Et=E=>{var p=Zt();k(()=>{j(p,"data-bs-target",`#${O??""}`),j(p,"aria-controls",O)}),fe("click",p,()=>Ee({...je,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),s(E,p)};b(ht,E=>{e(xe)&&E(Et)})}t(J),t(U);var Nt=o(U,2);{var Lt=E=>{var p=sa(),P=a(p),Z=a(P),G=o(a(Z),2),C=a(G,!0);t(G),t(Z),t(P);var ee=o(P,2);{var Be=v=>{var x=wt(),z=Te(x);ue(z,1,()=>e(we),it,(Q,c)=>{var m=ta(),g=a(m),N=a(g),B=a(N),He=a(B,!0);t(B);var le=o(B,2),Le=a(le,!0);t(le),t(N);var ie=o(N,2);ue(ie,7,()=>(e(c),n(()=>e(c).events)),(S,h)=>`${S.id??"new"}-${S.start_time}-${h}`,(S,h)=>{var R=ea(),H=a(R),qe=a(H);kt(qe,{get item(){return e(h)},showDate:!1,get searchQuery(){return ze()}}),t(H);var Ke=o(H,2);{var Ve=L=>{var q=Gt(),K=a(q);t(q),k(()=>{j(K,"data-bs-target",`#${O??""}`),j(K,"aria-controls",O)}),fe("click",K,()=>Ee(e(h))),s(L,q)};b(Ke,L=>{e(h),n(()=>de(e(h)))&&L(Ve)})}t(R),s(S,R)}),t(ie),t(g),t(m),k(()=>{I(He,(e(c),n(()=>e(c).displayDay))),I(Le,(e(c),n(()=>e(c).displayDate)))}),s(Q,m)}),s(v,x)},Re=v=>{var x=ra(),z=a(x),Q=o(a(z));{var c=m=>{var g=aa(),N=a(g,!0);t(g),k(()=>{ot(g,1,`ms-1 me-1 badge rounded-pill bg-color-${y(),n(()=>y().color_number)??""}`,"svelte-fzou33"),I(N,(y(),n(()=>y().label)))}),s(m,g)};b(Q,m=>{te(),y(),n(()=>te()&&y()?.label?.length)&&m(c)})}oe(),t(z),t(x),s(v,x)};b(ee,v=>{e(we),n(()=>e(we).length)?v(Be):v(Re,!1)})}oe(2),t(p),k(v=>I(C,v),[()=>n(Ie)]),s(E,p)};b(Nt,E=>{ut()&&E(Lt)})}var At=o(Nt,2);{var qt=E=>{var p=ca(),P=a(p),Z=a(P),G=o(a(Z),2),C=a(G,!0);t(G),t(Z),t(P);var ee=o(P,2);{var Be=v=>{var x=wt(),z=Te(x);ue(z,1,()=>e(ke),it,(Q,c)=>{var m=ia(),g=a(m),N=a(g),B=a(N),He=a(B,!0);t(B);var le=o(B,2),Le=a(le,!0);t(le),t(N);var ie=o(N,2);ue(ie,7,()=>(e(c),n(()=>e(c).events)),(S,h)=>`${S.id??"new"}-${S.start_time}-${h}`,(S,h)=>{var R=la(),H=a(R),qe=a(H);kt(qe,{get item(){return e(h)},showDate:!1,get searchQuery(){return ze()}}),t(H);var Ke=o(H,2);{var Ve=L=>{var q=na(),K=a(q);t(q),k(()=>{j(K,"data-bs-target",`#${O??""}`),j(K,"aria-controls",O)}),fe("click",K,()=>Ee(e(h))),s(L,q)};b(Ke,L=>{e(h),n(()=>de(e(h)))&&L(Ve)})}t(R),s(S,R)}),t(ie),t(g),t(m),k(()=>{I(He,(e(c),n(()=>e(c).displayDay))),I(Le,(e(c),n(()=>e(c).displayDate)))}),s(Q,m)}),s(v,x)},Re=v=>{var x=va(),z=a(x),Q=o(a(z));{var c=m=>{var g=oa(),N=a(g,!0);t(g),k(()=>{ot(g,1,`ms-1 me-1 badge rounded-pill bg-color-${y(),n(()=>y().color_number)??""}`,"svelte-fzou33"),I(N,(y(),n(()=>y().label)))}),s(m,g)};b(Q,m=>{te(),y(),n(()=>te()&&y()?.label?.length)&&m(c)})}oe(),t(z),t(x),s(v,x)};b(ee,v=>{e(ke),n(()=>e(ke).length)?v(Be):v(Re,!1)})}oe(2),t(p),k(v=>I(C,v),[()=>n(Me)]),s(E,p)};b(At,E=>{ft()&&E(qt)})}var Kt=o(At,2);{var Vt=E=>{var p=_a(),P=a(p),Z=a(P),G=o(a(Z),2),C=a(G,!0);t(G),t(Z),t(P);var ee=o(P,2);{var Be=v=>{var x=wt(),z=Te(x);ue(z,1,()=>e(De),it,(Q,c)=>{var m=fa(),g=a(m),N=a(g),B=a(N),He=a(B,!0);t(B);var le=o(B,2),Le=a(le,!0);t(le),t(N);var ie=o(N,2);ue(ie,7,()=>(e(c),n(()=>e(c).events)),(S,h)=>`${S.id??"new"}-${S.start_time}-${h}`,(S,h)=>{var R=ua(),H=a(R),qe=a(H);kt(qe,{get item(){return e(h)},showDate:!1,get searchQuery(){return ze()}}),t(H);var Ke=o(H,2);{var Ve=L=>{var q=da(),K=a(q);t(q),k(()=>{j(K,"data-bs-target",`#${O??""}`),j(K,"aria-controls",O)}),fe("click",K,()=>Ee(e(h))),s(L,q)};b(Ke,L=>{e(h),n(()=>de(e(h)))&&L(Ve)})}t(R),s(S,R)}),t(ie),t(g),t(m),k(()=>{I(He,(e(c),n(()=>e(c).displayDay))),I(Le,(e(c),n(()=>e(c).displayDate)))}),s(Q,m)}),s(v,x)},Re=v=>{var x=ga(),z=a(x),Q=o(a(z));{var c=m=>{var g=ma(),N=a(g,!0);t(g),k(()=>{ot(g,1,`ms-1 me-1 badge rounded-pill bg-color-${y(),n(()=>y().color_number)??""}`,"svelte-fzou33"),I(N,(y(),n(()=>y().label)))}),s(m,g)};b(Q,m=>{te(),y(),n(()=>te()&&y()?.label?.length)&&m(c)})}oe(),t(z),t(x),s(v,x)};b(ee,v=>{e(De),n(()=>e(De).length)?v(Be):v(Re,!1)})}oe(2),t(p),k(v=>I(C,v),[()=>n(be)]),s(E,p)};b(Kt,E=>{mt()&&E(Vt)})}t(r),t(_),s(i,_)},xt=i=>{var _=ba(),r=a(_);Ct(r,{}),t(_),s(i,_)};b(Ae,i=>{Ze()?i(st):i(xt,!1)})}s(ct,V),It(),dt()}var xa=l('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add announcement"><i class="bi bi-plus"></i></button>'),ha=l('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit announcement"><i class="bi bi-pencil-square"></i></button>'),Ea=l('<li class="list-group-item"><div class="d-flex justify-content-between"><!> <div><!></div></div></li>'),$a=l('<!> <li class="list-group-item py-2"><a href="/calendar">More</a></li>',1),wa=l("<span> </span>"),ka=l('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> announcements</div></li>'),Da=l('<div class="d-flex flex-column gap-4"><div><div class="d-flex justify-content-between align-items-center mb-2"><h5 class="mb-0">Announcements</h5> <div class="d-flex align-items-center gap-2"><!></div></div> <ul class="list-group"><!></ul></div></div>'),Na=l("<!> <!>",1);function Ha(ct,me){zt(me,!1);const Ue=()=>f(y,"$currentUser",F),Oe=()=>f(ut,"$userOrganizations",F),D=()=>f(A,"$currentUserHasPermission",F),ge=()=>f(Ge,"$currentUserIsRoot",F),We=()=>f(dt,"$currentUserIsAdmin",F),Je=()=>f(ft,"$ready",F),_e=()=>f(_t,"$announcements",F),Ye=()=>f(pt,"$searchQuery",F),Ze=()=>f(mt,"$categoryFilter",F),re=()=>f(gt,"$currentCategoryFilter",F),[F,ze]=Mt(),te=u(),{stores:{currentUser:y,currentUserHasPermission:A,currentUserIsAdmin:dt,currentUserIsRoot:Ge,userOrganizations:ut}}=Pt(),{stores:{ready:ft,categoryFilter:mt,currentCategoryFilter:gt,announcements:_t,searchQuery:pt},actions:{reload:bt}}=jt(),et={title:"Announcement",description:"",location:"",event_type:"announcement",is_public:!0},se=Rt();let Se=u(!1),pe=u(!1),ve=u(),Ie=u(!1),Me=u(!1),be=u(!1),ye=u(new Set),tt=u(""),at=u({...et});const Pe=w=>{d(tt,"Announcement Form"),d(at,{...w,category:w?.meta_data?.category})},yt=w=>Bt(w,{currentUserId:e(ve),isPrivileged:e(pe),canEditOwnOrgEvents:e(be),userOrganizations:e(ye)});Wt(async()=>{await bt()}),$(()=>Ue(),()=>{d(ve,Ue()?.id)}),$(()=>Oe(),()=>{d(ye,Oe())}),$(()=>e(ve),()=>{d(Me,!!e(ve))}),$(()=>(e(ye),vt),()=>{d(Ie,e(ye).has(vt.Bishopric))}),$(()=>(D(),M),()=>{d(be,D()(M.EditOwnOrgEvents))}),$(()=>(ge(),We(),e(Ie),D(),M),()=>{d(pe,ge()||We()||e(Ie)||D()(M.EditAllEvents))}),$(()=>(e(pe),D(),e(be),e(Me)),()=>{d(Se,e(pe)||D()(M.CreateEvents)||e(be)||e(Me))}),$(()=>(D(),M),()=>{d(te,D()(M.DeleteEvents))}),St(),Ft();var xe=Na(),ce=Te(xe);Ht(ce,{get title(){return e(tt)},get id(){return se},children:(w,ae)=>{Qt(w,{get eventItem(){return e(at)},get drawerId(){return se},name:"announcement-item-form",get canDelete(){return e(te)}})},$$slots:{default:!0}});var he=o(ce,2);{var Fe=w=>{var ae=Da(),je=a(ae),O=a(je),Qe=o(a(O),2),rt=a(Qe);{var Ee=T=>{var W=xa();k(()=>{j(W,"data-bs-target",`#${se??""}`),j(W,"aria-controls",se)}),fe("click",W,()=>Pe({...et,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),s(T,W)};b(rt,T=>{e(Se)&&T(Ee)})}t(Qe),t(O);var $e=o(O,2),we=a($e);{var ke=T=>{var W=$a(),Ne=Te(W);ue(Ne,1,_e,it,(de,ne)=>{var V=Ea(),X=a(V),Ae=a(X);Jt(Ae,{get item(){return e(ne)},get searchQuery(){return Ye()}});var st=o(Ae,2),xt=a(st);{var i=_=>{var r=ha();k(()=>{j(r,"data-bs-target",`#${se??""}`),j(r,"aria-controls",se)}),fe("click",r,()=>Pe(e(ne))),s(_,r)};b(xt,_=>{e(ne),n(()=>yt(e(ne)))&&_(i)})}t(st),t(X),t(V),s(de,V)}),oe(2),s(T,W)},De=T=>{var W=ka(),Ne=a(W),de=o(a(Ne));{var ne=V=>{var X=wa(),Ae=a(X,!0);t(X),k(()=>{ot(X,1,`ms-1 me-1 badge rounded-pill bg-color-${re(),n(()=>re().color_number)??""}`),I(Ae,(re(),n(()=>re().label)))}),s(V,X)};b(de,V=>{Ze(),re(),n(()=>Ze()&&re()?.label?.length)&&V(ne)})}oe(),t(Ne),t(W),s(T,W)};b(we,T=>{_e(),n(()=>_e()?.length)?T(ke):T(De,!1)})}t($e),t(je),t(ae),s(w,ae)},Ce=w=>{Ct(w,{})};b(he,w=>{Je()?w(Fe):w(Ce,!1)})}s(ct,xe),It(),ze()}export{Ha as A,Ra as E};
