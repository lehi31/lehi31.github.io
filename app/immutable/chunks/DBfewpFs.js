import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{d as Tt,o as Wt,g as Ut}from"./DUiJaq3B.js";import{p as St,ai as w,d as e,aj as It,f as Ne,a as Mt,E as u,s as i,D as d,c as a,r as t,t as D,u as n,F as ve}from"./DkHtKwEy.js";import{p as $t,b as m,i as p,a as Pt,e as ge,s as S}from"./DJ88wS1R.js";import{e as me,i as ot}from"./CKczAFpg.js";import{f as l,a as r,t as Ot,c as wt}from"./B190dNFg.js";import{s as Q}from"./BAllHlw7.js";import{d as Ft,p as Ze,O as ct,P as I,i as lt,e as vt}from"./BWVFsUZz.js";import{i as Ct}from"./CrhaOPk_.js";import{S as jt}from"./BIck9t-Q.js";import{g as Qt,d as Yt}from"./BlMw_xuH.js";import{A as zt,a as Bt,E as kt,c as Rt,b as Zt}from"./D9M6X5wO.js";import{v as Ht,D as Lt}from"./B73bWyVy.js";import{s as Dt}from"./DY0t93Bc.js";var Gt=l('<button class="btn btn-sm btn-outline-danger" type="button"><!></button>'),ea=l('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add event"><i class="bi bi-plus"></i></button>'),ta=l('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),aa=l('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),ra=l('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),sa=l("<span> </span>"),na=l('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),ia=l('<ul class="list-group"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">This Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),la=l('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),oa=l('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),va=l('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),ca=l("<span> </span>"),da=l('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),ua=l('<ul class="list-group border-top-0"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">Next Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),ma=l('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),ga=l('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),fa=l('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),_a=l("<span> </span>"),pa=l('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),ba=l('<ul class="list-group border-top-0"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">The Following Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),ya=l('<div class="d-flex flex-column gap-4"><div><div class="d-flex justify-content-between align-items-center gap-3 flex-wrap mb-2"><h5 class="mb-0">Events</h5> <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end"><!> <!> <!></div></div> <!> <!> <!></div></div>'),xa=l('<div class="d-flex flex-column gap-4"><!></div>'),ha=l("<!> <!>",1);function La(dt,fe){St(fe,!1);const Te=()=>m(st,"$currentUser",T),Ue=()=>m(xt,"$userOrganizations",T),A=()=>m(xe,"$currentUserHasPermission",T),_e=()=>m(Pe,"$currentUserIsRoot",T),Oe=()=>m(nt,"$currentUserIsAdmin",T),Ge=()=>m(rt,"$calendarEventsThisWeek",T),pe=()=>m(yt,"$calendarEventsNextWeek",T),et=()=>m(ne,"$calendarEventsNextNextWeek",T),tt=()=>m(_t,"$ready",T),se=()=>m(M,"$hasPastEvents",T),C=()=>m(P,"$pastEventsCount",T),We=()=>m(be,"$searchQuery",T),ee=()=>m(pt,"$categoryFilter",T),b=()=>m(bt,"$currentCategoryFilter",T),[T,ut]=Pt(),at=u();let mt=$t(fe,"showThisWeek",8,!0),gt=$t(fe,"showNextWeek",8,!0),ft=$t(fe,"showNextNextWeek",8,!0);const{stores:{ready:_t,categoryFilter:pt,currentCategoryFilter:bt,calendarEventsNextWeek:yt,calendarEventsThisWeek:rt,calendarEventsNextNextWeek:ne,calendarEvents:Se,searchQuery:be},actions:{reload:ce,calendarEventsThisWeekLabel:Ie,calendarEventsNextWeekLabel:Me,calendarEventsNextNextWeekLabel:ye}}=Qt(),{stores:{currentUserHasPermission:xe,currentUser:st,currentUserIsAdmin:nt,currentUserIsRoot:Pe,userOrganizations:xt}}=Ft();let he=u(!1),de=u(!1),Ee=u(),Fe=u(!1),Ce=u(!1),k=u(!1),te=u(new Set);const je={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0},U=Ht();let Qe=u(""),ze=u({...je});const $e=o=>{d(Qe,"Event Item"),d(ze,{...o,category:o?.meta_data?.category})},Be=o=>{if(!o||!o.length)return[];const y=new Map;for(const s of o){if(!s.start_time)continue;const x=Ze(s.start_time);if(Number.isNaN(x.getTime()))continue;const X=lt(x,"yyyy-MM-dd");let J=y.get(X);J||(J={key:X,displayDay:lt(x,"EEE"),displayDate:lt(x,"MMM d"),events:[]},y.set(X,J)),J.events.push(s)}return Array.from(y.values()).sort((s,x)=>s.key<x.key?-1:s.key>x.key?1:0).map(s=>({...s,events:s.events.slice().sort((x,X)=>{const J=x.is_all_day?0:1,He=X.is_all_day?0:1;if(J!==He)return J-He;const ht=x.start_time?Ze(x.start_time).getTime():Number.MAX_SAFE_INTEGER,Et=X.start_time?Ze(X.start_time).getTime():Number.MAX_SAFE_INTEGER;return ht-Et})}))};let ue=u([]),we=u([]),ke=u([]),De=u(!1);const M=Tt(Se,o=>{if(!o||!o.length)return!1;const y=Dt().getTime();return o.some(s=>s.event_type==="calendar_event"&&s.start_time&&Ze(s.start_time).getTime()<y)}),P=Tt(Se,o=>{if(!o||!o.length)return 0;const y=Dt().getTime();return o.filter(s=>s.event_type==="calendar_event"&&s.start_time&&Ze(s.start_time).getTime()<y).length}),ie=o=>Rt(o,{currentUserId:e(Ee),isPrivileged:e(de),canEditOwnOrgEvents:e(k),userOrganizations:e(te)}),Re=async()=>{if(!e(he)||!Ut(Pe)||!Ut(M))return;const o=Dt(),y=lt(o,"MMM d, yyyy");if(confirm(`Delete all events that occurred before ${y}?`)){d(De,!0);try{const s=await Yt(o);await ce(),s.deleted>0&&console.info(`Deleted ${s.deleted} past events.`),s.skipped>0&&console.info(`Skipped ${s.skipped} recurring events with active future instances.`),s.deleted===0&&s.skipped===0&&console.info("No past events matched the delete criteria.")}catch(s){console.error("Failed to delete past events",s),alert("Failed to delete past events. Please try again.")}finally{d(De,!1)}}};Wt(async()=>{await ce()}),w(()=>Te(),()=>{d(Ee,Te()?.id)}),w(()=>Ue(),()=>{d(te,Ue())}),w(()=>e(Ee),()=>{d(Ce,!!e(Ee))}),w(()=>(e(te),ct),()=>{d(Fe,e(te).has(ct.Bishopric))}),w(()=>(A(),I),()=>{d(k,A()(I.EditOwnOrgEvents))}),w(()=>(_e(),Oe(),e(Fe),A(),I),()=>{d(de,_e()||Oe()||e(Fe)||A()(I.EditAllEvents))}),w(()=>(e(de),A(),e(k),e(Ce)),()=>{d(he,e(de)||A()(I.CreateEvents)||e(k)||e(Ce))}),w(()=>(A(),I),()=>{d(at,A()(I.DeleteEvents))}),w(()=>Ge(),()=>{d(ue,Be(Ge()))}),w(()=>pe(),()=>{d(we,Be(pe()))}),w(()=>et(),()=>{d(ke,Be(et()))}),It(),Ct();var ae=ha(),V=Ne(ae);Lt(V,{get title(){return e(Qe)},get id(){return U},children:(o,y)=>{zt(o,{get eventItem(){return e(ze)},get drawerId(){return U},name:"event-item-form",get canDelete(){return e(at)}})},$$slots:{default:!0}});var re=i(V,2);{var Ae=o=>{var y=ya(),s=a(y),x=a(s),X=i(a(x),2),J=a(X);Bt(J,{});var He=i(J,2);{var ht=$=>{var _=Gt(),F=a(_);{var Y=j=>{var G=Ot("Deletingâ€¦");r(j,G)},Z=j=>{var G=Ot();D(()=>S(G,`Delete Past Events (${C()??""})`)),r(j,G)};p(F,j=>{e(De)?j(Y):j(Z,!1)})}t(_),D(()=>_.disabled=e(De)),ge("click",_,Re),r($,_)};p(He,$=>{_e()&&se()&&$(ht)})}var Et=i(He,2);{var qt=$=>{var _=ea();D(()=>{Q(_,"data-bs-target",`#${U??""}`),Q(_,"aria-controls",U)}),ge("click",_,()=>$e({...je,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),r($,_)};p(Et,$=>{e(he)&&$(qt)})}t(X),t(x);var At=i(x,2);{var Kt=$=>{var _=ia(),F=a(_),Y=a(F),Z=i(a(Y),2),j=a(Z,!0);t(Z),t(Y),t(F);var G=i(F,2);{var Le=v=>{var h=wt(),O=Ne(h);me(O,1,()=>e(ue),ot,(z,c)=>{var g=ra(),f=a(g),N=a(f),B=a(N),Ke=a(B,!0);t(B);var le=i(B,2),Ve=a(le,!0);t(le),t(N);var oe=i(N,2);me(oe,7,()=>(e(c),n(()=>e(c).events)),(W,E)=>`${W.id??"new"}-${W.start_time}-${E}`,(W,E)=>{var R=aa(),H=a(R),Xe=a(H);kt(Xe,{get item(){return e(E)},showDate:!1,get searchQuery(){return We()}}),t(H);var Je=i(H,2);{var Ye=L=>{var q=ta(),K=a(q);t(q),D(()=>{Q(K,"data-bs-target",`#${U??""}`),Q(K,"aria-controls",U)}),ge("click",K,()=>$e(e(E))),r(L,q)};p(Je,L=>{e(E),n(()=>ie(e(E)))&&L(Ye)})}t(R),r(W,R)}),t(oe),t(f),t(g),D(()=>{S(Ke,(e(c),n(()=>e(c).displayDay))),S(Ve,(e(c),n(()=>e(c).displayDate)))}),r(z,g)}),r(v,h)},qe=v=>{var h=na(),O=a(h),z=i(a(O));{var c=g=>{var f=sa(),N=a(f,!0);t(f),D(()=>{vt(f,1,`ms-1 me-1 badge rounded-pill bg-color-${b(),n(()=>b().color_number)??""}`,"svelte-19k62y7"),S(N,(b(),n(()=>b().label)))}),r(g,f)};p(z,g=>{ee(),b(),n(()=>ee()&&b()?.label?.length)&&g(c)})}ve(),t(O),t(h),r(v,h)};p(G,v=>{e(ue),n(()=>e(ue).length)?v(Le):v(qe,!1)})}ve(2),t(_),D(v=>S(j,v),[()=>n(Ie)]),r($,_)};p(At,$=>{mt()&&$(Kt)})}var Nt=i(At,2);{var Vt=$=>{var _=ua(),F=a(_),Y=a(F),Z=i(a(Y),2),j=a(Z,!0);t(Z),t(Y),t(F);var G=i(F,2);{var Le=v=>{var h=wt(),O=Ne(h);me(O,1,()=>e(we),ot,(z,c)=>{var g=va(),f=a(g),N=a(f),B=a(N),Ke=a(B,!0);t(B);var le=i(B,2),Ve=a(le,!0);t(le),t(N);var oe=i(N,2);me(oe,7,()=>(e(c),n(()=>e(c).events)),(W,E)=>`${W.id??"new"}-${W.start_time}-${E}`,(W,E)=>{var R=oa(),H=a(R),Xe=a(H);kt(Xe,{get item(){return e(E)},showDate:!1,get searchQuery(){return We()}}),t(H);var Je=i(H,2);{var Ye=L=>{var q=la(),K=a(q);t(q),D(()=>{Q(K,"data-bs-target",`#${U??""}`),Q(K,"aria-controls",U)}),ge("click",K,()=>$e(e(E))),r(L,q)};p(Je,L=>{e(E),n(()=>ie(e(E)))&&L(Ye)})}t(R),r(W,R)}),t(oe),t(f),t(g),D(()=>{S(Ke,(e(c),n(()=>e(c).displayDay))),S(Ve,(e(c),n(()=>e(c).displayDate)))}),r(z,g)}),r(v,h)},qe=v=>{var h=da(),O=a(h),z=i(a(O));{var c=g=>{var f=ca(),N=a(f,!0);t(f),D(()=>{vt(f,1,`ms-1 me-1 badge rounded-pill bg-color-${b(),n(()=>b().color_number)??""}`,"svelte-19k62y7"),S(N,(b(),n(()=>b().label)))}),r(g,f)};p(z,g=>{ee(),b(),n(()=>ee()&&b()?.label?.length)&&g(c)})}ve(),t(O),t(h),r(v,h)};p(G,v=>{e(we),n(()=>e(we).length)?v(Le):v(qe,!1)})}ve(2),t(_),D(v=>S(j,v),[()=>n(Me)]),r($,_)};p(Nt,$=>{gt()&&$(Vt)})}var Xt=i(Nt,2);{var Jt=$=>{var _=ba(),F=a(_),Y=a(F),Z=i(a(Y),2),j=a(Z,!0);t(Z),t(Y),t(F);var G=i(F,2);{var Le=v=>{var h=wt(),O=Ne(h);me(O,1,()=>e(ke),ot,(z,c)=>{var g=fa(),f=a(g),N=a(f),B=a(N),Ke=a(B,!0);t(B);var le=i(B,2),Ve=a(le,!0);t(le),t(N);var oe=i(N,2);me(oe,7,()=>(e(c),n(()=>e(c).events)),(W,E)=>`${W.id??"new"}-${W.start_time}-${E}`,(W,E)=>{var R=ga(),H=a(R),Xe=a(H);kt(Xe,{get item(){return e(E)},showDate:!1,get searchQuery(){return We()}}),t(H);var Je=i(H,2);{var Ye=L=>{var q=ma(),K=a(q);t(q),D(()=>{Q(K,"data-bs-target",`#${U??""}`),Q(K,"aria-controls",U)}),ge("click",K,()=>$e(e(E))),r(L,q)};p(Je,L=>{e(E),n(()=>ie(e(E)))&&L(Ye)})}t(R),r(W,R)}),t(oe),t(f),t(g),D(()=>{S(Ke,(e(c),n(()=>e(c).displayDay))),S(Ve,(e(c),n(()=>e(c).displayDate)))}),r(z,g)}),r(v,h)},qe=v=>{var h=pa(),O=a(h),z=i(a(O));{var c=g=>{var f=_a(),N=a(f,!0);t(f),D(()=>{vt(f,1,`ms-1 me-1 badge rounded-pill bg-color-${b(),n(()=>b().color_number)??""}`,"svelte-19k62y7"),S(N,(b(),n(()=>b().label)))}),r(g,f)};p(z,g=>{ee(),b(),n(()=>ee()&&b()?.label?.length)&&g(c)})}ve(),t(O),t(h),r(v,h)};p(G,v=>{e(ke),n(()=>e(ke).length)?v(Le):v(qe,!1)})}ve(2),t(_),D(v=>S(j,v),[()=>n(ye)]),r($,_)};p(Xt,$=>{ft()&&$(Jt)})}t(s),t(y),r(o,y)},it=o=>{var y=xa(),s=a(y);jt(s,{}),t(y),r(o,y)};p(re,o=>{tt()?o(Ae):o(it,!1)})}r(dt,ae),Mt(),ut()}var Ea=l('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add announcement"><i class="bi bi-plus"></i></button>'),$a=l('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit announcement"><i class="bi bi-pencil-square"></i></button>'),wa=l('<li class="list-group-item"><div class="d-flex justify-content-between"><!> <div><!></div></div></li>'),ka=l('<!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li>',1),Da=l("<span> </span>"),Aa=l('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> announcements</div></li>'),Na=l('<div class="d-flex flex-column gap-4"><div><div class="d-flex justify-content-between align-items-center mb-2"><h5 class="mb-0">Announcements</h5> <div class="d-flex align-items-center gap-2"><!> <!></div></div> <ul class="list-group"><!></ul></div></div>'),Ta=l("<!> <!>",1);function qa(dt,fe){St(fe,!1);const Te=()=>m(b,"$currentUser",C),Ue=()=>m(mt,"$userOrganizations",C),A=()=>m(T,"$currentUserHasPermission",C),_e=()=>m(at,"$currentUserIsRoot",C),Oe=()=>m(ut,"$currentUserIsAdmin",C),Ge=()=>m(gt,"$ready",C),pe=()=>m(pt,"$announcements",C),et=()=>m(bt,"$searchQuery",C),tt=()=>m(ft,"$categoryFilter",C),se=()=>m(_t,"$currentCategoryFilter",C),[C,We]=Pt(),ee=u(),{stores:{currentUser:b,currentUserHasPermission:T,currentUserIsAdmin:ut,currentUserIsRoot:at,userOrganizations:mt}}=Ft(),{stores:{ready:gt,categoryFilter:ft,currentCategoryFilter:_t,announcements:pt,searchQuery:bt},actions:{reload:yt}}=Qt(),rt={title:"Announcement",description:"",location:"",event_type:"announcement",is_public:!0},ne=Ht();let Se=u(!1),be=u(!1),ce=u(),Ie=u(!1),Me=u(!1),ye=u(!1),xe=u(new Set),st=u(""),nt=u({...rt});const Pe=k=>{d(st,"Announcement Form"),d(nt,{...k,category:k?.meta_data?.category})},xt=k=>Rt(k,{currentUserId:e(ce),isPrivileged:e(be),canEditOwnOrgEvents:e(ye),userOrganizations:e(xe)});Wt(async()=>{await yt()}),w(()=>Te(),()=>{d(ce,Te()?.id)}),w(()=>Ue(),()=>{d(xe,Ue())}),w(()=>e(ce),()=>{d(Me,!!e(ce))}),w(()=>(e(xe),ct),()=>{d(Ie,e(xe).has(ct.Bishopric))}),w(()=>(A(),I),()=>{d(ye,A()(I.EditOwnOrgEvents))}),w(()=>(_e(),Oe(),e(Ie),A(),I),()=>{d(be,_e()||Oe()||e(Ie)||A()(I.EditAllEvents))}),w(()=>(e(be),A(),e(ye),e(Me)),()=>{d(Se,e(be)||A()(I.CreateEvents)||e(ye)||e(Me))}),w(()=>(A(),I),()=>{d(ee,A()(I.DeleteEvents))}),It(),Ct();var he=Ta(),de=Ne(he);Lt(de,{get title(){return e(st)},get id(){return ne},children:(k,te)=>{zt(k,{get eventItem(){return e(nt)},get drawerId(){return ne},name:"announcement-item-form",get canDelete(){return e(ee)}})},$$slots:{default:!0}});var Ee=i(de,2);{var Fe=k=>{var te=Na(),je=a(te),U=a(je),Qe=i(a(U),2),ze=a(Qe);Bt(ze,{});var $e=i(ze,2);{var Be=M=>{var P=Ea();D(()=>{Q(P,"data-bs-target",`#${ne??""}`),Q(P,"aria-controls",ne)}),ge("click",P,()=>Pe({...rt,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),r(M,P)};p($e,M=>{e(Se)&&M(Be)})}t(Qe),t(U);var ue=i(U,2),we=a(ue);{var ke=M=>{var P=ka(),ie=Ne(P);me(ie,1,pe,ot,(Re,ae)=>{var V=wa(),re=a(V),Ae=a(re);Zt(Ae,{get item(){return e(ae)},get searchQuery(){return et()}});var it=i(Ae,2),o=a(it);{var y=s=>{var x=$a();D(()=>{Q(x,"data-bs-target",`#${ne??""}`),Q(x,"aria-controls",ne)}),ge("click",x,()=>Pe(e(ae))),r(s,x)};p(o,s=>{e(ae),n(()=>xt(e(ae)))&&s(y)})}t(it),t(re),t(V),r(Re,V)}),ve(2),r(M,P)},De=M=>{var P=Aa(),ie=a(P),Re=i(a(ie));{var ae=V=>{var re=Da(),Ae=a(re,!0);t(re),D(()=>{vt(re,1,`ms-1 me-1 badge rounded-pill bg-color-${se(),n(()=>se().color_number)??""}`),S(Ae,(se(),n(()=>se().label)))}),r(V,re)};p(Re,V=>{tt(),se(),n(()=>tt()&&se()?.label?.length)&&V(ae)})}ve(),t(ie),t(P),r(M,P)};p(we,M=>{pe(),n(()=>pe()?.length)?M(ke):M(De,!1)})}t(ue),t(je),t(te),r(k,te)},Ce=k=>{jt(k,{})};p(Ee,k=>{Ge()?k(Fe):k(Ce,!1)})}r(dt,he),Mt(),We()}export{qa as A,La as E};
