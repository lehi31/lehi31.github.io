import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{d as Ft,o as Qt,g as Ct}from"./CuVcyAaV.js";import{p as Wt,ai as p,m as e,aj as It,f as Ie,a as zt,E as m,s as i,D as u,c as a,r as t,B as g,u as n,F as Fe,n as h}from"./BWCcv1pC.js";import{p as it,b as $,i as v,a as Ht,e as we,s as N}from"./KiCntiD6.js";import{e as Ke,i as $t}from"./CvOYN50o.js";import{f as l,a as s,t as Se,c as bt}from"./DqgkBxsg.js";import{s as R,e as ta}from"./CDrl09S1.js";import{e as Rt,p as nt,O as kt,P as se,i as pt,f as ht}from"./DnVuGurV.js";import{i as Mt}from"./BeNQ5BU7.js";import{S as Kt}from"./TQLXPvU9.js";import{g as Lt,d as aa,h as Nt,c as wt,b as Et,e as Bt}from"./BOsxNJ5s.js";import{C as qt,E as Ot,c as Vt}from"./Cl2REAJA.js";import{v as Xt,D as Jt}from"./pEAXO0Hl.js";import{s as Ut}from"./ByjMlHuk.js";import{s as jt}from"./CdEA5IGF.js";var ra=l('<button class="btn btn-sm btn-outline-danger" type="button"><!></button>'),sa=l('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add event"><i class="bi bi-plus"></i></button>'),na=l('<div class="event-actions svelte-fzou33"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),ia=l('<div class="daily-event-row svelte-fzou33"><div class="event-content svelte-fzou33"><!></div> <!></div>'),la=l('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-fzou33"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),oa=l("<span> </span>"),va=l('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),da=l('<ul class="list-group"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">This Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/calendar">More</a></li></ul>'),ca=l('<div class="event-actions svelte-fzou33"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),ua=l('<div class="daily-event-row svelte-fzou33"><div class="event-content svelte-fzou33"><!></div> <!></div>'),ma=l('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-fzou33"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),_a=l("<span> </span>"),fa=l('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),ga=l('<ul class="list-group border-top-0 mt-3"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">Next Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/calendar">More</a></li></ul>'),pa=l('<div class="event-actions svelte-fzou33"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),ba=l('<div class="daily-event-row svelte-fzou33"><div class="event-content svelte-fzou33"><!></div> <!></div>'),ha=l('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-fzou33"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),ya=l("<span> </span>"),xa=l('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),wa=l('<ul class="list-group border-top-0"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">The Following Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/calendar">More</a></li></ul>'),Ea=l('<div class="d-flex flex-column gap-4"><div><div class="d-flex justify-content-between align-items-center gap-3 flex-wrap mb-2"><h5 class="mb-0">Events</h5> <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end"><!> <!></div></div> <!> <!> <!></div></div>'),$a=l('<div class="d-flex flex-column gap-4"><!></div>'),ka=l("<!> <!>",1);function cr(lt,me){Wt(me,!1);const le=()=>$(rt,"$currentUser",F),Ee=()=>$(I,"$userOrganizations",F),W=()=>$(Qe,"$currentUserHasPermission",F),ne=()=>$(D,"$currentUserIsRoot",F),oe=()=>$(o,"$currentUserIsAdmin",F),Le=()=>$(Ze,"$calendarEventsThisWeek",F),ve=()=>$(Ye,"$calendarEventsNextWeek",F),$e=()=>$(De,"$calendarEventsNextNextWeek",F),qe=()=>$(Xe,"$ready",F),r=()=>$(_,"$hasPastEvents",F),K=()=>$(ce,"$pastEventsCount",F),de=()=>$(Be,"$searchQuery",F),_e=()=>$(Je,"$categoryFilter",F),k=()=>$(vt,"$currentCategoryFilter",F),[F,tt]=Ht(),Ve=m();let ot=it(me,"showThisWeek",8,!0),ke=it(me,"showNextWeek",8,!0),at=it(me,"showNextNextWeek",8,!0);const{stores:{ready:Xe,categoryFilter:Je,currentCategoryFilter:vt,calendarEventsNextWeek:Ye,calendarEventsThisWeek:Ze,calendarEventsNextNextWeek:De,calendarEvents:Ce,searchQuery:Be},actions:{reload:ze,calendarEventsThisWeekLabel:Ge,calendarEventsNextWeekLabel:et,calendarEventsNextNextWeekLabel:je}}=Lt(),{stores:{currentUserHasPermission:Qe,currentUser:rt,currentUserIsAdmin:o,currentUserIsRoot:D,userOrganizations:I}}=Rt();let ee=m(!1),Y=m(!1),C=m(),b=m(!1),B=m(!1),E=m(!1),V=m(new Set);const y={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0},j=Xt();let Me=m(""),te=m({...y});const X=f=>{u(Me,"Event Item"),u(te,{...f,category:f?.meta_data?.category})},Q=f=>{if(!f||!f.length)return[];const O=new Map;for(const c of f){if(!c.start_time)continue;const G=nt(c.start_time);if(Number.isNaN(G.getTime()))continue;const Ae=pt(G,"yyyy-MM-dd");let Ne=O.get(Ae);Ne||(Ne={key:Ae,displayDay:pt(G,"EEE"),displayDate:pt(G,"MMM d"),events:[]},O.set(Ae,Ne)),Ne.events.push(c)}return Array.from(O.values()).sort((c,G)=>c.key<G.key?-1:c.key>G.key?1:0).map(c=>({...c,events:c.events.slice().sort((G,Ae)=>{const Ne=G.is_all_day?0:1,xt=Ae.is_all_day?0:1;if(Ne!==xt)return Ne-xt;const Tt=G.start_time?nt(G.start_time).getTime():Number.MAX_SAFE_INTEGER,At=Ae.start_time?nt(Ae.start_time).getTime():Number.MAX_SAFE_INTEGER;return Tt-At})}))};let z=m([]),M=m([]),Z=m([]),d=m(!1);const _=Ft(Ce,f=>{if(!f||!f.length)return!1;const O=Ut().getTime();return f.some(c=>c.event_type==="calendar_event"&&c.start_time&&nt(c.start_time).getTime()<O)}),ce=Ft(Ce,f=>{if(!f||!f.length)return 0;const O=Ut().getTime();return f.filter(c=>c.event_type==="calendar_event"&&c.start_time&&nt(c.start_time).getTime()<O).length}),Pe=f=>Vt(f,{currentUserId:e(C),isPrivileged:e(Y),canEditOwnOrgEvents:e(E),userOrganizations:e(V)}),Te=async()=>{if(!e(ee)||!Ct(D)||!Ct(_))return;const f=Ut(),O=pt(f,"MMM d, yyyy");if(confirm(`Delete all events that occurred before ${O}?`)){u(d,!0);try{const c=await aa(f);await ze(),c.deleted>0&&console.info(`Deleted ${c.deleted} past events.`),c.skipped>0&&console.info(`Skipped ${c.skipped} recurring events with active future instances.`),c.deleted===0&&c.skipped===0&&console.info("No past events matched the delete criteria.")}catch(c){console.error("Failed to delete past events",c),alert("Failed to delete past events. Please try again.")}finally{u(d,!1)}}};Qt(async()=>{await ze()}),p(()=>le(),()=>{u(C,le()?.id)}),p(()=>Ee(),()=>{u(V,Ee())}),p(()=>e(C),()=>{u(B,!!e(C))}),p(()=>(e(V),kt),()=>{u(b,e(V).has(kt.Bishopric))}),p(()=>(W(),se),()=>{u(E,W()(se.EditOwnOrgEvents))}),p(()=>(ne(),oe(),e(b),W(),se),()=>{u(Y,ne()||oe()||e(b)||W()(se.EditAllEvents))}),p(()=>(e(Y),W(),e(E),e(B)),()=>{u(ee,e(Y)||W()(se.CreateEvents)||e(E)||e(B))}),p(()=>(W(),se),()=>{u(Ve,W()(se.DeleteEvents))}),p(()=>Le(),()=>{u(z,Q(Le()))}),p(()=>ve(),()=>{u(M,Q(ve()))}),p(()=>$e(),()=>{u(Z,Q($e()))}),It(),Mt();var L=ka(),J=Ie(L);Jt(J,{get title(){return e(Me)},get id(){return j},children:(f,O)=>{qt(f,{get eventItem(){return e(te)},get drawerId(){return j},name:"event-item-form",get canDelete(){return e(Ve)}})},$$slots:{default:!0}});var st=i(J,2);{var yt=f=>{var O=Ea(),c=a(O),G=a(c),Ae=i(a(G),2),Ne=a(Ae);{var xt=H=>{var U=ra(),ie=a(U);{var Oe=ue=>{var We=Se("Deleting…");s(ue,We)},Ue=ue=>{var We=Se();g(()=>N(We,`Delete Past Events (${K()??""})`)),s(ue,We)};v(ie,ue=>{e(d)?ue(Oe):ue(Ue,!1)})}t(U),g(()=>U.disabled=e(d)),we("click",U,Te),s(H,U)};v(Ne,H=>{ne()&&r()&&H(xt)})}var Tt=i(Ne,2);{var At=H=>{var U=sa();g(()=>{R(U,"data-bs-target",`#${j??""}`),R(U,"aria-controls",j)}),we("click",U,()=>X({...y,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),s(H,U)};v(Tt,H=>{e(ee)&&H(At)})}t(Ae),t(G);var Pt=i(G,2);{var Yt=H=>{var U=da(),ie=a(U),Oe=a(ie),Ue=i(a(Oe),2),ue=a(Ue,!0);t(Ue),t(Oe),t(ie);var We=i(ie,2);{var dt=x=>{var P=bt(),ae=Ie(P);Ke(ae,1,()=>e(z),$t,(fe,w)=>{var T=la(),A=a(T),q=a(A),ge=a(q),ut=a(ge,!0);t(ge);var He=i(ge,2),mt=a(He,!0);t(He),t(q);var Re=i(q,2);Ke(Re,7,()=>(e(w),n(()=>e(w).events)),(re,S)=>`${re.id??"new"}-${re.start_time}-${S}`,(re,S)=>{var pe=ia(),be=a(pe),_t=a(be);Ot(_t,{get item(){return e(S)},showDate:!1,get searchQuery(){return de()}}),t(be);var ft=i(be,2);{var gt=he=>{var ye=na(),xe=a(ye);t(ye),g(()=>{R(xe,"data-bs-target",`#${j??""}`),R(xe,"aria-controls",j)}),we("click",xe,()=>X(e(S))),s(he,ye)};v(ft,he=>{e(S),n(()=>Pe(e(S)))&&he(gt)})}t(pe),s(re,pe)}),t(Re),t(A),t(T),g(()=>{N(ut,(e(w),n(()=>e(w).displayDay))),N(mt,(e(w),n(()=>e(w).displayDate)))}),s(fe,T)}),s(x,P)},ct=x=>{var P=va(),ae=a(P),fe=i(a(ae));{var w=T=>{var A=oa(),q=a(A,!0);t(A),g(()=>{ht(A,1,`ms-1 me-1 badge rounded-pill bg-color-${k(),n(()=>k().color_number)??""}`,"svelte-fzou33"),N(q,(k(),n(()=>k().label)))}),s(T,A)};v(fe,T=>{_e(),k(),n(()=>_e()&&k()?.label?.length)&&T(w)})}Fe(),t(ae),t(P),s(x,P)};v(We,x=>{e(z),n(()=>e(z).length)?x(dt):x(ct,!1)})}Fe(2),t(U),g(x=>N(ue,x),[()=>n(Ge)]),s(H,U)};v(Pt,H=>{ot()&&H(Yt)})}var St=i(Pt,2);{var Zt=H=>{var U=ga(),ie=a(U),Oe=a(ie),Ue=i(a(Oe),2),ue=a(Ue,!0);t(Ue),t(Oe),t(ie);var We=i(ie,2);{var dt=x=>{var P=bt(),ae=Ie(P);Ke(ae,1,()=>e(M),$t,(fe,w)=>{var T=ma(),A=a(T),q=a(A),ge=a(q),ut=a(ge,!0);t(ge);var He=i(ge,2),mt=a(He,!0);t(He),t(q);var Re=i(q,2);Ke(Re,7,()=>(e(w),n(()=>e(w).events)),(re,S)=>`${re.id??"new"}-${re.start_time}-${S}`,(re,S)=>{var pe=ua(),be=a(pe),_t=a(be);Ot(_t,{get item(){return e(S)},showDate:!1,get searchQuery(){return de()}}),t(be);var ft=i(be,2);{var gt=he=>{var ye=ca(),xe=a(ye);t(ye),g(()=>{R(xe,"data-bs-target",`#${j??""}`),R(xe,"aria-controls",j)}),we("click",xe,()=>X(e(S))),s(he,ye)};v(ft,he=>{e(S),n(()=>Pe(e(S)))&&he(gt)})}t(pe),s(re,pe)}),t(Re),t(A),t(T),g(()=>{N(ut,(e(w),n(()=>e(w).displayDay))),N(mt,(e(w),n(()=>e(w).displayDate)))}),s(fe,T)}),s(x,P)},ct=x=>{var P=fa(),ae=a(P),fe=i(a(ae));{var w=T=>{var A=_a(),q=a(A,!0);t(A),g(()=>{ht(A,1,`ms-1 me-1 badge rounded-pill bg-color-${k(),n(()=>k().color_number)??""}`,"svelte-fzou33"),N(q,(k(),n(()=>k().label)))}),s(T,A)};v(fe,T=>{_e(),k(),n(()=>_e()&&k()?.label?.length)&&T(w)})}Fe(),t(ae),t(P),s(x,P)};v(We,x=>{e(M),n(()=>e(M).length)?x(dt):x(ct,!1)})}Fe(2),t(U),g(x=>N(ue,x),[()=>n(et)]),s(H,U)};v(St,H=>{ke()&&H(Zt)})}var Gt=i(St,2);{var ea=H=>{var U=wa(),ie=a(U),Oe=a(ie),Ue=i(a(Oe),2),ue=a(Ue,!0);t(Ue),t(Oe),t(ie);var We=i(ie,2);{var dt=x=>{var P=bt(),ae=Ie(P);Ke(ae,1,()=>e(Z),$t,(fe,w)=>{var T=ha(),A=a(T),q=a(A),ge=a(q),ut=a(ge,!0);t(ge);var He=i(ge,2),mt=a(He,!0);t(He),t(q);var Re=i(q,2);Ke(Re,7,()=>(e(w),n(()=>e(w).events)),(re,S)=>`${re.id??"new"}-${re.start_time}-${S}`,(re,S)=>{var pe=ba(),be=a(pe),_t=a(be);Ot(_t,{get item(){return e(S)},showDate:!1,get searchQuery(){return de()}}),t(be);var ft=i(be,2);{var gt=he=>{var ye=pa(),xe=a(ye);t(ye),g(()=>{R(xe,"data-bs-target",`#${j??""}`),R(xe,"aria-controls",j)}),we("click",xe,()=>X(e(S))),s(he,ye)};v(ft,he=>{e(S),n(()=>Pe(e(S)))&&he(gt)})}t(pe),s(re,pe)}),t(Re),t(A),t(T),g(()=>{N(ut,(e(w),n(()=>e(w).displayDay))),N(mt,(e(w),n(()=>e(w).displayDate)))}),s(fe,T)}),s(x,P)},ct=x=>{var P=xa(),ae=a(P),fe=i(a(ae));{var w=T=>{var A=ya(),q=a(A,!0);t(A),g(()=>{ht(A,1,`ms-1 me-1 badge rounded-pill bg-color-${k(),n(()=>k().color_number)??""}`,"svelte-fzou33"),N(q,(k(),n(()=>k().label)))}),s(T,A)};v(fe,T=>{_e(),k(),n(()=>_e()&&k()?.label?.length)&&T(w)})}Fe(),t(ae),t(P),s(x,P)};v(We,x=>{e(Z),n(()=>e(Z).length)?x(dt):x(ct,!1)})}Fe(2),t(U),g(x=>N(ue,x),[()=>n(je)]),s(H,U)};v(Gt,H=>{at()&&H(ea)})}t(c),t(O),s(f,O)},Dt=f=>{var O=$a(),c=a(O);Kt(c,{}),t(O),s(f,O)};v(st,f=>{qe()?f(yt):f(Dt,!1)})}s(lt,L),zt(),tt()}var Da=l('<span class="text-muted">•</span>'),Ta=l("<span> </span> <!>",1),Aa=l('<span class="text-muted">•</span>'),Na=l('<em class="small fw-lighter svelte-gw8hde"><!></em> <!>',1),Oa=l('<em class="small fw-lighter text-decoration-underline svelte-gw8hde"><!> details</em>'),Ua=l('<div class="small text-muted posted-meta svelte-gw8hde">Posted <!> <!></div>'),Wa=l('<div class="small text-muted posted-meta svelte-gw8hde">Last edited <!> <!></div>'),Ia=l('<div class="small svelte-gw8hde"><!> <!> <!></div>'),za=l('<div class="attachment-image-container svelte-gw8hde"><button type="button" class="attachment-image-button svelte-gw8hde"><img class="attachment-image svelte-gw8hde"/></button> <div class="attachment-image-label svelte-gw8hde"><small class="text-muted"> </small></div></div>'),Ma=l('<button type="button" class="btn btn-sm btn-outline-secondary d-flex align-items-center gap-2"><i class="bi bi-file-pdf"></i> <span class="text-truncate" style="max-width: 150px;"> </span> <small class="text-muted"> </small></button>'),Pa=l('<div class="mt-1 svelte-gw8hde"><div class="fw-semibold small mb-1 svelte-gw8hde">Attachments:</div> <div class="d-flex flex-wrap gap-2"></div></div>'),Sa=l('<div class="details-container svelte-gw8hde"><!> <!></div>'),Fa=l('<div class="announcement-thumbnail-container svelte-gw8hde"><img class="announcement-thumbnail svelte-gw8hde"/></div>'),Ca=l('<div role="button" tabindex="0" class="d-flex flex-column gap-1 svelte-gw8hde"><div class="d-flex gap-1"><div class="d-flex flex-column flex-grow-1 gap-1 svelte-gw8hde"><div class="fw-bold svelte-gw8hde"><!></div> <div class="flex d-flex align-items-center flex-wrap gap-2"><!> <!> <!></div> <!></div> <!></div></div>');function Ba(lt,me){Wt(me,!1);const le=m(),Ee=m(),W=m(),ne=m(),oe=m(),Le=m(),ve=m(),$e=m(),qe=m();let r=it(me,"item",8),K=it(me,"showDetails",12,!1),de=it(me,"searchQuery",8,"");const _e=o=>o<1024?o+" B":o<1024*1024?(o/1024).toFixed(1)+" KB":(o/(1024*1024)).toFixed(1)+" MB",k=o=>o.startsWith("image/"),F=o=>{window.open(o,"_blank")},tt=o=>{if(!o)return"";try{return pt(nt(o),"MMM d, yyyy 'at' h:mm a")}catch{return""}},Ve=()=>{e(Ee)&&K(!K())},ot=o=>{e(Ee)&&(o.key==="Enter"||o.key===" ")&&Ve()};p(()=>h(r()),()=>{u(le,r().attachments&&r().attachments.length>0?r().attachments.find(o=>k(o.type)):void 0)}),p(()=>h(r()),()=>{u(Ee,!!(r().description||r().attachments&&r().attachments.length>0))}),p(()=>h(r()),()=>{u(W,r().meta_data?.submitted_at??r().created_at)}),p(()=>e(W),()=>{u(ne,tt(e(W)))}),p(()=>h(r()),()=>{u(oe,r().meta_data?.submitted_by_name)}),p(()=>(e(ne),e(oe)),()=>{u(Le,!!(e(ne)||e(oe)))}),p(()=>h(r()),()=>{u(ve,tt(r().meta_data?.edited_at))}),p(()=>h(r()),()=>{u($e,r().meta_data?.edited_by_name)}),p(()=>(e(ve),e($e)),()=>{u(qe,!!(e(ve)||e($e)))}),It(),Mt();var ke=Ca(),at=a(ke),Xe=a(at),Je=a(Xe),vt=a(Je);Nt(vt,()=>(h(wt),h(r()),h(de()),n(()=>wt(r().title||"",de())))),t(Je);var Ye=i(Je,2),Ze=a(Ye);{var De=o=>{var D=Ta(),I=Ie(D),ee=a(I,!0);t(I);var Y=i(I,2);{var C=b=>{var B=Da();s(b,B)};v(Y,b=>{h(r()),n(()=>r().location||r().description||r().attachments&&r().attachments.length>0)&&b(C)})}g((b,B)=>{ht(I,1,`badge rounded-pill bg-color-${b??""}`,"svelte-gw8hde"),N(ee,B)},[()=>(h(Et),h(r()),n(()=>Et(r()?.meta_data?.category)?.color_number)),()=>(h(Et),h(r()),n(()=>Et(r()?.meta_data?.category)?.label))]),s(o,D)};v(Ze,o=>{h(r()),n(()=>r()?.meta_data?.category)&&o(De)})}var Ce=i(Ze,2);{var Be=o=>{var D=Na(),I=Ie(D),ee=a(I);Nt(ee,()=>(h(wt),h(r()),h(de()),n(()=>wt(r().location,de())))),t(I);var Y=i(I,2);{var C=b=>{var B=Aa();s(b,B)};v(Y,b=>{h(r()),n(()=>r().description||r().attachments&&r().attachments.length>0)&&b(C)})}s(o,D)};v(Ce,o=>{h(r()),n(()=>r().location)&&o(Be)})}var ze=i(Ce,2);{var Ge=o=>{var D=Oa(),I=a(D);{var ee=C=>{var b=Se("Hide");s(C,b)},Y=C=>{var b=Se("Show");s(C,b)};v(I,C=>{K()?C(ee):C(Y,!1)})}Fe(),t(D),s(o,D)};v(ze,o=>{h(r()),n(()=>r().description||r().attachments&&r().attachments.length>0)&&o(Ge)})}t(Ye);var et=i(Ye,2);{var je=o=>{var D=Sa(),I=a(D);{var ee=b=>{var B=Ia(),E=a(B);Nt(E,()=>(h(Bt),h(r()),h(de()),n(()=>Bt(r().description,de()))));var V=i(E,2);{var y=te=>{var X=Ua(),Q=i(a(X));{var z=d=>{var _=Se();g(()=>N(_,e(ne))),s(d,_)};v(Q,d=>{e(ne)&&d(z)})}var M=i(Q,2);{var Z=d=>{var _=bt(),ce=Ie(_);{var Pe=L=>{var J=Se();g(()=>N(J,`by ${e(oe)??""}`)),s(L,J)},Te=L=>{var J=Se();g(()=>N(J,`by ${e(oe)??""}`)),s(L,J)};v(ce,L=>{e(ne)?L(Pe):L(Te,!1)})}s(d,_)};v(M,d=>{e(oe)&&d(Z)})}t(X),s(te,X)};v(V,te=>{e(Le)&&te(y)})}var j=i(V,2);{var Me=te=>{var X=Wa(),Q=i(a(X));{var z=d=>{var _=Se();g(()=>N(_,e(ve))),s(d,_)};v(Q,d=>{e(ve)&&d(z)})}var M=i(Q,2);{var Z=d=>{var _=Se();g(()=>N(_,`by ${e($e)??""}`)),s(d,_)};v(M,d=>{e($e)&&d(Z)})}t(X),s(te,X)};v(j,te=>{e(qe)&&te(Me)})}t(B),s(b,B)};v(I,b=>{h(r()),n(()=>r().description)&&b(ee)})}var Y=i(I,2);{var C=b=>{var B=Pa(),E=i(a(B),2);Ke(E,5,()=>(h(r()),n(()=>r().attachments)),V=>V.id,(V,y)=>{var j=bt(),Me=Ie(j);{var te=Q=>{var z=za(),M=a(z),Z=a(M);t(M);var d=i(M,2),_=a(d),ce=a(_,!0);t(_),t(d),t(z),g(()=>{R(M,"title",`Open ${e(y),n(()=>e(y).name)??""}`),R(Z,"src",(e(y),n(()=>e(y).url))),R(Z,"alt",(e(y),n(()=>e(y).name))),N(ce,(e(y),n(()=>e(y).name)))}),we("click",M,jt(()=>F(e(y).url))),s(Q,z)},X=Q=>{var z=Ma(),M=i(a(z),2),Z=a(M,!0);t(M);var d=i(M,2),_=a(d);t(d),t(z),g(ce=>{R(z,"title",`Open ${e(y),n(()=>e(y).name)??""}`),N(Z,(e(y),n(()=>e(y).name))),N(_,`(${ce??""})`)},[()=>(e(y),n(()=>_e(e(y).size)))]),we("click",z,jt(()=>F(e(y).url))),s(Q,z)};v(Me,Q=>{e(y),n(()=>k(e(y).type))?Q(te):Q(X,!1)})}s(V,j)}),t(E),t(B),s(b,B)};v(Y,b=>{h(r()),n(()=>r().attachments&&r().attachments.length>0)&&b(C)})}t(D),s(o,D)};v(et,o=>{K()&&o(je)})}t(Xe);var Qe=i(Xe,2);{var rt=o=>{var D=Fa(),I=a(D);t(D),g(()=>{R(I,"src",(e(le),n(()=>e(le).url))),R(I,"alt",(e(le),n(()=>e(le).name)))}),s(o,D)};v(Qe,o=>{e(le)&&o(rt)})}t(at),t(ke),g(()=>ta(ke,e(Ee)?"cursor: pointer;":"")),we("keydown",ke,ot),we("click",ke,Ve),s(lt,ke),zt()}var ja=l('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add announcement"><i class="bi bi-plus"></i></button>'),Qa=l('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit announcement"><i class="bi bi-pencil-square"></i></button>'),Ha=l('<li class="list-group-item"><div class="d-flex justify-content-between"><!> <div><!></div></div></li>'),Ra=l('<!> <li class="list-group-item py-2"><a href="/calendar">More</a></li>',1),Ka=l("<span> </span>"),La=l('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> announcements</div></li>'),qa=l('<div class="d-flex flex-column gap-4"><div><div class="d-flex justify-content-between align-items-center mb-2"><h5 class="mb-0">Announcements</h5> <div class="d-flex align-items-center gap-2"><!></div></div> <ul class="list-group"><!></ul></div></div>'),Va=l("<!> <!>",1);function ur(lt,me){Wt(me,!1);const le=()=>$(k,"$currentUser",K),Ee=()=>$(ot,"$userOrganizations",K),W=()=>$(F,"$currentUserHasPermission",K),ne=()=>$(Ve,"$currentUserIsRoot",K),oe=()=>$(tt,"$currentUserIsAdmin",K),Le=()=>$(ke,"$ready",K),ve=()=>$(Je,"$announcements",K),$e=()=>$(vt,"$searchQuery",K),qe=()=>$(at,"$categoryFilter",K),r=()=>$(Xe,"$currentCategoryFilter",K),[K,de]=Ht(),_e=m(),{stores:{currentUser:k,currentUserHasPermission:F,currentUserIsAdmin:tt,currentUserIsRoot:Ve,userOrganizations:ot}}=Rt(),{stores:{ready:ke,categoryFilter:at,currentCategoryFilter:Xe,announcements:Je,searchQuery:vt},actions:{reload:Ye}}=Lt(),Ze={title:"Announcement",description:"",location:"",event_type:"announcement",is_public:!0},De=Xt();let Ce=m(!1),Be=m(!1),ze=m(),Ge=m(!1),et=m(!1),je=m(!1),Qe=m(new Set),rt=m(""),o=m({...Ze});const D=E=>{u(rt,"Announcement Form"),u(o,{...E,category:E?.meta_data?.category})},I=E=>Vt(E,{currentUserId:e(ze),isPrivileged:e(Be),canEditOwnOrgEvents:e(je),userOrganizations:e(Qe)});Qt(async()=>{await Ye()}),p(()=>le(),()=>{u(ze,le()?.id)}),p(()=>Ee(),()=>{u(Qe,Ee())}),p(()=>e(ze),()=>{u(et,!!e(ze))}),p(()=>(e(Qe),kt),()=>{u(Ge,e(Qe).has(kt.Bishopric))}),p(()=>(W(),se),()=>{u(je,W()(se.EditOwnOrgEvents))}),p(()=>(ne(),oe(),e(Ge),W(),se),()=>{u(Be,ne()||oe()||e(Ge)||W()(se.EditAllEvents))}),p(()=>(e(Be),W(),e(je),e(et)),()=>{u(Ce,e(Be)||W()(se.CreateEvents)||e(je)||e(et))}),p(()=>(W(),se),()=>{u(_e,W()(se.DeleteEvents))}),It(),Mt();var ee=Va(),Y=Ie(ee);Jt(Y,{get title(){return e(rt)},get id(){return De},children:(E,V)=>{qt(E,{get eventItem(){return e(o)},get drawerId(){return De},name:"announcement-item-form",get canDelete(){return e(_e)}})},$$slots:{default:!0}});var C=i(Y,2);{var b=E=>{var V=qa(),y=a(V),j=a(y),Me=i(a(j),2),te=a(Me);{var X=d=>{var _=ja();g(()=>{R(_,"data-bs-target",`#${De??""}`),R(_,"aria-controls",De)}),we("click",_,()=>D({...Ze,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),s(d,_)};v(te,d=>{e(Ce)&&d(X)})}t(Me),t(j);var Q=i(j,2),z=a(Q);{var M=d=>{var _=Ra(),ce=Ie(_);Ke(ce,1,ve,$t,(Pe,Te)=>{var L=Ha(),J=a(L),st=a(J);Ba(st,{get item(){return e(Te)},get searchQuery(){return $e()}});var yt=i(st,2),Dt=a(yt);{var f=O=>{var c=Qa();g(()=>{R(c,"data-bs-target",`#${De??""}`),R(c,"aria-controls",De)}),we("click",c,()=>D(e(Te))),s(O,c)};v(Dt,O=>{e(Te),n(()=>I(e(Te)))&&O(f)})}t(yt),t(J),t(L),s(Pe,L)}),Fe(2),s(d,_)},Z=d=>{var _=La(),ce=a(_),Pe=i(a(ce));{var Te=L=>{var J=Ka(),st=a(J,!0);t(J),g(()=>{ht(J,1,`ms-1 me-1 badge rounded-pill bg-color-${r(),n(()=>r().color_number)??""}`),N(st,(r(),n(()=>r().label)))}),s(L,J)};v(Pe,L=>{qe(),r(),n(()=>qe()&&r()?.label?.length)&&L(Te)})}Fe(),t(ce),t(_),s(d,_)};v(z,d=>{ve(),n(()=>ve()?.length)?d(M):d(Z,!1)})}t(Q),t(y),t(V),s(E,V)},B=E=>{Kt(E,{})};v(C,E=>{Le()?E(b):E(B,!1)})}s(lt,ee),zt(),de()}export{ur as A,cr as E};
