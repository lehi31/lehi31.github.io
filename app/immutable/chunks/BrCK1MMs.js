import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{d as lt,o as gt,g as _t}from"./DjNGvcU6.js";import{p as pt,aj as it,ak as Ct,f as ge,g as a,a as bt,E as J,s as l,D as R,c as t,r as e,t as y,u as d,F as ae}from"./JKZwkikK.js";import{p as ot,i as f,a as yt,b as w,e as oe,s as D}from"./BxjzTaz1.js";import{e as ie,i as Je}from"./B2BlSr7K.js";import{f as i,a as s,t as ft,c as vt}from"./JDsN5plM.js";import{s as C}from"./Cyuh9449.js";import{g as xt,p as Pe,P as pe,f as ze,c as Qe}from"./BlxY7dAc.js";import{i as ht}from"./b8c_lO2i.js";import{S as Et}from"./BgO2BILN.js";import{g as kt,A as wt,a as $t,d as St,E as dt,b as It}from"./SttL8sg2.js";import{v as Nt,D as Tt}from"./BFlEiyJa.js";import{s as ct}from"./7zbNVKOi.js";var jt=i('<button class="btn btn-sm btn-outline-danger" type="button"><!></button>'),Ot=i('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add event"><i class="bi bi-plus"></i></button>'),Ut=i('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),Ht=i('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),Lt=i('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),Rt=i("<span> </span>"),qt=i('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),Kt=i('<ul class="list-group list-group-flush"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">This Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),Bt=i('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),Vt=i('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),Xt=i('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),zt=i("<span> </span>"),Jt=i('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),Qt=i('<ul class="list-group list-group-flush border-top-0"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">Next Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),Yt=i('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),Zt=i('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),Gt=i('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),ea=i("<span> </span>"),ta=i('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),aa=i('<ul class="list-group list-group-flush border-top-0"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">The Following Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),sa=i('<div class="d-flex flex-column gap-4"><div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center gap-3 flex-wrap"><span>Events</span> <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end"><!> <!> <!></div></div></div> <!> <!> <!></div></div>'),ra=i('<div class="d-flex flex-column gap-4"><!></div>'),na=i("<!> <!>",1);function Da(Ye,ve){pt(ve,!1);const de=()=>w(Ue,"$calendarEventsThisWeek",M),Ce=()=>w(Oe,"$calendarEventsNextWeek",M),be=()=>w(He,"$calendarEventsNextNextWeek",M),ye=()=>w(qe,"$currentUserHasPermission",M),xe=()=>w(he,"$ready",M),se=()=>w(ne,"$userIsRoot",M),Ze=()=>w(_e,"$hasPastEvents",M),Ge=()=>w(fe,"$pastEventsCount",M),Z=()=>w(Ie,"$categoryFilter",M),g=()=>w(je,"$currentCategoryFilter",M),[M,et]=yt();let tt=ot(ve,"showThisWeek",8,!0),Se=ot(ve,"showNextWeek",8,!0),G=ot(ve,"showNextNextWeek",8,!0);const{stores:{ready:he,categoryFilter:Ie,currentCategoryFilter:je,calendarEventsNextWeek:Oe,calendarEventsThisWeek:Ue,calendarEventsNextNextWeek:He,calendarEvents:Le},actions:{reload:Re,calendarEventsThisWeekLabel:at,calendarEventsNextWeekLabel:W,calendarEventsNextNextWeekLabel:ce}}=kt(),{stores:{currentUserHasPermission:qe,currentUser:Ee}}=xt();let Q=J(!1);const ke={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0},A=Nt();let Ke=J(""),Be=J({...ke});const re=r=>{R(Ke,"Event Item"),R(Be,{...r,category:r?.meta_data?.category})},we=r=>{if(!r||!r.length)return[];const c=new Map;for(const n of r){if(!n.start_time)continue;const k=Pe(n.start_time);if(Number.isNaN(k.getTime()))continue;const K=ze(k,"yyyy-MM-dd");let B=c.get(K);B||(B={key:K,displayDay:ze(k,"EEE"),displayDate:ze(k,"MMM d"),events:[]},c.set(K,B)),B.events.push(n)}return Array.from(c.values()).sort((n,k)=>n.key<k.key?-1:n.key>k.key?1:0).map(n=>({...n,events:n.events.slice().sort((k,K)=>{const B=k.is_all_day?0:1,$e=K.is_all_day?0:1;if(B!==$e)return B-$e;const Xe=k.start_time?Pe(k.start_time).getTime():Number.MAX_SAFE_INTEGER,nt=K.start_time?Pe(K.start_time).getTime():Number.MAX_SAFE_INTEGER;return Xe-nt})}))};let ue=J([]),me=J([]),E=J([]),h=J(!1);const ne=lt(Ee,r=>r.roles?.includes("system-root")??!1),_e=lt(Le,r=>{if(!r||!r.length)return!1;const c=ct().getTime();return r.some(n=>n.event_type==="calendar_event"&&n.start_time&&Pe(n.start_time).getTime()<c)}),fe=lt(Le,r=>{if(!r||!r.length)return 0;const c=ct().getTime();return r.filter(n=>n.event_type==="calendar_event"&&n.start_time&&Pe(n.start_time).getTime()<c).length}),Y=async()=>{if(!a(Q)||!_t(ne)||!_t(_e))return;const r=ct(),c=ze(r,"MMM d, yyyy");if(confirm(`Delete all events that occurred before ${c}?`)){R(h,!0);try{const n=await St(r);await Re(),n.deleted>0&&console.info(`Deleted ${n.deleted} past events.`),n.skipped>0&&console.info(`Skipped ${n.skipped} recurring events with active future instances.`),n.deleted===0&&n.skipped===0&&console.info("No past events matched the delete criteria.")}catch(n){console.error("Failed to delete past events",n),alert("Failed to delete past events. Please try again.")}finally{R(h,!1)}}};gt(async()=>{R(Q,ye()(pe.CreateEvents)||ye()(pe.EditOwnOrgEvents)||ye()(pe.EditAllEvents)),await Re()}),it(()=>de(),()=>{R(ue,we(de()))}),it(()=>Ce(),()=>{R(me,we(Ce()))}),it(()=>be(),()=>{R(E,we(be()))}),Ct(),ht();var q=na(),le=ge(q);Tt(le,{get title(){return a(Ke)},get id(){return A},children:(r,c)=>{wt(r,{get eventItem(){return a(Be)},get drawerId(){return A},name:"event-item-form"})},$$slots:{default:!0}});var Ve=l(le,2);{var st=r=>{var c=sa(),n=t(c),k=t(n),K=t(k),B=l(t(K),2),$e=t(B);$t($e,{});var Xe=l($e,2);{var nt=b=>{var _=jt(),F=t(_);{var V=P=>{var z=ft("Deletingâ€¦");s(P,z)},X=P=>{var z=ft();y(()=>D(z,`Delete Past Events (${Ge()??""})`)),s(P,z)};f(F,P=>{a(h)?P(V):P(X,!1)})}e(_),y(()=>_.disabled=a(h)),oe("click",_,Y),s(b,_)};f(Xe,b=>{se()&&Ze()&&b(nt)})}var Dt=l(Xe,2);{var Wt=b=>{var _=Ot();y(()=>{C(_,"data-bs-target",`#${A??""}`),C(_,"aria-controls",A)}),oe("click",_,()=>re({...ke,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),s(b,_)};f(Dt,b=>{a(Q)&&b(Wt)})}e(B),e(K),e(k);var ut=l(k,2);{var At=b=>{var _=Kt(),F=t(_),V=t(F),X=l(t(V),2),P=t(X,!0);e(X),e(V),e(F);var z=l(F,2);{var Ne=o=>{var p=vt(),$=ge(p);ie($,1,()=>a(ue),Je,(S,v)=>{var u=Lt(),m=t(u),x=t(m),I=t(x),De=t(I,!0);e(I);var ee=l(I,2),We=t(ee,!0);e(ee),e(x);var te=l(x,2);ie(te,7,()=>(a(v),d(()=>a(v).events)),(N,T)=>`${N.id??"new"}-${N.start_time}-${T}`,(N,T)=>{var j=Ht(),O=t(j),Ae=t(O);dt(Ae,{get item(){return a(T)},showDate:!1}),e(O);var Fe=l(O,2);{var Me=U=>{var H=Ut(),L=t(H);e(H),y(()=>{C(L,"data-bs-target",`#${A??""}`),C(L,"aria-controls",A)}),oe("click",L,()=>re(a(T))),s(U,H)};f(Fe,U=>{a(Q)&&U(Me)})}e(j),s(N,j)}),e(te),e(m),e(u),y(()=>{D(De,(a(v),d(()=>a(v).displayDay))),D(We,(a(v),d(()=>a(v).displayDate)))}),s(S,u)}),s(o,p)},Te=o=>{var p=qt(),$=t(p),S=l(t($));{var v=u=>{var m=Rt(),x=t(m,!0);e(m),y(()=>{Qe(m,1,`ms-1 me-1 badge rounded-pill bg-color-${g(),d(()=>g().color_number)??""}`,"svelte-19k62y7"),D(x,(g(),d(()=>g().label)))}),s(u,m)};f(S,u=>{Z(),g(),d(()=>Z()&&g()?.label?.length)&&u(v)})}ae(),e($),e(p),s(o,p)};f(z,o=>{a(ue),d(()=>a(ue).length)?o(Ne):o(Te,!1)})}ae(2),e(_),y(o=>D(P,o),[()=>d(at)]),s(b,_)};f(ut,b=>{tt()&&b(At)})}var mt=l(ut,2);{var Ft=b=>{var _=Qt(),F=t(_),V=t(F),X=l(t(V),2),P=t(X,!0);e(X),e(V),e(F);var z=l(F,2);{var Ne=o=>{var p=vt(),$=ge(p);ie($,1,()=>a(me),Je,(S,v)=>{var u=Xt(),m=t(u),x=t(m),I=t(x),De=t(I,!0);e(I);var ee=l(I,2),We=t(ee,!0);e(ee),e(x);var te=l(x,2);ie(te,7,()=>(a(v),d(()=>a(v).events)),(N,T)=>`${N.id??"new"}-${N.start_time}-${T}`,(N,T)=>{var j=Vt(),O=t(j),Ae=t(O);dt(Ae,{get item(){return a(T)},showDate:!1}),e(O);var Fe=l(O,2);{var Me=U=>{var H=Bt(),L=t(H);e(H),y(()=>{C(L,"data-bs-target",`#${A??""}`),C(L,"aria-controls",A)}),oe("click",L,()=>re(a(T))),s(U,H)};f(Fe,U=>{a(Q)&&U(Me)})}e(j),s(N,j)}),e(te),e(m),e(u),y(()=>{D(De,(a(v),d(()=>a(v).displayDay))),D(We,(a(v),d(()=>a(v).displayDate)))}),s(S,u)}),s(o,p)},Te=o=>{var p=Jt(),$=t(p),S=l(t($));{var v=u=>{var m=zt(),x=t(m,!0);e(m),y(()=>{Qe(m,1,`ms-1 me-1 badge rounded-pill bg-color-${g(),d(()=>g().color_number)??""}`,"svelte-19k62y7"),D(x,(g(),d(()=>g().label)))}),s(u,m)};f(S,u=>{Z(),g(),d(()=>Z()&&g()?.label?.length)&&u(v)})}ae(),e($),e(p),s(o,p)};f(z,o=>{a(me),d(()=>a(me).length)?o(Ne):o(Te,!1)})}ae(2),e(_),y(o=>D(P,o),[()=>d(W)]),s(b,_)};f(mt,b=>{Se()&&b(Ft)})}var Mt=l(mt,2);{var Pt=b=>{var _=aa(),F=t(_),V=t(F),X=l(t(V),2),P=t(X,!0);e(X),e(V),e(F);var z=l(F,2);{var Ne=o=>{var p=vt(),$=ge(p);ie($,1,()=>a(E),Je,(S,v)=>{var u=Gt(),m=t(u),x=t(m),I=t(x),De=t(I,!0);e(I);var ee=l(I,2),We=t(ee,!0);e(ee),e(x);var te=l(x,2);ie(te,7,()=>(a(v),d(()=>a(v).events)),(N,T)=>`${N.id??"new"}-${N.start_time}-${T}`,(N,T)=>{var j=Zt(),O=t(j),Ae=t(O);dt(Ae,{get item(){return a(T)},showDate:!1}),e(O);var Fe=l(O,2);{var Me=U=>{var H=Yt(),L=t(H);e(H),y(()=>{C(L,"data-bs-target",`#${A??""}`),C(L,"aria-controls",A)}),oe("click",L,()=>re(a(T))),s(U,H)};f(Fe,U=>{a(Q)&&U(Me)})}e(j),s(N,j)}),e(te),e(m),e(u),y(()=>{D(De,(a(v),d(()=>a(v).displayDay))),D(We,(a(v),d(()=>a(v).displayDate)))}),s(S,u)}),s(o,p)},Te=o=>{var p=ta(),$=t(p),S=l(t($));{var v=u=>{var m=ea(),x=t(m,!0);e(m),y(()=>{Qe(m,1,`ms-1 me-1 badge rounded-pill bg-color-${g(),d(()=>g().color_number)??""}`,"svelte-19k62y7"),D(x,(g(),d(()=>g().label)))}),s(u,m)};f(S,u=>{Z(),g(),d(()=>Z()&&g()?.label?.length)&&u(v)})}ae(),e($),e(p),s(o,p)};f(z,o=>{a(E),d(()=>a(E).length)?o(Ne):o(Te,!1)})}ae(2),e(_),y(o=>D(P,o),[()=>d(ce)]),s(b,_)};f(Mt,b=>{G()&&b(Pt)})}e(n),e(c),s(r,c)},rt=r=>{var c=ra(),n=t(c);Et(n,{}),e(c),s(r,c)};f(Ve,r=>{xe()?r(st):r(rt,!1)})}s(Ye,q),bt(),et()}var la=i('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add announcement"><i class="bi bi-plus"></i></button>'),ia=i('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit announcement"><i class="bi bi-pencil-square"></i></button>'),oa=i('<li class="list-group-item"><div class="d-flex justify-content-between"><!> <div><!></div></div></li>'),va=i('<!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li>',1),da=i("<span> </span>"),ca=i('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> announcements</div></li>'),ua=i('<div class="d-flex flex-column gap-4"><div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center"><span>Announcements</span> <div class="d-flex align-items-center gap-2"><!> <!></div></div></div> <ul class="list-group list-group-flush"><!></ul></div></div>'),ma=i("<!> <!>",1);function Wa(Ye,ve){pt(ve,!1);const de=()=>w(Ge,"$currentUserHasPermission",se),Ce=()=>w(Z,"$ready",se),be=()=>w(et,"$announcements",se),ye=()=>w(g,"$categoryFilter",se),xe=()=>w(M,"$currentCategoryFilter",se),[se,Ze]=yt(),{stores:{currentUserHasPermission:Ge}}=xt(),{stores:{ready:Z,categoryFilter:g,currentCategoryFilter:M,announcements:et},actions:{reload:tt}}=kt(),Se={title:"Announcement",description:"",location:"",event_type:"announcement",is_public:!0},G=Nt();let he=J(!1),Ie=J(""),je=J({...Se});const Oe=W=>{R(Ie,"Announcement Form"),R(je,{...W,category:W?.meta_data?.category})};gt(async()=>{R(he,de()(pe.CreateEvents)||de()(pe.EditOwnOrgEvents)||de()(pe.EditAllEvents)),await tt()}),ht();var Ue=ma(),He=ge(Ue);Tt(He,{get title(){return a(Ie)},get id(){return G},children:(W,ce)=>{wt(W,{get eventItem(){return a(je)},get drawerId(){return G},name:"announcement-item-form"})},$$slots:{default:!0}});var Le=l(He,2);{var Re=W=>{var ce=ua(),qe=t(ce),Ee=t(qe),Q=t(Ee),ke=l(t(Q),2),A=t(ke);$t(A,{});var Ke=l(A,2);{var Be=E=>{var h=la();y(()=>{C(h,"data-bs-target",`#${G??""}`),C(h,"aria-controls",G)}),oe("click",h,()=>Oe({...Se,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),s(E,h)};f(Ke,E=>{a(he)&&E(Be)})}e(ke),e(Q),e(Ee);var re=l(Ee,2),we=t(re);{var ue=E=>{var h=va(),ne=ge(h);ie(ne,1,be,Je,(_e,fe)=>{var Y=oa(),q=t(Y),le=t(q);It(le,{get item(){return a(fe)}});var Ve=l(le,2),st=t(Ve);{var rt=r=>{var c=ia();y(()=>{C(c,"data-bs-target",`#${G??""}`),C(c,"aria-controls",G)}),oe("click",c,()=>Oe(a(fe))),s(r,c)};f(st,r=>{a(he)&&r(rt)})}e(Ve),e(q),e(Y),s(_e,Y)}),ae(2),s(E,h)},me=E=>{var h=ca(),ne=t(h),_e=l(t(ne));{var fe=Y=>{var q=da(),le=t(q,!0);e(q),y(()=>{Qe(q,1,`ms-1 me-1 badge rounded-pill bg-color-${xe().color_number??""}`),D(le,xe().label)}),s(Y,q)};f(_e,Y=>{ye()&&xe()?.label?.length&&Y(fe)})}ae(),e(ne),e(h),s(E,h)};f(we,E=>{be()?.length?E(ue):E(me,!1)})}e(re),e(qe),e(ce),s(W,ce)},at=W=>{Et(W,{})};f(Le,W=>{Ce()?W(Re):W(at,!1)})}s(Ye,Ue),bt(),Ze()}export{Wa as A,Da as E};
