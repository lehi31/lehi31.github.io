import{t as z,j as ft,k as pt,K as tr,bb as rr,L as _t,Y as nr,ac as ar,b1 as sr,a_ as or,N as ir,G as Ue,p as lr,ai as j,D as T,E as U,w as G,g as o,aj as cr,c as D,s as F,u as I,r as w,a as ur,R as dr,F as mt,f as fr}from"./CPOcesE7.js";import{b as vt,d as pr,f as C,a as M}from"./YsHTGu5k.js";import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{p as qe,b as _r,i as B,a as mr,s as le,e as ye}from"./opPvMm1W.js";import{e as vr,i as br}from"./DAwrR-3T.js";import{s as gr}from"./B678cWRA.js";import{t as xe,v as hr,w as yr,b as q,g as It,p as ue,k as ce,f as Q,x as bt,A as Ve,D as wr,c as we,h as Ge}from"./BsRP2LKs.js";import{i as Dr}from"./C2Q_9cr2.js";import{w as ne,g as gt,r as Et,d as te}from"./DHXte27T.js";import{S as Ke}from"./rXwHPYJY.js";import{R as xr}from"./CC589K26.js";import{s as Tr,i as Sr}from"./D_BP0e98.js";function Un(e,t,r=!1,n=!1,a=!1){var s=e,i="";z(()=>{var u=tr;if(i===(i=t()??"")){ft&&pt();return}if(u.nodes!==null&&(rr(u.nodes.start,u.nodes.end),u.nodes=null),i!==""){if(ft){_t.data;for(var m=pt(),h=m;m!==null&&(m.nodeType!==nr||m.data!=="");)h=m,m=ar(m);if(m===null)throw sr(),or;vt(_t,h),s=ir(m);return}var N=i+"";r?N=`<svg>${N}</svg>`:n&&(N=`<math>${N}</math>`);var E=pr(N);if((r||n)&&(E=Ue(E)),vt(Ue(E),E.lastChild),r||n)for(;Ue(E);)s.before(Ue(E));else s.before(E)}})}function kr(e,t){const r=xe(e);return isNaN(t)?hr(e,NaN):(t&&r.setDate(r.getDate()+t),r)}function De(e,t){const r=t*7;return kr(e,r)}function re(e,t){const r=yr(),n=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,a=xe(e),s=a.getDay(),i=(s<n?-7:0)+6-(s-n);return a.setDate(a.getDate()+i),a.setHours(23,59,59,999),a}function Ae(e,t){const r=+xe(e),[n,a]=[+xe(t.start),+xe(t.end)].sort((s,i)=>s-i);return r>=n&&r<=a}function Nr(e,t){const r=Ir(t);return"formatToParts"in r?Or(r,e):Cr(r,e)}const Mr={year:0,month:1,day:2,hour:3,minute:4,second:5};function Or(e,t){try{const r=e.formatToParts(t),n=[];for(let a=0;a<r.length;a++){const s=Mr[r[a].type];s!==void 0&&(n[s]=parseInt(r[a].value,10))}return n}catch(r){if(r instanceof RangeError)return[NaN];throw r}}function Cr(e,t){const r=e.format(t),n=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(r);return[parseInt(n[3],10),parseInt(n[1],10),parseInt(n[2],10),parseInt(n[4],10),parseInt(n[5],10),parseInt(n[6],10)]}const Qe={},ht=new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:"America/New_York",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),Yr=ht==="06/25/2014, 00:00:00"||ht==="‎06‎/‎25‎/‎2014‎ ‎00‎:‎00‎:‎00";function Ir(e){return Qe[e]||(Qe[e]=Yr?new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),Qe[e]}function ot(e,t,r,n,a,s,i){const u=new Date(0);return u.setUTCFullYear(e,t,r),u.setUTCHours(n,a,s,i),u}const yt=36e5,Er=6e4,Je={timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-])(\d{2}):?(\d{2})$/};function it(e,t,r){if(!e)return 0;let n=Je.timezoneZ.exec(e);if(n)return 0;let a,s;if(n=Je.timezoneHH.exec(e),n)return a=parseInt(n[1],10),wt(a)?-(a*yt):NaN;if(n=Je.timezoneHHMM.exec(e),n){a=parseInt(n[2],10);const i=parseInt(n[3],10);return wt(a,i)?(s=Math.abs(a)*yt+i*Er,n[1]==="+"?-s:s):NaN}if(Pr(e)){t=new Date(t||Date.now());const i=r?t:Ur(t),u=rt(i,e);return-(r?u:Ar(t,u,e))}return NaN}function Ur(e){return ot(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function rt(e,t){const r=Nr(e,t),n=ot(r[0],r[1]-1,r[2],r[3]%24,r[4],r[5],0).getTime();let a=e.getTime();const s=a%1e3;return a-=s>=0?s:1e3+s,n-a}function Ar(e,t,r){let a=e.getTime()-t;const s=rt(new Date(a),r);if(t===s)return t;a-=s-t;const i=rt(new Date(a),r);return s===i?s:Math.max(s,i)}function wt(e,t){return-23<=e&&e<=23&&(t==null||0<=t&&t<=59)}const Dt={};function Pr(e){if(Dt[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),Dt[e]=!0,!0}catch{return!1}}function xt(e){const t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+e-+t}const Ut=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,Xe=36e5,Tt=6e4,Lr=2,O={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:Ut};function nt(e,t={}){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(e===null)return new Date(NaN);const r=t.additionalDigits==null?Lr:Number(t.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]")return new Date(e.getTime());if(typeof e=="number"||Object.prototype.toString.call(e)==="[object Number]")return new Date(e);if(Object.prototype.toString.call(e)!=="[object String]")return new Date(NaN);const n=Rr(e),{year:a,restDateString:s}=Hr(n.date,r),i=Wr(s,a);if(i===null||isNaN(i.getTime()))return new Date(NaN);if(i){const u=i.getTime();let m=0,h;if(n.time&&(m=Fr(n.time),m===null||isNaN(m)))return new Date(NaN);if(n.timeZone||t.timeZone){if(h=it(n.timeZone||t.timeZone,new Date(u+m)),isNaN(h))return new Date(NaN)}else h=xt(new Date(u+m)),h=xt(new Date(u+m+h));return new Date(u+m+h)}else return new Date(NaN)}function Rr(e){const t={};let r=O.dateTimePattern.exec(e),n;if(r?(t.date=r[1],n=r[3]):(r=O.datePattern.exec(e),r?(t.date=r[1],n=r[2]):(t.date=null,n=e)),n){const a=O.timeZone.exec(n);a?(t.time=n.replace(a[1],""),t.timeZone=a[1].trim()):t.time=n}return t}function Hr(e,t){if(e){const r=O.YYY[t],n=O.YYYYY[t];let a=O.YYYY.exec(e)||n.exec(e);if(a){const s=a[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(a=O.YY.exec(e)||r.exec(e),a){const s=a[1];return{year:parseInt(s,10)*100,restDateString:e.slice(s.length)}}}return{year:null}}function Wr(e,t){if(t===null)return null;let r,n,a;if(!e||!e.length)return r=new Date(0),r.setUTCFullYear(t),r;let s=O.MM.exec(e);if(s)return r=new Date(0),n=parseInt(s[1],10)-1,kt(t,n)?(r.setUTCFullYear(t,n),r):new Date(NaN);if(s=O.DDD.exec(e),s){r=new Date(0);const i=parseInt(s[1],10);return Br(t,i)?(r.setUTCFullYear(t,0,i),r):new Date(NaN)}if(s=O.MMDD.exec(e),s){r=new Date(0),n=parseInt(s[1],10)-1;const i=parseInt(s[2],10);return kt(t,n,i)?(r.setUTCFullYear(t,n,i),r):new Date(NaN)}if(s=O.Www.exec(e),s)return a=parseInt(s[1],10)-1,Nt(a)?St(t,a):new Date(NaN);if(s=O.WwwD.exec(e),s){a=parseInt(s[1],10)-1;const i=parseInt(s[2],10)-1;return Nt(a,i)?St(t,a,i):new Date(NaN)}return null}function Fr(e){let t,r,n=O.HH.exec(e);if(n)return t=parseFloat(n[1].replace(",",".")),et(t)?t%24*Xe:NaN;if(n=O.HHMM.exec(e),n)return t=parseInt(n[1],10),r=parseFloat(n[2].replace(",",".")),et(t,r)?t%24*Xe+r*Tt:NaN;if(n=O.HHMMSS.exec(e),n){t=parseInt(n[1],10),r=parseInt(n[2],10);const a=parseFloat(n[3].replace(",","."));return et(t,r,a)?t%24*Xe+r*Tt+a*1e3:NaN}return null}function St(e,t,r){t=t||0,r=r||0;const n=new Date(0);n.setUTCFullYear(e,0,4);const a=n.getUTCDay()||7,s=t*7+r+1-a;return n.setUTCDate(n.getUTCDate()+s),n}const $r=[31,28,31,30,31,30,31,31,30,31,30,31],jr=[31,29,31,30,31,30,31,31,30,31,30,31];function At(e){return e%400===0||e%4===0&&e%100!==0}function kt(e,t,r){if(t<0||t>11)return!1;if(r!=null){if(r<1)return!1;const n=At(e);if(n&&r>jr[t]||!n&&r>$r[t])return!1}return!0}function Br(e,t){if(t<1)return!1;const r=At(e);return!(r&&t>366||!r&&t>365)}function Nt(e,t){return!(e<0||e>52||t!=null&&(t<0||t>6))}function et(e,t,r){return!(e<0||e>=25||t!=null&&(t<0||t>=60)||r!=null&&(r<0||r>=60))}function Mt(e,t,r){e=nt(e,r);const n=it(t,e,!0),a=new Date(e.getTime()-n),s=new Date(0);return s.setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()),s.setHours(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),s}function zr(e,t,r){if(typeof e=="string"&&!e.match(Ut))return nt(e,{...r,timeZone:t});e=nt(e,r);const n=ot(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()).getTime(),a=it(t,new Date(n));return new Date(n+a)}const at=ne([]);let Z=null;async function ae(){return Z||(Z=(async()=>{const{data:e,error:t}=await q.from("calendar_events").select("*").order("start_time",{ascending:!0});if(t)throw Z=null,t;const r=e||[];return at.set(r),setTimeout(()=>{Z=null},100),r})(),Z)}async function Pt(e){let t=gt(at);return t.length||(await ae(),t=gt(at)),t.find(r=>r.id===e)}async function Zr(e){const{data:t,error:r}=await q.from("calendar_events").insert([e]).select();if(r)throw r;return Z=null,await ae(),t?t[0]:void 0}async function Pe(e,t){const{data:r,error:n}=await q.from("calendar_events").update(t).eq("id",e).select();if(n)throw n;return Z=null,await ae(),r?r[0]:void 0}async function qr(e){const t=await Pt(e),{error:r}=await q.from("calendar_events").delete().eq("id",e);if(r)throw r;t?.attachments&&t.attachments.length>0&&await lt(t.attachments),Z=null,await ae()}const Vr={bishop:{approval:"bishop_approval",timestamp:"bishop_approval_at",userId:"bishop_approval_by_user_id"},first_counselor:{approval:"first_counselor_approval",timestamp:"first_counselor_approval_at",userId:"first_counselor_approval_by_user_id"},second_counselor:{approval:"second_counselor_approval",timestamp:"second_counselor_approval_at",userId:"second_counselor_approval_by_user_id"}};async function Lt(e,t,r,n){const a=Vr[t],s=r?new Date().toISOString():null;return Pe(e,{[a.approval]:r,[a.timestamp]:s,[a.userId]:r?n??null:null})}async function Rt(e){return Pe(e,{is_published:!0})}async function Ht(e){return Pe(e,{is_published:!1})}async function Gr(e=new Date){const t=e.toISOString(),{data:r,error:n}=await q.from("calendar_events").select("*").lt("start_time",t).eq("event_type","calendar_event");if(n)throw n;if(!r||r.length===0)return{deleted:0,skipped:0};const a=[],s=[];for(const u of r){if(u.recurrence_rule&&(!u.recurrence_end_date||u.recurrence_end_date&&new Date(u.recurrence_end_date)>=e)){s.push(u);continue}a.push(u)}let i=0;if(a.length>0){const u=a.map(m=>m.id).filter(m=>m!==void 0);if(u.length>0){const{data:m,error:h}=await q.from("calendar_events").delete().in("id",u).select("id");if(h)throw h;i=m?.length??0;for(const N of a)N.attachments&&N.attachments.length>0&&await lt(N.attachments)}}return Z=null,await ae(),{deleted:i,skipped:s.length}}async function Kr(e,t){const r=e.name.split(".").pop()||"bin",n=t||"temp",s=`${crypto.randomUUID()}.${r}`,i=`${n}/${s}`,{error:u}=await q.storage.from("event-attachments").upload(i,e,{cacheControl:"3600",upsert:!1});if(u)throw u;const{data:{publicUrl:m}}=q.storage.from("event-attachments").getPublicUrl(i);return{id:crypto.randomUUID(),name:e.name,url:m,type:e.type,size:e.size,uploadedAt:new Date().toISOString()}}async function Qr(e){const{error:t}=await q.storage.from("event-attachments").remove([e]);if(t)throw t}function Wt(e){const t=e.match(/event-attachments\/(.+)$/);return t?t[1]:""}async function lt(e){if(!e||e.length===0)return;const t=e.map(r=>Wt(r.url)).filter(r=>r);if(t.length>0){const{error:r}=await q.storage.from("event-attachments").remove(t);if(r)throw r}}const An=Object.freeze(Object.defineProperty({__proto__:null,createCalendarEvent:Zr,deleteCalendarEvent:qr,deleteEventAttachment:Qr,deleteEventAttachments:lt,deletePastCalendarEvents:Gr,extractStoragePath:Wt,getAllCalendarEvents:ae,getCalendarEvent:Pt,publishCalendarEvent:Rt,unpublishCalendarEvent:Ht,updateBishopricApproval:Lt,updateCalendarEvent:Pe,uploadEventAttachment:Kr},Symbol.toStringTag,{value:"Module"})),Jr={all:{label:"All",key:"",sort_index:0,color_number:0},public:{label:"Public",key:"PUB",sort_index:0,color_number:1},church:{label:"Church",key:"CHU",sort_index:0,color_number:2},stake:{label:"Stake",key:"STK",sort_index:0,color_number:3},ward:{label:"Ward",key:"WRD",sort_index:1,color_number:4},reliefSociety:{label:"Relief Society",key:"RES",sort_index:2,color_number:5},eldersQuorum:{label:"Elders Quorum",key:"ELQ",sort_index:3,color_number:6},youth:{label:"Youth",key:"YOU",sort_index:4,color_number:7},youngWomen:{label:"Young Women",key:"YOW",sort_index:4,color_number:8},youngWomenPearls:{label:"Young Women | Pearls",key:"YWP",sort_index:5,color_number:9},youngWomenRubies:{label:"Young Women | Rubies",key:"YWR",sort_index:6,color_number:10},youngWomenDiamonds:{label:"Young Women | Diamonds",key:"YWD",sort_index:7,color_number:11},aaronicPriesthood:{label:"Young Men",key:"YOM",sort_index:8,color_number:12},aaronicPriesthoodDeacons:{label:"Young Men | Deacons",key:"YMD",sort_index:9,color_number:13},aaronicPriesthoodTeachers:{label:"Young Men | Teachers",key:"YMT",sort_index:10,color_number:14},aaronicPriesthoodPriests:{label:"Young Men | Priests",key:"YMP",sort_index:11,color_number:15},primary:{label:"Primary",key:"PRI",sort_index:12,color_number:16},primaryNursery:{label:"Primary | Nursery",key:"PRN",sort_index:13,color_number:17},primarySunbeams:{label:"Primary | Sunbeams",key:"PRS",sort_index:14,color_number:18},primaryCTR:{label:"Primary | CTR",key:"PRC",sort_index:15,color_number:19},primaryValiant:{label:"Primary | Valiant",key:"PRV",sort_index:16,color_number:20},sundaySchool:{label:"Sunday School",key:"SUS",sort_index:17,color_number:21}},st=Object.values(Jr).sort((e,t)=>e.sort_index-t.sort_index),Pn=e=>e?st.find(t=>t.key===e):void 0,Ot={bishop:"Bishop",first_counselor:"1st Counselor",second_counselor:"2nd Counselor"},ct=e=>{let t=0;return e.bishop_approval==="YES"&&t++,e.first_counselor_approval==="YES"&&t++,e.second_counselor_approval==="YES"&&t++,t},Xr=e=>ct(e)>0,en=e=>e.is_published?"published":ct(e)>0?"approved":e.bishop_approval==="NO"||e.first_counselor_approval==="NO"||e.second_counselor_approval==="NO"?"needs_review":"pending";let Te=null;const tn=e=>e.replace(/<[^>]*>/g,"").toLowerCase(),Ct=(e,t)=>{if(!t.trim())return!0;const r=t.toLowerCase(),n=(e.title||"").toLowerCase(),a=tn(e.description||""),s=(e.location||"").toLowerCase();return n.includes(r)||a.includes(r)||s.includes(r)},Ln=(e,t)=>{if(!t.trim()||!e)return Yt(e||"");const r=Yt(e),n=new RegExp(`(${Ft(t)})`,"gi");return r.replace(n,"<mark>$1</mark>")},Rn=(e,t)=>{if(!t.trim()||!e)return e||"";const r=new RegExp(`(${Ft(t)})`,"gi");return e.replace(/(<[^>]*>)|([^<]+)/g,(n,a,s)=>a||(s?s.replace(r,"<mark>$1</mark>"):n))},Yt=e=>{const t=typeof document<"u"?document.createElement("div"):null;return t?(t.textContent=e,t.innerHTML):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},Ft=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),rn=It()??null,nn=Et(!1),tt=rn?.stores.authenticated??nn,an=()=>{const e=ne(!1),t=ne([]),r=ne([]),n=ne(""),a=ne(""),s=ne(!1),i=(p,f)=>!(!p.is_published||!f&&p.is_public===!1),u=te([r,tt],([p,f])=>{const g=new Date,S=re(De(g,3),{weekStartsOn:1}),l=p.filter(_=>_?.meta_data?.category?.length).filter(_=>i(_,f)).filter(_=>{if(_.event_type==="calendar_event"){const k=_.start_time?ue(_.start_time):null;return k?Ae(k,{start:g,end:S}):!1}return!0}).map(_=>st.find(k=>k.key===_.meta_data?.category)).filter(_=>_!==void 0);return Array.from(new Set(l))}),m=te([n],([p])=>st.find(f=>f.key===p)),h=te([r,n,a,tt],([p,f,g,S])=>p.filter(l=>l.event_type==="calendar_event").filter(l=>{const _=l?.meta_data;return f&&_?_?.category===f:!0}).filter(l=>Ct(l,g)).filter(l=>i(l,S)).filter(l=>{const _=l.start_time?ue(l.start_time):null,k=Tr();return _?Sr(_,k)||_.getTime()>=k.getTime():!1})),N=te([r,n,a,tt],([p,f,g,S])=>p.filter(l=>l.event_type==="announcement").filter(l=>{const _=l?.meta_data;return f&&_?_?.category===f:!0}).filter(l=>Ct(l,g)).filter(l=>i(l,S))),E=te([h],([p])=>p.filter(f=>{const g=f.start_time?ue(f.start_time):null;return g?Ae(g,{start:ce(new Date,{weekStartsOn:1}),end:re(new Date,{weekStartsOn:1})}):!1})),de=()=>{const p=ce(new Date,{weekStartsOn:1}),f=re(new Date,{weekStartsOn:1});return`${Q(p,"MMM d").toUpperCase()} – ${Q(f,"MMM d").toUpperCase()}`},fe=te([h],([p])=>{const f=De(ce(new Date,{weekStartsOn:1}),1),g=re(f,{weekStartsOn:1});return p.filter(S=>{const l=S.start_time?ue(S.start_time):null;return l?Ae(l,{start:f,end:g}):!1})}),Se=()=>{const p=De(ce(new Date,{weekStartsOn:1}),1),f=re(p,{weekStartsOn:1});return`${Q(p,"MMM d").toUpperCase()} – ${Q(f,"MMM d").toUpperCase()}`},b=te([h],([p])=>{const f=De(ce(new Date,{weekStartsOn:1}),2),g=re(f,{weekStartsOn:1});return p.filter(S=>{const l=S.start_time?ue(S.start_time):null;return l?Ae(l,{start:f,end:g}):!1})}),J=()=>{const p=De(ce(new Date,{weekStartsOn:1}),2),f=re(p,{weekStartsOn:1});return`${Q(p,"MMM d").toUpperCase()} – ${Q(f,"MMM d").toUpperCase()}`},ke=p=>{const f=[],g=new Date,S=new Date;S.setFullYear(g.getFullYear()+1);for(const l of p)if(l.recurrence_rule&&l.start_time&&l.end_time)try{const _=xr.fromString(l.recurrence_rule),k=l.recurrence_end_date?_.all():_.between(g,S,!0),V=new Date(l.start_time),He=new Date(l.end_time).getTime()-V.getTime(),X=Mt(V,Ve),pe=X.getHours(),We=X.getMinutes(),Ne=X.getSeconds(),se=X.getMilliseconds(),Fe=l.recurrence_exceptions||[],Me=l.recurrence_overrides||{};k.forEach((Oe,_e)=>{const $e=Mt(Oe,Ve),Ce=new Date($e);Ce.setHours(pe,We,Ne,se);const Ye=zr(Ce,Ve),me=Ye,ve=new Date(Ye.getTime()+He),Ie=Q(Oe,"yyyy-MM-dd"),x=Me[Ie];if(Fe.includes(Ie)&&!x)return;const H={...l,id:void 0,start_time:me.toISOString(),end_time:ve.toISOString(),meta_data:{category:l.meta_data?.category||"",...l.meta_data,recurring_instance:!0,recurring_parent_id:l.id,recurring_instance_index:_e}};x&&(x.title!==void 0&&(H.title=x.title),x.description!==void 0&&(H.description=x.description),x.location!==void 0&&(H.location=x.location),x.start_time!==void 0&&(H.start_time=x.start_time),x.end_time!==void 0&&(H.end_time=x.end_time),x.is_all_day!==void 0&&(H.is_all_day=x.is_all_day),x.meta_data!==void 0&&(H.meta_data={...H.meta_data,...x.meta_data})),f.push(H)})}catch(_){console.error("Failed to expand recurring event:",l.id,_),f.push(l)}else f.push(l);return f},Le=p=>p.length?ke(p).map(g=>({...g,start_time:g?.start_time?bt(g.start_time):void 0,end_time:g.end_time?bt(g.end_time):void 0})):[];return Te={stores:{ready:e,data:t,dbData:r,announcements:N,calendarEvents:h,calendarEventsThisWeek:E,calendarEventsNextWeek:fe,calendarEventsNextNextWeek:b,currentCategories:u,categoryFilter:n,searchQuery:a,currentCategoryFilter:m,weeksExpanded:s},actions:{reload:async()=>{e.set(!1);const p=await ae();r.set(Le(p)),e.set(!0)},calendarEventsThisWeekLabel:de,calendarEventsNextWeekLabel:Se,calendarEventsNextNextWeekLabel:J}},Te},Hn=()=>Te?.stores&&Object.keys(Te.stores).length>0?Te:an();var sn=C("<span> </span>"),on=C('<div class="alert alert-info mb-0" role="alert">Save this event or announcement before requesting bishopric approvals.</div>'),ln=C('<small class="text-muted"> </small>'),cn=C("<span><!></span>"),un=C('<div class="decision-buttons d-grid gap-2 gap-md-3 svelte-rko3uy"><button type="button"><i class="bi bi-check-circle-fill"></i> <div><div class="action-label svelte-rko3uy">Approve</div> <small class="text-muted">Vote to approve</small></div></button> <button type="button"><i class="bi bi-pencil-square"></i> <div><div class="action-label svelte-rko3uy">Request Changes</div> <small class="text-muted">Ask submitter to revise</small></div></button> <button type="button"><i class="bi bi-hourglass-split"></i> <div><div class="action-label svelte-rko3uy">Mark Pending</div> <small class="text-muted">No decision yet</small></div></button> <!></div>'),dn=C("<span> </span>"),fn=C('<div class="list-group-item"><div class="d-flex flex-column gap-2"><div><div class="fw-semibold"> </div> <!></div> <div><!></div></div></div>'),pn=C('<i class="bi bi-globe-americas"></i>'),_n=C('<button type="button" class="btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center gap-2"><!> Unpublish</button>'),mn=C('<i class="bi bi-globe"></i>'),vn=C('<small class="text-muted text-center">At least one approval required to publish</small>'),bn=C('<button type="button" class="btn btn-success w-100 d-flex align-items-center justify-content-center gap-2"><!> Publish to Ward</button> <!>',1),gn=C('<div class="card-footer text-danger small"> </div>'),hn=C('<div class="card"><div class="list-group list-group-flush"></div> <div class="publish-section d-flex flex-column gap-2 p-3 svelte-rko3uy"><div class="d-flex justify-content-between align-items-center"><span class="text-muted small fw-semibold"> </span></div> <!></div> <!></div>'),yn=C('<div class="d-flex flex-column gap-3"><div class="d-flex flex-wrap align-items-center justify-content-between gap-2"><h3 class="h5 mb-0">Bishopric Approval</h3> <!></div> <!></div>');function Wn(e,t){lr(t,!1);const r=()=>_r(S,"$currentUserStore",n),[n,a]=mr(),s=U(),i=U(),u=U(),m=U(),h=U(),N=U(),E=U(),de=U(),fe=U(),Se=U();let b=qe(t,"eventItem",12),J=qe(t,"disabled",8,!1),ke=qe(t,"reloadEvents",8,null);const Le={bishop:"bishopric-bishop",first_counselor:"bishopric-first-counselor",second_counselor:"bishopric-second-counselor"},Re={bishop:{status:"bishop_approval",timestamp:"bishop_approval_at"},first_counselor:{status:"first_counselor_approval",timestamp:"first_counselor_approval_at"},second_counselor:{status:"second_counselor_approval",timestamp:"second_counselor_approval_at"}},p={pending:{text:"Pending Approval",class:"bg-warning-subtle text-warning-emphasis"},approved:{text:"Approved",class:"bg-success-subtle text-success-emphasis"},needs_review:{text:"Needs Review",class:"bg-info-subtle text-info-emphasis"},published:{text:"Published",class:"bg-primary-subtle text-primary-emphasis"}},f=It()??null,g=Et(wr),S=f?.stores.currentUser??g,l=["bishop","first_counselor","second_counselor"];let _=U(""),k=U(null),V=U(!1);function ut(c){const v=Le[c];return o(s)?.roles?.includes(v)??!1}function He(c){if(!c)return null;try{return Q(ue(c),"MMM d, yyyy 'at' h:mm a")}catch(v){return console.error("Failed to format timestamp",v),null}}async function X(){typeof ke()=="function"&&await ke()()}async function pe(c,v){if(b()?.id){T(_,""),T(k,c);try{const y=await Lt(b().id,c,v,o(s)?.id);y&&b({...b(),bishop_approval:y.bishop_approval,first_counselor_approval:y.first_counselor_approval,second_counselor_approval:y.second_counselor_approval,bishop_approval_at:y.bishop_approval_at,first_counselor_approval_at:y.first_counselor_approval_at,second_counselor_approval_at:y.second_counselor_approval_at,bishop_approval_by_user_id:y.bishop_approval_by_user_id,first_counselor_approval_by_user_id:y.first_counselor_approval_by_user_id,second_counselor_approval_by_user_id:y.second_counselor_approval_by_user_id,is_published:y.is_published}),await X()}catch(y){console.error("Failed to update approval",y),T(_,"Unable to update approval. Please try again.")}finally{T(k,null)}}}async function We(c){await pe(c,null)}async function Ne(){if(b()?.id){T(_,""),T(V,!0);try{const c=o(N)?await Ht(b().id):await Rt(b().id);c&&b({...b(),is_published:c.is_published}),await X()}catch(c){console.error("Failed to update publish status",c),T(_,"Unable to update publish status. Please try again.")}finally{T(V,!1)}}}const se=c=>{const{status:v}=Re[c];return b()?.[v]},Fe=c=>{const{timestamp:v}=Re[c];return b()?.[v]};function Me(c){return He(Fe(c))}function Oe(c){const v=se(c);return v==="YES"?{text:"Approved",class:"bg-success-subtle text-success-emphasis"}:v==="NO"?{text:"Requested Changes",class:"bg-info-subtle text-info-emphasis"}:{text:"No Input Yet",class:"bg-secondary-subtle text-secondary-emphasis"}}const _e="btn btn-sm action-btn w-100 text-start d-flex align-items-center gap-2";function $e(c){const v=se(c)==="YES";return`${_e} ${v?"btn-success text-white":"btn-outline-success"}`}function Ce(c){const v=se(c)==="NO";return`${_e} ${v?"btn-info text-dark":"btn-outline-info"}`}function Ye(c){const v=se(c),y=v==null;return`${_e} ${y?"btn-secondary text-white":"btn-outline-secondary"}`}j(()=>r(),()=>{T(s,r())}),j(()=>G(b()),()=>{T(i,en(b()))}),j(()=>o(i),()=>{T(u,p[o(i)])}),j(()=>G(b()),()=>{T(m,ct(b()))}),j(()=>G(b()),()=>{T(h,Xr(b()))}),j(()=>G(b()),()=>{T(N,b()?.is_published??!1)}),j(()=>o(s),()=>{T(E,o(s)?.roles?.includes("bishopric-bishop")??!1)}),j(()=>o(s),()=>{T(de,o(s)?.roles?.includes("bishopric-first-counselor")??!1)}),j(()=>o(s),()=>{T(fe,o(s)?.roles?.includes("bishopric-second-counselor")??!1)}),j(()=>(o(E),o(de),o(fe)),()=>{T(Se,o(E)?l:l.filter(c=>c==="bishop"||c==="first_counselor"&&o(de)||c==="second_counselor"&&o(fe)))}),cr(),Dr();var me=yn(),ve=D(me),Ie=F(D(ve),2);{var x=c=>{var v=sn(),y=D(v,!0);w(v),z(()=>{we(v,1,(o(u),I(()=>`badge ${o(u).class}`)),"svelte-rko3uy"),le(y,(o(u),I(()=>o(u).text)))}),M(c,v)};B(Ie,c=>{G(b()),I(()=>b()?.id)&&c(x)})}w(ve);var H=F(ve,2);{var $t=c=>{var v=on();M(c,v)},jt=c=>{var v=hn(),y=D(v);vr(y,5,()=>o(Se),br,(A,d)=>{var Y=fn(),oe=D(Y),ee=D(oe),P=D(ee),be=D(P,!0);w(P);var ze=F(P,2);{var L=$=>{var R=ln(),W=D(R,!0);w(R),z(K=>le(W,K),[()=>(o(d),I(()=>Me(o(d))))]),M($,R)};B(ze,$=>{o(d),I(()=>Me(o(d)))&&$(L)})}w(ee);var ie=F(ee,2),Kt=D(ie);{var Qt=$=>{var R=un(),W=D(R),K=F(W,2),Ee=F(K,2),Xt=F(Ee,2);{var er=ge=>{var he=cn(),Ze=D(he);Ke(Ze,{size:"xs"}),w(he),M(ge,he)};B(Xt,ge=>{o(k)===o(d)&&ge(er)})}w(R),z((ge,he,Ze)=>{we(W,1,ge,"svelte-rko3uy"),W.disabled=J()||o(k)===o(d),we(K,1,he,"svelte-rko3uy"),K.disabled=J()||o(k)===o(d),we(Ee,1,Ze,"svelte-rko3uy"),Ee.disabled=J()||o(k)===o(d)},[()=>Ge((o(d),I(()=>$e(o(d))))),()=>Ge((o(d),I(()=>Ce(o(d))))),()=>Ge((o(d),I(()=>Ye(o(d)))))]),ye("click",W,()=>pe(o(d),"YES")),ye("click",K,()=>pe(o(d),"NO")),ye("click",Ee,()=>We(o(d))),M($,R)},Jt=$=>{const R=dr(()=>(o(d),I(()=>Oe(o(d)))));var W=dn(),K=D(W,!0);w(W),z(()=>{we(W,1,(G(o(R)),I(()=>`badge ${o(R).class}`)),"svelte-rko3uy"),le(K,(G(o(R)),I(()=>o(R).text)))}),M($,W)};B(Kt,$=>{o(d),I(()=>ut(o(d)))?$(Qt):$(Jt,!1)})}w(ie),w(oe),w(Y),z(()=>le(be,(G(Ot),o(d),I(()=>Ot[o(d)])))),M(A,Y)}),w(y);var je=F(y,2),Be=D(je),dt=D(Be),Bt=D(dt);w(dt),w(Be);var zt=F(Be,2);{var Zt=A=>{var d=_n(),Y=D(d);{var oe=P=>{Ke(P,{size:"xs"})},ee=P=>{var be=pn();M(P,be)};B(Y,P=>{o(V)?P(oe):P(ee,!1)})}mt(),w(d),z(()=>d.disabled=J()||o(V)),ye("click",d,Ne),M(A,d)},qt=A=>{var d=bn(),Y=fr(d),oe=D(Y);{var ee=L=>{Ke(L,{size:"xs"})},P=L=>{var ie=mn();M(L,ie)};B(oe,L=>{o(V)?L(ee):L(P,!1)})}mt(),w(Y);var be=F(Y,2);{var ze=L=>{var ie=vn();M(L,ie)};B(be,L=>{o(h)||L(ze)})}z(()=>{Y.disabled=J()||o(V)||!o(h),gr(Y,"title",o(h)?"":"At least one approval required to publish")}),ye("click",Y,Ne),M(A,d)};B(zt,A=>{o(N)?A(Zt):A(qt,!1)})}w(je);var Vt=F(je,2);{var Gt=A=>{var d=gn(),Y=D(d,!0);w(d),z(()=>le(Y,o(_))),M(A,d)};B(Vt,A=>{o(_)&&A(Gt)})}w(v),z(()=>le(Bt,`Approvals: ${o(m)??""} of 3`)),M(c,v)};B(H,c=>{G(b()),I(()=>!b()?.id)?c($t):c(jt,!1)})}w(me),M(e,me),ur(),a()}export{Wn as B,st as D,en as a,Pn as b,De as c,Gr as d,re as e,ct as f,Hn as g,Un as h,kr as i,Ln as j,Rn as k,zr as l,Wt as m,Qr as n,qr as o,Pt as p,Pe as q,Zr as r,An as s,Mt as t,Kr as u};
