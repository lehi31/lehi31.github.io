import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{d as ot,o as bt,g as gt}from"./CxzQr61Z.js";import{p as yt,aj as vt,ak as It,f as ge,g as a,a as xt,E as z,s as l,D as L,c as t,r as e,t as y,u as d,F as se}from"./DVz9v3yu.js";import{p as dt,i as f,a as ht,b as h,e as oe,s as D}from"./DxLPEELx.js";import{e as ie,i as ze}from"./BoUt-3Zs.js";import{f as i,a as s,t as pt,c as ct}from"./BMBpHE4F.js";import{s as C}from"./D_h9jGPv.js";import{g as Et,p as Se,P as pe,f as Xe,c as Je}from"./C-HciA9L.js";import{i as kt}from"./B41JjjA1.js";import{S as wt}from"./BT5d7Hus.js";import{g as $t,A as Nt,a as Tt,d as jt,E as ut,b as Ot}from"./DdIyQF9g.js";import{v as Dt,D as Wt}from"./126_5pGN.js";import{s as mt}from"./Bje9sCWW.js";var Qt=i('<button class="btn btn-sm btn-outline-danger" type="button"><!></button>'),Ut=i('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add event"><i class="bi bi-plus"></i></button>'),Ht=i('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),Lt=i('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),Rt=i('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),qt=i("<span> </span>"),Kt=i('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),Bt=i('<ul class="list-group list-group-flush"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">This Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),Vt=i('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),Xt=i('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),zt=i('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),Jt=i("<span> </span>"),Yt=i('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),Zt=i('<ul class="list-group list-group-flush border-top-0"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">Next Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),Gt=i('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),ea=i('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),ta=i('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),aa=i("<span> </span>"),sa=i('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),ra=i('<ul class="list-group list-group-flush border-top-0"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">The Following Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),na=i('<div class="d-flex flex-column gap-4"><div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center gap-3 flex-wrap"><span>Events</span> <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end"><!> <!> <!></div></div></div> <!> <!> <!></div></div>'),la=i('<div class="d-flex flex-column gap-4"><!></div>'),ia=i("<!> <!>",1);function Aa(Ye,ve){yt(ve,!1);const de=()=>h(Ue,"$calendarEventsThisWeek",W),Ie=()=>h(Qe,"$calendarEventsNextWeek",W),be=()=>h(He,"$calendarEventsNextNextWeek",W),ye=()=>h(Re,"$currentUserHasPermission",W),Ze=()=>h(ee,"$ready",W),xe=()=>h(ne,"$userIsRoot",W),Z=()=>h(_e,"$hasPastEvents",W),Ge=()=>h(fe,"$pastEventsCount",W),he=()=>h(st,"$searchQuery",W),G=()=>h(Ee,"$categoryFilter",W),g=()=>h(Oe,"$currentCategoryFilter",W),[W,et]=ht();let tt=dt(ve,"showThisWeek",8,!0),at=dt(ve,"showNextWeek",8,!0),je=dt(ve,"showNextNextWeek",8,!0);const{stores:{ready:ee,categoryFilter:Ee,currentCategoryFilter:Oe,calendarEventsNextWeek:Qe,calendarEventsThisWeek:Ue,calendarEventsNextNextWeek:He,calendarEvents:ke,searchQuery:st},actions:{reload:Le,calendarEventsThisWeekLabel:rt,calendarEventsNextWeekLabel:A,calendarEventsNextNextWeekLabel:ce}}=$t(),{stores:{currentUserHasPermission:Re,currentUser:we}}=Et();let J=z(!1);const $e={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0},F=Dt();let qe=z(""),Ke=z({...$e});const re=r=>{L(qe,"Event Item"),L(Ke,{...r,category:r?.meta_data?.category})},Ne=r=>{if(!r||!r.length)return[];const c=new Map;for(const n of r){if(!n.start_time)continue;const w=Se(n.start_time);if(Number.isNaN(w.getTime()))continue;const q=Xe(w,"yyyy-MM-dd");let K=c.get(q);K||(K={key:q,displayDay:Xe(w,"EEE"),displayDate:Xe(w,"MMM d"),events:[]},c.set(q,K)),K.events.push(n)}return Array.from(c.values()).sort((n,w)=>n.key<w.key?-1:n.key>w.key?1:0).map(n=>({...n,events:n.events.slice().sort((w,q)=>{const K=w.is_all_day?0:1,Te=q.is_all_day?0:1;if(K!==Te)return K-Te;const Ve=w.start_time?Se(w.start_time).getTime():Number.MAX_SAFE_INTEGER,it=q.start_time?Se(q.start_time).getTime():Number.MAX_SAFE_INTEGER;return Ve-it})}))};let ue=z([]),me=z([]),k=z([]),E=z(!1);const ne=ot(we,r=>r.roles?.includes("system-root")??!1),_e=ot(ke,r=>{if(!r||!r.length)return!1;const c=mt().getTime();return r.some(n=>n.event_type==="calendar_event"&&n.start_time&&Se(n.start_time).getTime()<c)}),fe=ot(ke,r=>{if(!r||!r.length)return 0;const c=mt().getTime();return r.filter(n=>n.event_type==="calendar_event"&&n.start_time&&Se(n.start_time).getTime()<c).length}),Y=async()=>{if(!a(J)||!gt(ne)||!gt(_e))return;const r=mt(),c=Xe(r,"MMM d, yyyy");if(confirm(`Delete all events that occurred before ${c}?`)){L(E,!0);try{const n=await jt(r);await Le(),n.deleted>0&&console.info(`Deleted ${n.deleted} past events.`),n.skipped>0&&console.info(`Skipped ${n.skipped} recurring events with active future instances.`),n.deleted===0&&n.skipped===0&&console.info("No past events matched the delete criteria.")}catch(n){console.error("Failed to delete past events",n),alert("Failed to delete past events. Please try again.")}finally{L(E,!1)}}};bt(async()=>{L(J,ye()(pe.CreateEvents)||ye()(pe.EditOwnOrgEvents)||ye()(pe.EditAllEvents)),await Le()}),vt(()=>de(),()=>{L(ue,Ne(de()))}),vt(()=>Ie(),()=>{L(me,Ne(Ie()))}),vt(()=>be(),()=>{L(k,Ne(be()))}),It(),kt();var R=ia(),le=ge(R);Wt(le,{get title(){return a(qe)},get id(){return F},children:(r,c)=>{Nt(r,{get eventItem(){return a(Ke)},get drawerId(){return F},name:"event-item-form"})},$$slots:{default:!0}});var Be=l(le,2);{var nt=r=>{var c=na(),n=t(c),w=t(n),q=t(w),K=l(t(q),2),Te=t(K);Tt(Te,{});var Ve=l(Te,2);{var it=b=>{var _=Qt(),M=t(_);{var B=P=>{var X=pt("Deletingâ€¦");s(P,X)},V=P=>{var X=pt();y(()=>D(X,`Delete Past Events (${Ge()??""})`)),s(P,X)};f(M,P=>{a(E)?P(B):P(V,!1)})}e(_),y(()=>_.disabled=a(E)),oe("click",_,Y),s(b,_)};f(Ve,b=>{xe()&&Z()&&b(it)})}var At=l(Ve,2);{var Ft=b=>{var _=Ut();y(()=>{C(_,"data-bs-target",`#${F??""}`),C(_,"aria-controls",F)}),oe("click",_,()=>re({...$e,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),s(b,_)};f(At,b=>{a(J)&&b(Ft)})}e(K),e(q),e(w);var _t=l(w,2);{var Mt=b=>{var _=Bt(),M=t(_),B=t(M),V=l(t(B),2),P=t(V,!0);e(V),e(B),e(M);var X=l(M,2);{var De=o=>{var p=ct(),$=ge(p);ie($,1,()=>a(ue),ze,(S,v)=>{var u=Rt(),m=t(u),x=t(m),I=t(x),Ae=t(I,!0);e(I);var te=l(I,2),Fe=t(te,!0);e(te),e(x);var ae=l(x,2);ie(ae,7,()=>(a(v),d(()=>a(v).events)),(N,T)=>`${N.id??"new"}-${N.start_time}-${T}`,(N,T)=>{var j=Lt(),O=t(j),Me=t(O);ut(Me,{get item(){return a(T)},showDate:!1,get searchQuery(){return he()}}),e(O);var Pe=l(O,2);{var Ce=Q=>{var U=Ht(),H=t(U);e(U),y(()=>{C(H,"data-bs-target",`#${F??""}`),C(H,"aria-controls",F)}),oe("click",H,()=>re(a(T))),s(Q,U)};f(Pe,Q=>{a(J)&&Q(Ce)})}e(j),s(N,j)}),e(ae),e(m),e(u),y(()=>{D(Ae,(a(v),d(()=>a(v).displayDay))),D(Fe,(a(v),d(()=>a(v).displayDate)))}),s(S,u)}),s(o,p)},We=o=>{var p=Kt(),$=t(p),S=l(t($));{var v=u=>{var m=qt(),x=t(m,!0);e(m),y(()=>{Je(m,1,`ms-1 me-1 badge rounded-pill bg-color-${g(),d(()=>g().color_number)??""}`,"svelte-19k62y7"),D(x,(g(),d(()=>g().label)))}),s(u,m)};f(S,u=>{G(),g(),d(()=>G()&&g()?.label?.length)&&u(v)})}se(),e($),e(p),s(o,p)};f(X,o=>{a(ue),d(()=>a(ue).length)?o(De):o(We,!1)})}se(2),e(_),y(o=>D(P,o),[()=>d(rt)]),s(b,_)};f(_t,b=>{tt()&&b(Mt)})}var ft=l(_t,2);{var Pt=b=>{var _=Zt(),M=t(_),B=t(M),V=l(t(B),2),P=t(V,!0);e(V),e(B),e(M);var X=l(M,2);{var De=o=>{var p=ct(),$=ge(p);ie($,1,()=>a(me),ze,(S,v)=>{var u=zt(),m=t(u),x=t(m),I=t(x),Ae=t(I,!0);e(I);var te=l(I,2),Fe=t(te,!0);e(te),e(x);var ae=l(x,2);ie(ae,7,()=>(a(v),d(()=>a(v).events)),(N,T)=>`${N.id??"new"}-${N.start_time}-${T}`,(N,T)=>{var j=Xt(),O=t(j),Me=t(O);ut(Me,{get item(){return a(T)},showDate:!1,get searchQuery(){return he()}}),e(O);var Pe=l(O,2);{var Ce=Q=>{var U=Vt(),H=t(U);e(U),y(()=>{C(H,"data-bs-target",`#${F??""}`),C(H,"aria-controls",F)}),oe("click",H,()=>re(a(T))),s(Q,U)};f(Pe,Q=>{a(J)&&Q(Ce)})}e(j),s(N,j)}),e(ae),e(m),e(u),y(()=>{D(Ae,(a(v),d(()=>a(v).displayDay))),D(Fe,(a(v),d(()=>a(v).displayDate)))}),s(S,u)}),s(o,p)},We=o=>{var p=Yt(),$=t(p),S=l(t($));{var v=u=>{var m=Jt(),x=t(m,!0);e(m),y(()=>{Je(m,1,`ms-1 me-1 badge rounded-pill bg-color-${g(),d(()=>g().color_number)??""}`,"svelte-19k62y7"),D(x,(g(),d(()=>g().label)))}),s(u,m)};f(S,u=>{G(),g(),d(()=>G()&&g()?.label?.length)&&u(v)})}se(),e($),e(p),s(o,p)};f(X,o=>{a(me),d(()=>a(me).length)?o(De):o(We,!1)})}se(2),e(_),y(o=>D(P,o),[()=>d(A)]),s(b,_)};f(ft,b=>{at()&&b(Pt)})}var Ct=l(ft,2);{var St=b=>{var _=ra(),M=t(_),B=t(M),V=l(t(B),2),P=t(V,!0);e(V),e(B),e(M);var X=l(M,2);{var De=o=>{var p=ct(),$=ge(p);ie($,1,()=>a(k),ze,(S,v)=>{var u=ta(),m=t(u),x=t(m),I=t(x),Ae=t(I,!0);e(I);var te=l(I,2),Fe=t(te,!0);e(te),e(x);var ae=l(x,2);ie(ae,7,()=>(a(v),d(()=>a(v).events)),(N,T)=>`${N.id??"new"}-${N.start_time}-${T}`,(N,T)=>{var j=ea(),O=t(j),Me=t(O);ut(Me,{get item(){return a(T)},showDate:!1,get searchQuery(){return he()}}),e(O);var Pe=l(O,2);{var Ce=Q=>{var U=Gt(),H=t(U);e(U),y(()=>{C(H,"data-bs-target",`#${F??""}`),C(H,"aria-controls",F)}),oe("click",H,()=>re(a(T))),s(Q,U)};f(Pe,Q=>{a(J)&&Q(Ce)})}e(j),s(N,j)}),e(ae),e(m),e(u),y(()=>{D(Ae,(a(v),d(()=>a(v).displayDay))),D(Fe,(a(v),d(()=>a(v).displayDate)))}),s(S,u)}),s(o,p)},We=o=>{var p=sa(),$=t(p),S=l(t($));{var v=u=>{var m=aa(),x=t(m,!0);e(m),y(()=>{Je(m,1,`ms-1 me-1 badge rounded-pill bg-color-${g(),d(()=>g().color_number)??""}`,"svelte-19k62y7"),D(x,(g(),d(()=>g().label)))}),s(u,m)};f(S,u=>{G(),g(),d(()=>G()&&g()?.label?.length)&&u(v)})}se(),e($),e(p),s(o,p)};f(X,o=>{a(k),d(()=>a(k).length)?o(De):o(We,!1)})}se(2),e(_),y(o=>D(P,o),[()=>d(ce)]),s(b,_)};f(Ct,b=>{je()&&b(St)})}e(n),e(c),s(r,c)},lt=r=>{var c=la(),n=t(c);wt(n,{}),e(c),s(r,c)};f(Be,r=>{Ze()?r(nt):r(lt,!1)})}s(Ye,R),xt(),et()}var oa=i('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add announcement"><i class="bi bi-plus"></i></button>'),va=i('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit announcement"><i class="bi bi-pencil-square"></i></button>'),da=i('<li class="list-group-item"><div class="d-flex justify-content-between"><!> <div><!></div></div></li>'),ca=i('<!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li>',1),ua=i("<span> </span>"),ma=i('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> announcements</div></li>'),_a=i('<div class="d-flex flex-column gap-4"><div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center"><span>Announcements</span> <div class="d-flex align-items-center gap-2"><!> <!></div></div></div> <ul class="list-group list-group-flush"><!></ul></div></div>'),fa=i("<!> <!>",1);function Fa(Ye,ve){yt(ve,!1);const de=()=>h(he,"$currentUserHasPermission",Z),Ie=()=>h(G,"$ready",Z),be=()=>h(et,"$announcements",Z),ye=()=>h(tt,"$searchQuery",Z),Ze=()=>h(g,"$categoryFilter",Z),xe=()=>h(W,"$currentCategoryFilter",Z),[Z,Ge]=ht(),{stores:{currentUserHasPermission:he}}=Et(),{stores:{ready:G,categoryFilter:g,currentCategoryFilter:W,announcements:et,searchQuery:tt},actions:{reload:at}}=$t(),je={title:"Announcement",description:"",location:"",event_type:"announcement",is_public:!0},ee=Dt();let Ee=z(!1),Oe=z(""),Qe=z({...je});const Ue=A=>{L(Oe,"Announcement Form"),L(Qe,{...A,category:A?.meta_data?.category})};bt(async()=>{L(Ee,de()(pe.CreateEvents)||de()(pe.EditOwnOrgEvents)||de()(pe.EditAllEvents)),await at()}),kt();var He=fa(),ke=ge(He);Wt(ke,{get title(){return a(Oe)},get id(){return ee},children:(A,ce)=>{Nt(A,{get eventItem(){return a(Qe)},get drawerId(){return ee},name:"announcement-item-form"})},$$slots:{default:!0}});var st=l(ke,2);{var Le=A=>{var ce=_a(),Re=t(ce),we=t(Re),J=t(we),$e=l(t(J),2),F=t($e);Tt(F,{});var qe=l(F,2);{var Ke=k=>{var E=oa();y(()=>{C(E,"data-bs-target",`#${ee??""}`),C(E,"aria-controls",ee)}),oe("click",E,()=>Ue({...je,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),s(k,E)};f(qe,k=>{a(Ee)&&k(Ke)})}e($e),e(J),e(we);var re=l(we,2),Ne=t(re);{var ue=k=>{var E=ca(),ne=ge(E);ie(ne,1,be,ze,(_e,fe)=>{var Y=da(),R=t(Y),le=t(R);Ot(le,{get item(){return a(fe)},get searchQuery(){return ye()}});var Be=l(le,2),nt=t(Be);{var lt=r=>{var c=va();y(()=>{C(c,"data-bs-target",`#${ee??""}`),C(c,"aria-controls",ee)}),oe("click",c,()=>Ue(a(fe))),s(r,c)};f(nt,r=>{a(Ee)&&r(lt)})}e(Be),e(R),e(Y),s(_e,Y)}),se(2),s(k,E)},me=k=>{var E=ma(),ne=t(E),_e=l(t(ne));{var fe=Y=>{var R=ua(),le=t(R,!0);e(R),y(()=>{Je(R,1,`ms-1 me-1 badge rounded-pill bg-color-${xe().color_number??""}`),D(le,xe().label)}),s(Y,R)};f(_e,Y=>{Ze()&&xe()?.label?.length&&Y(fe)})}se(),e(ne),e(E),s(k,E)};f(Ne,k=>{be()?.length?k(ue):k(me,!1)})}e(re),e(Re),e(ce),s(A,ce)},rt=A=>{wt(A,{})};f(st,A=>{Ie()?A(Le):A(rt,!1)})}s(Ye,He),xt(),Ge()}export{Fa as A,Aa as E};
