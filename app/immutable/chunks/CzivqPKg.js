const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DMc808GQ.js","./DkHtKwEy.js","./DIeogL5L.js","./B190dNFg.js","./CmsKOCeN.js","./NZTpNUN0.js","./69_IOA4Y.js","./DUiJaq3B.js","./DJ88wS1R.js","./CKczAFpg.js","./DSRfHcWV.js","./DsQF7ATG.js","./UdkePjTS.js","./BUApaBEI.js","./CrhaOPk_.js","./BED0Tb20.js","../assets/Spinner.DTjfhZ6-.css","./BFNSnplj.js","./DiyZ4cS1.js","./Cf6qqcEk.js","./DO_vVYAf.js","./B2NZqfz3.js","./DoBrUMEb.js","./OOJ6Y-tm.js","./Ca8CDg5L.js","./C9XkDnnj.js","../assets/BishopricApprovalSection.BKvfNpLP.css"])))=>i.map(i=>d[i]);
import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{o as fa,w as Pa,g as ca}from"./DUiJaq3B.js";import{p as Ae,ai as D,d as t,aj as ga,f as F,a as Te,E as _,s as l,D as u,c as n,r,u as d,t as z,F as ye,i as da,R as ve,aq as Wa,w as Qt,ar as La}from"./DkHtKwEy.js";import{b as q,i as h,a as Ue,e as $t,s as ct,d as Va,p as Se,j as ja,k as za}from"./DJ88wS1R.js";import{e as re,i as Xe}from"./CKczAFpg.js";import{f as v,a as o,c as Vt,t as ue}from"./B190dNFg.js";import{s as jt,e as qa,b as Ba}from"./DSRfHcWV.js";import{i as Fe}from"./CrhaOPk_.js";import{u as Kt,v as va,w as Ha,t as Ya,d as Ze,O as Ie,P as lt,x as Qa,A as De,e as he,p as Tt,i as ut}from"./DsQF7ATG.js";import{A as ya,a as Ka,c as ba,E as Xa}from"./Dp2rDA19.js";import{g as Je,C as ha,c as Za,f as Ce,e as Ke}from"./DMc808GQ.js";import{S as Oe}from"./BED0Tb20.js";import{v as Ea,D as wa}from"./BFNSnplj.js";import{_ as Ja}from"./CmsKOCeN.js";import{P as Ga}from"./BgB8pT2-.js";import{p as tr}from"./BDT4lekt.js";import{s as er}from"./C9XkDnnj.js";import{e as be}from"./OOJ6Y-tm.js";function ua(c,s,e){const a=Kt(c,e),m=Kt(s,e),M=+a-va(a),S=+m-va(m);return Math.round((M-S)/Ha)}function ma(c){const s=Ya(c);return s.setDate(1),s.setHours(0,0,0,0),s}var ar=v('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add announcement"><i class="bi bi-plus"></i></button>'),rr=v('<div class="announcement-actions svelte-1axao39"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit announcement"><i class="bi bi-pencil-square"></i></button></div>'),nr=v('<li class="list-group-item py-2"><div class="announcement-row svelte-1axao39"><div class="announcement-content svelte-1axao39"><!></div> <!></div></li>'),sr=v('<div class="card-footer d-flex align-items-center justify-content-between"><small> </small> <button class="btn btn-primary btn-sm">More</button></div>'),or=v('<ul class="list-group list-group-flush border-top-0"></ul> <!>',1),ir=v('<div class="card-body text-muted small"><!></div>'),lr=v('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center"><span>Announcements</span> <!></div></div> <!></div>'),cr=v('<div class="d-flex flex-column gap-4"><!></div>'),dr=v("<!> <!>",1);function En(c,s){Ae(s,!1);const e=()=>q(ne,"$searchQuery",W),a=()=>q(N,"$announcements",W),m=()=>q(dt,"$currentUser",W),M=()=>q(_t,"$userOrganizations",W),S=()=>q(mt,"$currentUserHasPermission",W),f=()=>q(Z,"$currentUserIsRoot",W),I=()=>q(T,"$currentUserIsAdmin",W),B=()=>q(zt,"$ready",W),[W,R]=Ue(),X=_(),J=_(),ht=_(),{stores:{currentUser:dt,currentUserHasPermission:mt,currentUserIsAdmin:T,currentUserIsRoot:Z,userOrganizations:_t}}=Ze(),{stores:{ready:zt,announcements:N,searchQuery:ne},actions:{reload:Xt}}=Je(),se={title:"Announcement",description:"",location:"",event_type:"announcement",is_public:!0},Dt=Ea();let oe=_(!1),Ut=_(!1),qt=_(),Zt=_(!1),Jt=_(!1),Bt=_(!1),Ft=_(new Set),y=_(""),E=_({...se});const rt=5,pt=5;let G=_(rt);function U(){u(G,t(G)+pt)}const tt=k=>ba(k,{currentUserId:t(qt),isPrivileged:t(Ut),canEditOwnOrgEvents:t(Bt),userOrganizations:t(Ft)});fa(async()=>{await Xt()});const H=k=>{u(y,"Announcement Form"),u(E,{...k,category:k?.meta_data?.category})};D(()=>(e(),a(),t(G)),()=>{u(X,e()?a()??[]:(a()??[]).slice(0,t(G)))}),D(()=>(e(),a(),t(G)),()=>{u(J,!e()&&(a()?.length??0)>t(G))}),D(()=>m(),()=>{u(qt,m()?.id)}),D(()=>t(qt),()=>{u(Jt,!!t(qt))}),D(()=>M(),()=>{u(Ft,M())}),D(()=>(t(Ft),Ie),()=>{u(Zt,t(Ft).has(Ie.Bishopric))}),D(()=>(S(),lt),()=>{u(Bt,S()(lt.EditOwnOrgEvents))}),D(()=>(f(),I(),t(Zt),S(),lt),()=>{u(Ut,f()||I()||t(Zt)||S()(lt.EditAllEvents))}),D(()=>(t(Ut),S(),t(Bt),t(Jt)),()=>{u(oe,t(Ut)||S()(lt.CreateEvents)||t(Bt)||t(Jt))}),D(()=>(S(),lt),()=>{u(ht,S()(lt.DeleteEvents))}),ga(),Fe();var nt=dr(),st=F(nt);wa(st,{get title(){return t(y)},get id(){return Dt},children:(k,C)=>{ya(k,{get eventItem(){return t(E)},get drawerId(){return Dt},name:"announcement-item-form",get canDelete(){return t(ht)}})},$$slots:{default:!0}});var O=l(st,2);{var L=k=>{var C=lr(),P=n(C),ot=n(P),Ct=l(n(ot),2);{var wt=Q=>{var V=ar();z(()=>{jt(V,"data-bs-target",`#${Dt??""}`),jt(V,"aria-controls",Dt)}),$t("click",V,()=>H({...se,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),o(Q,V)};h(Ct,Q=>{t(oe)&&Q(wt)})}r(ot),r(P);var St=l(P,2);{var Rt=Q=>{var V=or(),ft=F(V);re(ft,5,()=>t(X),Xe,(w,x)=>{var j=nr(),gt=n(j),et=n(gt),i=n(et);Ka(i,{get item(){return t(x)},get searchQuery(){return e()}}),r(et);var g=l(et,2);{var $=A=>{var p=rr(),b=n(p);r(p),z(()=>{jt(b,"data-bs-target",`#${Dt??""}`),jt(b,"aria-controls",Dt)}),$t("click",b,()=>H(t(x))),o(A,p)};h(g,A=>{t(x),d(()=>tt(t(x)))&&A($)})}r(gt),r(j),o(w,j)}),r(ft);var Et=l(ft,2);{var vt=w=>{var x=sr(),j=n(x),gt=n(j);r(j);var et=l(j,2);r(x),z(()=>ct(gt,`Showing ${t(G)??""} of ${a(),d(()=>a()?.length??0)??""}`)),$t("click",et,U),o(w,x)};h(Et,w=>{t(J)&&w(vt)})}o(Q,V)},Nt=Q=>{var V=Vt(),ft=F(V);{var Et=vt=>{var w=ir(),x=n(w);{var j=et=>{var i=ue("No announcements match your search.");o(et,i)},gt=et=>{var i=ue("There are no announcements yet.");o(et,i)};h(x,et=>{e()?et(j):et(gt,!1)})}r(w),o(vt,w)};h(ft,vt=>{a(),d(()=>a()?.length===0)&&vt(Et)},!0)}o(Q,V)};h(St,Q=>{t(X),d(()=>t(X).length)?Q(Rt):Q(Nt,!1)})}r(C),o(k,C)},Y=k=>{var C=cr(),P=n(C);Oe(P,{}),r(C),o(k,C)};h(O,k=>{B()?k(L):k(Y,!1)})}o(c,nt),Te(),R()}const Ma={};for(const c of Object.values(ha))c.key&&(Ma[c.label.toLowerCase()]=c.key);const vr=new Set(Object.values(ha).map(c=>c.key).filter(Boolean));function ur(c){const s=c.trim();if(s)return vr.has(s.toUpperCase())?s.toUpperCase():Ma[s.toLowerCase()]}async function mr(c){return new Promise((s,e)=>{Ga.parse(c,{header:!0,skipEmptyLines:!0,complete:a=>{const m=a.data,M=a.meta.fields||[];s({data:m,columns:M})},error:a=>e(a)})})}function _r(c){return c.map(s=>{const e=s.toLowerCase().trim();return e==="title"||e==="event"||e==="event name"||e==="name"?{csvColumn:s,eventField:"title"}:e==="description"||e==="details"||e==="notes"?{csvColumn:s,eventField:"description"}:e==="start date"||e==="start_date"||e==="date"||e==="event date"?{csvColumn:s,eventField:"start_date"}:e==="start time"||e==="start_time"||e==="time"||e==="event time"?{csvColumn:s,eventField:"start_time"}:e==="end date"||e==="end_date"?{csvColumn:s,eventField:"end_date"}:e==="end time"||e==="end_time"?{csvColumn:s,eventField:"end_time"}:e==="location"||e==="place"||e==="venue"?{csvColumn:s,eventField:"location"}:e==="category"||e==="group"||e==="organization"||e==="org"?{csvColumn:s,eventField:"category"}:e==="all day"||e==="all_day"||e==="is_all_day"||e==="allday"?{csvColumn:s,eventField:"is_all_day"}:{csvColumn:s,eventField:null}})}function Lt(c,s,e){const a=s.find(m=>m.eventField===e);return a?(c[a.csvColumn]||"").trim():""}function _a(c){const s=["yyyy-MM-dd","MM/dd/yyyy","M/d/yyyy","MM-dd-yyyy","M-d-yyyy","MM/dd/yy","M/d/yy","yyyy/MM/dd","MMM d, yyyy","MMMM d, yyyy","MMM d yyyy","d MMM yyyy"];for(const e of s){const a=tr(c,e,new Date);if(Qa(a))return a}return null}function pa(c){const s=c.match(/^(\d{1,2}):(\d{2})$/);if(s){const a=parseInt(s[1],10),m=parseInt(s[2],10);if(a>=0&&a<=23&&m>=0&&m<=59)return{hours:a,minutes:m}}const e=c.match(/^(\d{1,2})(?::(\d{2}))?\s*(am|pm)$/i);if(e){let a=parseInt(e[1],10);const m=e[2]?parseInt(e[2],10):0,M=e[3].toLowerCase();if(a>=1&&a<=12&&m>=0&&m<=59)return M==="pm"&&a!==12&&(a+=12),M==="am"&&a===12&&(a=0),{hours:a,minutes:m}}return null}function pr(c){const s=c.toLowerCase().trim();return["true","yes","1","y","x"].includes(s)}function fr(c,s,e){const a=[],m=Lt(c,s,"title"),M=Lt(c,s,"description"),S=Lt(c,s,"start_date"),f=Lt(c,s,"start_time"),I=Lt(c,s,"end_date"),B=Lt(c,s,"end_time"),W=Lt(c,s,"location"),R=Lt(c,s,"category"),X=Lt(c,s,"is_all_day");if(!m)return a.push({row:e,field:"title",message:"Title is required"}),{event:null,errors:a};if(m.length<3)return a.push({row:e,field:"title",message:"Title must be at least 3 characters"}),{event:null,errors:a};if(m.length>255)return a.push({row:e,field:"title",message:"Title cannot exceed 255 characters"}),{event:null,errors:a};if(!S)return a.push({row:e,field:"start_date",message:"Start date is required"}),{event:null,errors:a};const J=_a(S);if(!J)return a.push({row:e,field:"start_date",message:`Invalid date format: "${S}"`}),{event:null,errors:a};const ht=X?pr(X):!f;let dt;if(!ht&&f){const N=pa(f);if(!N)return a.push({row:e,field:"start_time",message:`Invalid time format: "${f}"`}),{event:null,errors:a};J.setHours(N.hours,N.minutes,0,0),dt=Ce(J,De)}else J.setHours(0,0,0,0),dt=Ce(J,De);let mt;const T=I?_a(I):new Date(J);if(T&&!ht&&B){const N=pa(B);if(!N)return a.push({row:e,field:"end_time",message:`Invalid time format: "${B}"`}),{event:null,errors:a};T.setHours(N.hours,N.minutes,0,0),mt=Ce(T,De)}else if(!ht&&f)mt=new Date(dt.getTime()+60*60*1e3);else{const N=T||new Date(J);N.setHours(23,59,59,0),mt=Ce(N,De)}let Z;if(R&&(Z=ur(R),!Z))return a.push({row:e,field:"category",message:`Unknown category: "${R}"`}),{event:null,errors:a};if(W&&W.length>255)return a.push({row:e,field:"location",message:"Location cannot exceed 255 characters"}),{event:null,errors:a};const _t={};return Z&&(_t.category=Z),{event:{title:m,event_type:"calendar_event",start_time:dt.toISOString(),end_time:mt.toISOString(),is_all_day:ht,is_public:!0,is_published:!1,meta_data:_t,...M?{description:M}:{},...W?{location:W}:{}},errors:[]}}async function gr(c,s){const e={success:0,validationErrors:0,errors:[]},a=[];for(let f=0;f<c.length;f++){const{event:I,errors:B}=fr(c[f],s,f+1);if(B.length>0){e.validationErrors++,e.errors.push(...B);continue}I&&a.push(I)}const m=Ze(),M=m?ca(m.stores.currentUser):void 0,S=m?ca(m.stores.userOrganizations):void 0;if(M){const f=M.displayName||M.username,I=M.id,B=S?Array.from(S):[],W=new Date().toISOString();for(const R of a){const X=R.meta_data||{};f&&(X.submitted_by_name=f),I&&(X.submitted_by_user_id=I),B.length&&(X.submitted_by_organizations=B),X.submitted_at=W,R.meta_data=X}}return a.length>0&&(await Za(a),e.success=a.length),e}function yr(){const c=Pa({step:"upload",csvData:[],csvColumns:[],columnMappings:[],importResult:null});return{state:c,parseCsvFile:mr,autoDetectMappings:_r,importEvents:gr,reset:()=>c.set({step:"upload",csvData:[],csvColumns:[],columnMappings:[],importResult:null})}}var br=v(`<p class="text-muted small mb-3">Upload a CSV file to bulk-import calendar events. Need a starting point? <a href="/sample-events.csv" download="">Download sample CSV template</a>.</p> <div class="mb-3"><label for="csvFile" class="form-label">Select CSV File</label> <input type="file" class="form-control" id="csvFile" accept=".csv"/></div> <div class="alert alert-warning small mb-3 d-flex align-items-start gap-2"><i class="bi bi-info-circle mt-1"></i> <span>All imported events require <strong>bishopric approval</strong> before they appear on the
							public calendar.</span></div> <div class="alert alert-info small mb-0"><strong>Format Guide:</strong> <ul class="mb-0 mt-1"><li><strong>Required columns:</strong> Title, Date</li> <li><strong>Optional columns:</strong> Start Time, End Time, Location, Category, Description</li> <li>Dates: YYYY-MM-DD, MM/DD/YYYY, Jan 1, 2025, etc.</li> <li>Times: 7:00 PM, 19:00, etc. (omit for all-day events)</li> <li>Categories: Ward, Relief Society, Elders Quorum, Youth, Young Women, Young Men,
								Primary, etc.</li></ul></div>`,1),hr=v('<tr><td> </td><td><select class="form-select form-select-sm"><option>-- Skip --</option><option>Title</option><option>Description</option><option>Start Date</option><option>Start Time</option><option>End Date</option><option>End Time</option><option>Location</option><option>Category</option><option>All Day</option></select></td></tr>'),Er=v('<h6>Map CSV Columns to Event Fields</h6> <p class="text-muted"> </p> <table class="table table-sm"><thead><tr><th>CSV Column</th><th>Maps To</th></tr></thead><tbody></tbody></table>',1),wr=v('<div class="text-center py-5"><!> <p class="mt-3">Importing events...</p></div>'),Mr=v("<li><strong> </strong> rows had validation errors</li>"),kr=v(`<div class="alert alert-info small">Imported events are <strong>unpublished</strong> and will need bishopric approval before
							they appear on the public calendar.</div>`),xr=v("<li> </li>"),$r=v("<li><em> </em></li>"),Dr=v('<div class="alert alert-warning"><h6>Validation Errors:</h6> <ul class="mb-0" style="max-height: 200px; overflow-y: auto;"><!> <!></ul></div>'),Cr=v('<div class="alert alert-success"><h6>Import Complete</h6> <ul class="mb-0"><li><strong> </strong> events imported successfully</li> <!></ul></div> <!> <!>',1),Sr=v('<button type="button" class="btn btn-secondary">Cancel</button>'),Ir=v('<button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-primary"> </button>',1),Or=v('<button type="button" class="btn btn-secondary" disabled>Cancel</button> <button type="button" class="btn btn-primary" disabled><!> Importing...</button>',1),Ar=v('<button type="button" class="btn btn-primary">Done</button>'),Tr=v('<div class="modal-backdrop fade show"></div>'),Ur=v('<div tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Import Events from CSV</h5> <button type="button" class="btn-close" aria-label="Close import modal"></button></div> <div class="modal-body"><!></div> <div class="modal-footer"><!></div></div></div></div> <!>',1);function Fr(c,s){Ae(s,!1);const e=()=>q(I,"$state",a),[a,m]=Ue();let M=Se(s,"isOpen",8,!1),S=Se(s,"onClose",8),f=Se(s,"onComplete",8);const{state:I,parseCsvFile:B,autoDetectMappings:W,importEvents:R,reset:X}=yr();async function J(y){const E=y.target.files?.[0];if(E)try{const{data:rt,columns:pt}=await B(E),G=W(pt);I.update(U=>({...U,step:"mapping",csvData:rt,csvColumns:pt,columnMappings:G}))}catch(rt){console.error("Failed to parse CSV:",rt),alert("Failed to parse CSV file. Please check the file format.")}}async function ht(){I.update(y=>({...y,step:"importing"}));try{const y=await R(e().csvData,e().columnMappings);I.update(E=>({...E,step:"complete",importResult:y})),f()()}catch(y){console.error("Failed to import events:",y),alert("Failed to import events. Please try again."),I.update(E=>({...E,step:"mapping"}))}}function dt(){X(),S()()}Fe();var mt=Ur(),T=F(mt);let Z;var _t=n(T),zt=n(_t),N=n(zt),ne=l(n(N),2);ne.__click=dt,r(N);var Xt=l(N,2),se=n(Xt);{var Dt=y=>{var E=br(),rt=l(F(E),2),pt=l(n(rt),2);pt.__change=J,r(rt),ye(4),o(y,E)},oe=y=>{var E=Vt(),rt=F(E);{var pt=U=>{var tt=Er(),H=l(F(tt),2),nt=n(H);r(H);var st=l(H,2),O=l(n(st));re(O,5,()=>(e(),d(()=>e().columnMappings)),Xe,(L,Y,k)=>{var C=hr(),P=n(C),ot=n(P,!0);r(P);var Ct=l(P),wt=n(Ct);z(()=>{t(Y),da(()=>{})});var St=n(wt);St.value=(St.__value=null)??"";var Rt=l(St);Rt.value=Rt.__value="title";var Nt=l(Rt);Nt.value=Nt.__value="description";var Q=l(Nt);Q.value=Q.__value="start_date";var V=l(Q);V.value=V.__value="start_time";var ft=l(V);ft.value=ft.__value="end_date";var Et=l(ft);Et.value=Et.__value="end_time";var vt=l(Et);vt.value=vt.__value="location";var w=l(vt);w.value=w.__value="category";var x=l(w);x.value=x.__value="is_all_day",r(wt),r(Ct),r(C),z(()=>ct(ot,(t(Y),d(()=>t(Y).csvColumn)))),Ba(wt,()=>t(Y).eventField,j=>(t(Y).eventField=j,da(()=>e()),ja(a,"$state"))),o(L,C)}),r(O),r(st),z(()=>ct(nt,`Found ${e(),d(()=>e().csvData.length)??""} rows in CSV`)),o(U,tt)},G=U=>{var tt=Vt(),H=F(tt);{var nt=O=>{var L=wr(),Y=n(L);Oe(Y,{}),ye(2),r(L),o(O,L)},st=O=>{var L=Vt(),Y=F(L);{var k=C=>{var P=Cr(),ot=F(P),Ct=l(n(ot),2),wt=n(Ct),St=n(wt),Rt=n(St,!0);r(St),ye(),r(wt);var Nt=l(wt,2);{var Q=w=>{var x=Mr(),j=n(x),gt=n(j,!0);r(j),ye(),r(x),z(()=>ct(gt,(e(),d(()=>e().importResult.validationErrors)))),o(w,x)};h(Nt,w=>{e(),d(()=>e().importResult?.validationErrors&&e().importResult.validationErrors>0)&&w(Q)})}r(Ct),r(ot);var V=l(ot,2);{var ft=w=>{var x=kr();o(w,x)};h(V,w=>{e(),d(()=>e().importResult?.success&&e().importResult.success>0)&&w(ft)})}var Et=l(V,2);{var vt=w=>{var x=Dr(),j=l(n(x),2),gt=n(j);re(gt,1,()=>(e(),d(()=>e().importResult.errors.slice(0,10))),Xe,(g,$)=>{var A=xr(),p=n(A);r(A),z(()=>ct(p,`Row ${t($),d(()=>t($).row)??""}: ${t($),d(()=>t($).message)??""}`)),o(g,A)});var et=l(gt,2);{var i=g=>{var $=$r(),A=n($),p=n(A);r(A),r($),z(()=>ct(p,`... and ${e(),d(()=>e().importResult.errors.length-10)??""} more errors`)),o(g,$)};h(et,g=>{e(),d(()=>e().importResult.errors.length>10)&&g(i)})}r(j),r(x),o(w,x)};h(Et,w=>{e(),d(()=>e().importResult?.errors&&e().importResult.errors.length>0)&&w(vt)})}z(()=>ct(Rt,(e(),d(()=>e().importResult?.success||0)))),o(C,P)};h(Y,C=>{e(),d(()=>e().step==="complete")&&C(k)},!0)}o(O,L)};h(H,O=>{e(),d(()=>e().step==="importing")?O(nt):O(st,!1)},!0)}o(U,tt)};h(rt,U=>{e(),d(()=>e().step==="mapping")?U(pt):U(G,!1)},!0)}o(y,E)};h(se,y=>{e(),d(()=>e().step==="upload")?y(Dt):y(oe,!1)})}r(Xt);var Ut=l(Xt,2),qt=n(Ut);{var Zt=y=>{var E=Sr();E.__click=dt,o(y,E)},Jt=y=>{var E=Vt(),rt=F(E);{var pt=U=>{var tt=Ir(),H=F(tt);H.__click=dt;var nt=l(H,2);nt.__click=ht;var st=n(nt);r(nt),z(()=>ct(st,`Import ${e(),d(()=>e().csvData.length)??""} Events`)),o(U,tt)},G=U=>{var tt=Vt(),H=F(tt);{var nt=O=>{var L=Or(),Y=l(F(L),2),k=n(Y);Oe(k,{size:"sm"}),ye(),r(Y),o(O,L)},st=O=>{var L=Vt(),Y=F(L);{var k=C=>{var P=Ar();P.__click=dt,o(C,P)};h(Y,C=>{e(),d(()=>e().step==="complete")&&C(k)},!0)}o(O,L)};h(H,O=>{e(),d(()=>e().step==="importing")?O(nt):O(st,!1)},!0)}o(U,tt)};h(rt,U=>{e(),d(()=>e().step==="mapping")?U(pt):U(G,!1)},!0)}o(y,E)};h(qt,y=>{e(),d(()=>e().step==="upload")?y(Zt):y(Jt,!1)})}r(Ut),r(zt),r(_t),r(T);var Bt=l(T,2);{var Ft=y=>{var E=Tr();o(y,E)};h(Bt,y=>{M()&&y(Ft)})}z(()=>{Z=he(T,1,"modal fade",null,Z,{show:M()}),qa(T,`display: ${M()?"block":"none"}`)}),o(c,mt),Te(),m()}Va(["click","change"]);var Rr=v('<button class="btn btn-sm btn-outline-secondary flex-shrink-0"><i></i> </button>');function Nr(c,s){Ae(s,!1);const e=()=>q(M,"$weeksExpanded",a),[a,m]=Ue(),{stores:{weeksExpanded:M}}=Je();function S(){za(M,!e())}Fe();var f=Rr(),I=n(f),B=l(I);r(f),z(()=>{he(I,1,`bi ${e()?"bi-chevron-up":"bi-chevron-down"}`),ct(B,` ${e()?"Collapse All":"Expand All"}`)}),$t("click",f,S),o(c,f),Te(),m()}var Pr=v('<div class="dropdown"><button class="btn btn-sm btn-primary dropdown-toggle" type="button" id="addEventDropdown" data-bs-toggle="dropdown" aria-label="Add event actions" aria-expanded="false"><i class="bi bi-plus"></i></button> <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="addEventDropdown"><li><button class="dropdown-item" type="button" data-bs-toggle="offcanvas"><i class="bi bi-calendar-plus me-2"></i>Create Event</button></li> <li><button class="dropdown-item" type="button"><i class="bi bi-file-earmark-arrow-up me-2"></i>Import CSV</button></li></ul></div>'),Wr=v('<div class="event-actions svelte-i4p9jq"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),Lr=v('<div class="daily-event-row svelte-i4p9jq"><div class="event-content svelte-i4p9jq"><!></div> <!></div>'),Vr=v('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-i4p9jq"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),jr=v('<li class="list-group-item py-3 text-muted">No events scheduled this week.</li>'),zr=v('<li class="list-group-item list-group-item-light text-uppercase small fw-lighter p-0"><button><span class="d-flex align-items-center gap-2"><i></i> <span class="text-muted"> </span></span> <span> </span></button></li> <!>',1),qr=v('<li class="list-group-item bg-secondary text-white fw-semibold"> </li> <!>',1),Br=v('<ul class="list-group list-group-flush border-top-0"></ul>'),Hr=v('<div class="card-body text-muted small"><!></div>'),Yr=v('<button class="btn btn-outline-secondary btn-sm">Reset</button>'),Qr=v('<div class="d-flex gap-2"><button class="btn btn-primary btn-sm">More</button> <button class="btn btn-outline-primary btn-sm">All</button></div>'),Kr=v('<div class="card-footer d-flex align-items-center justify-content-between"><small> </small> <!></div>'),Xr=v("<!> <!>",1),Zr=v('<div class="card-body text-muted small"><!></div>'),Jr=v('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center"><span>Events</span> <div class="d-flex align-items-center gap-2"><!> <!></div></div></div> <!></div>'),Gr=v('<div class="d-flex flex-column gap-4"><!></div>'),tn=v("<!> <!> <!>",1);function wn(c,s){Ae(s,!1);const e=()=>q(Jt,"$weeksExpanded",R),a=()=>q(Bt,"$searchQuery",R),m=()=>q(Zt,"$calendarEvents",R),M=()=>q(Xt,"$currentUser",R),S=()=>q(Ut,"$userOrganizations",R),f=()=>q(se,"$currentUserHasPermission",R),I=()=>q(oe,"$currentUserIsRoot",R),B=()=>q(Dt,"$currentUserIsAdmin",R),W=()=>q(qt,"$ready",R),[R,X]=Ue(),J=_(),ht=_(),dt=_(),mt=_(),T=_(),Z=_(),_t=_(),zt=_(),N=_(),ne=_(),{stores:{currentUser:Xt,currentUserHasPermission:se,currentUserIsAdmin:Dt,currentUserIsRoot:oe,userOrganizations:Ut}}=Ze(),{stores:{ready:qt,calendarEvents:Zt,weeksExpanded:Jt,searchQuery:Bt},actions:{reload:Ft}}=Je(),y={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0};let E=Se(s,"formId",24,Ea),rt=_(!1),pt=_(!1),G=_(),U=_(!1),tt=_(!1),H=_(new Set),nt=_(""),st=_({...y}),O=_(!1);const L=8,Y=8;let k=_(L),C=_(!1);const P=er();let ot=_({});function Ct(i){return i===t(ht)||i===t(dt)}function wt(i){const g=t(ot)[i]??Ct(i);u(ot,{...t(ot),[i]:!g})}const St=i=>{const g=new Map;for(const p of i){if(!p.start_time)continue;const b=Tt(p.start_time);if(Number.isNaN(b.getTime()))continue;const K=Kt(b,{weekStartsOn:1}),It=be(b,{weekStartsOn:1}),Mt=ut(K,"yyyy-MM-dd"),ie=`${ut(K,"MMM d")} – ${ut(It,"MMM d")}`;let Pt=g.get(Mt);Pt||(Pt={key:Mt,label:ie,days:new Map},g.set(Mt,Pt));const at=ut(b,"yyyy-MM-dd");let it=Pt.days.get(at);it||(it={key:at,displayDay:ut(b,"EEE"),displayDate:ut(b,"MMM d"),events:[]},Pt.days.set(at,it)),it.events.push(p)}const $=p=>{const b=ut(p,"yyyy-MM-dd");g.has(b)||g.set(b,{key:b,label:`${ut(p,"MMM d")} – ${ut(be(p,{weekStartsOn:1}),"MMM d")}`,days:new Map})},A=Array.from(g.values());if(A.length){const p=A.reduce((It,Mt)=>Mt.key>It?Mt.key:It,A[0].key),b=Tt(p);let K=Kt(new Date,{weekStartsOn:1});if(K>b)$(K);else for(;K<=b;)$(K),K=Ke(K,1)}return Array.from(g.values()).sort((p,b)=>p.key<b.key?-1:p.key>b.key?1:0).map(p=>({key:p.key,label:p.label,days:Array.from(p.days.values()).sort((b,K)=>b.key<K.key?-1:b.key>K.key?1:0).map(b=>({...b,events:b.events.slice().sort((K,It)=>{const Mt=K.is_all_day?0:1,ie=It.is_all_day?0:1;if(Mt!==ie)return Mt-ie;const Pt=K.start_time?Tt(K.start_time).getTime():Number.MAX_SAFE_INTEGER,at=It.start_time?Tt(It.start_time).getTime():Number.MAX_SAFE_INTEGER;return Pt-at})}))}))};function Rt(){u(k,t(k)+Y)}function Nt(){u(k,520),u(C,!0)}function Q(){u(k,L),u(C,!1)}const V=i=>ba(i,{currentUserId:t(G),isPrivileged:t(pt),canEditOwnOrgEvents:t(tt),userOrganizations:t(H)});function ft(){Ft()}fa(async()=>{await Ft()});const Et=async i=>{if(u(nt,"Item Form"),i?.meta_data?.recurring_instance&&i?.meta_data?.recurring_parent_id){const{getCalendarEvent:g}=await Ja(async()=>{const{getCalendarEvent:A}=await import("./DMc808GQ.js").then(p=>p.x);return{getCalendarEvent:A}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url),$=await g(i.meta_data.recurring_parent_id);if($){u(st,{...$,category:$?.meta_data?.category,start_time:i.start_time,end_time:i.end_time,meta_data:{...$.meta_data,recurring_instance:!0,recurring_parent_id:i.meta_data.recurring_parent_id,recurring_instance_index:i.meta_data.recurring_instance_index}});return}}u(st,{...i,category:i?.meta_data?.category})};D(()=>t(k),()=>{u(J,Ke(P,t(k)))}),D(()=>Kt,()=>{u(ht,ut(Kt(P,{weekStartsOn:1}),"yyyy-MM-dd"))}),D(()=>Kt,()=>{u(dt,ut(Ke(Kt(P,{weekStartsOn:1}),1),"yyyy-MM-dd"))}),D(()=>(e(),a(),t(ot)),()=>{u(mt,i=>e()||a()?!0:t(ot)[i]!==void 0?t(ot)[i]:Ct(i))}),D(()=>(m(),Tt),()=>{u(T,(m()??[]).filter(i=>i.start_time?Tt(i.start_time)>=P:!1))}),D(()=>(a(),t(T),t(J)),()=>{u(Z,a()?t(T):t(T).filter(i=>Tt(i.start_time)<=t(J)))}),D(()=>t(Z),()=>{u(_t,St(t(Z)))}),D(()=>(a(),t(T),t(Z)),()=>{u(zt,!a()&&t(T).length>t(Z).length)}),D(()=>(t(_t),ut),()=>{u(N,t(_t).reduce((i,g)=>{const $=Tt(g.key),A=be($,{weekStartsOn:1}),p=ut(A,"yyyy-MM"),b=ut(A,"MMMM yyyy");return i[p]||(i[p]={label:b,weeks:[]}),i[p].weeks.push(g),i},{}))}),D(()=>M(),()=>{u(G,M()?.id)}),D(()=>S(),()=>{u(H,S())}),D(()=>(t(H),Ie),()=>{u(U,t(H).has(Ie.Bishopric))}),D(()=>(f(),lt),()=>{u(tt,f()(lt.EditOwnOrgEvents))}),D(()=>(I(),B(),t(U),f(),lt),()=>{u(pt,I()||B()||t(U)||f()(lt.EditAllEvents))}),D(()=>(f(),lt),()=>{u(rt,f()(lt.CreateEvents))}),D(()=>(f(),lt),()=>{u(ne,f()(lt.DeleteEvents))}),ga(),Fe();var vt=tn(),w=F(vt);wa(w,{get title(){return t(nt)},get id(){return E()},children:(i,g)=>{ya(i,{get eventItem(){return t(st)},get drawerId(){return E()},name:"event-item-form",get canDelete(){return t(ne)}})},$$slots:{default:!0}});var x=l(w,2);Fr(x,{get isOpen(){return t(O)},onClose:()=>u(O,!1),onComplete:ft});var j=l(x,2);{var gt=i=>{var g=Jr(),$=n(g),A=n($),p=l(n(A),2),b=n(p);Nr(b,{});var K=l(b,2);{var It=at=>{var it=Pr(),Gt=l(n(it),2),te=n(Gt),ee=n(te);r(te);var kt=l(te,2),ae=n(kt);r(kt),r(Gt),r(it),z(()=>{jt(ee,"data-bs-target",`#${E()??""}`),jt(ee,"aria-controls",E())}),$t("click",ee,()=>Et({...y,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),$t("click",ae,()=>u(O,!0)),o(at,it)};h(K,at=>{t(rt)&&at(It)})}r(p),r(A),r($);var Mt=l($,2);{var ie=at=>{var it=Xr(),Gt=F(it);{var te=Ot=>{var xt=Br();re(xt,5,()=>(t(N),d(()=>Object.entries(t(N)))),([Wt,le])=>Wt,(Wt,le)=>{var me=Wa(()=>La(t(le),2));let yt=()=>t(me)[1];var Ht=qr(),At=F(Ht),Yt=n(At,!0);r(At);var Ee=l(At,2);re(Ee,1,()=>(yt(),d(()=>yt().weeks)),_e=>_e.key,(_e,bt)=>{const Ge=ve(()=>(Qt(Tt),t(bt),d(()=>Tt(t(bt).key)))),we=ve(()=>(Qt(be),Qt(t(Ge)),d(()=>be(t(Ge),{weekStartsOn:1})))),ta=ve(()=>(Qt(ma),Qt(t(we)),d(()=>ma(t(we))))),ka=ve(()=>(Qt(ua),Qt(t(we)),Qt(t(ta)),d(()=>ua(t(we),t(ta),{weekStartsOn:1})+1))),Re=ve(()=>(t(mt),t(bt),d(()=>t(mt)(t(bt).key)))),Me=ve(()=>(t(bt),d(()=>t(bt).days.reduce((fe,ke)=>fe+ke.events.length,0))));var ea=zr(),Ne=F(ea),pe=n(Ne);let aa;var Pe=n(pe),ra=n(Pe),na=l(ra,2),xa=n(na);r(na),r(Pe);var We=l(Pe,2);let sa;var $a=n(We,!0);r(We),r(pe),r(Ne);var Da=l(Ne,2);{var Ca=fe=>{var ke=Vt(),Sa=F(ke);{var Ia=ce=>{var xe=Vt(),Aa=F(xe);re(Aa,1,()=>(t(bt),d(()=>t(bt).days)),Le=>Le.key,(Le,de)=>{var Ve=Vr(),oa=n(Ve),je=n(oa),ze=n(je),Ta=n(ze,!0);r(ze);var ia=l(ze,2),Ua=n(ia,!0);r(ia),r(je);var la=l(je,2);re(la,5,()=>(t(de),d(()=>t(de).events)),ge=>ge.id??`${ge.start_time}-${ge.meta_data?.recurring_instance_index??0}`,(ge,$e)=>{var qe=Lr(),Be=n(qe),Fa=n(Be);Xa(Fa,{get item(){return t($e)},showDate:!1,get searchQuery(){return a()}}),r(Be);var Ra=l(Be,2);{var Na=He=>{var Ye=Wr(),Qe=n(Ye);r(Ye),z(()=>{jt(Qe,"data-bs-target",`#${E()??""}`),jt(Qe,"aria-controls",E())}),$t("click",Qe,()=>Et(t($e))),o(He,Ye)};h(Ra,He=>{t($e),d(()=>V(t($e)))&&He(Na)})}r(qe),o(ge,qe)}),r(la),r(oa),r(Ve),z(()=>{ct(Ta,(t(de),d(()=>t(de).displayDay))),ct(Ua,(t(de),d(()=>t(de).displayDate)))}),o(Le,Ve)}),o(ce,xe)},Oa=ce=>{var xe=jr();o(ce,xe)};h(Sa,ce=>{t(bt),d(()=>t(bt).days.length)?ce(Ia):ce(Oa,!1)})}o(fe,ke)};h(Da,fe=>{t(Re)&&fe(Ca)})}z(()=>{aa=he(pe,1,"week-header w-100 d-flex justify-content-between align-items-center border-0 bg-transparent p-2 text-start svelte-i4p9jq",null,aa,{"text-muted":t(Me)===0}),jt(pe,"title",t(Re)?"Click to collapse week":"Click to expand week"),he(ra,1,`bi ${t(Re)?"bi-chevron-up":"bi-chevron-down"}`),ct(xa,`Week ${t(ka)??""} [${t(Me)??""} Event${t(Me)===1?"":"s"}]`),sa=he(We,1,"",null,sa,{"opacity-50":t(Me)===0}),ct($a,(t(bt),d(()=>t(bt).label)))}),$t("click",pe,()=>wt(t(bt).key)),o(_e,ea)}),z(()=>ct(Yt,(yt(),d(()=>yt().label)))),o(Wt,Ht)}),r(xt),o(Ot,xt)},ee=Ot=>{var xt=Hr(),Wt=n(xt);{var le=yt=>{var Ht=ue("No events match your search.");o(yt,Ht)},me=yt=>{var Ht=ue("There are no upcoming events this month.");o(yt,Ht)};h(Wt,yt=>{a()?yt(le):yt(me,!1)})}r(xt),o(Ot,xt)};h(Gt,Ot=>{t(_t),d(()=>t(_t).length)?Ot(te):Ot(ee,!1)})}var kt=l(Gt,2);{var ae=Ot=>{var xt=Kr(),Wt=n(xt),le=n(Wt);r(Wt);var me=l(Wt,2);{var yt=At=>{var Yt=Yr();$t("click",Yt,Q),o(At,Yt)},Ht=At=>{var Yt=Qr(),Ee=n(Yt),_e=l(Ee,2);r(Yt),$t("click",Ee,Rt),$t("click",_e,Nt),o(At,Yt)};h(me,At=>{t(C)?At(yt):At(Ht,!1)})}r(xt),z(()=>ct(le,`Showing ${t(Z),d(()=>t(Z).length)??""} of ${t(T),d(()=>t(T).length)??""} future events`)),o(Ot,xt)};h(kt,Ot=>{(t(zt)||t(C))&&Ot(ae)})}o(at,it)},Pt=at=>{var it=Zr(),Gt=n(it);{var te=kt=>{var ae=ue("No events match your search.");o(kt,ae)},ee=kt=>{var ae=ue("There are no upcoming events scheduled.");o(kt,ae)};h(Gt,kt=>{a()?kt(te):kt(ee,!1)})}r(it),o(at,it)};h(Mt,at=>{m(),d(()=>m()?.length)?at(ie):at(Pt,!1)})}r(g),o(i,g)},et=i=>{var g=Gr(),$=n(g);Oe($,{}),r(g),o(i,g)};h(j,i=>{W()?i(gt):i(et,!1)})}o(c,vt),Te(),X()}export{En as A,wn as E,ua as d,ma as s};
