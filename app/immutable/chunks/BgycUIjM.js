const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BDrIpSzK.js","./CPOcesE7.js","./DIeogL5L.js","./YsHTGu5k.js","./NZTpNUN0.js","./69_IOA4Y.js","./DHXte27T.js","./opPvMm1W.js","./DAwrR-3T.js","./DaR1hxxh.js","./Bn9b25fh.js","./C7YoSwyH.js","./BUApaBEI.js","./C2Q_9cr2.js","./BsnDzLp8.js","../assets/Spinner.DTjfhZ6-.css","./QDlYjqxz.js","./DLuN8Kcu.js","./XOESS4D6.js","./HBi00i7Z.js","../assets/BishopricApprovalSection.7XL7-u-1.css"])))=>i.map(i=>d[i]);
import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{o as pa,w as Pa,g as la}from"./DHXte27T.js";import{p as Ye,ai as x,g as t,aj as fa,f as U,a as Qe,E as m,s as l,D as u,c as n,r,u as d,t as Y,F as ye,i as ca,R as ve,an as Wa,w as Qt,ao as La}from"./CPOcesE7.js";import{b as Q,i as b,a as Ke,e as Tt,s as ut,d as Va,p as $e,j as ja}from"./opPvMm1W.js";import{e as re,i as He}from"./DAwrR-3T.js";import{f as v,a as s,c as Vt,t as ue}from"./YsHTGu5k.js";import{s as jt,e as za,b as qa}from"./DaR1hxxh.js";import{i as Xe}from"./C2Q_9cr2.js";import{o as Kt,q as da,u as Ba,t as Ha,g as Ze,O as Ie,P as lt,v as Ya,A as xe,c as Se,p as At,f as vt}from"./Bn9b25fh.js";import{A as ga,b as Qa,c as ya,p as Ka,a as Xa,E as Za}from"./CICf0WsW.js";import{g as ba,C as ha,c as Ja,f as Ce,e as Be,i as be}from"./BDrIpSzK.js";import{S as Oe}from"./BsnDzLp8.js";import{v as Ea,D as Ma}from"./DB4Rx7xY.js";import{_ as Ga}from"./CmsKOCeN.js";import{P as tr}from"./BgB8pT2-.js";import{s as er}from"./HBi00i7Z.js";function va(c,o,e){const a=Kt(c,e),_=Kt(o,e),$=+a-da(a),S=+_-da(_);return Math.round(($-S)/Ba)}function ua(c){const o=Ha(c);return o.setDate(1),o.setHours(0,0,0,0),o}var ar=v('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add announcement"><i class="bi bi-plus"></i></button>'),rr=v('<div class="announcement-actions svelte-1axao39"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit announcement"><i class="bi bi-pencil-square"></i></button></div>'),nr=v('<li class="list-group-item py-2"><div class="announcement-row svelte-1axao39"><div class="announcement-content svelte-1axao39"><!></div> <!></div></li>'),sr=v('<div class="card-footer d-flex align-items-center justify-content-between"><small> </small> <button class="btn btn-primary btn-sm">More</button></div>'),or=v('<ul class="list-group list-group-flush border-top-0"></ul> <!>',1),ir=v('<div class="card-body text-muted small"><!></div>'),lr=v('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center"><span>Announcements</span> <!></div></div> <!></div>'),cr=v('<div class="d-flex flex-column gap-4"><!></div>'),dr=v("<!> <!>",1);function gn(c,o){Ye(o,!1);const e=()=>Q(ne,"$searchQuery",W),a=()=>Q(N,"$announcements",W),_=()=>Q(ct,"$currentUser",W),$=()=>Q(_t,"$userOrganizations",W),S=()=>Q(mt,"$currentUserHasPermission",W),M=()=>Q(X,"$currentUserIsRoot",W),F=()=>Q(A,"$currentUserIsAdmin",W),Z=()=>Q(zt,"$ready",W),[W,R]=Ke(),K=m(),J=m(),ht=m(),{stores:{currentUser:ct,currentUserHasPermission:mt,currentUserIsAdmin:A,currentUserIsRoot:X,userOrganizations:_t}}=Ze(),{stores:{ready:zt,announcements:N,searchQuery:ne},actions:{reload:Xt}}=ba(),se={title:"Announcement",description:"",location:"",event_type:"announcement",is_public:!0},xt=Ea();let oe=m(!1),Ut=m(!1),qt=m(),Zt=m(!1),Jt=m(!1),Bt=m(!1),Ft=m(new Set),g=m(""),h=m({...se});const rt=5,pt=5;let G=m(rt);function T(){u(G,t(G)+pt)}const tt=w=>ya(w,{currentUserId:t(qt),isPrivileged:t(Ut),canEditOwnOrgEvents:t(Bt),userOrganizations:t(Ft)});pa(async()=>{await Xt()});const z=w=>{u(g,"Announcement Form"),u(h,{...w,category:w?.meta_data?.category})};x(()=>(e(),a(),t(G)),()=>{u(K,e()?a()??[]:(a()??[]).slice(0,t(G)))}),x(()=>(e(),a(),t(G)),()=>{u(J,!e()&&(a()?.length??0)>t(G))}),x(()=>_(),()=>{u(qt,_()?.id)}),x(()=>t(qt),()=>{u(Jt,!!t(qt))}),x(()=>$(),()=>{u(Ft,$())}),x(()=>(t(Ft),Ie),()=>{u(Zt,t(Ft).has(Ie.Bishopric))}),x(()=>(S(),lt),()=>{u(Bt,S()(lt.EditOwnOrgEvents))}),x(()=>(M(),F(),t(Zt),S(),lt),()=>{u(Ut,M()||F()||t(Zt)||S()(lt.EditAllEvents))}),x(()=>(t(Ut),S(),t(Bt),t(Jt)),()=>{u(oe,t(Ut)||S()(lt.CreateEvents)||t(Bt)||t(Jt))}),x(()=>(S(),lt),()=>{u(ht,S()(lt.DeleteEvents))}),fa(),Xe();var nt=dr(),st=U(nt);Ma(st,{get title(){return t(g)},get id(){return xt},children:(w,C)=>{ga(w,{get eventItem(){return t(h)},get drawerId(){return xt},name:"announcement-item-form",get canDelete(){return t(ht)}})},$$slots:{default:!0}});var I=l(st,2);{var L=w=>{var C=lr(),P=n(C),ot=n(P),Ct=l(n(ot),2);{var Mt=B=>{var V=ar();Y(()=>{jt(V,"data-bs-target",`#${xt??""}`),jt(V,"aria-controls",xt)}),Tt("click",V,()=>z({...se,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),s(B,V)};b(Ct,B=>{t(oe)&&B(Mt)})}r(ot),r(P);var $t=l(P,2);{var Rt=B=>{var V=or(),ft=U(V);re(ft,5,()=>t(K),He,(E,k)=>{var j=nr(),gt=n(j),et=n(gt),i=n(et);Qa(i,{get item(){return t(k)},get searchQuery(){return e()}}),r(et);var f=l(et,2);{var D=O=>{var p=rr(),y=n(p);r(p),Y(()=>{jt(y,"data-bs-target",`#${xt??""}`),jt(y,"aria-controls",xt)}),Tt("click",y,()=>z(t(k))),s(O,p)};b(f,O=>{t(k),d(()=>tt(t(k)))&&O(D)})}r(gt),r(j),s(E,j)}),r(ft);var Et=l(ft,2);{var dt=E=>{var k=sr(),j=n(k),gt=n(j);r(j);var et=l(j,2);r(k),Y(()=>ut(gt,`Showing ${t(G)??""} of ${a(),d(()=>a()?.length??0)??""}`)),Tt("click",et,T),s(E,k)};b(Et,E=>{t(J)&&E(dt)})}s(B,V)},Nt=B=>{var V=Vt(),ft=U(V);{var Et=dt=>{var E=ir(),k=n(E);{var j=et=>{var i=ue("No announcements match your search.");s(et,i)},gt=et=>{var i=ue("There are no announcements yet.");s(et,i)};b(k,et=>{e()?et(j):et(gt,!1)})}r(E),s(dt,E)};b(ft,dt=>{a(),d(()=>a()?.length===0)&&dt(Et)},!0)}s(B,V)};b($t,B=>{t(K),d(()=>t(K).length)?B(Rt):B(Nt,!1)})}r(C),s(w,C)},q=w=>{var C=cr(),P=n(C);Oe(P,{}),r(C),s(w,C)};b(I,w=>{Z()?w(L):w(q,!1)})}s(c,nt),Qe(),R()}const wa={};for(const c of Object.values(ha))c.key&&(wa[c.label.toLowerCase()]=c.key);const vr=new Set(Object.values(ha).map(c=>c.key).filter(Boolean));function ur(c){const o=c.trim();if(o)return vr.has(o.toUpperCase())?o.toUpperCase():wa[o.toLowerCase()]}async function mr(c){return new Promise((o,e)=>{tr.parse(c,{header:!0,skipEmptyLines:!0,complete:a=>{const _=a.data,$=a.meta.fields||[];o({data:_,columns:$})},error:a=>e(a)})})}function _r(c){return c.map(o=>{const e=o.toLowerCase().trim();return e==="title"||e==="event"||e==="event name"||e==="name"?{csvColumn:o,eventField:"title"}:e==="description"||e==="details"||e==="notes"?{csvColumn:o,eventField:"description"}:e==="start date"||e==="start_date"||e==="date"||e==="event date"?{csvColumn:o,eventField:"start_date"}:e==="start time"||e==="start_time"||e==="time"||e==="event time"?{csvColumn:o,eventField:"start_time"}:e==="end date"||e==="end_date"?{csvColumn:o,eventField:"end_date"}:e==="end time"||e==="end_time"?{csvColumn:o,eventField:"end_time"}:e==="location"||e==="place"||e==="venue"?{csvColumn:o,eventField:"location"}:e==="category"||e==="group"||e==="organization"||e==="org"?{csvColumn:o,eventField:"category"}:e==="all day"||e==="all_day"||e==="is_all_day"||e==="allday"?{csvColumn:o,eventField:"is_all_day"}:{csvColumn:o,eventField:null}})}function Lt(c,o,e){const a=o.find(_=>_.eventField===e);return a?(c[a.csvColumn]||"").trim():""}function ma(c){const o=["yyyy-MM-dd","MM/dd/yyyy","M/d/yyyy","MM-dd-yyyy","M-d-yyyy","MM/dd/yy","M/d/yy","yyyy/MM/dd","MMM d, yyyy","MMMM d, yyyy","MMM d yyyy","d MMM yyyy"];for(const e of o){const a=Ka(c,e,new Date);if(Ya(a))return a}return null}function _a(c){const o=c.match(/^(\d{1,2}):(\d{2})$/);if(o){const a=parseInt(o[1],10),_=parseInt(o[2],10);if(a>=0&&a<=23&&_>=0&&_<=59)return{hours:a,minutes:_}}const e=c.match(/^(\d{1,2})(?::(\d{2}))?\s*(am|pm)$/i);if(e){let a=parseInt(e[1],10);const _=e[2]?parseInt(e[2],10):0,$=e[3].toLowerCase();if(a>=1&&a<=12&&_>=0&&_<=59)return $==="pm"&&a!==12&&(a+=12),$==="am"&&a===12&&(a=0),{hours:a,minutes:_}}return null}function pr(c){const o=c.toLowerCase().trim();return["true","yes","1","y","x"].includes(o)}function fr(c,o,e){const a=[],_=Lt(c,o,"title"),$=Lt(c,o,"description"),S=Lt(c,o,"start_date"),M=Lt(c,o,"start_time"),F=Lt(c,o,"end_date"),Z=Lt(c,o,"end_time"),W=Lt(c,o,"location"),R=Lt(c,o,"category"),K=Lt(c,o,"is_all_day");if(!_)return a.push({row:e,field:"title",message:"Title is required"}),{event:null,errors:a};if(_.length<3)return a.push({row:e,field:"title",message:"Title must be at least 3 characters"}),{event:null,errors:a};if(_.length>255)return a.push({row:e,field:"title",message:"Title cannot exceed 255 characters"}),{event:null,errors:a};if(!S)return a.push({row:e,field:"start_date",message:"Start date is required"}),{event:null,errors:a};const J=ma(S);if(!J)return a.push({row:e,field:"start_date",message:`Invalid date format: "${S}"`}),{event:null,errors:a};const ht=K?pr(K):!M;let ct;if(!ht&&M){const N=_a(M);if(!N)return a.push({row:e,field:"start_time",message:`Invalid time format: "${M}"`}),{event:null,errors:a};J.setHours(N.hours,N.minutes,0,0),ct=Ce(J,xe)}else J.setHours(0,0,0,0),ct=Ce(J,xe);let mt;const A=F?ma(F):new Date(J);if(A&&!ht&&Z){const N=_a(Z);if(!N)return a.push({row:e,field:"end_time",message:`Invalid time format: "${Z}"`}),{event:null,errors:a};A.setHours(N.hours,N.minutes,0,0),mt=Ce(A,xe)}else if(!ht&&M)mt=new Date(ct.getTime()+60*60*1e3);else{const N=A||new Date(J);N.setHours(23,59,59,0),mt=Ce(N,xe)}let X;if(R&&(X=ur(R),!X))return a.push({row:e,field:"category",message:`Unknown category: "${R}"`}),{event:null,errors:a};if(W&&W.length>255)return a.push({row:e,field:"location",message:"Location cannot exceed 255 characters"}),{event:null,errors:a};const _t={};return X&&(_t.category=X),{event:{title:_,event_type:"calendar_event",start_time:ct.toISOString(),end_time:mt.toISOString(),is_all_day:ht,is_public:!0,is_published:!1,meta_data:_t,...$?{description:$}:{},...W?{location:W}:{}},errors:[]}}async function gr(c,o){const e={success:0,validationErrors:0,errors:[]},a=[];for(let M=0;M<c.length;M++){const{event:F,errors:Z}=fr(c[M],o,M+1);if(Z.length>0){e.validationErrors++,e.errors.push(...Z);continue}F&&a.push(F)}const _=Ze(),$=_?la(_.stores.currentUser):void 0,S=_?la(_.stores.userOrganizations):void 0;if($){const M=$.displayName||$.username,F=$.id,Z=S?Array.from(S):[],W=new Date().toISOString();for(const R of a){const K=R.meta_data||{};M&&(K.submitted_by_name=M),F&&(K.submitted_by_user_id=F),Z.length&&(K.submitted_by_organizations=Z),K.submitted_at=W,R.meta_data=K}}return a.length>0&&(await Ja(a),e.success=a.length),e}function yr(){const c=Pa({step:"upload",csvData:[],csvColumns:[],columnMappings:[],importResult:null});return{state:c,parseCsvFile:mr,autoDetectMappings:_r,importEvents:gr,reset:()=>c.set({step:"upload",csvData:[],csvColumns:[],columnMappings:[],importResult:null})}}var br=v(`<p class="text-muted small mb-3">Upload a CSV file to bulk-import calendar events. Need a starting point? <a href="/sample-events.csv" download="">Download sample CSV template</a>.</p> <div class="mb-3"><label for="csvFile" class="form-label">Select CSV File</label> <input type="file" class="form-control" id="csvFile" accept=".csv"/></div> <div class="alert alert-warning small mb-3 d-flex align-items-start gap-2"><i class="bi bi-info-circle mt-1"></i> <span>All imported events require <strong>bishopric approval</strong> before they appear on the
							public calendar.</span></div> <div class="alert alert-info small mb-0"><strong>Format Guide:</strong> <ul class="mb-0 mt-1"><li><strong>Required columns:</strong> Title, Date</li> <li><strong>Optional columns:</strong> Start Time, End Time, Location, Category, Description</li> <li>Dates: YYYY-MM-DD, MM/DD/YYYY, Jan 1, 2025, etc.</li> <li>Times: 7:00 PM, 19:00, etc. (omit for all-day events)</li> <li>Categories: Ward, Relief Society, Elders Quorum, Youth, Young Women, Young Men,
								Primary, etc.</li></ul></div>`,1),hr=v('<tr><td> </td><td><select class="form-select form-select-sm"><option>-- Skip --</option><option>Title</option><option>Description</option><option>Start Date</option><option>Start Time</option><option>End Date</option><option>End Time</option><option>Location</option><option>Category</option><option>All Day</option></select></td></tr>'),Er=v('<h6>Map CSV Columns to Event Fields</h6> <p class="text-muted"> </p> <table class="table table-sm"><thead><tr><th>CSV Column</th><th>Maps To</th></tr></thead><tbody></tbody></table>',1),Mr=v('<div class="text-center py-5"><!> <p class="mt-3">Importing events...</p></div>'),wr=v("<li><strong> </strong> rows had validation errors</li>"),kr=v(`<div class="alert alert-info small">Imported events are <strong>unpublished</strong> and will need bishopric approval before
							they appear on the public calendar.</div>`),Dr=v("<li> </li>"),xr=v("<li><em> </em></li>"),Cr=v('<div class="alert alert-warning"><h6>Validation Errors:</h6> <ul class="mb-0" style="max-height: 200px; overflow-y: auto;"><!> <!></ul></div>'),$r=v('<div class="alert alert-success"><h6>Import Complete</h6> <ul class="mb-0"><li><strong> </strong> events imported successfully</li> <!></ul></div> <!> <!>',1),Sr=v('<button type="button" class="btn btn-secondary">Cancel</button>'),Ir=v('<button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-primary"> </button>',1),Or=v('<button type="button" class="btn btn-secondary" disabled>Cancel</button> <button type="button" class="btn btn-primary" disabled><!> Importing...</button>',1),Ar=v('<button type="button" class="btn btn-primary">Done</button>'),Tr=v('<div class="modal-backdrop fade show"></div>'),Ur=v('<div tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Import Events from CSV</h5> <button type="button" class="btn-close" aria-label="Close import modal"></button></div> <div class="modal-body"><!></div> <div class="modal-footer"><!></div></div></div></div> <!>',1);function Fr(c,o){Ye(o,!1);const e=()=>Q(F,"$state",a),[a,_]=Ke();let $=$e(o,"isOpen",8,!1),S=$e(o,"onClose",8),M=$e(o,"onComplete",8);const{state:F,parseCsvFile:Z,autoDetectMappings:W,importEvents:R,reset:K}=yr();async function J(g){const h=g.target.files?.[0];if(h)try{const{data:rt,columns:pt}=await Z(h),G=W(pt);F.update(T=>({...T,step:"mapping",csvData:rt,csvColumns:pt,columnMappings:G}))}catch(rt){console.error("Failed to parse CSV:",rt),alert("Failed to parse CSV file. Please check the file format.")}}async function ht(){F.update(g=>({...g,step:"importing"}));try{const g=await R(e().csvData,e().columnMappings);F.update(h=>({...h,step:"complete",importResult:g})),M()()}catch(g){console.error("Failed to import events:",g),alert("Failed to import events. Please try again."),F.update(h=>({...h,step:"mapping"}))}}function ct(){K(),S()()}Xe();var mt=Ur(),A=U(mt);let X;var _t=n(A),zt=n(_t),N=n(zt),ne=l(n(N),2);ne.__click=ct,r(N);var Xt=l(N,2),se=n(Xt);{var xt=g=>{var h=br(),rt=l(U(h),2),pt=l(n(rt),2);pt.__change=J,r(rt),ye(4),s(g,h)},oe=g=>{var h=Vt(),rt=U(h);{var pt=T=>{var tt=Er(),z=l(U(tt),2),nt=n(z);r(z);var st=l(z,2),I=l(n(st));re(I,5,()=>(e(),d(()=>e().columnMappings)),He,(L,q,w)=>{var C=hr(),P=n(C),ot=n(P,!0);r(P);var Ct=l(P),Mt=n(Ct);Y(()=>{t(q),ca(()=>{})});var $t=n(Mt);$t.value=($t.__value=null)??"";var Rt=l($t);Rt.value=Rt.__value="title";var Nt=l(Rt);Nt.value=Nt.__value="description";var B=l(Nt);B.value=B.__value="start_date";var V=l(B);V.value=V.__value="start_time";var ft=l(V);ft.value=ft.__value="end_date";var Et=l(ft);Et.value=Et.__value="end_time";var dt=l(Et);dt.value=dt.__value="location";var E=l(dt);E.value=E.__value="category";var k=l(E);k.value=k.__value="is_all_day",r(Mt),r(Ct),r(C),Y(()=>ut(ot,(t(q),d(()=>t(q).csvColumn)))),qa(Mt,()=>t(q).eventField,j=>(t(q).eventField=j,ca(()=>e()),ja(a,"$state"))),s(L,C)}),r(I),r(st),Y(()=>ut(nt,`Found ${e(),d(()=>e().csvData.length)??""} rows in CSV`)),s(T,tt)},G=T=>{var tt=Vt(),z=U(tt);{var nt=I=>{var L=Mr(),q=n(L);Oe(q,{}),ye(2),r(L),s(I,L)},st=I=>{var L=Vt(),q=U(L);{var w=C=>{var P=$r(),ot=U(P),Ct=l(n(ot),2),Mt=n(Ct),$t=n(Mt),Rt=n($t,!0);r($t),ye(),r(Mt);var Nt=l(Mt,2);{var B=E=>{var k=wr(),j=n(k),gt=n(j,!0);r(j),ye(),r(k),Y(()=>ut(gt,(e(),d(()=>e().importResult.validationErrors)))),s(E,k)};b(Nt,E=>{e(),d(()=>e().importResult?.validationErrors&&e().importResult.validationErrors>0)&&E(B)})}r(Ct),r(ot);var V=l(ot,2);{var ft=E=>{var k=kr();s(E,k)};b(V,E=>{e(),d(()=>e().importResult?.success&&e().importResult.success>0)&&E(ft)})}var Et=l(V,2);{var dt=E=>{var k=Cr(),j=l(n(k),2),gt=n(j);re(gt,1,()=>(e(),d(()=>e().importResult.errors.slice(0,10))),He,(f,D)=>{var O=Dr(),p=n(O);r(O),Y(()=>ut(p,`Row ${t(D),d(()=>t(D).row)??""}: ${t(D),d(()=>t(D).message)??""}`)),s(f,O)});var et=l(gt,2);{var i=f=>{var D=xr(),O=n(D),p=n(O);r(O),r(D),Y(()=>ut(p,`... and ${e(),d(()=>e().importResult.errors.length-10)??""} more errors`)),s(f,D)};b(et,f=>{e(),d(()=>e().importResult.errors.length>10)&&f(i)})}r(j),r(k),s(E,k)};b(Et,E=>{e(),d(()=>e().importResult?.errors&&e().importResult.errors.length>0)&&E(dt)})}Y(()=>ut(Rt,(e(),d(()=>e().importResult?.success||0)))),s(C,P)};b(q,C=>{e(),d(()=>e().step==="complete")&&C(w)},!0)}s(I,L)};b(z,I=>{e(),d(()=>e().step==="importing")?I(nt):I(st,!1)},!0)}s(T,tt)};b(rt,T=>{e(),d(()=>e().step==="mapping")?T(pt):T(G,!1)},!0)}s(g,h)};b(se,g=>{e(),d(()=>e().step==="upload")?g(xt):g(oe,!1)})}r(Xt);var Ut=l(Xt,2),qt=n(Ut);{var Zt=g=>{var h=Sr();h.__click=ct,s(g,h)},Jt=g=>{var h=Vt(),rt=U(h);{var pt=T=>{var tt=Ir(),z=U(tt);z.__click=ct;var nt=l(z,2);nt.__click=ht;var st=n(nt);r(nt),Y(()=>ut(st,`Import ${e(),d(()=>e().csvData.length)??""} Events`)),s(T,tt)},G=T=>{var tt=Vt(),z=U(tt);{var nt=I=>{var L=Or(),q=l(U(L),2),w=n(q);Oe(w,{size:"sm"}),ye(),r(q),s(I,L)},st=I=>{var L=Vt(),q=U(L);{var w=C=>{var P=Ar();P.__click=ct,s(C,P)};b(q,C=>{e(),d(()=>e().step==="complete")&&C(w)},!0)}s(I,L)};b(z,I=>{e(),d(()=>e().step==="importing")?I(nt):I(st,!1)},!0)}s(T,tt)};b(rt,T=>{e(),d(()=>e().step==="mapping")?T(pt):T(G,!1)},!0)}s(g,h)};b(qt,g=>{e(),d(()=>e().step==="upload")?g(Zt):g(Jt,!1)})}r(Ut),r(zt),r(_t),r(A);var Bt=l(A,2);{var Ft=g=>{var h=Tr();s(g,h)};b(Bt,g=>{$()&&g(Ft)})}Y(()=>{X=Se(A,1,"modal fade",null,X,{show:$()}),za(A,`display: ${$()?"block":"none"}`)}),s(c,mt),Qe(),_()}Va(["click","change"]);var Rr=v('<div class="dropdown"><button class="btn btn-sm btn-primary dropdown-toggle" type="button" id="addEventDropdown" data-bs-toggle="dropdown" aria-label="Add event actions" aria-expanded="false"><i class="bi bi-plus"></i></button> <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="addEventDropdown"><li><button class="dropdown-item" type="button" data-bs-toggle="offcanvas"><i class="bi bi-calendar-plus me-2"></i>Create Event</button></li> <li><button class="dropdown-item" type="button"><i class="bi bi-file-earmark-arrow-up me-2"></i>Import CSV</button></li></ul></div>'),Nr=v('<div class="event-actions svelte-i4p9jq"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),Pr=v('<div class="daily-event-row svelte-i4p9jq"><div class="event-content svelte-i4p9jq"><!></div> <!></div>'),Wr=v('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-i4p9jq"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),Lr=v('<li class="list-group-item py-3 text-muted">No events scheduled this week.</li>'),Vr=v('<li class="list-group-item list-group-item-light text-uppercase small fw-lighter p-0"><button><span class="d-flex align-items-center gap-2"><i></i> <span class="text-muted"> </span></span> <span> </span></button></li> <!>',1),jr=v('<li class="list-group-item bg-secondary text-white fw-semibold"> </li> <!>',1),zr=v('<ul class="list-group list-group-flush border-top-0"></ul>'),qr=v('<div class="card-body text-muted small"><!></div>'),Br=v('<button class="btn btn-outline-secondary btn-sm">Reset</button>'),Hr=v('<div class="d-flex gap-2"><button class="btn btn-primary btn-sm">More</button> <button class="btn btn-outline-primary btn-sm">All</button></div>'),Yr=v('<div class="card-footer d-flex align-items-center justify-content-between"><small> </small> <!></div>'),Qr=v("<!> <!>",1),Kr=v('<div class="card-body text-muted small"><!></div>'),Xr=v('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center"><span>Events</span> <div class="d-flex align-items-center gap-2"><!> <!></div></div></div> <!></div>'),Zr=v('<div class="d-flex flex-column gap-4"><!></div>'),Jr=v("<!> <!> <!>",1);function yn(c,o){Ye(o,!1);const e=()=>Q(Jt,"$weeksExpanded",R),a=()=>Q(Bt,"$searchQuery",R),_=()=>Q(Zt,"$calendarEvents",R),$=()=>Q(Xt,"$currentUser",R),S=()=>Q(Ut,"$userOrganizations",R),M=()=>Q(se,"$currentUserHasPermission",R),F=()=>Q(oe,"$currentUserIsRoot",R),Z=()=>Q(xt,"$currentUserIsAdmin",R),W=()=>Q(qt,"$ready",R),[R,K]=Ke(),J=m(),ht=m(),ct=m(),mt=m(),A=m(),X=m(),_t=m(),zt=m(),N=m(),ne=m(),{stores:{currentUser:Xt,currentUserHasPermission:se,currentUserIsAdmin:xt,currentUserIsRoot:oe,userOrganizations:Ut}}=Ze(),{stores:{ready:qt,calendarEvents:Zt,weeksExpanded:Jt,searchQuery:Bt},actions:{reload:Ft}}=ba(),g={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0};let h=$e(o,"formId",24,Ea),rt=m(!1),pt=m(!1),G=m(),T=m(!1),tt=m(!1),z=m(new Set),nt=m(""),st=m({...g}),I=m(!1);const L=8,q=8;let w=m(L),C=m(!1);const P=er();let ot=m({});function Ct(i){return i===t(ht)||i===t(ct)}function Mt(i){const f=t(ot)[i]??Ct(i);u(ot,{...t(ot),[i]:!f})}const $t=i=>{const f=new Map;for(const p of i){if(!p.start_time)continue;const y=At(p.start_time);if(Number.isNaN(y.getTime()))continue;const H=Kt(y,{weekStartsOn:1}),St=be(y,{weekStartsOn:1}),wt=vt(H,"yyyy-MM-dd"),ie=`${vt(H,"MMM d")} – ${vt(St,"MMM d")}`;let Pt=f.get(wt);Pt||(Pt={key:wt,label:ie,days:new Map},f.set(wt,Pt));const at=vt(y,"yyyy-MM-dd");let it=Pt.days.get(at);it||(it={key:at,displayDay:vt(y,"EEE"),displayDate:vt(y,"MMM d"),events:[]},Pt.days.set(at,it)),it.events.push(p)}const D=p=>{const y=vt(p,"yyyy-MM-dd");f.has(y)||f.set(y,{key:y,label:`${vt(p,"MMM d")} – ${vt(be(p,{weekStartsOn:1}),"MMM d")}`,days:new Map})},O=Array.from(f.values());if(O.length){const p=O.reduce((St,wt)=>wt.key>St?wt.key:St,O[0].key),y=At(p);let H=Kt(new Date,{weekStartsOn:1});if(H>y)D(H);else for(;H<=y;)D(H),H=Be(H,1)}return Array.from(f.values()).sort((p,y)=>p.key<y.key?-1:p.key>y.key?1:0).map(p=>({key:p.key,label:p.label,days:Array.from(p.days.values()).sort((y,H)=>y.key<H.key?-1:y.key>H.key?1:0).map(y=>({...y,events:y.events.slice().sort((H,St)=>{const wt=H.is_all_day?0:1,ie=St.is_all_day?0:1;if(wt!==ie)return wt-ie;const Pt=H.start_time?At(H.start_time).getTime():Number.MAX_SAFE_INTEGER,at=St.start_time?At(St.start_time).getTime():Number.MAX_SAFE_INTEGER;return Pt-at})}))}))};function Rt(){u(w,t(w)+q)}function Nt(){u(w,520),u(C,!0)}function B(){u(w,L),u(C,!1)}const V=i=>ya(i,{currentUserId:t(G),isPrivileged:t(pt),canEditOwnOrgEvents:t(tt),userOrganizations:t(z)});function ft(){Ft()}pa(async()=>{await Ft()});const Et=async i=>{if(u(nt,"Item Form"),i?.meta_data?.recurring_instance&&i?.meta_data?.recurring_parent_id){const{getCalendarEvent:f}=await Ga(async()=>{const{getCalendarEvent:O}=await import("./BDrIpSzK.js").then(p=>p.w);return{getCalendarEvent:O}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),import.meta.url),D=await f(i.meta_data.recurring_parent_id);if(D){u(st,{...D,category:D?.meta_data?.category,start_time:i.start_time,end_time:i.end_time,meta_data:{...D.meta_data,recurring_instance:!0,recurring_parent_id:i.meta_data.recurring_parent_id,recurring_instance_index:i.meta_data.recurring_instance_index}});return}}u(st,{...i,category:i?.meta_data?.category})};x(()=>t(w),()=>{u(J,Be(P,t(w)))}),x(()=>Kt,()=>{u(ht,vt(Kt(P,{weekStartsOn:1}),"yyyy-MM-dd"))}),x(()=>Kt,()=>{u(ct,vt(Be(Kt(P,{weekStartsOn:1}),1),"yyyy-MM-dd"))}),x(()=>(e(),a(),t(ot)),()=>{u(mt,i=>e()||a()?!0:t(ot)[i]!==void 0?t(ot)[i]:Ct(i))}),x(()=>(_(),At),()=>{u(A,(_()??[]).filter(i=>i.start_time?At(i.start_time)>=P:!1))}),x(()=>(a(),t(A),t(J)),()=>{u(X,a()?t(A):t(A).filter(i=>At(i.start_time)<=t(J)))}),x(()=>t(X),()=>{u(_t,$t(t(X)))}),x(()=>(a(),t(A),t(X)),()=>{u(zt,!a()&&t(A).length>t(X).length)}),x(()=>(t(_t),vt),()=>{u(N,t(_t).reduce((i,f)=>{const D=At(f.key),O=be(D,{weekStartsOn:1}),p=vt(O,"yyyy-MM"),y=vt(O,"MMMM yyyy");return i[p]||(i[p]={label:y,weeks:[]}),i[p].weeks.push(f),i},{}))}),x(()=>$(),()=>{u(G,$()?.id)}),x(()=>S(),()=>{u(z,S())}),x(()=>(t(z),Ie),()=>{u(T,t(z).has(Ie.Bishopric))}),x(()=>(M(),lt),()=>{u(tt,M()(lt.EditOwnOrgEvents))}),x(()=>(F(),Z(),t(T),M(),lt),()=>{u(pt,F()||Z()||t(T)||M()(lt.EditAllEvents))}),x(()=>(M(),lt),()=>{u(rt,M()(lt.CreateEvents))}),x(()=>(M(),lt),()=>{u(ne,M()(lt.DeleteEvents))}),fa(),Xe();var dt=Jr(),E=U(dt);Ma(E,{get title(){return t(nt)},get id(){return h()},children:(i,f)=>{ga(i,{get eventItem(){return t(st)},get drawerId(){return h()},name:"event-item-form",get canDelete(){return t(ne)}})},$$slots:{default:!0}});var k=l(E,2);Fr(k,{get isOpen(){return t(I)},onClose:()=>u(I,!1),onComplete:ft});var j=l(k,2);{var gt=i=>{var f=Xr(),D=n(f),O=n(D),p=l(n(O),2),y=n(p);Xa(y,{});var H=l(y,2);{var St=at=>{var it=Rr(),Gt=l(n(it),2),te=n(Gt),ee=n(te);r(te);var kt=l(te,2),ae=n(kt);r(kt),r(Gt),r(it),Y(()=>{jt(ee,"data-bs-target",`#${h()??""}`),jt(ee,"aria-controls",h())}),Tt("click",ee,()=>Et({...g,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),Tt("click",ae,()=>u(I,!0)),s(at,it)};b(H,at=>{t(rt)&&at(St)})}r(p),r(O),r(D);var wt=l(D,2);{var ie=at=>{var it=Qr(),Gt=U(it);{var te=It=>{var Dt=zr();re(Dt,5,()=>(t(N),d(()=>Object.entries(t(N)))),([Wt,le])=>Wt,(Wt,le)=>{var me=Wa(()=>La(t(le),2));let yt=()=>t(me)[1];var Ht=jr(),Ot=U(Ht),Yt=n(Ot,!0);r(Ot);var he=l(Ot,2);re(he,1,()=>(yt(),d(()=>yt().weeks)),_e=>_e.key,(_e,bt)=>{const Je=ve(()=>(Qt(At),t(bt),d(()=>At(t(bt).key)))),Ee=ve(()=>(Qt(be),Qt(t(Je)),d(()=>be(t(Je),{weekStartsOn:1})))),Ge=ve(()=>(Qt(ua),Qt(t(Ee)),d(()=>ua(t(Ee))))),ka=ve(()=>(Qt(va),Qt(t(Ee)),Qt(t(Ge)),d(()=>va(t(Ee),t(Ge),{weekStartsOn:1})+1))),Ae=ve(()=>(t(mt),t(bt),d(()=>t(mt)(t(bt).key)))),Me=ve(()=>(t(bt),d(()=>t(bt).days.reduce((fe,we)=>fe+we.events.length,0))));var ta=Vr(),Te=U(ta),pe=n(Te);let ea;var Ue=n(pe),aa=n(Ue),ra=l(aa,2),Da=n(ra);r(ra),r(Ue);var Fe=l(Ue,2);let na;var xa=n(Fe,!0);r(Fe),r(pe),r(Te);var Ca=l(Te,2);{var $a=fe=>{var we=Vt(),Sa=U(we);{var Ia=ce=>{var ke=Vt(),Aa=U(ke);re(Aa,1,()=>(t(bt),d(()=>t(bt).days)),Re=>Re.key,(Re,de)=>{var Ne=Wr(),sa=n(Ne),Pe=n(sa),We=n(Pe),Ta=n(We,!0);r(We);var oa=l(We,2),Ua=n(oa,!0);r(oa),r(Pe);var ia=l(Pe,2);re(ia,5,()=>(t(de),d(()=>t(de).events)),ge=>ge.id??`${ge.start_time}-${ge.meta_data?.recurring_instance_index??0}`,(ge,De)=>{var Le=Pr(),Ve=n(Le),Fa=n(Ve);Za(Fa,{get item(){return t(De)},showDate:!1,get searchQuery(){return a()}}),r(Ve);var Ra=l(Ve,2);{var Na=je=>{var ze=Nr(),qe=n(ze);r(ze),Y(()=>{jt(qe,"data-bs-target",`#${h()??""}`),jt(qe,"aria-controls",h())}),Tt("click",qe,()=>Et(t(De))),s(je,ze)};b(Ra,je=>{t(De),d(()=>V(t(De)))&&je(Na)})}r(Le),s(ge,Le)}),r(ia),r(sa),r(Ne),Y(()=>{ut(Ta,(t(de),d(()=>t(de).displayDay))),ut(Ua,(t(de),d(()=>t(de).displayDate)))}),s(Re,Ne)}),s(ce,ke)},Oa=ce=>{var ke=Lr();s(ce,ke)};b(Sa,ce=>{t(bt),d(()=>t(bt).days.length)?ce(Ia):ce(Oa,!1)})}s(fe,we)};b(Ca,fe=>{t(Ae)&&fe($a)})}Y(()=>{ea=Se(pe,1,"week-header w-100 d-flex justify-content-between align-items-center border-0 bg-transparent p-2 text-start svelte-i4p9jq",null,ea,{"text-muted":t(Me)===0}),jt(pe,"title",t(Ae)?"Click to collapse week":"Click to expand week"),Se(aa,1,`bi ${t(Ae)?"bi-chevron-up":"bi-chevron-down"}`),ut(Da,`Week ${t(ka)??""} [${t(Me)??""} Event${t(Me)===1?"":"s"}]`),na=Se(Fe,1,"",null,na,{"opacity-50":t(Me)===0}),ut(xa,(t(bt),d(()=>t(bt).label)))}),Tt("click",pe,()=>Mt(t(bt).key)),s(_e,ta)}),Y(()=>ut(Yt,(yt(),d(()=>yt().label)))),s(Wt,Ht)}),r(Dt),s(It,Dt)},ee=It=>{var Dt=qr(),Wt=n(Dt);{var le=yt=>{var Ht=ue("No events match your search.");s(yt,Ht)},me=yt=>{var Ht=ue("There are no upcoming events this month.");s(yt,Ht)};b(Wt,yt=>{a()?yt(le):yt(me,!1)})}r(Dt),s(It,Dt)};b(Gt,It=>{t(_t),d(()=>t(_t).length)?It(te):It(ee,!1)})}var kt=l(Gt,2);{var ae=It=>{var Dt=Yr(),Wt=n(Dt),le=n(Wt);r(Wt);var me=l(Wt,2);{var yt=Ot=>{var Yt=Br();Tt("click",Yt,B),s(Ot,Yt)},Ht=Ot=>{var Yt=Hr(),he=n(Yt),_e=l(he,2);r(Yt),Tt("click",he,Rt),Tt("click",_e,Nt),s(Ot,Yt)};b(me,Ot=>{t(C)?Ot(yt):Ot(Ht,!1)})}r(Dt),Y(()=>ut(le,`Showing ${t(X),d(()=>t(X).length)??""} of ${t(A),d(()=>t(A).length)??""} future events`)),s(It,Dt)};b(kt,It=>{(t(zt)||t(C))&&It(ae)})}s(at,it)},Pt=at=>{var it=Kr(),Gt=n(it);{var te=kt=>{var ae=ue("No events match your search.");s(kt,ae)},ee=kt=>{var ae=ue("There are no upcoming events scheduled.");s(kt,ae)};b(Gt,kt=>{a()?kt(te):kt(ee,!1)})}r(it),s(at,it)};b(wt,at=>{_(),d(()=>_()?.length)?at(ie):at(Pt,!1)})}r(f),s(i,f)},et=i=>{var f=Zr(),D=n(f);Oe(D,{}),r(f),s(i,f)};b(j,i=>{W()?i(gt):i(et,!1)})}s(c,dt),Qe(),K()}export{gn as A,yn as E,va as d,ua as s};
