const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DYjrPUtT.js","./BWCcv1pC.js","./DIeogL5L.js","./DqgkBxsg.js","./CmsKOCeN.js","./NZTpNUN0.js","./69_IOA4Y.js","./CuVcyAaV.js","./KiCntiD6.js","./CvOYN50o.js","./BLfjesDR.js","./BZ_cLCXa.js","./BX4jFIqB.js","./BUApaBEI.js","./BeNQ5BU7.js","./BeYvafiM.js","../assets/Spinner.DTjfhZ6-.css","./B4f_lHFw.js","./C7eOEiMq.js","./CzDGc265.js","./Drf-2KpF.js","./KnlAAyDp.js","./D7yrvtzI.js","./DuvDvsb0.js","./CTSfrSuw.js","./DrfTdo8l.js","../assets/BishopricApprovalSection.DRGo_BHg.css"])))=>i.map(i=>d[i]);
import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{o as Ye,w as oa,g as Te}from"./CuVcyAaV.js";import{p as Xt,ai as J,m as t,aj as _e,f as ut,a as te,E as P,s as o,D as C,c as r,r as a,u as n,B as I,n as f,F as ne,C as Re,R as Wt}from"./BWCcv1pC.js";import{b as xt,i as h,a as pe,e as ft,s as F,p as Bt,d as ia,j as la,k as va}from"./KiCntiD6.js";import{e as qt,i as ce}from"./CvOYN50o.js";import{f as m,a as i,c as Pt,t as Ht}from"./DqgkBxsg.js";import{s as Mt,e as ca,b as da}from"./BLfjesDR.js";import{i as ee}from"./BeNQ5BU7.js";import{t as de,c as Fe,e as ke,O as ue,P as At,i as lt,p as Et,f as Kt,B as ua,A as ie,y as ma}from"./BZ_cLCXa.js";import{C as ze,A as _a,c as We}from"./CQ9ys_Rk.js";import{g as Me,b as Jt,h as pa,C as He,f as fa,i as le}from"./DYjrPUtT.js";import{S as me}from"./BeYvafiM.js";import{v as Ee,D as xe}from"./B4f_lHFw.js";import{_ as Ue}from"./CmsKOCeN.js";import{s as we}from"./CdEA5IGF.js";import{R as se}from"./D7yrvtzI.js";import{P as ba}from"./BgB8pT2-.js";import{p as ya}from"./iNPl_KTw.js";import{c as ga,e as ha}from"./KnlAAyDp.js";import{i as ve}from"./CoGJEauq.js";import{e as Ea}from"./DuvDvsb0.js";import{a as Pe}from"./CTSfrSuw.js";function qe(y,u){const e=de(y);if(isNaN(u))return Fe(y,NaN);if(!u)return e;const v=e.getDate(),S=Fe(y,e.getTime());S.setMonth(e.getMonth()+u+1,0);const B=S.getDate();return v>=B?S:(e.setFullYear(S.getFullYear(),S.getMonth(),v),e)}function xa(y){const u=de(y);return u.setDate(1),u.setHours(0,0,0,0),u}function Le(y,u){const e=de(y),v=de(u);return e.getFullYear()===v.getFullYear()&&e.getMonth()===v.getMonth()}function Ne(y){return ve(y,ga(y))}function wa(y,u){return qe(y,-1)}var ka=m('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add announcement"><i class="bi bi-plus"></i></button>'),Ma=m('<div class="announcement-actions svelte-1yokbat"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit announcement"><i class="bi bi-pencil-square"></i></button></div>'),Da=m('<li class="list-group-item py-2"><div class="announcement-row svelte-1yokbat"><div class="announcement-content svelte-1yokbat"><!></div> <!></div></li>'),Ca=m('<div class="card-footer d-flex align-items-center justify-content-between"><small> </small> <button class="btn btn-primary btn-sm">More</button></div>'),$a=m('<ul class="list-group list-group-flush border-top-0"></ul> <!>',1),Ia=m('<div class="card-body text-muted small"><!></div>'),Sa=m('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center"><span>Announcements</span> <!></div></div> <!></div>'),Aa=m('<div class="d-flex flex-column gap-4"><!></div>'),Oa=m("<!> <!>",1);function kn(y,u){Xt(u,!1);const e=()=>xt(Vt,"$searchQuery",w),v=()=>xt(rt,"$announcements",w),S=()=>xt(ht,"$currentUser",w),B=()=>xt(kt,"$userOrganizations",w),Y=()=>xt(Dt,"$currentUserHasPermission",w),N=()=>xt($t,"$currentUserIsRoot",w),q=()=>xt(bt,"$currentUserIsAdmin",w),W=()=>xt(It,"$ready",w),[w,p]=pe(),ot=P(),it=P(),wt=P(),{stores:{currentUser:ht,currentUserHasPermission:Dt,currentUserIsAdmin:bt,currentUserIsRoot:$t,userOrganizations:kt}}=ke(),{stores:{ready:It,announcements:rt,searchQuery:Vt},actions:{reload:Rt}}=Me(),Ot={title:"Announcement",description:"",location:"",event_type:"announcement",is_public:!0},_t=Ee();let Lt=P(!1),Ct=P(!1),Tt=P(),Nt=P(!1),Ft=P(!1),St=P(!1),R=P(new Set),E=P(""),$=P({...Ot});const L=5,at=5;let K=P(L);function H(){C(K,t(K)+at)}const G=d=>We(d,{currentUserId:t(Tt),isPrivileged:t(Ct),canEditOwnOrgEvents:t(St),userOrganizations:t(R)});Ye(async()=>{await Rt()});const O=d=>{C(E,"Announcement Form"),C($,{...d,category:d?.meta_data?.category})};J(()=>(e(),v(),t(K)),()=>{C(ot,e()?v()??[]:(v()??[]).slice(0,t(K)))}),J(()=>(e(),v(),t(K)),()=>{C(it,!e()&&(v()?.length??0)>t(K))}),J(()=>S(),()=>{C(Tt,S()?.id)}),J(()=>t(Tt),()=>{C(Ft,!!t(Tt))}),J(()=>B(),()=>{C(R,B())}),J(()=>(t(R),ue),()=>{C(Nt,t(R).has(ue.Bishopric))}),J(()=>(Y(),At),()=>{C(St,Y()(At.EditOwnOrgEvents))}),J(()=>(N(),q(),t(Nt),Y(),At),()=>{C(Ct,N()||q()||t(Nt)||Y()(At.EditAllEvents))}),J(()=>(t(Ct),Y(),t(St),t(Ft)),()=>{C(Lt,t(Ct)||Y()(At.CreateEvents)||t(St)||t(Ft))}),J(()=>(Y(),At),()=>{C(wt,Y()(At.DeleteEvents))}),_e(),ee();var nt=Oa(),X=ut(nt);xe(X,{get title(){return t(E)},get id(){return _t},children:(d,s)=>{ze(d,{get eventItem(){return t($)},get drawerId(){return _t},name:"announcement-item-form",get canDelete(){return t(wt)}})},$$slots:{default:!0}});var Z=o(X,2);{var st=d=>{var s=Sa(),b=r(s),M=r(b),j=o(r(M),2);{var l=D=>{var T=ka();I(()=>{Mt(T,"data-bs-target",`#${_t??""}`),Mt(T,"aria-controls",_t)}),ft("click",T,()=>O({...Ot,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),i(D,T)};h(j,D=>{t(Lt)&&D(l)})}a(M),a(b);var _=o(b,2);{var x=D=>{var T=$a(),U=ut(T);qt(U,5,()=>t(ot),ce,(z,g)=>{var k=Da(),tt=r(k),vt=r(tt),yt=r(vt);_a(yt,{get item(){return t(g)},get searchQuery(){return e()}}),a(vt);var mt=o(vt,2);{var Q=gt=>{var Ut=Ma(),jt=r(Ut);a(Ut),I(()=>{Mt(jt,"data-bs-target",`#${_t??""}`),Mt(jt,"aria-controls",_t)}),ft("click",jt,()=>O(t(g))),i(gt,Ut)};h(mt,gt=>{t(g),n(()=>G(t(g)))&&gt(Q)})}a(tt),a(k),i(z,k)}),a(U);var V=o(U,2);{var pt=z=>{var g=Ca(),k=r(g),tt=r(k);a(k);var vt=o(k,2);a(g),I(()=>F(tt,`Showing ${t(K)??""} of ${v(),n(()=>v()?.length??0)??""}`)),ft("click",vt,H),i(z,g)};h(V,z=>{t(it)&&z(pt)})}i(D,T)},A=D=>{var T=Pt(),U=ut(T);{var V=pt=>{var z=Ia(),g=r(z);{var k=vt=>{var yt=Ht("No announcements match your search.");i(vt,yt)},tt=vt=>{var yt=Ht("There are no announcements yet.");i(vt,yt)};h(g,vt=>{e()?vt(k):vt(tt,!1)})}a(z),i(pt,z)};h(U,pt=>{v(),n(()=>v()?.length===0)&&pt(V)},!0)}i(D,T)};h(_,D=>{t(ot),n(()=>t(ot).length)?D(x):D(A,!1)})}a(s),i(d,s)},c=d=>{var s=Aa(),b=r(s);me(b,{}),a(s),i(d,s)};h(Z,d=>{W()?d(st):d(c,!1)})}i(y,nt),te(),p()}var Ta=m('<div class="event-header-image svelte-lu3xbf"><img class="svelte-lu3xbf"/></div>'),Ra=m("<span> </span>"),Fa=m('<button type="button" class="btn btn-sm btn-outline-primary"><i class="bi bi-pencil"></i> Edit</button>'),Ua=m('<p class="section-content svelte-lu3xbf"><span class="badge bg-secondary">All Day Event</span></p>'),Pa=m('<p class="section-content svelte-lu3xbf"> </p>'),La=m('<p class="section-content svelte-lu3xbf"><strong> </strong></p> <!>',1),Na=m('<p class="section-content text-muted svelte-lu3xbf"><i class="bi bi-arrow-repeat"></i> <!></p>'),Ba=m('<p class="section-content text-muted svelte-lu3xbf"><i class="bi bi-arrow-repeat"></i> Part of recurring event series</p>'),Va=m('<div class="event-section svelte-lu3xbf"><h6 class="section-label svelte-lu3xbf"><i class="bi bi-geo-alt"></i> Location</h6> <p class="section-content svelte-lu3xbf"> </p></div>'),Ya=m('<div class="event-section svelte-lu3xbf"><h6 class="section-label svelte-lu3xbf"><i class="bi bi-card-text"></i> Description</h6> <div class="section-content event-description svelte-lu3xbf"><!></div></div>'),za=m('<div class="attachment-image-container svelte-lu3xbf"><button type="button" class="attachment-image-button svelte-lu3xbf"><img class="attachment-image svelte-lu3xbf"/></button> <div class="attachment-image-label svelte-lu3xbf"><small class="text-muted"> </small></div></div>'),Wa=m('<button type="button" class="btn btn-outline-secondary attachment-file-button svelte-lu3xbf"><i class="bi bi-file-pdf"></i> <span class="text-truncate svelte-lu3xbf"> </span> <small class="text-muted"> </small></button>'),Ha=m('<div class="event-section svelte-lu3xbf"><h6 class="section-label svelte-lu3xbf"><i class="bi bi-paperclip"></i> Attachments</h6> <div class="attachments-grid svelte-lu3xbf"></div></div>'),qa=m('<p class="metadata-item svelte-lu3xbf"><i class="bi bi-clock-history"></i> Posted <!> <!></p>'),Ka=m('<p class="metadata-item svelte-lu3xbf"><i class="bi bi-pencil-square"></i> Last edited <!> <!></p>'),ja=m('<div class="event-section event-metadata svelte-lu3xbf"><!> <!></div>'),Qa=m('<div class="event-details-view svelte-lu3xbf"><div class="event-header svelte-lu3xbf"><div class="event-header-content svelte-lu3xbf"><!> <div class="event-header-text svelte-lu3xbf"><h3 class="event-title svelte-lu3xbf"> </h3> <!></div></div> <!></div> <div class="event-section svelte-lu3xbf"><h6 class="section-label svelte-lu3xbf"><i class="bi bi-calendar-event"></i> Date & Time</h6> <!> <!></div> <!> <!> <!> <!></div>');function Ja(y,u){Xt(u,!1);const e=P(),v=P(),S=P(),B=P(),Y=P(),N=P(),q=P(),W=P(),w=P();let p=Bt(u,"event",8),ot=Bt(u,"onEdit",8,null),it=Bt(u,"canEdit",8,!1);const wt=c=>c.startsWith("image/"),ht=c=>c<1024?c+" B":c<1024*1024?(c/1024).toFixed(1)+" KB":(c/(1024*1024)).toFixed(1)+" MB",Dt=c=>{window.open(c,"_blank")},bt=c=>{if(!c)return"";try{return lt(Et(c),"MMM d, yyyy 'at' h:mm a")}catch{return""}},$t=c=>{try{const s=se.fromString(c).origOptions,b=s.interval||1,M=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],j=["","1st","2nd","3rd","4th","5th"];if(s.freq===se.DAILY)return b===1?"Repeats daily":`Repeats every ${b} days`;if(s.freq===se.WEEKLY){if(s.byweekday){const _=(Array.isArray(s.byweekday)?s.byweekday:[s.byweekday]).map(x=>{const A=typeof x=="number"?x:x.weekday,D=A===6?0:A+1;return M[D]});return b===1?_.length===1?`Repeats every ${_[0]}`:`Repeats on ${_.join(", ")}`:`Repeats every ${b} weeks on ${_.join(", ")}`}return b===1?"Repeats weekly":`Repeats every ${b} weeks`}if(s.freq===se.MONTHLY){if(s.byweekday){const _=(Array.isArray(s.byweekday)?s.byweekday:[s.byweekday])[0];if(_&&typeof _=="object"&&"n"in _&&"weekday"in _){const x=_.weekday,A=x===6?0:x+1,D=_.n,T=j[D]||`${D}th`;return b===1?`Repeats on the ${T} ${M[A]} of the month`:`Repeats on the ${T} ${M[A]} every ${b} months`}}if(s.bymonthday){const l=Array.isArray(s.bymonthday)?s.bymonthday[0]:s.bymonthday,_=l===1?"st":l===2?"nd":l===3?"rd":"th";return b===1?`Repeats on the ${l}${_} of the month`:`Repeats on the ${l}${_} every ${b} months`}return b===1?"Repeats monthly":`Repeats every ${b} months`}if(s.freq===se.YEARLY){if(s.bymonth&&s.bymonthday){const l=["","January","February","March","April","May","June","July","August","September","October","November","December"],_=Array.isArray(s.bymonth)?s.bymonth[0]:s.bymonth,x=Array.isArray(s.bymonthday)?s.bymonthday[0]:s.bymonthday,A=x===1?"st":x===2?"nd":x===3?"rd":"th";return b===1?`Repeats every ${l[_]} ${x}${A}`:`Repeats every ${b} years on ${l[_]} ${x}${A}`}return b===1?"Repeats yearly":`Repeats every ${b} years`}return"Repeats"}catch{return"Repeats"}};J(()=>f(p()),()=>{C(e,Jt(p()?.meta_data?.category??""))}),J(()=>f(p()),()=>{C(v,p().meta_data?.submitted_at??p().created_at)}),J(()=>t(v),()=>{C(S,bt(t(v)))}),J(()=>f(p()),()=>{C(B,p().meta_data?.submitted_by_name)}),J(()=>(t(S),t(B)),()=>{C(Y,!!(t(S)||t(B)))}),J(()=>f(p()),()=>{C(N,bt(p().meta_data?.edited_at))}),J(()=>f(p()),()=>{C(q,p().meta_data?.edited_by_name)}),J(()=>(t(N),t(q)),()=>{C(W,!!(t(N)||t(q)))}),J(()=>f(p()),()=>{C(w,p().attachments?.find(c=>wt(c.type)))}),_e(),ee();var kt=Qa(),It=r(kt),rt=r(It),Vt=r(rt);{var Rt=c=>{var d=Ta(),s=r(d);a(d),I(()=>{Mt(s,"src",(t(w),n(()=>t(w).url))),Mt(s,"alt",(t(w),n(()=>t(w).name)))}),i(c,d)};h(Vt,c=>{t(w)&&c(Rt)})}var Ot=o(Vt,2),_t=r(Ot),Lt=r(_t,!0);a(_t);var Ct=o(_t,2);{var Tt=c=>{var d=Ra(),s=r(d,!0);a(d),I(()=>{Kt(d,1,`badge rounded-pill bg-color-${t(e),n(()=>t(e).color_number)??""}`,"svelte-lu3xbf"),F(s,(t(e),n(()=>t(e).label)))}),i(c,d)};h(Ct,c=>{t(e),n(()=>t(e)?.label)&&c(Tt)})}a(Ot),a(rt);var Nt=o(rt,2);{var Ft=c=>{var d=Fa();ft("click",d,function(...s){ot()?.apply(this,s)}),i(c,d)};h(Nt,c=>{it()&&ot()&&c(Ft)})}a(It);var St=o(It,2),R=o(r(St),2);{var E=c=>{var d=La(),s=ut(d),b=r(s),M=r(b,!0);a(b),a(s);var j=o(s,2);{var l=x=>{var A=Ua();i(x,A)},_=x=>{var A=Pt(),D=ut(A);{var T=U=>{var V=Pa(),pt=r(V);a(V),I((z,g)=>F(pt,`${z??""} - ${g??""}`),[()=>(f(lt),f(Et),f(p()),n(()=>lt(Et(p().start_time),"h:mm a"))),()=>(f(lt),f(Et),f(p()),n(()=>lt(Et(p().end_time),"h:mm a")))]),i(U,V)};h(D,U=>{f(p()),n(()=>p().start_time&&p().end_time)&&U(T)},!0)}i(x,A)};h(j,x=>{f(p()),n(()=>p().is_all_day)?x(l):x(_,!1)})}I(x=>F(M,x),[()=>(f(lt),f(Et),f(p()),n(()=>lt(Et(p().start_time),"EEEE, MMMM d, yyyy")))]),i(c,d)};h(R,c=>{f(p()),n(()=>p().start_time)&&c(E)})}var $=o(R,2);{var L=c=>{var d=Na(),s=o(r(d)),b=o(s);{var M=j=>{var l=Ht();I(_=>F(l,`until ${_??""}`),[()=>(f(lt),f(Et),f(p()),n(()=>lt(Et(p().recurrence_end_date),"MMM d, yyyy")))]),i(j,l)};h(b,j=>{f(p()),n(()=>p().recurrence_end_date)&&j(M)})}a(d),I(j=>F(s,` ${j??""} `),[()=>(f(p()),n(()=>$t(p().recurrence_rule)))]),i(c,d)},at=c=>{var d=Pt(),s=ut(d);{var b=M=>{var j=Ba();i(M,j)};h(s,M=>{f(p()),n(()=>p()?.meta_data?.recurring_instance)&&M(b)},!0)}i(c,d)};h($,c=>{f(p()),n(()=>p().recurrence_rule)?c(L):c(at,!1)})}a(St);var K=o(St,2);{var H=c=>{var d=Va(),s=o(r(d),2),b=r(s,!0);a(s),a(d),I(()=>F(b,(f(p()),n(()=>p().location)))),i(c,d)};h(K,c=>{f(p()),n(()=>p().location)&&c(H)})}var G=o(K,2);{var O=c=>{var d=Ya(),s=o(r(d),2),b=r(s);pa(b,()=>(f(p()),n(()=>p().description))),a(s),a(d),i(c,d)};h(G,c=>{f(p()),n(()=>p().description)&&c(O)})}var nt=o(G,2);{var X=c=>{var d=Ha(),s=o(r(d),2);qt(s,5,()=>(f(p()),n(()=>p().attachments)),b=>b.id,(b,M)=>{var j=Pt(),l=ut(j);{var _=A=>{var D=za(),T=r(D),U=r(T);a(T);var V=o(T,2),pt=r(V),z=r(pt,!0);a(pt),a(V),a(D),I(()=>{Mt(T,"title",`Open ${t(M),n(()=>t(M).name)??""}`),Mt(U,"src",(t(M),n(()=>t(M).url))),Mt(U,"alt",(t(M),n(()=>t(M).name))),F(z,(t(M),n(()=>t(M).name)))}),ft("click",T,()=>Dt(t(M).url)),i(A,D)},x=A=>{var D=Wa(),T=o(r(D),2),U=r(T,!0);a(T);var V=o(T,2),pt=r(V);a(V),a(D),I(z=>{Mt(D,"title",`Open ${t(M),n(()=>t(M).name)??""}`),F(U,(t(M),n(()=>t(M).name))),F(pt,`(${z??""})`)},[()=>(t(M),n(()=>ht(t(M).size)))]),ft("click",D,()=>Dt(t(M).url)),i(A,D)};h(l,A=>{t(M),n(()=>wt(t(M).type))?A(_):A(x,!1)})}i(b,j)}),a(s),a(d),i(c,d)};h(nt,c=>{f(p()),n(()=>p().attachments&&p().attachments.length>0)&&c(X)})}var Z=o(nt,2);{var st=c=>{var d=ja(),s=r(d);{var b=l=>{var _=qa(),x=o(r(_),2);{var A=U=>{var V=Ht();I(()=>F(V,t(S))),i(U,V)};h(x,U=>{t(S)&&U(A)})}var D=o(x,2);{var T=U=>{var V=Ht();I(()=>F(V,`by ${t(B)??""}`)),i(U,V)};h(D,U=>{t(B)&&U(T)})}a(_),i(l,_)};h(s,l=>{t(Y)&&l(b)})}var M=o(s,2);{var j=l=>{var _=Ka(),x=o(r(_),2);{var A=U=>{var V=Ht();I(()=>F(V,t(N))),i(U,V)};h(x,U=>{t(N)&&U(A)})}var D=o(x,2);{var T=U=>{var V=Ht();I(()=>F(V,`by ${t(q)??""}`)),i(U,V)};h(D,U=>{t(q)&&U(T)})}a(_),i(l,_)};h(M,l=>{t(W)&&l(j)})}a(d),i(c,d)};h(Z,c=>{(t(Y)||t(W))&&c(st)})}a(kt),I(()=>F(Lt,(f(p()),n(()=>p().title)))),i(y,kt),te()}const Ke={};for(const y of Object.values(He))y.key&&(Ke[y.label.toLowerCase()]=y.key);const Ga=new Set(Object.values(He).map(y=>y.key).filter(Boolean));function Za(y){const u=y.trim();if(u)return Ga.has(u.toUpperCase())?u.toUpperCase():Ke[u.toLowerCase()]}async function Xa(y){return new Promise((u,e)=>{ba.parse(y,{header:!0,skipEmptyLines:!0,complete:v=>{const S=v.data,B=v.meta.fields||[];u({data:S,columns:B})},error:v=>e(v)})})}function tr(y){return y.map(u=>{const e=u.toLowerCase().trim();return e==="title"||e==="event"||e==="event name"||e==="name"?{csvColumn:u,eventField:"title"}:e==="description"||e==="details"||e==="notes"?{csvColumn:u,eventField:"description"}:e==="start date"||e==="start_date"||e==="date"||e==="event date"?{csvColumn:u,eventField:"start_date"}:e==="start time"||e==="start_time"||e==="time"||e==="event time"?{csvColumn:u,eventField:"start_time"}:e==="end date"||e==="end_date"?{csvColumn:u,eventField:"end_date"}:e==="end time"||e==="end_time"?{csvColumn:u,eventField:"end_time"}:e==="location"||e==="place"||e==="venue"?{csvColumn:u,eventField:"location"}:e==="category"||e==="group"||e==="organization"||e==="org"?{csvColumn:u,eventField:"category"}:e==="all day"||e==="all_day"||e==="is_all_day"||e==="allday"?{csvColumn:u,eventField:"is_all_day"}:{csvColumn:u,eventField:null}})}function zt(y,u,e){const v=u.find(S=>S.eventField===e);return v?(y[v.csvColumn]||"").trim():""}function Be(y){const u=["yyyy-MM-dd","MM/dd/yyyy","M/d/yyyy","MM-dd-yyyy","M-d-yyyy","MM/dd/yy","M/d/yy","yyyy/MM/dd","MMM d, yyyy","MMMM d, yyyy","MMM d yyyy","d MMM yyyy"];for(const e of u){const v=ya(y,e,new Date);if(ua(v))return v}return null}function Ve(y){const u=y.match(/^(\d{1,2}):(\d{2})$/);if(u){const v=parseInt(u[1],10),S=parseInt(u[2],10);if(v>=0&&v<=23&&S>=0&&S<=59)return{hours:v,minutes:S}}const e=y.match(/^(\d{1,2})(?::(\d{2}))?\s*(am|pm)$/i);if(e){let v=parseInt(e[1],10);const S=e[2]?parseInt(e[2],10):0,B=e[3].toLowerCase();if(v>=1&&v<=12&&S>=0&&S<=59)return B==="pm"&&v!==12&&(v+=12),B==="am"&&v===12&&(v=0),{hours:v,minutes:S}}return null}function er(y){const u=y.toLowerCase().trim();return["true","yes","1","y","x"].includes(u)}function ar(y,u,e){const v=[],S=zt(y,u,"title"),B=zt(y,u,"description"),Y=zt(y,u,"start_date"),N=zt(y,u,"start_time"),q=zt(y,u,"end_date"),W=zt(y,u,"end_time"),w=zt(y,u,"location"),p=zt(y,u,"category"),ot=zt(y,u,"is_all_day");if(!S)return v.push({row:e,field:"title",message:"Title is required"}),{event:null,errors:v};if(S.length<3)return v.push({row:e,field:"title",message:"Title must be at least 3 characters"}),{event:null,errors:v};if(S.length>255)return v.push({row:e,field:"title",message:"Title cannot exceed 255 characters"}),{event:null,errors:v};if(!Y)return v.push({row:e,field:"start_date",message:"Start date is required"}),{event:null,errors:v};const it=Be(Y);if(!it)return v.push({row:e,field:"start_date",message:`Invalid date format: "${Y}"`}),{event:null,errors:v};const wt=ot?er(ot):!N;let ht;if(!wt&&N){const rt=Ve(N);if(!rt)return v.push({row:e,field:"start_time",message:`Invalid time format: "${N}"`}),{event:null,errors:v};it.setHours(rt.hours,rt.minutes,0,0),ht=le(it,ie)}else it.setHours(0,0,0,0),ht=le(it,ie);let Dt;const bt=q?Be(q):new Date(it);if(bt&&!wt&&W){const rt=Ve(W);if(!rt)return v.push({row:e,field:"end_time",message:`Invalid time format: "${W}"`}),{event:null,errors:v};bt.setHours(rt.hours,rt.minutes,0,0),Dt=le(bt,ie)}else if(!wt&&N)Dt=new Date(ht.getTime()+60*60*1e3);else{const rt=bt||new Date(it);rt.setHours(23,59,59,0),Dt=le(rt,ie)}let $t;if(p&&($t=Za(p),!$t))return v.push({row:e,field:"category",message:`Unknown category: "${p}"`}),{event:null,errors:v};if(w&&w.length>255)return v.push({row:e,field:"location",message:"Location cannot exceed 255 characters"}),{event:null,errors:v};const kt={};return $t&&(kt.category=$t),{event:{title:S,event_type:"calendar_event",start_time:ht.toISOString(),end_time:Dt.toISOString(),is_all_day:wt,is_public:!0,is_published:!1,meta_data:kt,...B?{description:B}:{},...w?{location:w}:{}},errors:[]}}async function rr(y,u){const e={success:0,validationErrors:0,errors:[]},v=[];for(let N=0;N<y.length;N++){const{event:q,errors:W}=ar(y[N],u,N+1);if(W.length>0){e.validationErrors++,e.errors.push(...W);continue}q&&v.push(q)}const S=ke(),B=S?Te(S.stores.currentUser):void 0,Y=S?Te(S.stores.userOrganizations):void 0;if(B){const N=B.displayName||B.username,q=B.id,W=Y?Array.from(Y):[],w=new Date().toISOString();for(const p of v){const ot=p.meta_data||{};N&&(ot.submitted_by_name=N),q&&(ot.submitted_by_user_id=q),W.length&&(ot.submitted_by_organizations=W),ot.submitted_at=w,p.meta_data=ot}}return v.length>0&&(await fa(v),e.success=v.length),e}function nr(){const y=oa({step:"upload",csvData:[],csvColumns:[],columnMappings:[],importResult:null});return{state:y,parseCsvFile:Xa,autoDetectMappings:tr,importEvents:rr,reset:()=>y.set({step:"upload",csvData:[],csvColumns:[],columnMappings:[],importResult:null})}}var sr=m(`<p class="text-muted small mb-3">Upload a CSV file to bulk-import calendar events. Need a starting point? <a href="/sample-events.csv" download="">Download sample CSV template</a>.</p> <div class="mb-3"><label for="csvFile" class="form-label">Select CSV File</label> <input type="file" class="form-control" id="csvFile" accept=".csv"/></div> <div class="alert alert-warning small mb-3 d-flex align-items-start gap-2"><i class="bi bi-info-circle mt-1"></i> <span>All imported events require <strong>bishopric approval</strong> before they appear on the
							public calendar.</span></div> <div class="alert alert-info small mb-0"><strong>Format Guide:</strong> <ul class="mb-0 mt-1"><li><strong>Required columns:</strong> Title, Date</li> <li><strong>Optional columns:</strong> Start Time, End Time, Location, Category, Description</li> <li>Dates: YYYY-MM-DD, MM/DD/YYYY, Jan 1, 2025, etc.</li> <li>Times: 7:00 PM, 19:00, etc. (omit for all-day events)</li> <li>Categories: Ward, Relief Society, Elders Quorum, Youth, Young Women, Young Men,
								Primary, etc.</li></ul></div>`,1),or=m('<tr><td> </td><td><select class="form-select form-select-sm"><option>-- Skip --</option><option>Title</option><option>Description</option><option>Start Date</option><option>Start Time</option><option>End Date</option><option>End Time</option><option>Location</option><option>Category</option><option>All Day</option></select></td></tr>'),ir=m('<h6>Map CSV Columns to Event Fields</h6> <p class="text-muted"> </p> <table class="table table-sm"><thead><tr><th>CSV Column</th><th>Maps To</th></tr></thead><tbody></tbody></table>',1),lr=m('<div class="text-center py-5"><!> <p class="mt-3">Importing events...</p></div>'),vr=m("<li><strong> </strong> rows had validation errors</li>"),cr=m(`<div class="alert alert-info small">Imported events are <strong>unpublished</strong> and will need bishopric approval before
							they appear on the public calendar.</div>`),dr=m("<li> </li>"),ur=m("<li><em> </em></li>"),mr=m('<div class="alert alert-warning"><h6>Validation Errors:</h6> <ul class="mb-0" style="max-height: 200px; overflow-y: auto;"><!> <!></ul></div>'),_r=m('<div class="alert alert-success"><h6>Import Complete</h6> <ul class="mb-0"><li><strong> </strong> events imported successfully</li> <!></ul></div> <!> <!>',1),pr=m('<button type="button" class="btn btn-secondary">Cancel</button>'),fr=m('<button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-primary"> </button>',1),br=m('<button type="button" class="btn btn-secondary" disabled>Cancel</button> <button type="button" class="btn btn-primary" disabled><!> Importing...</button>',1),yr=m('<button type="button" class="btn btn-primary">Done</button>'),gr=m('<div class="modal-backdrop fade show"></div>'),hr=m('<div tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Import Events from CSV</h5> <button type="button" class="btn-close" aria-label="Close import modal"></button></div> <div class="modal-body"><!></div> <div class="modal-footer"><!></div></div></div></div> <!>',1);function Er(y,u){Xt(u,!1);const e=()=>xt(q,"$state",v),[v,S]=pe();let B=Bt(u,"isOpen",8,!1),Y=Bt(u,"onClose",8),N=Bt(u,"onComplete",8);const{state:q,parseCsvFile:W,autoDetectMappings:w,importEvents:p,reset:ot}=nr();async function it(E){const $=E.target.files?.[0];if($)try{const{data:L,columns:at}=await W($),K=w(at);q.update(H=>({...H,step:"mapping",csvData:L,csvColumns:at,columnMappings:K}))}catch(L){console.error("Failed to parse CSV:",L),alert("Failed to parse CSV file. Please check the file format.")}}async function wt(){q.update(E=>({...E,step:"importing"}));try{const E=await p(e().csvData,e().columnMappings);q.update($=>({...$,step:"complete",importResult:E})),N()()}catch(E){console.error("Failed to import events:",E),alert("Failed to import events. Please try again."),q.update($=>({...$,step:"mapping"}))}}function ht(){ot(),Y()()}ee();var Dt=hr(),bt=ut(Dt);let $t;var kt=r(bt),It=r(kt),rt=r(It),Vt=o(r(rt),2);Vt.__click=ht,a(rt);var Rt=o(rt,2),Ot=r(Rt);{var _t=E=>{var $=sr(),L=o(ut($),2),at=o(r(L),2);at.__change=it,a(L),ne(4),i(E,$)},Lt=E=>{var $=Pt(),L=ut($);{var at=H=>{var G=ir(),O=o(ut(G),2),nt=r(O);a(O);var X=o(O,2),Z=o(r(X));qt(Z,5,()=>(e(),n(()=>e().columnMappings)),ce,(st,c,d)=>{var s=or(),b=r(s),M=r(b,!0);a(b);var j=o(b),l=r(j);I(()=>{t(c),Re(()=>{})});var _=r(l);_.value=(_.__value=null)??"";var x=o(_);x.value=x.__value="title";var A=o(x);A.value=A.__value="description";var D=o(A);D.value=D.__value="start_date";var T=o(D);T.value=T.__value="start_time";var U=o(T);U.value=U.__value="end_date";var V=o(U);V.value=V.__value="end_time";var pt=o(V);pt.value=pt.__value="location";var z=o(pt);z.value=z.__value="category";var g=o(z);g.value=g.__value="is_all_day",a(l),a(j),a(s),I(()=>F(M,(t(c),n(()=>t(c).csvColumn)))),da(l,()=>t(c).eventField,k=>(t(c).eventField=k,Re(()=>e()),la(v,"$state"))),i(st,s)}),a(Z),a(X),I(()=>F(nt,`Found ${e(),n(()=>e().csvData.length)??""} rows in CSV`)),i(H,G)},K=H=>{var G=Pt(),O=ut(G);{var nt=Z=>{var st=lr(),c=r(st);me(c,{}),ne(2),a(st),i(Z,st)},X=Z=>{var st=Pt(),c=ut(st);{var d=s=>{var b=_r(),M=ut(b),j=o(r(M),2),l=r(j),_=r(l),x=r(_,!0);a(_),ne(),a(l);var A=o(l,2);{var D=z=>{var g=vr(),k=r(g),tt=r(k,!0);a(k),ne(),a(g),I(()=>F(tt,(e(),n(()=>e().importResult.validationErrors)))),i(z,g)};h(A,z=>{e(),n(()=>e().importResult?.validationErrors&&e().importResult.validationErrors>0)&&z(D)})}a(j),a(M);var T=o(M,2);{var U=z=>{var g=cr();i(z,g)};h(T,z=>{e(),n(()=>e().importResult?.success&&e().importResult.success>0)&&z(U)})}var V=o(T,2);{var pt=z=>{var g=mr(),k=o(r(g),2),tt=r(k);qt(tt,1,()=>(e(),n(()=>e().importResult.errors.slice(0,10))),ce,(mt,Q)=>{var gt=dr(),Ut=r(gt);a(gt),I(()=>F(Ut,`Row ${t(Q),n(()=>t(Q).row)??""}: ${t(Q),n(()=>t(Q).message)??""}`)),i(mt,gt)});var vt=o(tt,2);{var yt=mt=>{var Q=ur(),gt=r(Q),Ut=r(gt);a(gt),a(Q),I(()=>F(Ut,`... and ${e(),n(()=>e().importResult.errors.length-10)??""} more errors`)),i(mt,Q)};h(vt,mt=>{e(),n(()=>e().importResult.errors.length>10)&&mt(yt)})}a(k),a(g),i(z,g)};h(V,z=>{e(),n(()=>e().importResult?.errors&&e().importResult.errors.length>0)&&z(pt)})}I(()=>F(x,(e(),n(()=>e().importResult?.success||0)))),i(s,b)};h(c,s=>{e(),n(()=>e().step==="complete")&&s(d)},!0)}i(Z,st)};h(O,Z=>{e(),n(()=>e().step==="importing")?Z(nt):Z(X,!1)},!0)}i(H,G)};h(L,H=>{e(),n(()=>e().step==="mapping")?H(at):H(K,!1)},!0)}i(E,$)};h(Ot,E=>{e(),n(()=>e().step==="upload")?E(_t):E(Lt,!1)})}a(Rt);var Ct=o(Rt,2),Tt=r(Ct);{var Nt=E=>{var $=pr();$.__click=ht,i(E,$)},Ft=E=>{var $=Pt(),L=ut($);{var at=H=>{var G=fr(),O=ut(G);O.__click=ht;var nt=o(O,2);nt.__click=wt;var X=r(nt);a(nt),I(()=>F(X,`Import ${e(),n(()=>e().csvData.length)??""} Events`)),i(H,G)},K=H=>{var G=Pt(),O=ut(G);{var nt=Z=>{var st=br(),c=o(ut(st),2),d=r(c);me(d,{size:"sm"}),ne(),a(c),i(Z,st)},X=Z=>{var st=Pt(),c=ut(st);{var d=s=>{var b=yr();b.__click=ht,i(s,b)};h(c,s=>{e(),n(()=>e().step==="complete")&&s(d)},!0)}i(Z,st)};h(O,Z=>{e(),n(()=>e().step==="importing")?Z(nt):Z(X,!1)},!0)}i(H,G)};h(L,H=>{e(),n(()=>e().step==="mapping")?H(at):H(K,!1)},!0)}i(E,$)};h(Tt,E=>{e(),n(()=>e().step==="upload")?E(Nt):E(Ft,!1)})}a(Ct),a(It),a(kt),a(bt);var St=o(bt,2);{var R=E=>{var $=gr();i(E,$)};h(St,E=>{B()&&E(R)})}I(()=>{$t=Kt(bt,1,"modal fade",null,$t,{show:B()}),ca(bt,`display: ${B()?"block":"none"}`)}),i(y,Dt),te(),S()}ia(["click","change"]);var xr=m('<button class="btn btn-sm btn-outline-secondary flex-shrink-0"><i></i> </button>');function wr(y,u){Xt(u,!1);const e=()=>xt(B,"$weeksExpanded",v),[v,S]=pe(),{stores:{weeksExpanded:B}}=Me();function Y(){va(B,!e())}ee();var N=xr(),q=r(N),W=o(q);a(N),I(()=>{Kt(q,1,`bi ${e()?"bi-chevron-up":"bi-chevron-down"}`),F(W,` ${e()?"Collapse All":"Expand All"}`)}),ft("click",N,Y),i(y,N),te(),S()}var kr=m('<div class="calendar-day-header svelte-14mpkul"><span class="d-none d-md-inline"> </span> <span class="d-md-none"> </span></div>'),Mr=m('<button type="button"><span class="event-title svelte-14mpkul"> </span></button>'),Dr=m('<div class="more-events svelte-14mpkul"> </div>'),Cr=m('<div role="button" tabindex="0"><div class="day-number svelte-14mpkul"> </div> <div class="day-events svelte-14mpkul"><!> <!></div></div>'),$r=m('<div class="event-thumbnail-container svelte-14mpkul"><img class="event-thumbnail svelte-14mpkul"/></div>'),Ir=m("<span> </span>"),Sr=m('<span class="badge bg-secondary">All Day</span>'),Ar=m('<span class="event-time svelte-14mpkul"> </span>'),Or=m('<span class="event-location svelte-14mpkul"><i class="bi bi-geo-alt"></i> </span>'),Tr=m('<button type="button" class="btn btn-sm btn-outline-secondary" title="Edit event"><i class="bi bi-pencil"></i></button>'),Rr=m('<div class="selected-event-item svelte-14mpkul"><span></span> <!> <button type="button" class="event-details-button svelte-14mpkul"><div class="event-title-full svelte-14mpkul"> </div> <div class="event-meta svelte-14mpkul"><!> <!> <!></div></button> <div class="event-actions svelte-14mpkul"><!></div></div>'),Fr=m('<div class="selected-day-events svelte-14mpkul"><div class="selected-day-header svelte-14mpkul"><h6 class="selected-day-title svelte-14mpkul"> </h6> <button type="button" class="btn btn-sm btn-outline-secondary" aria-label="Close"><i class="bi bi-x-lg"></i></button></div> <div class="selected-day-event-list svelte-14mpkul"></div></div>'),Ur=m('<div class="month-calendar svelte-14mpkul"><div class="calendar-header svelte-14mpkul"><h5 class="month-title svelte-14mpkul"> </h5> <div class="calendar-nav svelte-14mpkul"><button type="button" class="btn btn-sm btn-outline-secondary" aria-label="Previous month"><i class="bi bi-chevron-left"></i></button> <button type="button" class="btn btn-sm btn-outline-secondary" aria-label="Go to today">Today</button> <button type="button" class="btn btn-sm btn-outline-secondary" aria-label="Next month"><i class="bi bi-chevron-right"></i></button></div></div> <div class="calendar-grid svelte-14mpkul"><!> <!></div> <!></div>');function Pr(y,u){Xt(u,!1);const e=P(),v=P(),S=P();let B=Bt(u,"events",24,()=>[]),Y=Bt(u,"onEventClick",8,()=>{}),N=Bt(u,"onEventEdit",8,null),q=Bt(u,"canEditEvent",8,null),W=P(new Date),w=P(null);const p=R=>{t(w)&&ve(t(w),R)?C(w,null):C(w,R)},ot=()=>{C(W,new Date)},it=()=>{C(W,wa(t(W)))},wt=()=>{C(W,qe(t(W),1))},ht=R=>{const E=lt(R,"yyyy-MM-dd");return t(S)[E]||[]},Dt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],bt=["S","M","T","W","T","F","S"],$t=R=>R.startsWith("image/");J(()=>t(w),()=>{C(e,t(w)?ht(t(w)):[])}),J(()=>(t(W),Pe),()=>{C(v,(()=>{const R=xa(t(W)),E=ha(t(W)),$=ma(R,{weekStartsOn:0}),L=Ea(E,{weekStartsOn:0}),at=[];let K=$;for(;K<=L;)at.push(K),K=Pe(K,1);return at})())}),J(()=>(f(B()),lt),()=>{C(S,B().reduce((R,E)=>{if(!E.start_time)return R;const $=Et(E.start_time),L=lt($,"yyyy-MM-dd");return R[L]||(R[L]=[]),R[L].push(E),R},{}))}),_e(),ee();var kt=Ur(),It=r(kt),rt=r(It),Vt=r(rt,!0);a(rt);var Rt=o(rt,2),Ot=r(Rt),_t=o(Ot,2),Lt=o(_t,2);a(Rt),a(It);var Ct=o(It,2),Tt=r(Ct);qt(Tt,1,()=>Dt,ce,(R,E,$)=>{var L=kr(),at=r(L),K=r(at,!0);a(at);var H=o(at,2),G=r(H,!0);a(H),a(L),I(()=>{F(K,t(E)),F(G,n(()=>bt[$]))}),i(R,L)});var Nt=o(Tt,2);qt(Nt,1,()=>t(v),R=>lt(R,"yyyy-MM-dd"),(R,E)=>{const $=Wt(()=>(t(E),n(()=>ht(t(E))))),L=Wt(()=>(f(Le),t(E),t(W),n(()=>Le(t(E),t(W))))),at=Wt(()=>(f(Ne),t(E),n(()=>Ne(t(E))))),K=Wt(()=>(t(w),f(ve),t(E),n(()=>t(w)&&ve(t(w),t(E)))));var H=Cr();let G;var O=r(H),nt=r(O,!0);a(O);var X=o(O,2),Z=r(X);qt(Z,1,()=>(f(t($)),n(()=>t($).slice(0,3))),d=>d.id??d.start_time,(d,s)=>{var b=Mr(),M=r(b),j=r(M,!0);a(M),a(b),I(l=>{Kt(b,1,`event-badge bg-color-${l??""}`,"svelte-14mpkul"),Mt(b,"title",(t(s),n(()=>t(s).title))),F(j,(t(s),n(()=>t(s).title)))},[()=>(f(Jt),t(s),n(()=>Jt(t(s)?.meta_data?.category??"")?.color_number??0))]),ft("click",b,we(()=>Y()(t(s)))),i(d,b)});var st=o(Z,2);{var c=d=>{var s=Dr(),b=r(s);a(s),I(()=>F(b,`+${f(t($)),n(()=>t($).length-3)??""} more`)),i(d,s)};h(st,d=>{f(t($)),n(()=>t($).length>3)&&d(c)})}a(X),a(H),I(d=>{G=Kt(H,1,"calendar-day svelte-14mpkul",null,G,{"other-month":!t(L),today:t(at),selected:t(K),"has-events":t($).length>0}),F(nt,d)},[()=>(f(lt),t(E),n(()=>lt(t(E),"d")))]),ft("click",H,()=>p(t(E))),ft("keydown",H,d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),p(t(E)))}),i(R,H)}),a(Ct);var Ft=o(Ct,2);{var St=R=>{var E=Fr(),$=r(E),L=r($),at=r(L,!0);a(L);var K=o(L,2);a($);var H=o($,2);qt(H,5,()=>t(e),G=>G.id??G.start_time,(G,O)=>{const nt=Wt(()=>(t(O),n(()=>t(O).attachments?.find(g=>$t(g.type))))),X=Wt(()=>(f(Jt),t(O),n(()=>Jt(t(O)?.meta_data?.category??""))));var Z=Rr(),st=r(Z),c=o(st,2);{var d=g=>{var k=$r(),tt=r(k);a(k),I(()=>{Mt(tt,"src",(f(t(nt)),n(()=>t(nt).url))),Mt(tt,"alt",(f(t(nt)),n(()=>t(nt).name)))}),i(g,k)};h(c,g=>{t(nt)&&g(d)})}var s=o(c,2),b=r(s),M=r(b,!0);a(b);var j=o(b,2),l=r(j);{var _=g=>{var k=Ir(),tt=r(k,!0);a(k),I(()=>{Kt(k,1,`badge rounded-pill bg-color-${f(t(X)),n(()=>t(X).color_number)??""}`,"svelte-14mpkul"),F(tt,(f(t(X)),n(()=>t(X).label)))}),i(g,k)};h(l,g=>{f(t(X)),n(()=>t(X)?.label)&&g(_)})}var x=o(l,2);{var A=g=>{var k=Sr();i(g,k)},D=g=>{var k=Pt(),tt=ut(k);{var vt=yt=>{var mt=Ar(),Q=r(mt,!0);a(mt),I(gt=>F(Q,gt),[()=>(f(lt),f(Et),t(O),n(()=>lt(Et(t(O).start_time),"h:mm a")))]),i(yt,mt)};h(tt,yt=>{t(O),n(()=>t(O).start_time)&&yt(vt)},!0)}i(g,k)};h(x,g=>{t(O),n(()=>t(O).is_all_day)?g(A):g(D,!1)})}var T=o(x,2);{var U=g=>{var k=Or(),tt=o(r(k));a(k),I(()=>F(tt,` ${t(O),n(()=>t(O).location)??""}`)),i(g,k)};h(T,g=>{t(O),n(()=>t(O).location)&&g(U)})}a(j),a(s);var V=o(s,2),pt=r(V);{var z=g=>{var k=Tr();ft("click",k,we(()=>N()&&N()(t(O)))),i(g,k)};h(pt,g=>{f(q()),f(N()),t(O),n(()=>q()&&N()&&q()(t(O)))&&g(z)})}a(V),a(Z),I(()=>{Kt(st,1,`event-color-indicator bg-color-${f(t(X)),n(()=>t(X)?.color_number??0)??""}`,"svelte-14mpkul"),F(M,(t(O),n(()=>t(O).title)))}),ft("click",s,()=>Y()(t(O))),i(G,Z)}),a(H),a(E),I(G=>F(at,G),[()=>(f(lt),t(w),n(()=>lt(t(w),"EEEE, MMMM d, yyyy")))]),ft("click",K,()=>C(w,null)),i(R,E)};h(Ft,R=>{t(w),t(e),n(()=>t(w)&&t(e).length>0)&&R(St)})}a(kt),I(R=>F(Vt,R),[()=>(f(lt),t(W),n(()=>lt(t(W),"MMMM yyyy")))]),ft("click",Ot,it),ft("click",_t,ot),ft("click",Lt,wt),i(y,kt),te()}var Lr=m('<div class="dropdown"><button class="btn btn-sm btn-primary dropdown-toggle" type="button" id="addEventDropdown" data-bs-toggle="dropdown" aria-label="Add event actions" aria-expanded="false"><i class="bi bi-plus"></i></button> <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="addEventDropdown"><li><button class="dropdown-item" type="button" data-bs-toggle="offcanvas"><i class="bi bi-calendar-plus me-2"></i>Create Event</button></li> <li><button class="dropdown-item" type="button"><i class="bi bi-file-earmark-arrow-up me-2"></i>Import CSV</button></li></ul></div>'),Nr=m('<div class="event-thumbnail-container svelte-1p8xa6u"><img class="event-thumbnail svelte-1p8xa6u"/></div>'),Br=m("<span> </span>"),Vr=m('<span class="event-date svelte-1p8xa6u"> </span>'),Yr=m('<span class="badge bg-secondary">All Day</span>'),zr=m('<span class="event-time svelte-1p8xa6u"> </span>'),Wr=m('<span class="event-location svelte-1p8xa6u"><i class="bi bi-geo-alt"></i> </span>'),Hr=m('<button type="button" class="btn btn-sm btn-outline-secondary" title="Edit event"><i class="bi bi-pencil"></i></button>'),qr=m('<div class="search-result-item svelte-1p8xa6u"><span></span> <!> <button type="button" class="event-details-button svelte-1p8xa6u"><div class="event-title-full svelte-1p8xa6u"> </div> <div class="event-meta svelte-1p8xa6u"><!> <!> <!> <!></div></button> <div class="event-actions svelte-1p8xa6u"><!></div></div>'),Kr=m('<div class="search-results svelte-1p8xa6u"><div class="search-results-header svelte-1p8xa6u"><h6 class="search-results-title svelte-1p8xa6u"> </h6></div> <div class="search-results-list svelte-1p8xa6u"></div></div>'),jr=m('<div class="search-no-results svelte-1p8xa6u"> </div>'),Qr=m("<!> <!>",1),Jr=m('<div class="no-events svelte-1p8xa6u"><!></div>'),Gr=m('<div class="calendar-container svelte-1p8xa6u"><div class="calendar-header svelte-1p8xa6u"><h2 class="calendar-title svelte-1p8xa6u">Events</h2> <div class="calendar-actions svelte-1p8xa6u"><!> <!></div></div> <!></div>'),Zr=m('<div class="d-flex flex-column gap-4"><!></div>'),Xr=m("<!> <!> <!> <!>",1);function Mn(y,u){Xt(u,!1);const e=()=>xt(rt,"$calendarEvents",w),v=()=>xt(Vt,"$searchQuery",w),S=()=>xt(ht,"$currentUser",w),B=()=>xt(kt,"$userOrganizations",w),Y=()=>xt(Dt,"$currentUserHasPermission",w),N=()=>xt($t,"$currentUserIsRoot",w),q=()=>xt(bt,"$currentUserIsAdmin",w),W=()=>xt(It,"$ready",w),[w,p]=pe(),ot=P(),it=P(),wt=P(),{stores:{currentUser:ht,currentUserHasPermission:Dt,currentUserIsAdmin:bt,currentUserIsRoot:$t,userOrganizations:kt}}=ke(),{stores:{ready:It,calendarEvents:rt,searchQuery:Vt},actions:{reload:Rt}}=Me(),Ot={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0};let _t=Bt(u,"formId",24,Ee),Lt=Bt(u,"detailsId",24,Ee),Ct=P(!1),Tt=P(!1),Nt=P(),Ft=P(!1),St=P(!1),R=P(new Set),E=P(""),$=P({...Ot}),L=P({...Ot}),at=P(!1);const K=l=>We(l,{currentUserId:t(Nt),isPrivileged:t(Tt),canEditOwnOrgEvents:t(St),userOrganizations:t(R)}),H=l=>l.startsWith("image/");function G(){Rt()}Ye(async()=>{await Rt()});const O=async l=>{if(C(E,"Item Form"),l?.meta_data?.recurring_instance&&l?.meta_data?.recurring_parent_id){const{getCalendarEvent:_}=await Ue(async()=>{const{getCalendarEvent:A}=await import("./DYjrPUtT.js").then(D=>D.x);return{getCalendarEvent:A}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url),x=await _(l.meta_data.recurring_parent_id);if(x){C($,{...x,category:x?.meta_data?.category,start_time:l.start_time,end_time:l.end_time,meta_data:{...x.meta_data,recurring_instance:!0,recurring_parent_id:l.meta_data.recurring_parent_id,recurring_instance_index:l.meta_data.recurring_instance_index}});return}}C($,{...l,category:l?.meta_data?.category})},nt=async l=>{if(l?.meta_data?.recurring_instance&&l?.meta_data?.recurring_parent_id){const{getCalendarEvent:x}=await Ue(async()=>{const{getCalendarEvent:D}=await import("./DYjrPUtT.js").then(T=>T.x);return{getCalendarEvent:D}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url),A=await x(l.meta_data.recurring_parent_id);A?C(L,{...A,start_time:l.start_time,end_time:l.end_time,meta_data:{...A.meta_data,recurring_instance:!0,recurring_parent_id:l.meta_data.recurring_parent_id,recurring_instance_index:l.meta_data.recurring_instance_index}}):C(L,l)}else C(L,l);const _=document.getElementById(Lt());_&&new window.bootstrap.Offcanvas(_).show()},X=async l=>{await O(l);const _=document.getElementById(_t());_&&new window.bootstrap.Offcanvas(_).show()},Z=async()=>{const l=document.getElementById(Lt());if(l){const _=window.bootstrap.Offcanvas.getInstance(l);_&&_.hide()}await O(t(L)),setTimeout(()=>{const _=document.getElementById(_t());_&&new window.bootstrap.Offcanvas(_).show()},300)};J(()=>(e(),Et),()=>{C(ot,(e()??[]).filter(l=>l.start_time?Et(l.start_time)>=new Date:!1))}),J(()=>(v(),t(ot)),()=>{C(it,v()?t(ot).filter(l=>{const _=v().toLowerCase(),x=(l.title||"").toLowerCase(),A=(l.description||"").replace(/<[^>]*>/g,"").toLowerCase(),D=(l.location||"").toLowerCase();return x.includes(_)||A.includes(_)||D.includes(_)}):[])}),J(()=>S(),()=>{C(Nt,S()?.id)}),J(()=>B(),()=>{C(R,B())}),J(()=>(t(R),ue),()=>{C(Ft,t(R).has(ue.Bishopric))}),J(()=>(Y(),At),()=>{C(St,Y()(At.EditOwnOrgEvents))}),J(()=>(N(),q(),t(Ft),Y(),At),()=>{C(Tt,N()||q()||t(Ft)||Y()(At.EditAllEvents))}),J(()=>(Y(),At),()=>{C(Ct,Y()(At.CreateEvents))}),J(()=>(Y(),At),()=>{C(wt,Y()(At.DeleteEvents))}),_e(),ee();var st=Xr(),c=ut(st);xe(c,{get title(){return t(E)},get id(){return _t()},children:(l,_)=>{ze(l,{get eventItem(){return t($)},get drawerId(){return _t()},name:"event-item-form",get canDelete(){return t(wt)}})},$$slots:{default:!0}});var d=o(c,2);xe(d,{title:"Event Details",get id(){return Lt()},children:(l,_)=>{{let x=Wt(()=>(t(L),n(()=>K(t(L)))));Ja(l,{get event(){return t(L)},get canEdit(){return t(x)},onEdit:Z})}},$$slots:{default:!0}});var s=o(d,2);Er(s,{get isOpen(){return t(at)},onClose:()=>C(at,!1),onComplete:G});var b=o(s,2);{var M=l=>{var _=Gr(),x=r(_),A=o(r(x),2),D=r(A);wr(D,{});var T=o(D,2);{var U=g=>{var k=Lr(),tt=o(r(k),2),vt=r(tt),yt=r(vt);a(vt);var mt=o(vt,2),Q=r(mt);a(mt),a(tt),a(k),I(()=>{Mt(yt,"data-bs-target",`#${_t()??""}`),Mt(yt,"aria-controls",_t())}),ft("click",yt,()=>O({...Ot,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),ft("click",Q,()=>C(at,!0)),i(g,k)};h(T,g=>{t(Ct)&&g(U)})}a(A),a(x);var V=o(x,2);{var pt=g=>{var k=Qr(),tt=ut(k);Pr(tt,{get events(){return t(ot)},onEventClick:Q=>nt(Q),onEventEdit:Q=>X(Q),canEditEvent:Q=>K(Q)});var vt=o(tt,2);{var yt=Q=>{var gt=Kr(),Ut=r(gt),jt=r(Ut),ae=r(jt);a(jt),a(Ut);var Gt=o(Ut,2);qt(Gt,5,()=>t(it),Zt=>Zt.id??Zt.start_time,(Zt,ct)=>{const re=Wt(()=>(t(ct),n(()=>t(ct).attachments?.find(et=>H(et.type))))),Qt=Wt(()=>(f(Jt),t(ct),n(()=>Jt(t(ct)?.meta_data?.category??""))));var fe=qr(),De=r(fe),Ce=o(De,2);{var je=et=>{var dt=Nr(),Yt=r(dt);a(dt),I(()=>{Mt(Yt,"src",(f(t(re)),n(()=>t(re).url))),Mt(Yt,"alt",(f(t(re)),n(()=>t(re).name)))}),i(et,dt)};h(Ce,et=>{t(re)&&et(je)})}var oe=o(Ce,2),be=r(oe),Qe=r(be,!0);a(be);var $e=o(be,2),Ie=r($e);{var Je=et=>{var dt=Br(),Yt=r(dt,!0);a(dt),I(()=>{Kt(dt,1,`badge rounded-pill bg-color-${f(t(Qt)),n(()=>t(Qt).color_number)??""}`,"svelte-1p8xa6u"),F(Yt,(f(t(Qt)),n(()=>t(Qt).label)))}),i(et,dt)};h(Ie,et=>{f(t(Qt)),n(()=>t(Qt)?.label)&&et(Je)})}var Se=o(Ie,2);{var Ge=et=>{var dt=Vr(),Yt=r(dt,!0);a(dt),I(ye=>F(Yt,ye),[()=>(f(lt),f(Et),t(ct),n(()=>lt(Et(t(ct).start_time),"MMM d, yyyy")))]),i(et,dt)};h(Se,et=>{t(ct),n(()=>t(ct).start_time)&&et(Ge)})}var Ae=o(Se,2);{var Ze=et=>{var dt=Yr();i(et,dt)},Xe=et=>{var dt=Pt(),Yt=ut(dt);{var ye=ge=>{var he=zr(),na=r(he,!0);a(he),I(sa=>F(na,sa),[()=>(f(lt),f(Et),t(ct),n(()=>lt(Et(t(ct).start_time),"h:mm a")))]),i(ge,he)};h(Yt,ge=>{t(ct),n(()=>t(ct).start_time)&&ge(ye)},!0)}i(et,dt)};h(Ae,et=>{t(ct),n(()=>t(ct).is_all_day)?et(Ze):et(Xe,!1)})}var ta=o(Ae,2);{var ea=et=>{var dt=Wr(),Yt=o(r(dt));a(dt),I(()=>F(Yt,` ${t(ct),n(()=>t(ct).location)??""}`)),i(et,dt)};h(ta,et=>{t(ct),n(()=>t(ct).location)&&et(ea)})}a($e),a(oe);var Oe=o(oe,2),aa=r(Oe);{var ra=et=>{var dt=Hr();ft("click",dt,we(()=>X(t(ct)))),i(et,dt)};h(aa,et=>{t(ct),n(()=>K(t(ct)))&&et(ra)})}a(Oe),a(fe),I(()=>{Kt(De,1,`event-color-indicator bg-color-${f(t(Qt)),n(()=>t(Qt)?.color_number??0)??""}`,"svelte-1p8xa6u"),F(Qe,(t(ct),n(()=>t(ct).title)))}),ft("click",oe,()=>nt(t(ct))),i(Zt,fe)}),a(Gt),a(gt),I(()=>F(ae,`${t(it),n(()=>t(it).length)??""} event${t(it),n(()=>t(it).length===1?"":"s")??""} matching "${v()??""}"`)),i(Q,gt)},mt=Q=>{var gt=Pt(),Ut=ut(gt);{var jt=ae=>{var Gt=jr(),Zt=r(Gt);a(Gt),I(()=>F(Zt,`No events match your search for "${v()??""}"`)),i(ae,Gt)};h(Ut,ae=>{v()&&ae(jt)},!0)}i(Q,gt)};h(vt,Q=>{v(),t(it),n(()=>v()&&t(it).length>0)?Q(yt):Q(mt,!1)})}i(g,k)},z=g=>{var k=Jr(),tt=r(k);{var vt=mt=>{var Q=Ht("No events match your search.");i(mt,Q)},yt=mt=>{var Q=Ht("There are no upcoming events scheduled.");i(mt,Q)};h(tt,mt=>{v()?mt(vt):mt(yt,!1)})}a(k),i(g,k)};h(V,g=>{e(),n(()=>e()?.length)?g(pt):g(z,!1)})}a(_),i(l,_)},j=l=>{var _=Zr(),x=r(_);me(x,{}),a(_),i(l,_)};h(b,l=>{W()?l(M):l(j,!1)})}i(y,st),te(),p()}export{kn as A,Mn as E,xa as s};
