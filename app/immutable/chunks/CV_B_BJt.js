const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ktOKAZrX.js","./CPOcesE7.js","./DIeogL5L.js","./YsHTGu5k.js","./NZTpNUN0.js","./69_IOA4Y.js","./opPvMm1W.js","./DHXte27T.js","./DAwrR-3T.js","./4IVeOVE-.js","./Cp2wIsih.js","./BUApaBEI.js","./C2Q_9cr2.js","./B_ME3evG.js","../assets/Spinner.DTjfhZ6-.css","./C2KIJHii.js","./qd9RxXjB.js","../assets/BishopricApprovalSection.Dj57tXOS.css"])))=>i.map(i=>d[i]);
import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{o as Jt}from"./DHXte27T.js";import{p as Yt,ai as v,g as e,aj as Zt,f as ee,a as Gt,E as i,s as p,D as s,c as n,r as a,u,t as te,R as Se,an as xa,w as de,ao as wa}from"./CPOcesE7.js";import{b,i as y,a as ea,e as ae,s as pe,p as Ma}from"./opPvMm1W.js";import{e as Xe,i as $a}from"./DAwrR-3T.js";import{f as d,a as o,c as Pt,t as De}from"./YsHTGu5k.js";import{s as re}from"./cmIPK5sb.js";import{i as ta}from"./C2Q_9cr2.js";import{k as ve,l as Kt,m as Ia,t as Oa,g as aa,O as ut,P as K,p as F,f as x,c as Wt}from"./4IVeOVE-.js";import{A as ra,b as Aa,c as sa,a as Sa,E as Da}from"./BzXd9kmL.js";import{g as na,c as Nt,e as Ve}from"./ktOKAZrX.js";import{S as oa}from"./B_ME3evG.js";import{v as ia,D as la}from"./Bk17wrXW.js";import{_ as Ua}from"./CmsKOCeN.js";import{s as Ta}from"./qd9RxXjB.js";function Vt(ue,j,O){const m=ve(ue,O),L=ve(j,O),me=+m-Kt(m),T=+L-Kt(L);return Math.round((me-T)/Ia)}function Xt(ue){const j=Oa(ue);return j.setDate(1),j.setHours(0,0,0,0),j}var Wa=d('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add announcement"><i class="bi bi-plus"></i></button>'),Na=d('<div class="announcement-actions svelte-1axao39"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit announcement"><i class="bi bi-pencil-square"></i></button></div>'),Pa=d('<li class="list-group-item py-2"><div class="announcement-row svelte-1axao39"><div class="announcement-content svelte-1axao39"><!></div> <!></div></li>'),Ra=d('<div class="card-footer d-flex align-items-center justify-content-between"><small> </small> <button class="btn btn-primary btn-sm">More</button></div>'),Ca=d('<ul class="list-group list-group-flush border-top-0"></ul> <!>',1),ja=d('<div class="card-body text-muted small"><!></div>'),La=d('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center"><span>Announcements</span> <!></div></div> <!></div>'),za=d('<div class="d-flex flex-column gap-4"><!></div>'),Ba=d("<!> <!>",1);function kr(ue,j){Yt(j,!1);const O=()=>b(We,"$searchQuery",z),m=()=>b(Ge,"$announcements",z),L=()=>b(Ye,"$currentUser",z),me=()=>b(X,"$userOrganizations",z),T=()=>b(Ze,"$currentUserHasPermission",z),V=()=>b(B,"$currentUserIsRoot",z),Ue=()=>b(Te,"$currentUserIsAdmin",z),Je=()=>b(_e,"$ready",z),[z,W]=ea(),ye=i(),be=i(),{stores:{currentUser:Ye,currentUserHasPermission:Ze,currentUserIsAdmin:Te,currentUserIsRoot:B,userOrganizations:X}}=aa(),{stores:{ready:_e,announcements:Ge,searchQuery:We},actions:{reload:mt}}=na(),et={title:"Announcement",description:"",location:"",event_type:"announcement",is_public:!0},se=ia();let tt=i(!1),Ee=i(!1),he=i(),Ne=i(!1),Pe=i(!1),ke=i(!1),xe=i(new Set),Re=i(""),J=i({...et});const at=5,we=5;let A=i(at);function Ce(){s(A,e(A)+we)}const je=g=>sa(g,{currentUserId:e(he),isPrivileged:e(Ee),canEditOwnOrgEvents:e(ke),userOrganizations:e(xe)});Jt(async()=>{await mt()});const fe=g=>{s(Re,"Announcement Form"),s(J,{...g,category:g?.meta_data?.category})};v(()=>(O(),m(),e(A)),()=>{s(ye,O()?m()??[]:(m()??[]).slice(0,e(A)))}),v(()=>(O(),m(),e(A)),()=>{s(be,!O()&&(m()?.length??0)>e(A))}),v(()=>L(),()=>{s(he,L()?.id)}),v(()=>e(he),()=>{s(Pe,!!e(he))}),v(()=>me(),()=>{s(xe,me())}),v(()=>(e(xe),ut),()=>{s(Ne,e(xe).has(ut.Bishopric))}),v(()=>(T(),K),()=>{s(ke,T()(K.EditOwnOrgEvents))}),v(()=>(V(),Ue(),e(Ne),T(),K),()=>{s(Ee,V()||Ue()||e(Ne)||T()(K.EditAllEvents))}),v(()=>(e(Ee),T(),e(ke),e(Pe)),()=>{s(tt,e(Ee)||T()(K.CreateEvents)||e(ke)||e(Pe))}),Zt(),ta();var ge=Ba(),Le=ee(ge);la(Le,{get title(){return e(Re)},get id(){return se},children:(g,w)=>{ra(g,{get eventItem(){return e(J)},get drawerId(){return se},name:"announcement-item-form"})},$$slots:{default:!0}});var ze=p(Le,2);{var rt=g=>{var w=La(),q=n(w),Y=n(q),st=p(n(Y),2);{var ft=S=>{var D=Wa();te(()=>{re(D,"data-bs-target",`#${se??""}`),re(D,"aria-controls",se)}),ae("click",D,()=>fe({...et,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),o(S,D)};y(st,S=>{e(tt)&&S(ft)})}a(Y),a(q);var gt=p(q,2);{var pt=S=>{var D=Ca(),ne=ee(D);Xe(ne,5,()=>e(ye),$a,(N,U)=>{var P=Pa(),t=n(P),r=n(t),f=n(r);Aa(f,{get item(){return e(U)},get searchQuery(){return O()}}),a(r);var M=p(r,2);{var c=l=>{var _=Na(),k=n(_);a(_),te(()=>{re(k,"data-bs-target",`#${se??""}`),re(k,"aria-controls",se)}),ae("click",k,()=>fe(e(U))),o(l,_)};y(M,l=>{e(U),u(()=>je(e(U)))&&l(c)})}a(t),a(P),o(N,P)}),a(ne);var Me=p(ne,2);{var oe=N=>{var U=Ra(),P=n(U),t=n(P);a(P);var r=p(P,2);a(U),te(()=>pe(t,`Showing ${e(A)??""} of ${m(),u(()=>m()?.length??0)??""}`)),ae("click",r,Ce),o(N,U)};y(Me,N=>{e(be)&&N(oe)})}o(S,D)},yt=S=>{var D=Pt(),ne=ee(D);{var Me=oe=>{var N=ja(),U=n(N);{var P=r=>{var f=De("No announcements match your search.");o(r,f)},t=r=>{var f=De("There are no announcements yet.");o(r,f)};y(U,r=>{O()?r(P):r(t,!1)})}a(N),o(oe,N)};y(ne,oe=>{m(),u(()=>m()?.length===0)&&oe(Me)},!0)}o(S,D)};y(gt,S=>{e(ye),u(()=>e(ye).length)?S(pt):S(yt,!1)})}a(w),o(g,w)},_t=g=>{var w=za(),q=n(w);oa(q,{}),a(w),o(g,w)};y(ze,g=>{Je()?g(rt):g(_t,!1)})}o(ue,ge),Gt(),W()}var qa=d('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add event"><i class="bi bi-plus"></i></button>'),Ha=d('<div class="event-actions svelte-i4p9jq"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),Qa=d('<div class="daily-event-row svelte-i4p9jq"><div class="event-content svelte-i4p9jq"><!></div> <!></div>'),Fa=d('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-i4p9jq"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),Ka=d('<li class="list-group-item py-3 text-muted">No events scheduled this week.</li>'),Va=d('<li class="list-group-item list-group-item-light text-uppercase small fw-lighter p-0"><button><span class="d-flex align-items-center gap-2"><i></i> <span class="text-muted"> </span></span> <span> </span></button></li> <!>',1),Xa=d('<li class="list-group-item bg-secondary text-white fw-semibold"> </li> <!>',1),Ja=d('<ul class="list-group list-group-flush border-top-0"></ul>'),Ya=d('<div class="card-body text-muted small"><!></div>'),Za=d('<button class="btn btn-outline-secondary btn-sm">Reset</button>'),Ga=d('<div class="d-flex gap-2"><button class="btn btn-primary btn-sm">More</button> <button class="btn btn-outline-primary btn-sm">All</button></div>'),er=d('<div class="card-footer d-flex align-items-center justify-content-between"><small> </small> <!></div>'),tr=d("<!> <!>",1),ar=d('<div class="card-body text-muted small"><!></div>'),rr=d('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center"><span>Events</span> <div class="d-flex align-items-center gap-2"><!> <!></div></div></div> <!></div>'),sr=d('<div class="d-flex flex-column gap-4"><!></div>'),nr=d("<!> <!>",1);function xr(ue,j){Yt(j,!1);const O=()=>b(Pe,"$weeksExpanded",W),m=()=>b(ke,"$searchQuery",W),L=()=>b(Ne,"$calendarEvents",W),me=()=>b(mt,"$currentUser",W),T=()=>b(Ee,"$userOrganizations",W),V=()=>b(et,"$currentUserHasPermission",W),Ue=()=>b(tt,"$currentUserIsRoot",W),Je=()=>b(se,"$currentUserIsAdmin",W),z=()=>b(he,"$ready",W),[W,ye]=ea(),be=i(),Ye=i(),Ze=i(),Te=i(),B=i(),X=i(),_e=i(),Ge=i(),We=i(),{stores:{currentUser:mt,currentUserHasPermission:et,currentUserIsAdmin:se,currentUserIsRoot:tt,userOrganizations:Ee}}=aa(),{stores:{ready:he,calendarEvents:Ne,weeksExpanded:Pe,searchQuery:ke},actions:{reload:xe}}=na(),Re={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0};let J=Ma(j,"formId",24,ia),at=i(!1),we=i(!1),A=i(),Ce=i(!1),je=i(!1),fe=i(!1),ge=i(new Set),Le=i(""),ze=i({...Re});const rt=8,_t=8;let g=i(rt),w=i(!1);const q=Ta();let Y=i({});function st(t){return t===e(Ye)||t===e(Ze)}function ft(t){const r=e(Y)[t]??st(t);s(Y,{...e(Y),[t]:!r})}const gt=t=>{const r=new Map;for(const c of t){if(!c.start_time)continue;const l=F(c.start_time);if(Number.isNaN(l.getTime()))continue;const _=ve(l,{weekStartsOn:1}),k=Ve(l,{weekStartsOn:1}),R=x(_,"yyyy-MM-dd"),$e=`${x(_,"MMM d")} – ${x(k,"MMM d")}`;let Z=r.get(R);Z||(Z={key:R,label:$e,days:new Map},r.set(R,Z));const E=x(l,"yyyy-MM-dd");let h=Z.days.get(E);h||(h={key:E,displayDay:x(l,"EEE"),displayDate:x(l,"MMM d"),events:[]},Z.days.set(E,h)),h.events.push(c)}const f=c=>{const l=x(c,"yyyy-MM-dd");r.has(l)||r.set(l,{key:l,label:`${x(c,"MMM d")} – ${x(Ve(c,{weekStartsOn:1}),"MMM d")}`,days:new Map})},M=Array.from(r.values());if(M.length){const c=M.reduce((k,R)=>R.key>k?R.key:k,M[0].key),l=F(c);let _=ve(new Date,{weekStartsOn:1});if(_>l)f(_);else for(;_<=l;)f(_),_=Nt(_,1)}return Array.from(r.values()).sort((c,l)=>c.key<l.key?-1:c.key>l.key?1:0).map(c=>({key:c.key,label:c.label,days:Array.from(c.days.values()).sort((l,_)=>l.key<_.key?-1:l.key>_.key?1:0).map(l=>({...l,events:l.events.slice().sort((_,k)=>{const R=_.is_all_day?0:1,$e=k.is_all_day?0:1;if(R!==$e)return R-$e;const Z=_.start_time?F(_.start_time).getTime():Number.MAX_SAFE_INTEGER,E=k.start_time?F(k.start_time).getTime():Number.MAX_SAFE_INTEGER;return Z-E})}))}))};function pt(){s(g,e(g)+_t)}function yt(){s(g,520),s(w,!0)}function S(){s(g,rt),s(w,!1)}const D=t=>sa(t,{currentUserId:e(A),isPrivileged:e(we),canEditOwnOrgEvents:e(fe),userOrganizations:e(ge)});Jt(async()=>{await xe()});const ne=async t=>{if(s(Le,"Item Form"),t?.meta_data?.recurring_instance&&t?.meta_data?.recurring_parent_id){const{getCalendarEvent:r}=await Ua(async()=>{const{getCalendarEvent:M}=await import("./ktOKAZrX.js").then(c=>c.r);return{getCalendarEvent:M}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),import.meta.url),f=await r(t.meta_data.recurring_parent_id);if(f){s(ze,{...f,category:f?.meta_data?.category,start_time:t.start_time,end_time:t.end_time,meta_data:{...f.meta_data,recurring_instance:!0,recurring_parent_id:t.meta_data.recurring_parent_id,recurring_instance_index:t.meta_data.recurring_instance_index}});return}}s(ze,{...t,category:t?.meta_data?.category})};v(()=>e(g),()=>{s(be,Nt(q,e(g)))}),v(()=>ve,()=>{s(Ye,x(ve(q,{weekStartsOn:1}),"yyyy-MM-dd"))}),v(()=>ve,()=>{s(Ze,x(Nt(ve(q,{weekStartsOn:1}),1),"yyyy-MM-dd"))}),v(()=>(O(),m(),e(Y)),()=>{s(Te,t=>O()||m()?!0:e(Y)[t]!==void 0?e(Y)[t]:st(t))}),v(()=>(L(),F),()=>{s(B,(L()??[]).filter(t=>t.start_time?F(t.start_time)>=q:!1))}),v(()=>(m(),e(B),e(be)),()=>{s(X,m()?e(B):e(B).filter(t=>F(t.start_time)<=e(be)))}),v(()=>e(X),()=>{s(_e,gt(e(X)))}),v(()=>(m(),e(B),e(X)),()=>{s(Ge,!m()&&e(B).length>e(X).length)}),v(()=>(e(_e),x),()=>{s(We,e(_e).reduce((t,r)=>{const f=F(r.key),M=Ve(f,{weekStartsOn:1}),c=x(M,"yyyy-MM"),l=x(M,"MMMM yyyy");return t[c]||(t[c]={label:l,weeks:[]}),t[c].weeks.push(r),t},{}))}),v(()=>me(),()=>{s(A,me()?.id)}),v(()=>e(A),()=>{s(je,!!e(A))}),v(()=>T(),()=>{s(ge,T())}),v(()=>(e(ge),ut),()=>{s(Ce,e(ge).has(ut.Bishopric))}),v(()=>(V(),K),()=>{s(fe,V()(K.EditOwnOrgEvents))}),v(()=>(Ue(),Je(),e(Ce),V(),K),()=>{s(we,Ue()||Je()||e(Ce)||V()(K.EditAllEvents))}),v(()=>(e(we),V(),e(fe),e(je)),()=>{s(at,e(we)||V()(K.CreateEvents)||e(fe)||e(je))}),Zt(),ta();var Me=nr(),oe=ee(Me);la(oe,{get title(){return e(Le)},get id(){return J()},children:(t,r)=>{ra(t,{get eventItem(){return e(ze)},get drawerId(){return J()},name:"event-item-form"})},$$slots:{default:!0}});var N=p(oe,2);{var U=t=>{var r=rr(),f=n(r),M=n(f),c=p(n(M),2),l=n(c);Sa(l,{});var _=p(l,2);{var k=E=>{var h=qa();te(()=>{re(h,"data-bs-target",`#${J()??""}`),re(h,"aria-controls",J())}),ae("click",h,()=>ne({...Re,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),o(E,h)};y(_,E=>{e(at)&&E(k)})}a(c),a(M),a(f);var R=p(f,2);{var $e=E=>{var h=tr(),nt=ee(h);{var bt=H=>{var C=Ja();Xe(C,5,()=>(e(We),u(()=>Object.entries(e(We)))),([G,Ie])=>G,(G,Ie)=>{var qe=xa(()=>wa(e(Ie),2));let $=()=>e(qe)[1];var le=Xa(),Q=ee(le),ce=n(Q,!0);a(Q);var ot=p(Q,2);Xe(ot,1,()=>($(),u(()=>$().weeks)),He=>He.key,(He,I)=>{const Rt=Se(()=>(de(F),e(I),u(()=>F(e(I).key)))),it=Se(()=>(de(Ve),de(e(Rt)),u(()=>Ve(e(Rt),{weekStartsOn:1})))),Ct=Se(()=>(de(Xt),de(e(it)),u(()=>Xt(e(it))))),ca=Se(()=>(de(Vt),de(e(it)),de(e(Ct)),u(()=>Vt(e(it),e(Ct),{weekStartsOn:1})+1))),ht=Se(()=>(e(Te),e(I),u(()=>e(Te)(e(I).key)))),lt=Se(()=>(e(I),u(()=>e(I).days.reduce((Fe,ct)=>Fe+ct.events.length,0))));var jt=Va(),kt=ee(jt),Qe=n(kt);let Lt;var xt=n(Qe),zt=n(xt),Bt=p(zt,2),da=n(Bt);a(Bt),a(xt);var wt=p(xt,2);let qt;var va=n(wt,!0);a(wt),a(Qe),a(kt);var ua=p(kt,2);{var ma=Fe=>{var ct=Pt(),_a=ee(ct);{var fa=Oe=>{var dt=Pt(),pa=ee(dt);Xe(pa,1,()=>(e(I),u(()=>e(I).days)),Mt=>Mt.key,(Mt,Ae)=>{var $t=Fa(),Ht=n($t),It=n(Ht),Ot=n(It),ya=n(Ot,!0);a(Ot);var Qt=p(Ot,2),ba=n(Qt,!0);a(Qt),a(It);var Ft=p(It,2);Xe(Ft,5,()=>(e(Ae),u(()=>e(Ae).events)),Ke=>Ke.id??`${Ke.start_time}-${Ke.meta_data?.recurring_instance_index??0}`,(Ke,vt)=>{var At=Qa(),St=n(At),Ea=n(St);Da(Ea,{get item(){return e(vt)},showDate:!1,get searchQuery(){return m()}}),a(St);var ha=p(St,2);{var ka=Dt=>{var Ut=Ha(),Tt=n(Ut);a(Ut),te(()=>{re(Tt,"data-bs-target",`#${J()??""}`),re(Tt,"aria-controls",J())}),ae("click",Tt,()=>ne(e(vt))),o(Dt,Ut)};y(ha,Dt=>{e(vt),u(()=>D(e(vt)))&&Dt(ka)})}a(At),o(Ke,At)}),a(Ft),a(Ht),a($t),te(()=>{pe(ya,(e(Ae),u(()=>e(Ae).displayDay))),pe(ba,(e(Ae),u(()=>e(Ae).displayDate)))}),o(Mt,$t)}),o(Oe,dt)},ga=Oe=>{var dt=Ka();o(Oe,dt)};y(_a,Oe=>{e(I),u(()=>e(I).days.length)?Oe(fa):Oe(ga,!1)})}o(Fe,ct)};y(ua,Fe=>{e(ht)&&Fe(ma)})}te(()=>{Lt=Wt(Qe,1,"week-header w-100 d-flex justify-content-between align-items-center border-0 bg-transparent p-2 text-start svelte-i4p9jq",null,Lt,{"text-muted":e(lt)===0}),re(Qe,"title",e(ht)?"Click to collapse week":"Click to expand week"),Wt(zt,1,`bi ${e(ht)?"bi-chevron-up":"bi-chevron-down"}`),pe(da,`Week ${e(ca)??""} [${e(lt)??""} Event${e(lt)===1?"":"s"}]`),qt=Wt(wt,1,"",null,qt,{"opacity-50":e(lt)===0}),pe(va,(e(I),u(()=>e(I).label)))}),ae("click",Qe,()=>ft(e(I).key)),o(He,jt)}),te(()=>pe(ce,($(),u(()=>$().label)))),o(G,le)}),a(C),o(H,C)},Et=H=>{var C=Ya(),G=n(C);{var Ie=$=>{var le=De("No events match your search.");o($,le)},qe=$=>{var le=De("There are no upcoming events this month.");o($,le)};y(G,$=>{m()?$(Ie):$(qe,!1)})}a(C),o(H,C)};y(nt,H=>{e(_e),u(()=>e(_e).length)?H(bt):H(Et,!1)})}var ie=p(nt,2);{var Be=H=>{var C=er(),G=n(C),Ie=n(G);a(G);var qe=p(G,2);{var $=Q=>{var ce=Za();ae("click",ce,S),o(Q,ce)},le=Q=>{var ce=Ga(),ot=n(ce),He=p(ot,2);a(ce),ae("click",ot,pt),ae("click",He,yt),o(Q,ce)};y(qe,Q=>{e(w)?Q($):Q(le,!1)})}a(C),te(()=>pe(Ie,`Showing ${e(X),u(()=>e(X).length)??""} of ${e(B),u(()=>e(B).length)??""} future events`)),o(H,C)};y(ie,H=>{(e(Ge)||e(w))&&H(Be)})}o(E,h)},Z=E=>{var h=ar(),nt=n(h);{var bt=ie=>{var Be=De("No events match your search.");o(ie,Be)},Et=ie=>{var Be=De("There are no upcoming events scheduled.");o(ie,Be)};y(nt,ie=>{m()?ie(bt):ie(Et,!1)})}a(h),o(E,h)};y(R,E=>{L(),u(()=>L()?.length)?E($e):E(Z,!1)})}a(r),o(t,r)},P=t=>{var r=sr(),f=n(r);oa(f,{}),a(r),o(t,r)};y(N,t=>{z()?t(U):t(P,!1)})}o(ue,Me),Gt(),ye()}export{kr as A,xr as E,Vt as d,Xt as s};
