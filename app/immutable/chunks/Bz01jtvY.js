const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./oGHNZfsf.js","./D2Wl5k_M.js","./DIeogL5L.js","./DfqsuKYE.js","./CmsKOCeN.js","./NZTpNUN0.js","./69_IOA4Y.js","./DB0qkhVq.js","./Dp64CMOB.js","./DQG7ZT7M.js","./qUE-nNH0.js","./DmmHGDVV.js","./BUApaBEI.js","./CPbJ_PqI.js","./AGB-_hs9.js","../assets/Spinner.DTjfhZ6-.css","./DrikPB-j.js","./CMEL2kP5.js","./D4FdWAE2.js","./vhQtniU6.js","./Yg_LT0aQ.js","./BicphDRr.js","./D5tvMO_e.js","./DPizCJj8.js","./CRTjJZPE.js","./CSiMCzJH.js","./EwVbW1vn.js","./GTetIcPS.js","../assets/confirm.ChDpDKXb.css","./C2hsME61.js","./DF0IcKPy.js","./Da0mNRZ0.js","../assets/CalendarEventForm.6P4cN81z.css"])))=>i.map(i=>d[i]);
import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{w as ma,g as Be,o as Xe}from"./DB0qkhVq.js";import{h as _a,d as pa,be as fa,P as ba,p as ue,ah as N,o as p,g as t,ai as $e,t as I,a as me,E as T,s as i,c as r,D as C,r as n,u as a,f as lt,F as ve,i as Ve,R as Jt}from"./D2Wl5k_M.js";import{B as ya,p as zt,i as E,s as F,e as gt,d as ga,b as Pe,a as Mt,j as ha}from"./Dp64CMOB.js";import{e as Zt,i as de}from"./DrikPB-j.js";import{f,a as l,c as Lt,t as se}from"./DfqsuKYE.js";import{s as Tt,e as Ea,b as wa,i as Ne,d as Ye}from"./DQG7ZT7M.js";import{t as xe,q as He,h as vt,p as Dt,e as ne,d as ke,y as xa,A as ge,O as Me,P as Kt,z as ka}from"./qUE-nNH0.js";import{s as De}from"./CdEA5IGF.js";import{i as _e}from"./CPbJ_PqI.js";import{b as Xt,h as Ue,e as ta,f as Ma,i as he,g as ea,C as aa,m as Ke,c as Ee}from"./oGHNZfsf.js";import{P as Da}from"./6mrJtLS3.js";import{p as Oa,a as We}from"./CSiMCzJH.js";import{S as Oe}from"./AGB-_hs9.js";import{v as Ce,D as Ie}from"./DF0IcKPy.js";import{c as na}from"./BqDBnger.js";import{_ as qe}from"./CmsKOCeN.js";import{R as ce}from"./DPizCJj8.js";import{c as Ca,e as Ia}from"./Da0mNRZ0.js";import{i as we}from"./ClZ1jIp7.js";import{e as $a}from"./CRTjJZPE.js";function Aa(x,u,e){_a&&pa();var m=new ya(x),D=!fa();ba(()=>{var U=u();D&&U!==null&&typeof U=="object"&&(U={}),m.ensure(U,e)})}function ra(x,u){const e=xe(x);if(isNaN(u))return He(x,NaN);if(!u)return e;const m=e.getDate(),D=He(x,e.getTime());D.setMonth(e.getMonth()+u+1,0);const U=D.getDate();return m>=U?D:(e.setFullYear(D.getFullYear(),D.getMonth(),m),e)}function je(x){const u=xe(x);return u.setDate(1),u.setHours(0,0,0,0),u}function Qe(x,u){const e=xe(x),m=xe(u);return e.getFullYear()===m.getFullYear()&&e.getMonth()===m.getMonth()}function Je(x){return we(x,Ca(x))}function Sa(x,u){return ra(x,-1)}var za=f('<div class="event-header-image svelte-lu3xbf"><img class="svelte-lu3xbf"/></div>'),Ta=f("<span> </span>"),Fa=f('<button type="button" class="btn btn-sm btn-primary"><i class="bi bi-pencil"></i> Edit</button>'),Ra=f('<p class="section-content svelte-lu3xbf"><span class="badge bg-secondary">All Day Event</span></p>'),Ua=f('<p class="section-content svelte-lu3xbf"> </p>'),Pa=f('<p class="section-content svelte-lu3xbf"><strong> </strong></p> <!>',1),La=f('<p class="section-content text-muted svelte-lu3xbf"><i class="bi bi-arrow-repeat"></i> <!></p>'),Ba=f('<p class="section-content text-muted svelte-lu3xbf"><i class="bi bi-arrow-repeat"></i> Part of recurring event series</p>'),Va=f('<div class="event-section svelte-lu3xbf"><h6 class="section-label svelte-lu3xbf"><i class="bi bi-geo-alt"></i> Location</h6> <p class="section-content svelte-lu3xbf"> </p></div>'),Na=f('<div class="event-section svelte-lu3xbf"><h6 class="section-label svelte-lu3xbf"><i class="bi bi-card-text"></i> Description</h6> <div class="section-content event-description svelte-lu3xbf"><!></div></div>'),Ya=f('<div class="attachment-image-container svelte-lu3xbf"><button type="button" class="attachment-image-button svelte-lu3xbf"><img class="attachment-image svelte-lu3xbf"/></button> <div class="attachment-image-label svelte-lu3xbf"><small class="text-muted"> </small></div></div>'),Ha=f('<button type="button" class="btn btn-outline-secondary attachment-file-button svelte-lu3xbf"><i class="bi bi-file-pdf"></i> <span class="text-truncate svelte-lu3xbf"> </span> <small class="text-muted"> </small></button>'),Ka=f('<div class="event-section svelte-lu3xbf"><h6 class="section-label svelte-lu3xbf"><i class="bi bi-paperclip"></i> Attachments</h6> <div class="attachments-grid svelte-lu3xbf"></div></div>'),Wa=f('<p class="metadata-item svelte-lu3xbf"><i class="bi bi-clock-history"></i> Posted <!> <!></p>'),qa=f('<p class="metadata-item svelte-lu3xbf"><i class="bi bi-pencil-square"></i> Last edited <!> <!></p>'),ja=f('<div class="event-section event-metadata svelte-lu3xbf"><!> <!></div>'),Qa=f('<div class="event-details-view svelte-lu3xbf"><div class="event-header svelte-lu3xbf"><div class="event-header-content svelte-lu3xbf"><!> <div class="event-header-text svelte-lu3xbf"><h3 class="event-title svelte-lu3xbf"> </h3> <!></div></div> <!></div> <div class="event-section svelte-lu3xbf"><h6 class="section-label svelte-lu3xbf"><i class="bi bi-calendar-event"></i> Date & Time</h6> <!> <!></div> <!> <!> <!> <!></div>');function sa(x,u){ue(u,!1);const e=T(),m=T(),D=T(),U=T(),X=T(),V=T(),W=T(),ct=T(),Y=T();let g=zt(u,"event",8),L=zt(u,"onEdit",8,null),ht=zt(u,"canEdit",8,!1);const mt=s=>s.startsWith("image/"),wt=s=>s<1024?s+" B":s<1024*1024?(s/1024).toFixed(1)+" KB":(s/(1024*1024)).toFixed(1)+" MB",tt=s=>{window.open(s,"_blank")},G=s=>{if(!s)return"";try{return vt(Dt(s),"MMM d, yyyy 'at' h:mm a")}catch{return""}},q=s=>{try{const o=ce.fromString(s).origOptions,b=o.interval||1,M=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],$=["","1st","2nd","3rd","4th","5th"];if(o.freq===ce.DAILY)return b===1?"Repeats daily":`Repeats every ${b} days`;if(o.freq===ce.WEEKLY){if(o.byweekday){const h=(Array.isArray(o.byweekday)?o.byweekday:[o.byweekday]).map(y=>{const A=typeof y=="number"?y:y.weekday,d=A===6?0:A+1;return M[d]});return b===1?h.length===1?`Repeats every ${h[0]}`:`Repeats on ${h.join(", ")}`:`Repeats every ${b} weeks on ${h.join(", ")}`}return b===1?"Repeats weekly":`Repeats every ${b} weeks`}if(o.freq===ce.MONTHLY){if(o.byweekday){const h=(Array.isArray(o.byweekday)?o.byweekday:[o.byweekday])[0];if(h&&typeof h=="object"&&"n"in h&&"weekday"in h){const y=h.weekday,A=y===6?0:y+1,d=h.n,c=$[d]||`${d}th`;return b===1?`Repeats on the ${c} ${M[A]} of the month`:`Repeats on the ${c} ${M[A]} every ${b} months`}}if(o.bymonthday){const k=Array.isArray(o.bymonthday)?o.bymonthday[0]:o.bymonthday,h=k===1?"st":k===2?"nd":k===3?"rd":"th";return b===1?`Repeats on the ${k}${h} of the month`:`Repeats on the ${k}${h} every ${b} months`}return b===1?"Repeats monthly":`Repeats every ${b} months`}if(o.freq===ce.YEARLY){if(o.bymonth&&o.bymonthday){const k=["","January","February","March","April","May","June","July","August","September","October","November","December"],h=Array.isArray(o.bymonth)?o.bymonth[0]:o.bymonth,y=Array.isArray(o.bymonthday)?o.bymonthday[0]:o.bymonthday,A=y===1?"st":y===2?"nd":y===3?"rd":"th";return b===1?`Repeats every ${k[h]} ${y}${A}`:`Repeats every ${b} years on ${k[h]} ${y}${A}`}return b===1?"Repeats yearly":`Repeats every ${b} years`}return"Repeats"}catch{return"Repeats"}};N(()=>p(g()),()=>{C(e,Xt(g()?.meta_data?.organization??""))}),N(()=>p(g()),()=>{C(m,g().meta_data?.submitted_at??g().created_at)}),N(()=>t(m),()=>{C(D,G(t(m)))}),N(()=>p(g()),()=>{C(U,g().meta_data?.submitted_by_name)}),N(()=>(t(D),t(U)),()=>{C(X,!!(t(D)||t(U)))}),N(()=>p(g()),()=>{C(V,G(g().meta_data?.edited_at))}),N(()=>p(g()),()=>{C(W,g().meta_data?.edited_by_name)}),N(()=>(t(V),t(W)),()=>{C(ct,!!(t(V)||t(W)))}),N(()=>p(g()),()=>{C(Y,g().attachments?.find(s=>mt(s.type)))}),$e(),_e();var At=Qa(),Bt=r(At),et=r(Bt),te=r(et);{var Vt=s=>{var v=za(),o=r(v);n(v),I(()=>{Tt(o,"src",(t(Y),a(()=>t(Y).url))),Tt(o,"alt",(t(Y),a(()=>t(Y).name)))}),l(s,v)};E(te,s=>{t(Y)&&s(Vt)})}var Nt=i(te,2),Ot=r(Nt),Gt=r(Ot,!0);n(Ot);var Yt=i(Ot,2);{var Rt=s=>{var v=Ta(),o=r(v,!0);n(v),I(()=>{ne(v,1,`badge rounded-pill bg-color-${t(e),a(()=>t(e).color_number)??""}`,"svelte-lu3xbf"),F(o,(t(e),a(()=>t(e).label)))}),l(s,v)};E(Yt,s=>{t(e),a(()=>t(e)?.label)&&s(Rt)})}n(Nt),n(et);var Ut=i(et,2);{var Wt=s=>{var v=Fa();gt("click",v,function(...o){L()?.apply(this,o)}),l(s,v)};E(Ut,s=>{ht()&&L()&&s(Wt)})}n(Bt);var St=i(Bt,2),Ft=i(r(St),2);{var P=s=>{var v=Pa(),o=lt(v),b=r(o),M=r(b,!0);n(b),n(o);var $=i(o,2);{var k=y=>{var A=Ra();l(y,A)},h=y=>{var A=Lt(),d=lt(A);{var c=_=>{var O=Ua(),R=r(O);n(O),I((S,B)=>F(R,`${S??""} - ${B??""}`),[()=>(p(vt),p(Dt),p(g()),a(()=>vt(Dt(g().start_time),"h:mm a"))),()=>(p(vt),p(Dt),p(g()),a(()=>vt(Dt(g().end_time),"h:mm a")))]),l(_,O)};E(d,_=>{p(g()),a(()=>g().start_time&&g().end_time)&&_(c)},!0)}l(y,A)};E($,y=>{p(g()),a(()=>g().is_all_day)?y(k):y(h,!1)})}I(y=>F(M,y),[()=>(p(vt),p(Dt),p(g()),a(()=>vt(Dt(g().start_time),"EEEE, MMMM d, yyyy")))]),l(s,v)};E(Ft,s=>{p(g()),a(()=>g().start_time)&&s(P)})}var j=i(Ft,2);{var ft=s=>{var v=La(),o=i(r(v)),b=i(o);{var M=$=>{var k=se();I(h=>F(k,`until ${h??""}`),[()=>(p(vt),p(Dt),p(g()),a(()=>vt(Dt(g().recurrence_end_date),"MMM d, yyyy")))]),l($,k)};E(b,$=>{p(g()),a(()=>g().recurrence_end_date)&&$(M)})}n(v),I($=>F(o,` ${$??""} `),[()=>(p(g()),a(()=>q(g().recurrence_rule)))]),l(s,v)},bt=s=>{var v=Lt(),o=lt(v);{var b=M=>{var $=Ba();l(M,$)};E(o,M=>{p(g()),a(()=>g()?.meta_data?.recurring_instance)&&M(b)},!0)}l(s,v)};E(j,s=>{p(g()),a(()=>g().recurrence_rule)?s(ft):s(bt,!1)})}n(St);var xt=i(St,2);{var st=s=>{var v=Va(),o=i(r(v),2),b=r(o,!0);n(o),n(v),I(()=>F(b,(p(g()),a(()=>g().location)))),l(s,v)};E(xt,s=>{p(g()),a(()=>g().location)&&s(st)})}var yt=i(xt,2);{var H=s=>{var v=Na(),o=i(r(v),2),b=r(o);Ue(b,()=>(p(g()),a(()=>g().description))),n(o),n(v),l(s,v)};E(yt,s=>{p(g()),a(()=>g().description)&&s(H)})}var dt=i(yt,2);{var Ct=s=>{var v=Ka(),o=i(r(v),2);Zt(o,5,()=>(p(g()),a(()=>g().attachments)),b=>b.id,(b,M)=>{var $=Lt(),k=lt($);{var h=A=>{var d=Ya(),c=r(d),_=r(c);n(c);var O=i(c,2),R=r(O),S=r(R,!0);n(R),n(O),n(d),I(()=>{Tt(c,"title",`Open ${t(M),a(()=>t(M).name)??""}`),Tt(_,"src",(t(M),a(()=>t(M).url))),Tt(_,"alt",(t(M),a(()=>t(M).name))),F(S,(t(M),a(()=>t(M).name)))}),gt("click",c,()=>tt(t(M).url)),l(A,d)},y=A=>{var d=Ha(),c=i(r(d),2),_=r(c,!0);n(c);var O=i(c,2),R=r(O);n(O),n(d),I(S=>{Tt(d,"title",`Open ${t(M),a(()=>t(M).name)??""}`),F(_,(t(M),a(()=>t(M).name))),F(R,`(${S??""})`)},[()=>(t(M),a(()=>wt(t(M).size)))]),gt("click",d,()=>tt(t(M).url)),l(A,d)};E(k,A=>{t(M),a(()=>mt(t(M).type))?A(h):A(y,!1)})}l(b,$)}),n(o),n(v),l(s,v)};E(dt,s=>{p(g()),a(()=>g().attachments&&g().attachments.length>0)&&s(Ct)})}var nt=i(dt,2);{var ot=s=>{var v=ja(),o=r(v);{var b=k=>{var h=Wa(),y=i(r(h),2);{var A=_=>{var O=se();I(()=>F(O,t(D))),l(_,O)};E(y,_=>{t(D)&&_(A)})}var d=i(y,2);{var c=_=>{var O=se();I(()=>F(O,`by ${t(U)??""}`)),l(_,O)};E(d,_=>{t(U)&&_(c)})}n(h),l(k,h)};E(o,k=>{t(X)&&k(b)})}var M=i(o,2);{var $=k=>{var h=qa(),y=i(r(h),2);{var A=_=>{var O=se();I(()=>F(O,t(V))),l(_,O)};E(y,_=>{t(V)&&_(A)})}var d=i(y,2);{var c=_=>{var O=se();I(()=>F(O,`by ${t(W)??""}`)),l(_,O)};E(d,_=>{t(W)&&_(c)})}n(h),l(k,h)};E(M,k=>{t(ct)&&k($)})}n(v),l(s,v)};E(nt,s=>{(t(X)||t(ct))&&s(ot)})}n(At),I(()=>F(Gt,(p(g()),a(()=>g().title)))),l(x,At),me()}const oa={},ia={};for(const x of Object.values(ta))x.key&&(oa[x.label.toLowerCase()]=x.key,ia[x.key]=x.label);const Ja=new Set(Object.values(ta).map(x=>x.key).filter(Boolean));function Ga(x){const u=x.trim();if(u)return Ja.has(u.toUpperCase())?u.toUpperCase():oa[u.toLowerCase()]}async function Za(x){return new Promise((u,e)=>{Da.parse(x,{header:!0,skipEmptyLines:!0,complete:m=>{const D=m.data,U=m.meta.fields||[];u({data:D,columns:U})},error:m=>e(m)})})}function Xa(x){return x.map(u=>{const e=u.toLowerCase().trim();return e==="title"||e==="event"||e==="event name"||e==="name"?{csvColumn:u,eventField:"title"}:e==="description"||e==="details"||e==="notes"?{csvColumn:u,eventField:"description"}:e==="start date"||e==="start_date"||e==="date"||e==="event date"?{csvColumn:u,eventField:"start_date"}:e==="start time"||e==="start_time"||e==="time"||e==="event time"?{csvColumn:u,eventField:"start_time"}:e==="end date"||e==="end_date"?{csvColumn:u,eventField:"end_date"}:e==="end time"||e==="end_time"?{csvColumn:u,eventField:"end_time"}:e==="location"||e==="place"||e==="venue"?{csvColumn:u,eventField:"location"}:e==="organization"||e==="group"||e==="organization"||e==="org"?{csvColumn:u,eventField:"organization"}:e==="all day"||e==="all_day"||e==="is_all_day"||e==="allday"?{csvColumn:u,eventField:"is_all_day"}:{csvColumn:u,eventField:null}})}function re(x,u,e){const m=u.find(D=>D.eventField===e);return m?(x[m.csvColumn]||"").trim():""}function Ge(x){const u=["yyyy-MM-dd","MM/dd/yyyy","M/d/yyyy","MM-dd-yyyy","M-d-yyyy","MM/dd/yy","M/d/yy","yyyy/MM/dd","MMM d, yyyy","MMMM d, yyyy","MMM d yyyy","d MMM yyyy"];for(const e of u){const m=Oa(x,e,new Date);if(xa(m))return m}return null}function Ze(x){const u=x.match(/^(\d{1,2}):(\d{2})$/);if(u){const m=parseInt(u[1],10),D=parseInt(u[2],10);if(m>=0&&m<=23&&D>=0&&D<=59)return{hours:m,minutes:D}}const e=x.match(/^(\d{1,2})(?::(\d{2}))?\s*(am|pm)$/i);if(e){let m=parseInt(e[1],10);const D=e[2]?parseInt(e[2],10):0,U=e[3].toLowerCase();if(m>=1&&m<=12&&D>=0&&D<=59)return U==="pm"&&m!==12&&(m+=12),U==="am"&&m===12&&(m=0),{hours:m,minutes:D}}return null}function tn(x){const u=x.toLowerCase().trim();return["true","yes","1","y","x"].includes(u)}function en(x,u,e){const m=[],D=re(x,u,"title"),U=re(x,u,"description"),X=re(x,u,"start_date"),V=re(x,u,"start_time"),W=re(x,u,"end_date"),ct=re(x,u,"end_time"),Y=re(x,u,"location"),g=re(x,u,"organization"),L=re(x,u,"is_all_day");if(!D)return m.push({row:e,field:"title",message:"Title is required"}),{event:null,errors:m};if(D.length<3)return m.push({row:e,field:"title",message:"Title must be at least 3 characters"}),{event:null,errors:m};if(D.length>255)return m.push({row:e,field:"title",message:"Title cannot exceed 255 characters"}),{event:null,errors:m};if(!X)return m.push({row:e,field:"start_date",message:"Start date is required"}),{event:null,errors:m};const ht=Ge(X);if(!ht)return m.push({row:e,field:"start_date",message:`Invalid date format: "${X}"`}),{event:null,errors:m};const mt=L?tn(L):!V;let wt;if(!mt&&V){const et=Ze(V);if(!et)return m.push({row:e,field:"start_time",message:`Invalid time format: "${V}"`}),{event:null,errors:m};ht.setHours(et.hours,et.minutes,0,0),wt=he(ht,ge)}else ht.setHours(0,0,0,0),wt=he(ht,ge);let tt;const G=W?Ge(W):new Date(ht);if(G&&!mt&&ct){const et=Ze(ct);if(!et)return m.push({row:e,field:"end_time",message:`Invalid time format: "${ct}"`}),{event:null,errors:m};G.setHours(et.hours,et.minutes,0,0),tt=he(G,ge)}else if(!mt&&V)tt=new Date(wt.getTime()+60*60*1e3);else{const et=G||new Date(ht);et.setHours(23,59,59,0),tt=he(et,ge)}let q;if(g&&(q=Ga(g),!q))return m.push({row:e,field:"organization",message:`Unknown organization: "${g}"`}),{event:null,errors:m};if(Y&&Y.length>255)return m.push({row:e,field:"location",message:"Location cannot exceed 255 characters"}),{event:null,errors:m};const At={};if(q){At.organization=q;const et=ia[q];et&&(At.organization_label=et)}return{event:{title:D,event_type:"calendar_event",start_time:wt.toISOString(),end_time:tt.toISOString(),is_all_day:mt,is_public:!0,is_published:!1,meta_data:At,...U?{description:U}:{},...Y?{location:Y}:{}},errors:[]}}async function an(x,u){const e={success:0,validationErrors:0,errors:[]},m=[];for(let V=0;V<x.length;V++){const{event:W,errors:ct}=en(x[V],u,V+1);if(ct.length>0){e.validationErrors++,e.errors.push(...ct);continue}W&&m.push(W)}const D=ke(),U=D?Be(D.stores.currentUser):void 0,X=D?Be(D.stores.userOrganizations):void 0;if(U){const V=U.displayName||U.username,W=U.id,ct=X?Array.from(X):[],Y=new Date().toISOString();for(const g of m){const L=g.meta_data||{};V&&(L.submitted_by_name=V),W&&(L.submitted_by_user_id=W),ct.length&&(L.submitted_by_organizations=ct),L.submitted_at=Y,g.meta_data=L}}return m.length>0&&(await Ma(m),e.success=m.length),e}function nn(){const x=ma({step:"upload",csvData:[],csvColumns:[],columnMappings:[],importResult:null});return{state:x,parseCsvFile:Za,autoDetectMappings:Xa,importEvents:an,reset:()=>x.set({step:"upload",csvData:[],csvColumns:[],columnMappings:[],importResult:null})}}var rn=f(`<p class="text-muted small mb-3">Upload a CSV file to bulk-import calendar events. Need a starting point? <a href="/sample-events.csv" download="">Download sample CSV template</a>.</p> <div class="mb-3"><label for="csvFile" class="form-label">Select CSV File</label> <input type="file" class="form-control" id="csvFile" accept=".csv"/></div> <div class="alert alert-warning small mb-3 d-flex align-items-start gap-2"><i class="bi bi-info-circle mt-1"></i> <span>All imported events require <strong>bishopric approval</strong> before they appear on the
							public calendar.</span></div> <div class="alert alert-info small mb-0"><strong>Format Guide:</strong> <ul class="mb-0 mt-1"><li><strong>Required columns:</strong> Title, Date</li> <li><strong>Optional columns:</strong> Start Time, End Time, Location, Category, Description</li> <li>Dates: YYYY-MM-DD, MM/DD/YYYY, Jan 1, 2025, etc.</li> <li>Times: 7:00 PM, 19:00, etc. (omit for all-day events)</li> <li>Categories: Ward, Relief Society, Elders Quorum, Youth, Young Women, Young Men,
								Primary, etc.</li></ul></div>`,1),sn=f('<tr><td> </td><td><select class="form-select form-select-sm"><option>-- Skip --</option><option>Title</option><option>Description</option><option>Start Date</option><option>Start Time</option><option>End Date</option><option>End Time</option><option>Location</option><option>Category</option><option>All Day</option></select></td></tr>'),on=f('<h6>Map CSV Columns to Event Fields</h6> <p class="text-muted"> </p> <table class="table table-sm"><thead><tr><th>CSV Column</th><th>Maps To</th></tr></thead><tbody></tbody></table>',1),ln=f('<div class="text-center py-5"><!> <p class="mt-3">Importing events...</p></div>'),vn=f("<li><strong> </strong> rows had validation errors</li>"),cn=f(`<div class="alert alert-info small">Imported events are <strong>unpublished</strong> and will need bishopric approval before
							they appear on the public calendar.</div>`),dn=f("<li> </li>"),un=f("<li><em> </em></li>"),mn=f('<div class="alert alert-warning"><h6>Validation Errors:</h6> <ul class="mb-0" style="max-height: 200px; overflow-y: auto;"><!> <!></ul></div>'),_n=f('<div class="alert alert-success"><h6>Import Complete</h6> <ul class="mb-0"><li><strong> </strong> events imported successfully</li> <!></ul></div> <!> <!>',1),pn=f('<button type="button" class="btn btn-secondary">Cancel</button>'),fn=f('<button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-primary"> </button>',1),bn=f('<button type="button" class="btn btn-secondary" disabled>Cancel</button> <button type="button" class="btn btn-primary" disabled><!> Importing...</button>',1),yn=f('<button type="button" class="btn btn-primary">Done</button>'),gn=f('<div class="modal-backdrop fade show"></div>'),hn=f('<div tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Import Events from CSV</h5> <button type="button" class="btn-close" aria-label="Close import modal"></button></div> <div class="modal-body"><!></div> <div class="modal-footer"><!></div></div></div></div> <!>',1);function En(x,u){ue(u,!1);const e=()=>Mt(W,"$state",m),[m,D]=Pe();let U=zt(u,"isOpen",8,!1),X=zt(u,"onClose",8),V=zt(u,"onComplete",8);const{state:W,parseCsvFile:ct,autoDetectMappings:Y,importEvents:g,reset:L}=nn();async function ht(P){const j=P.target.files?.[0];if(j)try{const{data:ft,columns:bt}=await ct(j),xt=Y(bt);W.update(st=>({...st,step:"mapping",csvData:ft,csvColumns:bt,columnMappings:xt}))}catch(ft){console.error("Failed to parse CSV:",ft),alert("Failed to parse CSV file. Please check the file format.")}}async function mt(){W.update(P=>({...P,step:"importing"}));try{const P=await g(e().csvData,e().columnMappings);W.update(j=>({...j,step:"complete",importResult:P})),V()()}catch(P){console.error("Failed to import events:",P),alert("Failed to import events. Please try again."),W.update(j=>({...j,step:"mapping"}))}}function wt(){L(),X()()}_e();var tt=hn(),G=lt(tt);let q;var At=r(G),Bt=r(At),et=r(Bt),te=i(r(et),2);te.__click=wt,n(et);var Vt=i(et,2),Nt=r(Vt);{var Ot=P=>{var j=rn(),ft=i(lt(j),2),bt=i(r(ft),2);bt.__change=ht,n(ft),ve(4),l(P,j)},Gt=P=>{var j=Lt(),ft=lt(j);{var bt=st=>{var yt=on(),H=i(lt(yt),2),dt=r(H);n(H);var Ct=i(H,2),nt=i(r(Ct));Zt(nt,5,()=>(e(),a(()=>e().columnMappings)),de,(ot,s,v)=>{var o=sn(),b=r(o),M=r(b,!0);n(b);var $=i(b),k=r($);I(()=>{t(s),Ve(()=>{})});var h=r(k);h.value=(h.__value=null)??"";var y=i(h);y.value=y.__value="title";var A=i(y);A.value=A.__value="description";var d=i(A);d.value=d.__value="start_date";var c=i(d);c.value=c.__value="start_time";var _=i(c);_.value=_.__value="end_date";var O=i(_);O.value=O.__value="end_time";var R=i(O);R.value=R.__value="location";var S=i(R);S.value=S.__value="category";var B=i(S);B.value=B.__value="is_all_day",n(k),n($),n(o),I(()=>F(M,(t(s),a(()=>t(s).csvColumn)))),wa(k,()=>t(s).eventField,Et=>(t(s).eventField=Et,Ve(()=>e()),ha(m,"$state"))),l(ot,o)}),n(nt),n(Ct),I(()=>F(dt,`Found ${e(),a(()=>e().csvData.length)??""} rows in CSV`)),l(st,yt)},xt=st=>{var yt=Lt(),H=lt(yt);{var dt=nt=>{var ot=ln(),s=r(ot);Oe(s,{}),ve(2),n(ot),l(nt,ot)},Ct=nt=>{var ot=Lt(),s=lt(ot);{var v=o=>{var b=_n(),M=lt(b),$=i(r(M),2),k=r($),h=r(k),y=r(h,!0);n(h),ve(),n(k);var A=i(k,2);{var d=S=>{var B=vn(),Et=r(B),Pt=r(Et,!0);n(Et),ve(),n(B),I(()=>F(Pt,(e(),a(()=>e().importResult.validationErrors)))),l(S,B)};E(A,S=>{e(),a(()=>e().importResult?.validationErrors&&e().importResult.validationErrors>0)&&S(d)})}n($),n(M);var c=i(M,2);{var _=S=>{var B=cn();l(S,B)};E(c,S=>{e(),a(()=>e().importResult?.success&&e().importResult.success>0)&&S(_)})}var O=i(c,2);{var R=S=>{var B=mn(),Et=i(r(B),2),Pt=r(Et);Zt(Pt,1,()=>(e(),a(()=>e().importResult.errors.slice(0,10))),de,(pt,J)=>{var at=dn(),ut=r(at);n(at),I(()=>F(ut,`Row ${t(J),a(()=>t(J).row)??""}: ${t(J),a(()=>t(J).message)??""}`)),l(pt,at)});var qt=i(Pt,2);{var _t=pt=>{var J=un(),at=r(J),ut=r(at);n(at),n(J),I(()=>F(ut,`... and ${e(),a(()=>e().importResult.errors.length-10)??""} more errors`)),l(pt,J)};E(qt,pt=>{e(),a(()=>e().importResult.errors.length>10)&&pt(_t)})}n(Et),n(B),l(S,B)};E(O,S=>{e(),a(()=>e().importResult?.errors&&e().importResult.errors.length>0)&&S(R)})}I(()=>F(y,(e(),a(()=>e().importResult?.success||0)))),l(o,b)};E(s,o=>{e(),a(()=>e().step==="complete")&&o(v)},!0)}l(nt,ot)};E(H,nt=>{e(),a(()=>e().step==="importing")?nt(dt):nt(Ct,!1)},!0)}l(st,yt)};E(ft,st=>{e(),a(()=>e().step==="mapping")?st(bt):st(xt,!1)},!0)}l(P,j)};E(Nt,P=>{e(),a(()=>e().step==="upload")?P(Ot):P(Gt,!1)})}n(Vt);var Yt=i(Vt,2),Rt=r(Yt);{var Ut=P=>{var j=pn();j.__click=wt,l(P,j)},Wt=P=>{var j=Lt(),ft=lt(j);{var bt=st=>{var yt=fn(),H=lt(yt);H.__click=wt;var dt=i(H,2);dt.__click=mt;var Ct=r(dt);n(dt),I(()=>F(Ct,`Import ${e(),a(()=>e().csvData.length)??""} Events`)),l(st,yt)},xt=st=>{var yt=Lt(),H=lt(yt);{var dt=nt=>{var ot=bn(),s=i(lt(ot),2),v=r(s);Oe(v,{size:"sm"}),ve(),n(s),l(nt,ot)},Ct=nt=>{var ot=Lt(),s=lt(ot);{var v=o=>{var b=yn();b.__click=wt,l(o,b)};E(s,o=>{e(),a(()=>e().step==="complete")&&o(v)},!0)}l(nt,ot)};E(H,nt=>{e(),a(()=>e().step==="importing")?nt(dt):nt(Ct,!1)},!0)}l(st,yt)};E(ft,st=>{e(),a(()=>e().step==="mapping")?st(bt):st(xt,!1)},!0)}l(P,j)};E(Rt,P=>{e(),a(()=>e().step==="upload")?P(Ut):P(Wt,!1)})}n(Yt),n(Bt),n(At),n(G);var St=i(G,2);{var Ft=P=>{var j=gn();l(P,j)};E(St,P=>{U()&&P(Ft)})}I(()=>{q=ne(G,1,"modal fade",null,q,{show:U()}),Ea(G,`display: ${U()?"block":"none"}`)}),l(x,tt),me(),D()}ga(["click","change"]);var wn=f('<div class="dropdown"><button class="btn btn-sm btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Add calendar item"><i class="bi bi-plus"></i> <span class="d-none d-md-inline ms-1">Add</span></button> <ul class="dropdown-menu dropdown-menu-end"><li><button class="dropdown-item" type="button" data-bs-toggle="offcanvas"><i class="bi bi-megaphone me-2"></i>Add Announcement</button></li> <li><button class="dropdown-item" type="button" data-bs-toggle="offcanvas"><i class="bi bi-calendar-event me-2"></i>Add Event</button></li> <li><hr class="dropdown-divider"/></li> <li><button class="dropdown-item" type="button"><i class="bi bi-file-earmark-arrow-up me-2"></i>Import Events (CSV)</button></li></ul></div>'),xn=f("<span> </span>"),kn=f('<span class="announcement-location svelte-1yokbat"><i class="bi bi-geo-alt"></i> </span>'),Mn=f('<div class="announcement-thumbnail-container svelte-1yokbat"><img class="announcement-thumbnail svelte-1yokbat"/></div>'),Dn=f('<div class="announcement-actions svelte-1yokbat"><button type="button" class="btn btn-sm btn-primary" title="Edit announcement"><i class="bi bi-pencil"></i></button></div>'),On=f('<li class="list-group-item list-group-item-action d-flex align-items-center gap-3"><span></span> <button type="button" class="announcement-details-button svelte-1yokbat"><div class="announcement-title svelte-1yokbat"> </div> <div class="announcement-meta svelte-1yokbat"><!> <!></div></button> <!> <!></li>'),Cn=f('<div class="announcements-footer svelte-1yokbat"><small> </small> <button class="btn btn-primary btn-sm">More</button></div>'),In=f('<div class="announcements-list-container svelte-1yokbat"><ul class="list-group list-group-flush"></ul></div> <!>',1),$n=f('<div class="no-announcements svelte-1yokbat"><!></div>'),An=f('<div class="announcements-container svelte-1yokbat"><div class="announcements-header svelte-1yokbat"><h2 class="announcements-title svelte-1yokbat">Announcements and Calendar</h2> <div class="announcements-actions svelte-1yokbat"><!></div></div> <!></div>'),Sn=f('<div class="d-flex flex-column gap-4"><!></div>'),zn=f("<!> <!> <!> <!>",1);function Fr(x,u){ue(u,!1);const e=()=>Mt(te,"$searchQuery",Y),m=()=>Mt(et,"$announcements",Y),D=()=>Mt(wt,"$currentUser",Y),U=()=>Mt(At,"$userOrganizations",Y),X=()=>Mt(tt,"$currentUserHasPermission",Y),V=()=>Mt(q,"$currentUserIsRoot",Y),W=()=>Mt(G,"$currentUserIsAdmin",Y),ct=()=>Mt(Bt,"$ready",Y),[Y,g]=Pe(),L=T(),ht=T(),mt=T(),{stores:{currentUser:wt,currentUserHasPermission:tt,currentUserIsAdmin:G,currentUserIsRoot:q,userOrganizations:At}}=ke(),{stores:{ready:Bt,announcements:et,searchQuery:te},actions:{reload:Vt}}=ea(),Nt={title:"Announcement",description:"",location:"",event_type:"announcement",is_public:!0},Ot=Ce(),Gt=Ce();let Yt=T(!1),Rt=T(!1),Ut=T(),Wt=T(!1),St=T(!1),Ft=T(!1),P=T(new Set),j=T(""),ft=T({...Nt}),bt=T({...Nt}),xt=T(!1);const st=5,yt=5;let H=T(st);function dt(){C(H,t(H)+yt)}const Ct=c=>na(c,{currentUserId:t(Ut),isPrivileged:t(Rt),canEditOwnOrgEvents:t(Ft),userOrganizations:t(P)}),nt=c=>c.startsWith("image/");Xe(async()=>{await Vt()});const ot=c=>{C(j,"Announcement Form"),C(ft,{...c,organization:c?.meta_data?.organization??""})},s=c=>{C(bt,c);const _=document.getElementById(Gt);_&&new window.bootstrap.Offcanvas(_).show()},v=c=>{ot(c);const _=document.getElementById(Ot);_&&new window.bootstrap.Offcanvas(_).show()},o=()=>{const c=document.getElementById(Gt);if(c){const _=window.bootstrap.Offcanvas.getInstance(c);_&&_.hide()}ot(t(bt)),setTimeout(()=>{const _=document.getElementById(Ot);_&&new window.bootstrap.Offcanvas(_).show()},300)};function b(){Vt()}N(()=>(e(),m(),t(H)),()=>{C(L,e()?m()??[]:(m()??[]).slice(0,t(H)))}),N(()=>(e(),m(),t(H)),()=>{C(ht,!e()&&(m()?.length??0)>t(H))}),N(()=>D(),()=>{C(Ut,D()?.id)}),N(()=>t(Ut),()=>{C(St,!!t(Ut))}),N(()=>U(),()=>{C(P,U())}),N(()=>(t(P),Me),()=>{C(Wt,t(P).has(Me.Bishopric))}),N(()=>(X(),Kt),()=>{C(Ft,X()(Kt.EditOwnOrgEvents))}),N(()=>(V(),W(),t(Wt),X(),Kt),()=>{C(Rt,V()||W()||t(Wt)||X()(Kt.EditAllEvents))}),N(()=>(t(Rt),X(),t(Ft),t(St)),()=>{C(Yt,t(Rt)||X()(Kt.CreateEvents)||t(Ft)||t(St))}),N(()=>(X(),Kt),()=>{C(mt,X()(Kt.DeleteEvents))}),$e(),_e();var M=zn(),$=lt(M);Ie($,{get title(){return t(j)},get id(){return Ot},children:(c,_)=>{aa(c,{get eventItem(){return t(ft)},get drawerId(){return Ot},name:"announcement-item-form",get canDelete(){return t(mt)}})},$$slots:{default:!0}});var k=i($,2);Ie(k,{title:"Announcement Details",get id(){return Gt},children:(c,_)=>{{let O=Jt(()=>(t(bt),a(()=>Ct(t(bt)))));sa(c,{get event(){return t(bt)},get canEdit(){return t(O)},onEdit:o})}},$$slots:{default:!0}});var h=i(k,2);En(h,{get isOpen(){return t(xt)},onClose:()=>C(xt,!1),onComplete:b});var y=i(h,2);{var A=c=>{var _=An(),O=r(_),R=i(r(O),2),S=r(R);{var B=_t=>{var pt=wn(),J=i(r(pt),2),at=r(J),ut=r(at);n(at);var It=i(at,2),Q=r(It);n(It);var K=i(It,4),z=r(K);n(K),n(J),n(pt),I(()=>{Tt(ut,"data-bs-target",`#${Ot??""}`),Tt(ut,"aria-controls",Ot),Tt(Q,"data-bs-target",`#${Ot??""}`),Tt(Q,"aria-controls",Ot)}),gt("click",ut,()=>ot({...Nt,event_type:"announcement"})),gt("click",Q,()=>ot({...Nt,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),gt("click",z,()=>C(xt,!0)),l(_t,pt)};E(S,_t=>{t(Yt)&&_t(B)})}n(R),n(O);var Et=i(O,2);{var Pt=_t=>{var pt=In(),J=lt(pt),at=r(J);Zt(at,5,()=>t(L),Q=>Q.id,(Q,K)=>{const z=Jt(()=>(t(K),a(()=>t(K).attachments?.find(kt=>nt(kt.type))))),w=Jt(()=>(p(Xt),t(K),a(()=>Xt(t(K)?.meta_data?.organization??""))));var rt=On(),Ht=r(rt),jt=i(Ht,2),ee=r(jt),oe=r(ee,!0);n(ee);var ie=i(ee,2),pe=r(ie);{var fe=kt=>{var $t=xn(),ae=r($t,!0);n($t),I(()=>{ne($t,1,`badge rounded-pill bg-color-${p(t(w)),a(()=>t(w).color_number)??""}`,"svelte-1yokbat"),F(ae,(p(t(w)),a(()=>t(w).label)))}),l(kt,$t)};E(pe,kt=>{p(t(w)),a(()=>t(w)?.label)&&kt(fe)})}var be=i(pe,2);{var Ae=kt=>{var $t=kn(),ae=i(r($t));n($t),I(()=>F(ae,` ${t(K),a(()=>t(K).location)??""}`)),l(kt,$t)};E(be,kt=>{t(K),a(()=>t(K).location)&&kt(Ae)})}n(ie),n(jt);var le=i(jt,2);{var Se=kt=>{var $t=Mn(),ae=r($t);n($t),I(()=>{Tt(ae,"src",(p(t(z)),a(()=>t(z).url))),Tt(ae,"alt",(p(t(z)),a(()=>t(z).name)))}),l(kt,$t)};E(le,kt=>{t(z)&&kt(Se)})}var ye=i(le,2);{var ze=kt=>{var $t=Dn(),ae=r($t);n($t),gt("click",ae,De(()=>v(t(K)))),l(kt,$t)};E(ye,kt=>{t(K),a(()=>Ct(t(K)))&&kt(ze)})}n(rt),I(()=>{ne(Ht,1,`announcement-color-indicator bg-color-${p(t(w)),a(()=>t(w)?.color_number??0)??""}`,"svelte-1yokbat"),F(oe,(t(K),a(()=>t(K).title)))}),gt("click",jt,()=>s(t(K))),l(Q,rt)}),n(at),n(J);var ut=i(J,2);{var It=Q=>{var K=Cn(),z=r(K),w=r(z);n(z);var rt=i(z,2);n(K),I(()=>F(w,`Showing ${t(H)??""} of ${m(),a(()=>m()?.length??0)??""}`)),gt("click",rt,dt),l(Q,K)};E(ut,Q=>{t(ht)&&Q(It)})}l(_t,pt)},qt=_t=>{var pt=Lt(),J=lt(pt);{var at=ut=>{var It=$n(),Q=r(It);{var K=w=>{var rt=se("No announcements match your search.");l(w,rt)},z=w=>{var rt=se("There are no announcements yet.");l(w,rt)};E(Q,w=>{e()?w(K):w(z,!1)})}n(It),l(ut,It)};E(J,ut=>{m(),a(()=>m()?.length===0)&&ut(at)},!0)}l(_t,pt)};E(Et,_t=>{t(L),a(()=>t(L).length)?_t(Pt):_t(qt,!1)})}n(_),l(c,_)},d=c=>{var _=Sn(),O=r(_);Oe(O,{}),n(_),l(c,_)};E(y,c=>{ct()?c(A):c(d,!1)})}l(x,M),me(),g()}var Tn=f("<option> </option>"),Fn=f('<select class="form-select form-select-sm organization-filter-desktop svelte-14mpkul" aria-label="Filter calendar by organization"><option>All Organizations</option><!></select>'),Rn=f("<option> </option>"),Un=f('<div class="mobile-filter-row svelte-14mpkul"><select class="form-select form-select-sm organization-filter-mobile svelte-14mpkul" aria-label="Filter calendar by organization"><option>All Organizations</option><!></select></div>'),Pn=f('<div class="calendar-day-header svelte-14mpkul"><span class="d-none d-md-inline"> </span> <span class="d-md-none"> </span></div>'),Ln=f('<button type="button"><span class="event-title svelte-14mpkul"> </span></button>'),Bn=f('<div class="more-events svelte-14mpkul"> </div>'),Vn=f('<div role="button" tabindex="0"><div class="day-number svelte-14mpkul"> </div> <div class="day-events svelte-14mpkul"><!> <!></div></div>'),Nn=f("<span> </span>"),Yn=f('<span class="badge bg-secondary">All Day</span>'),Hn=f('<span class="event-time svelte-14mpkul"> </span>'),Kn=f('<span class="event-location svelte-14mpkul"><i class="bi bi-geo-alt"></i> </span>'),Wn=f('<div class="event-thumbnail-container svelte-14mpkul"><img class="event-thumbnail svelte-14mpkul"/></div>'),qn=f('<div class="event-actions svelte-14mpkul"><button type="button" class="btn btn-sm btn-primary" title="Edit event"><i class="bi bi-pencil"></i></button></div>'),jn=f('<li class="list-group-item list-group-item-action d-flex align-items-center gap-3"><span></span> <button type="button" class="event-details-button svelte-14mpkul"><div class="event-title-full svelte-14mpkul"> </div> <div class="event-meta svelte-14mpkul"><!> <!> <!></div></button> <!> <!></li>'),Qn=f('<div class="card mt-3"><div class="card-header d-flex justify-content-between align-items-center"><h6 class="mb-0 fw-semibold"> </h6> <button type="button" class="btn btn-sm btn-primary" aria-label="Close"><i class="bi bi-x-lg"></i></button></div> <ul class="list-group list-group-flush"></ul></div>'),Jn=f('<div class="month-calendar svelte-14mpkul"><div class="calendar-header svelte-14mpkul"><h5 class="month-title svelte-14mpkul"> </h5> <div class="calendar-controls svelte-14mpkul"><!> <div class="calendar-nav svelte-14mpkul"><button type="button" class="btn btn-sm btn-primary svelte-14mpkul" aria-label="Previous month"><i class="bi bi-chevron-left"></i></button> <button type="button" class="btn btn-sm btn-primary svelte-14mpkul" aria-label="Go to today">Today</button> <button type="button" class="btn btn-sm btn-primary svelte-14mpkul" aria-label="Next month"><i class="bi bi-chevron-right"></i></button></div></div></div> <!> <div class="calendar-grid svelte-14mpkul"><!> <!></div> <!></div>');function Gn(x,u){ue(u,!1);const e=T(),m=T(),D=T(),U=T();let X=zt(u,"events",24,()=>[]),V=zt(u,"onEventClick",8,()=>{}),W=zt(u,"onEventEdit",8,null),ct=zt(u,"canEditEvent",8,null),Y=zt(u,"organizationFilter",8,""),g=zt(u,"onOrganizationFilterChange",8,()=>{}),L=zt(u,"availableOrganizations",24,()=>[]),ht=zt(u,"visibleMonth",24,()=>new Date),mt=zt(u,"onVisibleMonthChange",8,()=>{});const wt=s=>{const v=je(new Date(s));return v.setHours(0,0,0,0),v};let tt=T(wt(ht()));const G=(s,v=!0)=>{const o=wt(s);o.getTime()!==t(tt).getTime()&&(C(tt,o),v&&mt()(new Date(o)))};let q=T(null);const At=s=>{t(q)&&we(t(q),s)?C(q,null):C(q,s)},Bt=()=>{G(new Date)},et=()=>{G(Sa(t(tt)))},te=()=>{G(ra(t(tt),1))},Vt=s=>{const v=vt(s,"yyyy-MM-dd");return t(U)[v]||[]},Nt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Ot=["S","M","T","W","T","F","S"],Gt=s=>s.startsWith("image/");N(()=>p(ht()),()=>{G(ht(),!1)}),N(()=>t(q),()=>{C(e,t(q)?Vt(t(q)):[])}),N(()=>(t(e),Dt),()=>{C(m,t(e).slice().sort((s,v)=>{const o=s.is_all_day?0:1,b=v.is_all_day?0:1;if(o!==b)return o-b;const M=s.start_time?Dt(s.start_time).getTime():0,$=v.start_time?Dt(v.start_time).getTime():0;return M-$}))}),N(()=>(t(tt),We),()=>{C(D,(()=>{const s=je(t(tt)),v=Ia(t(tt)),o=ka(s,{weekStartsOn:0}),b=$a(v,{weekStartsOn:0}),M=[];let $=o;for(;$<=b;)M.push($),$=We($,1);return M})())}),N(()=>(p(X()),vt),()=>{C(U,X().reduce((s,v)=>{if(!v.start_time)return s;const o=Dt(v.start_time),b=vt(o,"yyyy-MM-dd");return s[b]||(s[b]=[]),s[b].push(v),s},{}))}),$e(),_e();var Yt=Jn(),Rt=r(Yt),Ut=r(Rt),Wt=r(Ut,!0);n(Ut);var St=i(Ut,2),Ft=r(St);{var P=s=>{var v=Fn(),o=r(v);o.value=o.__value="";var b=i(o);Zt(b,1,L,de,($,k)=>{var h=Tn(),y=r(h,!0);n(h);var A={};I(()=>{F(y,(t(k),a(()=>t(k).label))),A!==(A=(t(k),a(()=>t(k).key)))&&(h.value=(h.__value=(t(k),a(()=>t(k).key)))??"")}),l($,h)}),n(v);var M;Ne(v),I(()=>{M!==(M=Y())&&(v.value=(v.__value=Y())??"",Ye(v,Y()))}),gt("change",v,$=>g()($.currentTarget.value)),l(s,v)};E(Ft,s=>{p(L()),a(()=>L().length>0)&&s(P)})}var j=i(Ft,2),ft=r(j),bt=i(ft,2),xt=i(bt,2);n(j),n(St),n(Rt);var st=i(Rt,2);{var yt=s=>{var v=Un(),o=r(v),b=r(o);b.value=b.__value="";var M=i(b);Zt(M,1,L,de,(k,h)=>{var y=Rn(),A=r(y,!0);n(y);var d={};I(()=>{F(A,(t(h),a(()=>t(h).label))),d!==(d=(t(h),a(()=>t(h).key)))&&(y.value=(y.__value=(t(h),a(()=>t(h).key)))??"")}),l(k,y)}),n(o);var $;Ne(o),n(v),I(()=>{$!==($=Y())&&(o.value=(o.__value=Y())??"",Ye(o,Y()))}),gt("change",o,k=>g()(k.currentTarget.value)),l(s,v)};E(st,s=>{p(L()),a(()=>L().length>0)&&s(yt)})}var H=i(st,2),dt=r(H);Zt(dt,1,()=>Nt,de,(s,v,o)=>{var b=Pn(),M=r(b),$=r(M,!0);n(M);var k=i(M,2),h=r(k,!0);n(k),n(b),I(()=>{F($,t(v)),F(h,a(()=>Ot[o]))}),l(s,b)});var Ct=i(dt,2);Zt(Ct,1,()=>t(D),s=>vt(s,"yyyy-MM-dd"),(s,v)=>{const o=Jt(()=>(t(v),a(()=>Vt(t(v))))),b=Jt(()=>(p(Qe),t(v),t(tt),a(()=>Qe(t(v),t(tt))))),M=Jt(()=>(p(Je),t(v),a(()=>Je(t(v))))),$=Jt(()=>(t(q),p(we),t(v),a(()=>t(q)&&we(t(q),t(v)))));var k=Vn();let h;var y=r(k),A=r(y,!0);n(y);var d=i(y,2),c=r(d);Zt(c,1,()=>(p(t(o)),a(()=>t(o).slice(0,3))),R=>R.id??R.start_time,(R,S)=>{var B=Ln(),Et=r(B),Pt=r(Et,!0);n(Et),n(B),I(qt=>{ne(B,1,`event-badge bg-color-${qt??""}`,"svelte-14mpkul"),Tt(B,"title",(t(S),a(()=>t(S).title))),F(Pt,(t(S),a(()=>t(S).title)))},[()=>(p(Xt),t(S),a(()=>Xt(t(S)?.meta_data?.organization??"")?.color_number??0))]),gt("click",B,De(()=>V()(t(S)))),l(R,B)});var _=i(c,2);{var O=R=>{var S=Bn(),B=r(S);n(S),I(()=>F(B,`+${p(t(o)),a(()=>t(o).length-3)??""} more`)),l(R,S)};E(_,R=>{p(t(o)),a(()=>t(o).length>3)&&R(O)})}n(d),n(k),I(R=>{h=ne(k,1,"calendar-day svelte-14mpkul",null,h,{"other-month":!t(b),today:t(M),selected:t($),"has-events":t(o).length>0}),F(A,R)},[()=>(p(vt),t(v),a(()=>vt(t(v),"d")))]),gt("click",k,()=>At(t(v))),gt("keydown",k,R=>{(R.key==="Enter"||R.key===" ")&&(R.preventDefault(),At(t(v)))}),l(s,k)}),n(H);var nt=i(H,2);{var ot=s=>{var v=Qn(),o=r(v),b=r(o),M=r(b,!0);n(b);var $=i(b,2);n(o);var k=i(o,2);Zt(k,5,()=>t(m),h=>h.id??h.start_time,(h,y)=>{const A=Jt(()=>(t(y),a(()=>t(y).attachments?.find(z=>Gt(z.type))))),d=Jt(()=>(p(Xt),t(y),a(()=>Xt(t(y)?.meta_data?.organization??""))));var c=jn(),_=r(c),O=i(_,2),R=r(O),S=r(R,!0);n(R);var B=i(R,2),Et=r(B);{var Pt=z=>{var w=Nn(),rt=r(w,!0);n(w),I(()=>{ne(w,1,`badge rounded-pill bg-color-${p(t(d)),a(()=>t(d).color_number)??""}`,"svelte-14mpkul"),F(rt,(p(t(d)),a(()=>t(d).label)))}),l(z,w)};E(Et,z=>{p(t(d)),a(()=>t(d)?.label)&&z(Pt)})}var qt=i(Et,2);{var _t=z=>{var w=Yn();l(z,w)},pt=z=>{var w=Lt(),rt=lt(w);{var Ht=jt=>{var ee=Hn(),oe=r(ee,!0);n(ee),I(ie=>F(oe,ie),[()=>(p(vt),p(Dt),t(y),a(()=>vt(Dt(t(y).start_time),"h:mm a")))]),l(jt,ee)};E(rt,jt=>{t(y),a(()=>t(y).start_time)&&jt(Ht)},!0)}l(z,w)};E(qt,z=>{t(y),a(()=>t(y).is_all_day)?z(_t):z(pt,!1)})}var J=i(qt,2);{var at=z=>{var w=Kn(),rt=i(r(w));n(w),I(()=>F(rt,` ${t(y),a(()=>t(y).location)??""}`)),l(z,w)};E(J,z=>{t(y),a(()=>t(y).location)&&z(at)})}n(B),n(O);var ut=i(O,2);{var It=z=>{var w=Wn(),rt=r(w);n(w),I(()=>{Tt(rt,"src",(p(t(A)),a(()=>t(A).url))),Tt(rt,"alt",(p(t(A)),a(()=>t(A).name)))}),l(z,w)};E(ut,z=>{t(A)&&z(It)})}var Q=i(ut,2);{var K=z=>{var w=qn(),rt=r(w);n(w),gt("click",rt,De(()=>W()&&W()(t(y)))),l(z,w)};E(Q,z=>{p(ct()),p(W()),t(y),a(()=>ct()&&W()&&ct()(t(y)))&&z(K)})}n(c),I(()=>{ne(_,1,`event-color-indicator bg-color-${p(t(d)),a(()=>t(d)?.color_number??0)??""}`,"svelte-14mpkul"),F(S,(t(y),a(()=>t(y).title)))}),gt("click",O,()=>V()(t(y))),l(h,c)}),n(k),n(v),I(h=>F(M,h),[()=>(p(vt),t(q),a(()=>vt(t(q),"EEEE, MMMM d, yyyy")))]),gt("click",$,()=>C(q,null)),l(s,v)};E(nt,s=>{t(q),t(e),a(()=>t(q)&&t(e).length>0)&&s(ot)})}n(Yt),I(s=>F(Wt,s),[()=>(p(vt),t(tt),a(()=>vt(t(tt),"MMMM yyyy")))]),gt("click",ft,et),gt("click",bt,Bt),gt("click",xt,te),l(x,Yt),me()}var Zn=f("<span> </span>"),Xn=f('<span class="event-date svelte-1p8xa6u"> </span>'),tr=f('<span class="badge bg-secondary">All Day</span>'),er=f('<span class="event-time svelte-1p8xa6u"> </span>'),ar=f('<span class="event-location svelte-1p8xa6u"><i class="bi bi-geo-alt"></i> <!></span>'),nr=f('<div class="event-thumbnail-container svelte-1p8xa6u"><img class="event-thumbnail svelte-1p8xa6u"/></div>'),rr=f('<div class="event-actions svelte-1p8xa6u"><button type="button" class="btn btn-sm btn-primary" title="Edit event"><i class="bi bi-pencil"></i></button></div>'),sr=f('<li class="list-group-item list-group-item-action d-flex align-items-center gap-3"><span></span> <button type="button" class="event-details-button svelte-1p8xa6u"><div class="event-title-full svelte-1p8xa6u"><!></div> <div class="event-meta svelte-1p8xa6u"><!> <!> <!> <!></div></button> <!> <!></li>'),or=f('<div class="search-results svelte-1p8xa6u"><div class="search-results-header svelte-1p8xa6u"><h6 class="search-results-title svelte-1p8xa6u"> </h6></div> <ul class="list-group list-group-flush"></ul></div>'),ir=f('<div class="search-no-results svelte-1p8xa6u"> </div>'),lr=f("<!> <!>",1),vr=f('<div class="no-events svelte-1p8xa6u"><!></div>'),cr=f('<div class="d-flex flex-column gap-2"><!></div>'),dr=f('<div class="d-flex flex-column gap-4"><!></div>'),ur=f("<!> <!> <!>",1);function Rr(x,u){ue(u,!1);const e=()=>Mt(Yt,"$dbData",L),m=()=>Mt(Ut,"$authenticated",L),D=()=>Mt(Gt,"$searchQuery",L),U=()=>Mt(At,"$currentUser",L),X=()=>Mt(Vt,"$userOrganizations",L),V=()=>Mt(Bt,"$currentUserHasPermission",L),W=()=>Mt(te,"$currentUserIsRoot",L),ct=()=>Mt(et,"$currentUserIsAdmin",L),Y=()=>Mt(Nt,"$ready",L),g=()=>Mt(Ot,"$calendarEvents",L),[L,ht]=Pe(),mt=T(),wt=T(),tt=T(),G=T(),q=T(),{stores:{currentUser:At,currentUserHasPermission:Bt,currentUserIsAdmin:et,currentUserIsRoot:te,userOrganizations:Vt}}=ke(),{stores:{ready:Nt,calendarEvents:Ot,searchQuery:Gt,dbData:Yt},actions:{reload:Rt}}=ea(),{stores:{authenticated:Ut}}=ke(),Wt={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0};let St=zt(u,"formId",24,Ce),Ft=zt(u,"detailsId",24,Ce),P=T(!1),j=T(),ft=T(!1),bt=T(!1),xt=T(new Set),st=T(""),yt=T({...Wt}),H=T({...Wt}),dt=T(""),Ct=T(new Date);const nt=d=>na(d,{currentUserId:t(j),isPrivileged:t(P),canEditOwnOrgEvents:t(bt),userOrganizations:t(xt)}),ot=d=>d.startsWith("image/");Xe(async()=>{await Rt()});const s=async d=>{if(C(st,"Item Form"),d?.meta_data?.recurring_instance&&d?.meta_data?.recurring_parent_id){const{getCalendarEvent:c}=await qe(async()=>{const{getCalendarEvent:O}=await import("./oGHNZfsf.js").then(R=>R.n);return{getCalendarEvent:O}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url),_=await c(d.meta_data.recurring_parent_id);if(_){C(yt,{..._,organization:_?.meta_data?.organization,start_time:d.start_time,end_time:d.end_time,meta_data:{..._.meta_data,recurring_instance:!0,recurring_parent_id:d.meta_data.recurring_parent_id,recurring_instance_index:d.meta_data.recurring_instance_index}});return}}C(yt,{...d,organization:d?.meta_data?.organization})},v=async d=>{if(d?.meta_data?.recurring_instance&&d?.meta_data?.recurring_parent_id){const{getCalendarEvent:_}=await qe(async()=>{const{getCalendarEvent:R}=await import("./oGHNZfsf.js").then(S=>S.n);return{getCalendarEvent:R}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url),O=await _(d.meta_data.recurring_parent_id);O?C(H,{...O,start_time:d.start_time,end_time:d.end_time,meta_data:{...O.meta_data,recurring_instance:!0,recurring_parent_id:d.meta_data.recurring_parent_id,recurring_instance_index:d.meta_data.recurring_instance_index}}):C(H,d)}else C(H,d);const c=document.getElementById(Ft());c&&new window.bootstrap.Offcanvas(c).show()},o=async d=>{await s(d);const c=document.getElementById(St());c&&new window.bootstrap.Offcanvas(c).show()},b=async()=>{const d=document.getElementById(Ft());if(d){const c=window.bootstrap.Offcanvas.getInstance(d);c&&c.hide()}await s(t(H)),setTimeout(()=>{const c=document.getElementById(St());c&&new window.bootstrap.Offcanvas(c).show()},300)};N(()=>(e(),m()),()=>{C(mt,(e()??[]).filter(d=>d.event_type==="calendar_event").filter(d=>!(!d.is_published||!m()&&d.is_public===!1)))}),N(()=>(t(mt),Xt),()=>{C(wt,(()=>{const d=new Set(t(mt).filter(c=>c?.meta_data?.organization).map(c=>c.meta_data?.organization).filter(c=>c));return Array.from(d).map(c=>Xt(c||"")).filter(c=>c!==void 0).sort((c,_)=>c.sort_index-_.sort_index)})())}),N(()=>(t(dt),t(mt),Ke),()=>{C(tt,t(dt)?t(mt).filter(d=>Ke(d?.meta_data?.organization,t(dt))):t(mt))}),N(()=>(D(),t(mt)),()=>{C(G,D()?t(mt).filter(d=>{const c=D().toLowerCase(),_=(d.title||"").toLowerCase(),O=(d.description||"").replace(/<[^>]*>/g,"").toLowerCase(),R=(d.location||"").toLowerCase();return _.includes(c)||O.includes(c)||R.includes(c)}):[])}),N(()=>U(),()=>{C(j,U()?.id)}),N(()=>X(),()=>{C(xt,X())}),N(()=>(t(xt),Me),()=>{C(ft,t(xt).has(Me.Bishopric))}),N(()=>(V(),Kt),()=>{C(bt,V()(Kt.EditOwnOrgEvents))}),N(()=>(W(),ct(),t(ft),V(),Kt),()=>{C(P,W()||ct()||t(ft)||V()(Kt.EditAllEvents))}),N(()=>(V(),Kt),()=>{C(q,V()(Kt.DeleteEvents))}),$e(),_e();var M=ur(),$=lt(M);Ie($,{get title(){return t(st)},get id(){return St()},children:(d,c)=>{aa(d,{get eventItem(){return t(yt)},get drawerId(){return St()},name:"event-item-form",get canDelete(){return t(q)}})},$$slots:{default:!0}});var k=i($,2);Ie(k,{title:"Event Details",get id(){return Ft()},children:(d,c)=>{{let _=Jt(()=>(t(H),a(()=>nt(t(H)))));sa(d,{get event(){return t(H)},get canEdit(){return t(_)},onEdit:b})}},$$slots:{default:!0}});var h=i(k,2);{var y=d=>{var c=cr(),_=r(c);{var O=S=>{var B=lr(),Et=lt(B);{var Pt=J=>{var at=Lt(),ut=lt(at);Aa(ut,()=>t(dt),It=>{Gn(It,{get events(){return t(tt)},onEventClick:Q=>v(Q),onEventEdit:Q=>o(Q),canEditEvent:Q=>nt(Q),get organizationFilter(){return t(dt)},onOrganizationFilterChange:Q=>C(dt,Q),get availableOrganizations(){return t(wt)},get visibleMonth(){return t(Ct)},onVisibleMonthChange:Q=>C(Ct,new Date(Q))})}),l(J,at)};E(Et,J=>{D()||J(Pt)})}var qt=i(Et,2);{var _t=J=>{var at=or(),ut=r(at),It=r(ut),Q=r(It);n(It),n(ut);var K=i(ut,2);Zt(K,5,()=>t(G),z=>z.id??z.start_time,(z,w)=>{const rt=Jt(()=>(t(w),a(()=>t(w).attachments?.find(Z=>ot(Z.type))))),Ht=Jt(()=>(p(Xt),t(w),a(()=>Xt(t(w)?.meta_data?.organization??""))));var jt=sr(),ee=r(jt),oe=i(ee,2),ie=r(oe),pe=r(ie);Ue(pe,()=>(p(Ee),t(w),D(),a(()=>Ee(t(w).title,D())))),n(ie);var fe=i(ie,2),be=r(fe);{var Ae=Z=>{var it=Zn(),Qt=r(it,!0);n(it),I(()=>{ne(it,1,`badge rounded-pill bg-color-${p(t(Ht)),a(()=>t(Ht).color_number)??""}`,"svelte-1p8xa6u"),F(Qt,(p(t(Ht)),a(()=>t(Ht).label)))}),l(Z,it)};E(be,Z=>{p(t(Ht)),a(()=>t(Ht)?.label)&&Z(Ae)})}var le=i(be,2);{var Se=Z=>{var it=Xn(),Qt=r(it,!0);n(it),I(Te=>F(Qt,Te),[()=>(p(vt),p(Dt),t(w),a(()=>vt(Dt(t(w).start_time),"MMM d, yyyy")))]),l(Z,it)};E(le,Z=>{t(w),a(()=>t(w).start_time)&&Z(Se)})}var ye=i(le,2);{var ze=Z=>{var it=tr();l(Z,it)},kt=Z=>{var it=Lt(),Qt=lt(it);{var Te=Fe=>{var Re=er(),da=r(Re,!0);n(Re),I(ua=>F(da,ua),[()=>(p(vt),p(Dt),t(w),a(()=>vt(Dt(t(w).start_time),"h:mm a")))]),l(Fe,Re)};E(Qt,Fe=>{t(w),a(()=>t(w).start_time)&&Fe(Te)},!0)}l(Z,it)};E(ye,Z=>{t(w),a(()=>t(w).is_all_day)?Z(ze):Z(kt,!1)})}var $t=i(ye,2);{var ae=Z=>{var it=ar(),Qt=i(r(it),2);Ue(Qt,()=>(p(Ee),t(w),D(),a(()=>Ee(t(w).location,D())))),n(it),l(Z,it)};E($t,Z=>{t(w),a(()=>t(w).location)&&Z(ae)})}n(fe),n(oe);var Le=i(oe,2);{var la=Z=>{var it=nr(),Qt=r(it);n(it),I(()=>{Tt(Qt,"src",(p(t(rt)),a(()=>t(rt).url))),Tt(Qt,"alt",(p(t(rt)),a(()=>t(rt).name)))}),l(Z,it)};E(Le,Z=>{t(rt)&&Z(la)})}var va=i(Le,2);{var ca=Z=>{var it=rr(),Qt=r(it);n(it),gt("click",Qt,De(()=>o(t(w)))),l(Z,it)};E(va,Z=>{t(w),a(()=>nt(t(w)))&&Z(ca)})}n(jt),I(()=>ne(ee,1,`event-color-indicator bg-color-${p(t(Ht)),a(()=>t(Ht)?.color_number??0)??""}`,"svelte-1p8xa6u")),gt("click",oe,()=>v(t(w))),l(z,jt)}),n(K),n(at),I(()=>F(Q,`${t(G),a(()=>t(G).length)??""} event${t(G),a(()=>t(G).length===1?"":"s")??""} matching "${D()??""}"`)),l(J,at)},pt=J=>{var at=Lt(),ut=lt(at);{var It=Q=>{var K=ir(),z=r(K);n(K),I(()=>F(z,`No events match your search for "${D()??""}"`)),l(Q,K)};E(ut,Q=>{D()&&Q(It)},!0)}l(J,at)};E(qt,J=>{D(),t(G),a(()=>D()&&t(G).length>0)?J(_t):J(pt,!1)})}l(S,B)},R=S=>{var B=vr(),Et=r(B);{var Pt=_t=>{var pt=se("No events match your search.");l(_t,pt)},qt=_t=>{var pt=se("There are no upcoming events scheduled.");l(_t,pt)};E(Et,_t=>{D()?_t(Pt):_t(qt,!1)})}n(B),l(S,B)};E(_,S=>{g(),a(()=>g()?.length)?S(O):S(R,!1)})}n(c),l(d,c)},A=d=>{var c=dr(),_=r(c);Oe(_,{}),n(c),l(d,c)};E(h,d=>{Y()?d(y):d(A,!1)})}l(x,M),me(),ht()}export{Fr as A,sa as C,Rr as E,En as a,je as s};
