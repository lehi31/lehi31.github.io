import{d as l,w as d}from"./CxzQr61Z.js";import{a as r,b as m}from"./C-HciA9L.js";function a(e=!1){const s=localStorage.getItem("authToken"),t={authorization:s?`Bearer ${s}`:`Bearer ${m}`,apikey:m};return e&&(t["Content-Type"]="application/json"),t}const u=d([]),c=d([]),p=d(!1),h=d(!1),w=d(null),y=d(null),k=l(u,e=>{const s={};return e.forEach(t=>{const o=t.category||"Other";s[o]||(s[o]=[]),s[o].push(t)}),s}),P=l(u,e=>{const s=new Set(e.map(t=>t.category||"Other"));return Array.from(s).sort()}),O=l(c,e=>{const s={};return e.forEach(t=>{const o=t.organization||"Other";s[o]||(s[o]=[]),s[o].push(t)}),s});l(c,e=>{const s=new Set(e.map(t=>t.organization||"Other"));return Array.from(s).sort()});async function g(){p.set(!0),w.set(null);try{const e=await fetch(`${r}/functions/v1/admin-permissions`,{headers:a()});if(!e.ok)throw new Error(`Failed to fetch permissions: ${e.statusText}`);const s=await e.json();u.set(s.permissions||[])}catch(e){const s=e instanceof Error?e.message:"Unknown error";w.set(s),console.error("Error fetching permissions:",e)}finally{p.set(!1)}}async function $(){h.set(!0),y.set(null);try{const e=await fetch(`${r}/functions/v1/admin-roles`,{headers:a()});if(!e.ok)throw new Error(`Failed to fetch roles: ${e.statusText}`);const s=await e.json();c.set(s.roles||[])}catch(e){const s=e instanceof Error?e.message:"Unknown error";y.set(s),console.error("Error fetching roles:",e)}finally{h.set(!1)}}async function b(e){const s=await fetch(`${r}/functions/v1/admin-permissions`,{method:"POST",headers:a(!0),body:JSON.stringify(e)});if(!s.ok)throw new Error(`Failed to create permission: ${s.statusText}`);const o=(await s.json()).permission;return u.update(n=>[...n,o]),o}async function v(e,s){const t=await fetch(`${r}/functions/v1/admin-permissions/${e}`,{method:"PATCH",headers:a(!0),body:JSON.stringify(s)});if(!t.ok)throw new Error(`Failed to update permission: ${t.statusText}`);const n=(await t.json()).permission;return u.update(f=>f.map(i=>i.id===e?n:i)),n}async function x(e){const s=await fetch(`${r}/functions/v1/admin-permissions/${e}`,{method:"DELETE",headers:a()});if(!s.ok)throw new Error(`Failed to delete permission: ${s.statusText}`);u.update(t=>t.filter(o=>o.id!==e))}async function S(e){const s=await fetch(`${r}/functions/v1/admin-roles`,{method:"POST",headers:a(!0),body:JSON.stringify(e)});if(!s.ok)throw new Error(`Failed to create role: ${s.statusText}`);const o=(await s.json()).role;return c.update(n=>[...n,{...o,permissions:[]}]),o}async function j(e,s){const t=await fetch(`${r}/functions/v1/admin-roles/${e}`,{method:"PATCH",headers:a(!0),body:JSON.stringify(s)});if(!t.ok)throw new Error(`Failed to update role: ${t.statusText}`);const n=(await t.json()).role;return c.update(f=>f.map(i=>i.id===e?n:i)),n}async function F(e){const s=await fetch(`${r}/functions/v1/admin-roles/${e}`,{method:"DELETE",headers:a()});if(!s.ok)throw new Error(`Failed to delete role: ${s.statusText}`);c.update(t=>t.filter(o=>o.id!==e))}async function R(e,s){const t=await fetch(`${r}/functions/v1/admin-roles/${e}/permissions`,{method:"PUT",headers:a(!0),body:JSON.stringify({permission_ids:s})});if(!t.ok)throw new Error(`Failed to assign permissions: ${t.statusText}`);const n=(await t.json()).role;c.update(f=>f.map(i=>i.id===e?n:i))}async function z(){await Promise.all([g(),$()])}export{b as a,w as b,P as c,u as d,x as e,j as f,S as g,R as h,z as i,y as j,h as k,p as l,c as m,F as n,k as p,O as r,v as u};
