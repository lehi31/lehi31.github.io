import{t as Z,j as ft,k as pt,K as Xt,bb as er,L as _t,Y as tr,ac as rr,b1 as nr,a_ as ar,N as sr,G as Ee,p as or,ai as R,D as y,E as C,w as $,g as o,aj as ir,c as T,s as j,u as U,r as w,a as lr,R as cr,F as mt,f as ur}from"./CPOcesE7.js";import{b as vt,d as dr,f as I,a as O}from"./YsHTGu5k.js";import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{p as Ge,b as fr,i as z,a as pr,s as de,e as De}from"./opPvMm1W.js";import{e as _r,i as mr}from"./DAwrR-3T.js";import{s as vr}from"./BC54fyhh.js";import{t as Se,v as br,w as gr,b as G,g as It,p as pe,k as fe,f as Q,x as bt,A as Ve,D as hr,c as xe,h as Ke}from"./WMDXKID8.js";import{i as yr}from"./C2Q_9cr2.js";import{w as ae,g as gt,r as Et,d as re}from"./DHXte27T.js";import{S as Qe}from"./DwmScgcp.js";import{R as wr}from"./DvoWelOD.js";import{s as Dr,i as xr}from"./oOlFimUz.js";function In(e,t,r=!1,n=!1,a=!1){var s=e,i="";Z(()=>{var u=Xt;if(i===(i=t()??"")){ft&&pt();return}if(u.nodes!==null&&(er(u.nodes.start,u.nodes.end),u.nodes=null),i!==""){if(ft){_t.data;for(var _=pt(),g=_;_!==null&&(_.nodeType!==tr||_.data!=="");)g=_,_=rr(_);if(_===null)throw nr(),ar;vt(_t,g),s=sr(_);return}var M=i+"";r?M=`<svg>${M}</svg>`:n&&(M=`<math>${M}</math>`);var D=dr(M);if((r||n)&&(D=Ee(D)),vt(Ee(D),D.lastChild),r||n)for(;Ee(D);)s.before(Ee(D));else s.before(D)}})}function Tr(e,t){const r=Se(e);return isNaN(t)?br(e,NaN):(t&&r.setDate(r.getDate()+t),r)}function Te(e,t){const r=t*7;return Tr(e,r)}function ne(e,t){const r=gr(),n=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,a=Se(e),s=a.getDay(),i=(s<n?-7:0)+6-(s-n);return a.setDate(a.getDate()+i),a.setHours(23,59,59,999),a}function Ue(e,t){const r=+Se(e),[n,a]=[+Se(t.start),+Se(t.end)].sort((s,i)=>s-i);return r>=n&&r<=a}function Sr(e,t){const r=Or(t);return"formatToParts"in r?Nr(r,e):Mr(r,e)}const kr={year:0,month:1,day:2,hour:3,minute:4,second:5};function Nr(e,t){try{const r=e.formatToParts(t),n=[];for(let a=0;a<r.length;a++){const s=kr[r[a].type];s!==void 0&&(n[s]=parseInt(r[a].value,10))}return n}catch(r){if(r instanceof RangeError)return[NaN];throw r}}function Mr(e,t){const r=e.format(t),n=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(r);return[parseInt(n[3],10),parseInt(n[1],10),parseInt(n[2],10),parseInt(n[4],10),parseInt(n[5],10),parseInt(n[6],10)]}const Je={},ht=new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:"America/New_York",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),Cr=ht==="06/25/2014, 00:00:00"||ht==="‎06‎/‎25‎/‎2014‎ ‎00‎:‎00‎:‎00";function Or(e){return Je[e]||(Je[e]=Cr?new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),Je[e]}function it(e,t,r,n,a,s,i){const u=new Date(0);return u.setUTCFullYear(e,t,r),u.setUTCHours(n,a,s,i),u}const yt=36e5,Yr=6e4,Xe={timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-])(\d{2}):?(\d{2})$/};function lt(e,t,r){if(!e)return 0;let n=Xe.timezoneZ.exec(e);if(n)return 0;let a,s;if(n=Xe.timezoneHH.exec(e),n)return a=parseInt(n[1],10),wt(a)?-(a*yt):NaN;if(n=Xe.timezoneHHMM.exec(e),n){a=parseInt(n[2],10);const i=parseInt(n[3],10);return wt(a,i)?(s=Math.abs(a)*yt+i*Yr,n[1]==="+"?-s:s):NaN}if(Ur(e)){t=new Date(t||Date.now());const i=r?t:Ir(t),u=nt(i,e);return-(r?u:Er(t,u,e))}return NaN}function Ir(e){return it(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function nt(e,t){const r=Sr(e,t),n=it(r[0],r[1]-1,r[2],r[3]%24,r[4],r[5],0).getTime();let a=e.getTime();const s=a%1e3;return a-=s>=0?s:1e3+s,n-a}function Er(e,t,r){let a=e.getTime()-t;const s=nt(new Date(a),r);if(t===s)return t;a-=s-t;const i=nt(new Date(a),r);return s===i?s:Math.max(s,i)}function wt(e,t){return-23<=e&&e<=23&&(t==null||0<=t&&t<=59)}const Dt={};function Ur(e){if(Dt[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),Dt[e]=!0,!0}catch{return!1}}function xt(e){const t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+e-+t}const Ut=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,et=36e5,Tt=6e4,Ar=2,Y={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:Ut};function at(e,t={}){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(e===null)return new Date(NaN);const r=t.additionalDigits==null?Ar:Number(t.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]")return new Date(e.getTime());if(typeof e=="number"||Object.prototype.toString.call(e)==="[object Number]")return new Date(e);if(Object.prototype.toString.call(e)!=="[object String]")return new Date(NaN);const n=Pr(e),{year:a,restDateString:s}=Lr(n.date,r),i=Hr(s,a);if(i===null||isNaN(i.getTime()))return new Date(NaN);if(i){const u=i.getTime();let _=0,g;if(n.time&&(_=Rr(n.time),_===null||isNaN(_)))return new Date(NaN);if(n.timeZone||t.timeZone){if(g=lt(n.timeZone||t.timeZone,new Date(u+_)),isNaN(g))return new Date(NaN)}else g=xt(new Date(u+_)),g=xt(new Date(u+_+g));return new Date(u+_+g)}else return new Date(NaN)}function Pr(e){const t={};let r=Y.dateTimePattern.exec(e),n;if(r?(t.date=r[1],n=r[3]):(r=Y.datePattern.exec(e),r?(t.date=r[1],n=r[2]):(t.date=null,n=e)),n){const a=Y.timeZone.exec(n);a?(t.time=n.replace(a[1],""),t.timeZone=a[1].trim()):t.time=n}return t}function Lr(e,t){if(e){const r=Y.YYY[t],n=Y.YYYYY[t];let a=Y.YYYY.exec(e)||n.exec(e);if(a){const s=a[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(a=Y.YY.exec(e)||r.exec(e),a){const s=a[1];return{year:parseInt(s,10)*100,restDateString:e.slice(s.length)}}}return{year:null}}function Hr(e,t){if(t===null)return null;let r,n,a;if(!e||!e.length)return r=new Date(0),r.setUTCFullYear(t),r;let s=Y.MM.exec(e);if(s)return r=new Date(0),n=parseInt(s[1],10)-1,kt(t,n)?(r.setUTCFullYear(t,n),r):new Date(NaN);if(s=Y.DDD.exec(e),s){r=new Date(0);const i=parseInt(s[1],10);return $r(t,i)?(r.setUTCFullYear(t,0,i),r):new Date(NaN)}if(s=Y.MMDD.exec(e),s){r=new Date(0),n=parseInt(s[1],10)-1;const i=parseInt(s[2],10);return kt(t,n,i)?(r.setUTCFullYear(t,n,i),r):new Date(NaN)}if(s=Y.Www.exec(e),s)return a=parseInt(s[1],10)-1,Nt(a)?St(t,a):new Date(NaN);if(s=Y.WwwD.exec(e),s){a=parseInt(s[1],10)-1;const i=parseInt(s[2],10)-1;return Nt(a,i)?St(t,a,i):new Date(NaN)}return null}function Rr(e){let t,r,n=Y.HH.exec(e);if(n)return t=parseFloat(n[1].replace(",",".")),tt(t)?t%24*et:NaN;if(n=Y.HHMM.exec(e),n)return t=parseInt(n[1],10),r=parseFloat(n[2].replace(",",".")),tt(t,r)?t%24*et+r*Tt:NaN;if(n=Y.HHMMSS.exec(e),n){t=parseInt(n[1],10),r=parseInt(n[2],10);const a=parseFloat(n[3].replace(",","."));return tt(t,r,a)?t%24*et+r*Tt+a*1e3:NaN}return null}function St(e,t,r){t=t||0,r=r||0;const n=new Date(0);n.setUTCFullYear(e,0,4);const a=n.getUTCDay()||7,s=t*7+r+1-a;return n.setUTCDate(n.getUTCDate()+s),n}const Wr=[31,28,31,30,31,30,31,31,30,31,30,31],Fr=[31,29,31,30,31,30,31,31,30,31,30,31];function At(e){return e%400===0||e%4===0&&e%100!==0}function kt(e,t,r){if(t<0||t>11)return!1;if(r!=null){if(r<1)return!1;const n=At(e);if(n&&r>Fr[t]||!n&&r>Wr[t])return!1}return!0}function $r(e,t){if(t<1)return!1;const r=At(e);return!(r&&t>366||!r&&t>365)}function Nt(e,t){return!(e<0||e>52||t!=null&&(t<0||t>6))}function tt(e,t,r){return!(e<0||e>=25||t!=null&&(t<0||t>=60)||r!=null&&(r<0||r>=60))}function Mt(e,t,r){e=at(e,r);const n=lt(t,e,!0),a=new Date(e.getTime()-n),s=new Date(0);return s.setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()),s.setHours(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),s}function jr(e,t,r){if(typeof e=="string"&&!e.match(Ut))return at(e,{...r,timeZone:t});e=at(e,r);const n=it(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()).getTime(),a=lt(t,new Date(n));return new Date(n+a)}const st=ae([]);let q=null;async function se(){return q||(q=(async()=>{const{data:e,error:t}=await G.from("calendar_events").select("*").order("start_time",{ascending:!0});if(t)throw q=null,t;const r=e||[];return st.set(r),setTimeout(()=>{q=null},100),r})(),q)}async function Pt(e){let t=gt(st);return t.length||(await se(),t=gt(st)),t.find(r=>r.id===e)}async function Br(e){const{data:t,error:r}=await G.from("calendar_events").insert([e]).select();if(r)throw r;return q=null,await se(),t?t[0]:void 0}async function Ae(e,t){const{data:r,error:n}=await G.from("calendar_events").update(t).eq("id",e).select();if(n)throw n;return q=null,await se(),r?r[0]:void 0}async function zr(e){const t=await Pt(e),{error:r}=await G.from("calendar_events").delete().eq("id",e);if(r)throw r;t?.attachments&&t.attachments.length>0&&await ct(t.attachments),q=null,await se()}const Zr={bishop:{approval:"bishop_approval",timestamp:"bishop_approval_at",userId:"bishop_approval_by_user_id"},first_counselor:{approval:"first_counselor_approval",timestamp:"first_counselor_approval_at",userId:"first_counselor_approval_by_user_id"},second_counselor:{approval:"second_counselor_approval",timestamp:"second_counselor_approval_at",userId:"second_counselor_approval_by_user_id"}};async function Lt(e,t,r,n){const a=Zr[t],s=r?new Date().toISOString():null;return Ae(e,{[a.approval]:r,[a.timestamp]:s,[a.userId]:r?n??null:null})}async function Ht(e){return Ae(e,{is_published:!0})}async function Rt(e){return Ae(e,{is_published:!1})}async function qr(e=new Date){const t=e.toISOString(),{data:r,error:n}=await G.from("calendar_events").select("*").lt("start_time",t).eq("event_type","calendar_event");if(n)throw n;if(!r||r.length===0)return{deleted:0,skipped:0};const a=[],s=[];for(const u of r){if(u.recurrence_rule&&(!u.recurrence_end_date||u.recurrence_end_date&&new Date(u.recurrence_end_date)>=e)){s.push(u);continue}a.push(u)}let i=0;if(a.length>0){const u=a.map(_=>_.id).filter(_=>_!==void 0);if(u.length>0){const{data:_,error:g}=await G.from("calendar_events").delete().in("id",u).select("id");if(g)throw g;i=_?.length??0;for(const M of a)M.attachments&&M.attachments.length>0&&await ct(M.attachments)}}return q=null,await se(),{deleted:i,skipped:s.length}}async function Gr(e,t){const r=e.name.split(".").pop()||"bin",n=t||"temp",s=`${crypto.randomUUID()}.${r}`,i=`${n}/${s}`,{error:u}=await G.storage.from("event-attachments").upload(i,e,{cacheControl:"3600",upsert:!1});if(u)throw u;const{data:{publicUrl:_}}=G.storage.from("event-attachments").getPublicUrl(i);return{id:crypto.randomUUID(),name:e.name,url:_,type:e.type,size:e.size,uploadedAt:new Date().toISOString()}}async function Vr(e){const{error:t}=await G.storage.from("event-attachments").remove([e]);if(t)throw t}function Wt(e){const t=e.match(/event-attachments\/(.+)$/);return t?t[1]:""}async function ct(e){if(!e||e.length===0)return;const t=e.map(r=>Wt(r.url)).filter(r=>r);if(t.length>0){const{error:r}=await G.storage.from("event-attachments").remove(t);if(r)throw r}}const En=Object.freeze(Object.defineProperty({__proto__:null,createCalendarEvent:Br,deleteCalendarEvent:zr,deleteEventAttachment:Vr,deleteEventAttachments:ct,deletePastCalendarEvents:qr,extractStoragePath:Wt,getAllCalendarEvents:se,getCalendarEvent:Pt,publishCalendarEvent:Ht,unpublishCalendarEvent:Rt,updateBishopricApproval:Lt,updateCalendarEvent:Ae,uploadEventAttachment:Gr},Symbol.toStringTag,{value:"Module"})),Kr={all:{label:"All",key:"",sort_index:0,color_number:0},public:{label:"Public",key:"PUB",sort_index:0,color_number:1},church:{label:"Church",key:"CHU",sort_index:0,color_number:2},stake:{label:"Stake",key:"STK",sort_index:0,color_number:3},ward:{label:"Ward",key:"WRD",sort_index:1,color_number:4},reliefSociety:{label:"Relief Society",key:"RES",sort_index:2,color_number:5},eldersQuorum:{label:"Elders Quorum",key:"ELQ",sort_index:3,color_number:6},youth:{label:"Youth",key:"YOU",sort_index:4,color_number:7},youngWomen:{label:"Young Women",key:"YOW",sort_index:4,color_number:8},youngWomenPearls:{label:"Young Women | Pearls",key:"YWP",sort_index:5,color_number:9},youngWomenRubies:{label:"Young Women | Rubies",key:"YWR",sort_index:6,color_number:10},youngWomenDiamonds:{label:"Young Women | Diamonds",key:"YWD",sort_index:7,color_number:11},aaronicPriesthood:{label:"Young Men",key:"YOM",sort_index:8,color_number:12},aaronicPriesthoodDeacons:{label:"Young Men | Deacons",key:"YMD",sort_index:9,color_number:13},aaronicPriesthoodTeachers:{label:"Young Men | Teachers",key:"YMT",sort_index:10,color_number:14},aaronicPriesthoodPriests:{label:"Young Men | Priests",key:"YMP",sort_index:11,color_number:15},primary:{label:"Primary",key:"PRI",sort_index:12,color_number:16},primaryNursery:{label:"Primary | Nursery",key:"PRN",sort_index:13,color_number:17},primarySunbeams:{label:"Primary | Sunbeams",key:"PRS",sort_index:14,color_number:18},primaryCTR:{label:"Primary | CTR",key:"PRC",sort_index:15,color_number:19},primaryValiant:{label:"Primary | Valiant",key:"PRV",sort_index:16,color_number:20},sundaySchool:{label:"Sunday School",key:"SUS",sort_index:17,color_number:21}},ot=Object.values(Kr).sort((e,t)=>e.sort_index-t.sort_index),Un=e=>e?ot.find(t=>t.key===e):void 0,Ct={bishop:"Bishop",first_counselor:"1st Counselor",second_counselor:"2nd Counselor"},ut=e=>{let t=0;return e.bishop_approval==="YES"&&t++,e.first_counselor_approval==="YES"&&t++,e.second_counselor_approval==="YES"&&t++,t},Qr=e=>ut(e)>0,Jr=e=>e.is_published?"published":ut(e)>0?"approved":e.bishop_approval==="NO"||e.first_counselor_approval==="NO"||e.second_counselor_approval==="NO"?"needs_review":"pending";let ke=null;const Xr=e=>e.replace(/<[^>]*>/g,"").toLowerCase(),Ot=(e,t)=>{if(!t.trim())return!0;const r=t.toLowerCase(),n=(e.title||"").toLowerCase(),a=Xr(e.description||""),s=(e.location||"").toLowerCase();return n.includes(r)||a.includes(r)||s.includes(r)},An=(e,t)=>{if(!t.trim()||!e)return Yt(e||"");const r=Yt(e),n=new RegExp(`(${Ft(t)})`,"gi");return r.replace(n,"<mark>$1</mark>")},Pn=(e,t)=>{if(!t.trim()||!e)return e||"";const r=new RegExp(`(${Ft(t)})`,"gi");return e.replace(/(<[^>]*>)|([^<]+)/g,(n,a,s)=>a||(s?s.replace(r,"<mark>$1</mark>"):n))},Yt=e=>{const t=typeof document<"u"?document.createElement("div"):null;return t?(t.textContent=e,t.innerHTML):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},Ft=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),en=It()??null,tn=Et(!1),rt=en?.stores.authenticated??tn,rn=()=>{const e=ae(!1),t=ae([]),r=ae([]),n=ae(""),a=ae(""),s=ae(!1),i=(p,f)=>!(!p.is_published||!f&&p.is_public===!1),u=re([r,rt],([p,f])=>{const b=new Date,k=ne(Te(b,3),{weekStartsOn:1}),l=p.filter(v=>v?.meta_data?.category?.length).filter(v=>i(v,f)).filter(v=>{if(v.event_type==="calendar_event"){const N=v.start_time?pe(v.start_time):null;return N?Ue(N,{start:b,end:k}):!1}return!0}).map(v=>ot.find(N=>N.key===v.meta_data?.category)).filter(v=>v!==void 0);return Array.from(new Set(l))}),_=re([n],([p])=>ot.find(f=>f.key===p)),g=re([r,n,a,rt],([p,f,b,k])=>p.filter(l=>l.event_type==="calendar_event").filter(l=>{const v=l?.meta_data;return f&&v?v?.category===f:!0}).filter(l=>Ot(l,b)).filter(l=>i(l,k)).filter(l=>{const v=l.start_time?pe(l.start_time):null,N=Dr();return v?xr(v,N)||v.getTime()>=N.getTime():!1})),M=re([r,n,a,rt],([p,f,b,k])=>p.filter(l=>l.event_type==="announcement").filter(l=>{const v=l?.meta_data;return f&&v?v?.category===f:!0}).filter(l=>Ot(l,b)).filter(l=>i(l,k))),D=re([g],([p])=>p.filter(f=>{const b=f.start_time?pe(f.start_time):null;return b?Ue(b,{start:fe(new Date,{weekStartsOn:1}),end:ne(new Date,{weekStartsOn:1})}):!1})),J=()=>{const p=fe(new Date,{weekStartsOn:1}),f=ne(new Date,{weekStartsOn:1});return`${Q(p,"MMM d").toUpperCase()} – ${Q(f,"MMM d").toUpperCase()}`},_e=re([g],([p])=>{const f=Te(fe(new Date,{weekStartsOn:1}),1),b=ne(f,{weekStartsOn:1});return p.filter(k=>{const l=k.start_time?pe(k.start_time):null;return l?Ue(l,{start:f,end:b}):!1})}),me=()=>{const p=Te(fe(new Date,{weekStartsOn:1}),1),f=ne(p,{weekStartsOn:1});return`${Q(p,"MMM d").toUpperCase()} – ${Q(f,"MMM d").toUpperCase()}`},ve=re([g],([p])=>{const f=Te(fe(new Date,{weekStartsOn:1}),2),b=ne(f,{weekStartsOn:1});return p.filter(k=>{const l=k.start_time?pe(k.start_time):null;return l?Ue(l,{start:f,end:b}):!1})}),Ne=()=>{const p=Te(fe(new Date,{weekStartsOn:1}),2),f=ne(p,{weekStartsOn:1});return`${Q(p,"MMM d").toUpperCase()} – ${Q(f,"MMM d").toUpperCase()}`},m=p=>{const f=[],b=new Date,k=new Date;k.setFullYear(b.getFullYear()+1);for(const l of p)if(l.recurrence_rule&&l.start_time&&l.end_time)try{const v=wr.fromString(l.recurrence_rule),N=l.recurrence_end_date?v.all():v.between(b,k,!0),V=new Date(l.start_time),Le=new Date(l.end_time).getTime()-V.getTime(),oe=Mt(V,Ve),Me=oe.getHours(),be=oe.getMinutes(),He=oe.getSeconds(),Ce=oe.getMilliseconds(),Re=l.recurrence_exceptions||[],ge=l.recurrence_overrides||{};N.forEach((Oe,We)=>{const Fe=Mt(Oe,Ve),ie=new Date(Fe);ie.setHours(Me,be,He,Ce);const le=jr(ie,Ve),$e=le,je=new Date(le.getTime()+Le),Ye=Q(Oe,"yyyy-MM-dd"),S=ge[Ye];if(Re.includes(Ye)&&!S)return;const W={...l,id:void 0,start_time:$e.toISOString(),end_time:je.toISOString(),meta_data:{category:l.meta_data?.category||"",...l.meta_data,recurring_instance:!0,recurring_parent_id:l.id,recurring_instance_index:We}};S&&(S.title!==void 0&&(W.title=S.title),S.description!==void 0&&(W.description=S.description),S.location!==void 0&&(W.location=S.location),S.start_time!==void 0&&(W.start_time=S.start_time),S.end_time!==void 0&&(W.end_time=S.end_time),S.is_all_day!==void 0&&(W.is_all_day=S.is_all_day),S.meta_data!==void 0&&(W.meta_data={...W.meta_data,...S.meta_data})),f.push(W)})}catch(v){console.error("Failed to expand recurring event:",l.id,v),f.push(l)}else f.push(l);return f},X=p=>p.length?m(p).map(b=>({...b,start_time:b?.start_time?bt(b.start_time):void 0,end_time:b.end_time?bt(b.end_time):void 0})):[];return ke={stores:{ready:e,data:t,dbData:r,announcements:M,calendarEvents:g,calendarEventsThisWeek:D,calendarEventsNextWeek:_e,calendarEventsNextNextWeek:ve,currentCategories:u,categoryFilter:n,searchQuery:a,currentCategoryFilter:_,weeksExpanded:s},actions:{reload:async()=>{e.set(!1);const p=await se();r.set(X(p)),e.set(!0)},calendarEventsThisWeekLabel:J,calendarEventsNextWeekLabel:me,calendarEventsNextNextWeekLabel:Ne}},ke},Ln=()=>ke?.stores&&Object.keys(ke.stores).length>0?ke:rn();var nn=I("<span> </span>"),an=I('<div class="alert alert-info mb-0" role="alert">Save this event or announcement before requesting bishopric approvals.</div>'),sn=I('<small class="text-muted"> </small>'),on=I("<span><!></span>"),ln=I('<div class="decision-buttons d-grid gap-2 gap-md-3 svelte-rko3uy"><button type="button"><i class="bi bi-check-circle-fill"></i> <div><div class="action-label svelte-rko3uy">Approve</div> <small class="text-muted">Vote to approve</small></div></button> <button type="button"><i class="bi bi-pencil-square"></i> <div><div class="action-label svelte-rko3uy">Request Changes</div> <small class="text-muted">Ask submitter to revise</small></div></button> <button type="button"><i class="bi bi-hourglass-split"></i> <div><div class="action-label svelte-rko3uy">Mark Pending</div> <small class="text-muted">No decision yet</small></div></button> <!></div>'),cn=I("<span> </span>"),un=I('<div class="list-group-item"><div class="d-flex flex-column gap-2"><div><div class="fw-semibold"> </div> <!></div> <div><!></div></div></div>'),dn=I('<i class="bi bi-globe-americas"></i>'),fn=I('<button type="button" class="btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center gap-2"><!> Unpublish</button>'),pn=I('<i class="bi bi-globe"></i>'),_n=I('<small class="text-muted text-center">At least one approval required to publish</small>'),mn=I('<button type="button" class="btn btn-success w-100 d-flex align-items-center justify-content-center gap-2"><!> Publish to Ward</button> <!>',1),vn=I('<div class="card-footer text-danger small"> </div>'),bn=I('<div class="card"><div class="list-group list-group-flush"></div> <div class="publish-section d-flex flex-column gap-2 p-3 svelte-rko3uy"><div class="d-flex justify-content-between align-items-center"><span class="text-muted small fw-semibold"> </span></div> <!></div> <!></div>'),gn=I('<div class="d-flex flex-column gap-3"><div class="d-flex flex-wrap align-items-center justify-content-between gap-2"><h3 class="h5 mb-0">Bishopric Approval</h3> <!></div> <!></div>');function Hn(e,t){or(t,!1);const r=()=>fr(l,"$currentUserStore",n),[n,a]=pr(),s=C(),i=C(),u=C(),_=C(),g=C(),M=C(),D=C(),J=C(),_e=C(),me=C(),ve=C(),Ne=C();let m=Ge(t,"eventItem",12),X=Ge(t,"disabled",8,!1),Pe=Ge(t,"reloadEvents",8,null);const p={bishop:"bishopric-bishop",first_counselor:"bishopric-first-counselor",second_counselor:"bishopric-second-counselor"},f={pending:{text:"Pending Approval",class:"bg-warning-subtle text-warning-emphasis"},approved:{text:"Approved",class:"bg-success-subtle text-success-emphasis"},needs_review:{text:"Needs Review",class:"bg-info-subtle text-info-emphasis"},published:{text:"Published",class:"bg-primary-subtle text-primary-emphasis"}},b=It()??null,k=Et(hr),l=b?.stores.currentUser??k,v=["bishop","first_counselor","second_counselor"];let N=C(""),V=C(null),ee=C(!1);function Le(c){const h=p[c];return o(s)?.roles?.includes(h)??!1}function oe(c){if(!c)return null;try{return Q(pe(c),"MMM d, yyyy 'at' h:mm a")}catch(h){return console.error("Failed to format timestamp",h),null}}async function Me(){typeof Pe()=="function"&&await Pe()()}async function be(c,h){if(m()?.id){y(N,""),y(V,c);try{const x=await Lt(m().id,c,h,o(s)?.id);x&&m({...m(),bishop_approval:x.bishop_approval,first_counselor_approval:x.first_counselor_approval,second_counselor_approval:x.second_counselor_approval,bishop_approval_at:x.bishop_approval_at,first_counselor_approval_at:x.first_counselor_approval_at,second_counselor_approval_at:x.second_counselor_approval_at,bishop_approval_by_user_id:x.bishop_approval_by_user_id,first_counselor_approval_by_user_id:x.first_counselor_approval_by_user_id,second_counselor_approval_by_user_id:x.second_counselor_approval_by_user_id,is_published:x.is_published}),await Me()}catch(x){console.error("Failed to update approval",x),y(N,"Unable to update approval. Please try again.")}finally{y(V,null)}}}async function He(c){await be(c,null)}async function Ce(){if(m()?.id){y(N,""),y(ee,!0);try{const c=o(M)?await Rt(m().id):await Ht(m().id);c&&m({...m(),is_published:c.is_published}),await Me()}catch(c){console.error("Failed to update publish status",c),y(N,"Unable to update publish status. Please try again.")}finally{y(ee,!1)}}}function Re(c){return c==="YES"?{text:"Approved",class:"bg-success-subtle text-success-emphasis"}:c==="NO"?{text:"Requested Changes",class:"bg-info-subtle text-info-emphasis"}:{text:"No Input Yet",class:"bg-secondary-subtle text-secondary-emphasis"}}const ge="btn btn-sm action-btn w-100 text-start d-flex align-items-center gap-2";function Oe(c){return`${ge} ${c==="YES"?"btn-success text-white":"btn-outline-success"}`}function We(c){return`${ge} ${c==="NO"?"btn-info text-dark":"btn-outline-info"}`}function Fe(c){const h=c==null;return`${ge} ${h?"btn-secondary text-white":"btn-outline-secondary"}`}R(()=>r(),()=>{y(s,r())}),R(()=>$(m()),()=>{y(i,Jr(m()))}),R(()=>o(i),()=>{y(u,f[o(i)])}),R(()=>$(m()),()=>{y(_,ut(m()))}),R(()=>$(m()),()=>{y(g,Qr(m()))}),R(()=>$(m()),()=>{y(M,m()?.is_published??!1)}),R(()=>$(m()),()=>{y(D,{bishop:m()?.bishop_approval,first_counselor:m()?.first_counselor_approval,second_counselor:m()?.second_counselor_approval})}),R(()=>$(m()),()=>{y(J,{bishop:m()?.bishop_approval_at,first_counselor:m()?.first_counselor_approval_at,second_counselor:m()?.second_counselor_approval_at})}),R(()=>o(s),()=>{y(_e,o(s)?.roles?.includes("bishopric-bishop")??!1)}),R(()=>o(s),()=>{y(me,o(s)?.roles?.includes("bishopric-first-counselor")??!1)}),R(()=>o(s),()=>{y(ve,o(s)?.roles?.includes("bishopric-second-counselor")??!1)}),R(()=>(o(_e),o(me),o(ve)),()=>{y(Ne,o(_e)?v:v.filter(c=>c==="bishop"||c==="first_counselor"&&o(me)||c==="second_counselor"&&o(ve)))}),ir(),yr();var ie=gn(),le=T(ie),$e=j(T(le),2);{var je=c=>{var h=nn(),x=T(h,!0);w(h),Z(()=>{xe(h,1,(o(u),U(()=>`badge ${o(u).class}`)),"svelte-rko3uy"),de(x,(o(u),U(()=>o(u).text)))}),O(c,h)};z($e,c=>{$(m()),U(()=>m()?.id)&&c(je)})}w(le);var Ye=j(le,2);{var S=c=>{var h=an();O(c,h)},W=c=>{var h=bn(),x=T(h);_r(x,5,()=>o(Ne),mr,(A,d)=>{var E=un(),ce=T(E),te=T(ce),P=T(te),he=T(P,!0);w(P);var Ze=j(P,2);{var L=B=>{var H=sn(),F=T(H,!0);w(H),Z(K=>de(F,K),[()=>(o(J),o(d),U(()=>oe(o(J)[o(d)])))]),O(B,H)};z(Ze,B=>{o(J),o(d),U(()=>o(J)[o(d)])&&B(L)})}w(te);var ue=j(te,2),Gt=T(ue);{var Vt=B=>{var H=ln(),F=T(H),K=j(F,2),Ie=j(K,2),Qt=j(Ie,2);{var Jt=ye=>{var we=on(),qe=T(we);Qe(qe,{size:"xs"}),w(we),O(ye,we)};z(Qt,ye=>{o(V)===o(d)&&ye(Jt)})}w(H),Z((ye,we,qe)=>{xe(F,1,ye,"svelte-rko3uy"),F.disabled=X()||o(V)===o(d),xe(K,1,we,"svelte-rko3uy"),K.disabled=X()||o(V)===o(d),xe(Ie,1,qe,"svelte-rko3uy"),Ie.disabled=X()||o(V)===o(d)},[()=>Ke((o(D),o(d),U(()=>Oe(o(D)[o(d)])))),()=>Ke((o(D),o(d),U(()=>We(o(D)[o(d)])))),()=>Ke((o(D),o(d),U(()=>Fe(o(D)[o(d)]))))]),De("click",F,()=>be(o(d),"YES")),De("click",K,()=>be(o(d),"NO")),De("click",Ie,()=>He(o(d))),O(B,H)},Kt=B=>{const H=cr(()=>(o(D),o(d),U(()=>Re(o(D)[o(d)]))));var F=cn(),K=T(F,!0);w(F),Z(()=>{xe(F,1,($(o(H)),U(()=>`badge ${o(H).class}`)),"svelte-rko3uy"),de(K,($(o(H)),U(()=>o(H).text)))}),O(B,F)};z(Gt,B=>{o(d),U(()=>Le(o(d)))?B(Vt):B(Kt,!1)})}w(ue),w(ce),w(E),Z(()=>de(he,($(Ct),o(d),U(()=>Ct[o(d)])))),O(A,E)}),w(x);var Be=j(x,2),ze=T(Be),dt=T(ze),$t=T(dt);w(dt),w(ze);var jt=j(ze,2);{var Bt=A=>{var d=fn(),E=T(d);{var ce=P=>{Qe(P,{size:"xs"})},te=P=>{var he=dn();O(P,he)};z(E,P=>{o(ee)?P(ce):P(te,!1)})}mt(),w(d),Z(()=>d.disabled=X()||o(ee)),De("click",d,Ce),O(A,d)},zt=A=>{var d=mn(),E=ur(d),ce=T(E);{var te=L=>{Qe(L,{size:"xs"})},P=L=>{var ue=pn();O(L,ue)};z(ce,L=>{o(ee)?L(te):L(P,!1)})}mt(),w(E);var he=j(E,2);{var Ze=L=>{var ue=_n();O(L,ue)};z(he,L=>{o(g)||L(Ze)})}Z(()=>{E.disabled=X()||o(ee)||!o(g),vr(E,"title",o(g)?"":"At least one approval required to publish")}),De("click",E,Ce),O(A,d)};z(jt,A=>{o(M)?A(Bt):A(zt,!1)})}w(Be);var Zt=j(Be,2);{var qt=A=>{var d=vn(),E=T(d,!0);w(d),Z(()=>de(E,o(N))),O(A,d)};z(Zt,A=>{o(N)&&A(qt)})}w(h),Z(()=>de($t,`Approvals: ${o(_)??""} of 3`)),O(c,h)};z(Ye,c=>{$(m()),U(()=>!m()?.id)?c(S):c(W,!1)})}w(ie),O(e,ie),lr(),a()}export{Hn as B,ot as D,Jr as a,Un as b,Te as c,qr as d,ne as e,ut as f,Ln as g,In as h,Tr as i,An as j,Pn as k,jr as l,Wt as m,Vr as n,zr as o,Pt as p,Ae as q,Br as r,En as s,Mt as t,Gr as u};
