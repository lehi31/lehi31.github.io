const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./tUu8UEjF.js","./C2hsME61.js"])))=>i.map(i=>d[i]);
import{B as de,h as gr,d as yr,K as Oa,bc as Fa,L as wr,Y as Na,ac as Pa,b1 as Ya,a_ as La,N as Ba,G as yn,p as Ct,ah as Ce,ai as Jt,c as B,s as j,a as Mt,m as r,E as X,n as le,D as M,u as ee,F as at,r as L,C as Kn,ap as zr,f as bt,as as Dn,R as rt,v as Ha}from"./SWWSvUpQ.js";import{b as xr,d as za,f as re,a as te,c as Wa}from"./D8ekX_8E.js";import{_ as hn}from"./CmsKOCeN.js";import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{g as pn,w as Wt,r as Wr,d as Kt,c as ja,o as rr,a as jr}from"./WW5OsAH7.js";import{p as se,i as he,e as Se,s as ge,m as qa,u as $a,a as En,b as qr}from"./CU3XCoqN.js";import{b as Vn,r as ut,s as Oe}from"./Bo0ckpDG.js";import{t as vn,a as Pe,d as Rn,p as Zt,z as rn,h as Ne,H as Dr,A as ft,e as Qe,b as $r,f as Qr,I as Qa,i as Bn,C as Ka,O as Er}from"./Cd_j89jg.js";import{i as Ot}from"./Bgyk9asy.js";import{S as jt}from"./DZmooZ_8.js";import{e as bn,i as ar}from"./YJAcq9su.js";import{b as kt,a as ir,c as Hn}from"./CvxMDV_e.js";import{b as sn}from"./Dtu51PMB.js";import{b as Lt}from"./Cc3l00Qu.js";import{t as Yt}from"./r7-tBYgy.js";import{R as Le}from"./Blfjb2uJ.js";import{e as Vt}from"./CvIFtd6X.js";import{a as _n,p as An}from"./Cn94QYK6.js";import{s as Va,i as Za}from"./BtS1ps7i.js";import{c as Ga}from"./Dvip-AuD.js";import{a as Xa,b as Rt,f as Sr,h as Ja,e as ei,V as ti}from"./C2hsME61.js";import{v as Zn,D as Gn}from"./DJReKAPT.js";import{f as ni}from"./CzBDDMr3.js";function pl(n,a,u=!1,i=!1,e=!1){var t=n,f="";de(()=>{var c=Oa;if(f===(f=a()??"")){gr&&yr();return}if(c.nodes!==null&&(Fa(c.nodes.start,c.nodes.end),c.nodes=null),f!==""){if(gr){wr.data;for(var b=yr(),y=b;b!==null&&(b.nodeType!==Na||b.data!=="");)y=b,b=Pa(b);if(b===null)throw Ya(),La;xr(wr,y),t=Ba(b);return}var o=f+"";u?o=`<svg>${o}</svg>`:i&&(o=`<math>${o}</math>`);var l=za(o);if((u||i)&&(l=yn(l)),xr(yn(l),l.lastChild),u||i)for(;yn(l);)t.before(yn(l));else t.before(l)}})}function fn(n,a){const u=a*7;return _n(n,u)}function wn(n,a){const u=+vn(n),[i,e]=[+vn(a.start),+vn(a.end)].sort((t,f)=>t-f);return u>=i&&u<=e}function ri(n,a){const u=vn(n);return u.setHours(a),u}function ai(n,a){const u=vn(n);return u.setMinutes(a),u}function ii(n,a){const u=ui(a);return"formatToParts"in u?oi(u,n):li(u,n)}const si={year:0,month:1,day:2,hour:3,minute:4,second:5};function oi(n,a){try{const u=n.formatToParts(a),i=[];for(let e=0;e<u.length;e++){const t=si[u[e].type];t!==void 0&&(i[t]=parseInt(u[e].value,10))}return i}catch(u){if(u instanceof RangeError)return[NaN];throw u}}function li(n,a){const u=n.format(a),i=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(u);return[parseInt(i[3],10),parseInt(i[1],10),parseInt(i[2],10),parseInt(i[4],10),parseInt(i[5],10),parseInt(i[6],10)]}const zn={},Ar=new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:"America/New_York",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),ci=Ar==="06/25/2014, 00:00:00"||Ar==="‎06‎/‎25‎/‎2014‎ ‎00‎:‎00‎:‎00";function ui(n){return zn[n]||(zn[n]=ci?new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:n,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:n,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),zn[n]}function sr(n,a,u,i,e,t,f){const c=new Date(0);return c.setUTCFullYear(n,a,u),c.setUTCHours(i,e,t,f),c}const Ir=36e5,di=6e4,Wn={timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-])(\d{2}):?(\d{2})$/};function or(n,a,u){if(!n)return 0;let i=Wn.timezoneZ.exec(n);if(i)return 0;let e,t;if(i=Wn.timezoneHH.exec(n),i)return e=parseInt(i[1],10),kr(e)?-(e*Ir):NaN;if(i=Wn.timezoneHHMM.exec(n),i){e=parseInt(i[2],10);const f=parseInt(i[3],10);return kr(e,f)?(t=Math.abs(e)*Ir+f*di,i[1]==="+"?-t:t):NaN}if(mi(n)){a=new Date(a||Date.now());const f=u?a:fi(a),c=Xn(f,n);return-(u?c:vi(a,c,n))}return NaN}function fi(n){return sr(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())}function Xn(n,a){const u=ii(n,a),i=sr(u[0],u[1]-1,u[2],u[3]%24,u[4],u[5],0).getTime();let e=n.getTime();const t=e%1e3;return e-=t>=0?t:1e3+t,i-e}function vi(n,a,u){let e=n.getTime()-a;const t=Xn(new Date(e),u);if(a===t)return a;e-=t-a;const f=Xn(new Date(e),u);return t===f?t:Math.max(t,f)}function kr(n,a){return-23<=n&&n<=23&&(a==null||0<=a&&a<=59)}const Tr={};function mi(n){if(Tr[n])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:n}),Tr[n]=!0,!0}catch{return!1}}function Cr(n){const a=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return a.setUTCFullYear(n.getFullYear()),+n-+a}const Kr=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,jn=36e5,Mr=6e4,hi=2,dt={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:Kr};function Jn(n,a={}){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(n===null)return new Date(NaN);const u=a.additionalDigits==null?hi:Number(a.additionalDigits);if(u!==2&&u!==1&&u!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]")return new Date(n.getTime());if(typeof n=="number"||Object.prototype.toString.call(n)==="[object Number]")return new Date(n);if(Object.prototype.toString.call(n)!=="[object String]")return new Date(NaN);const i=pi(n),{year:e,restDateString:t}=_i(i.date,u),f=bi(t,e);if(f===null||isNaN(f.getTime()))return new Date(NaN);if(f){const c=f.getTime();let b=0,y;if(i.time&&(b=gi(i.time),b===null||isNaN(b)))return new Date(NaN);if(i.timeZone||a.timeZone){if(y=or(i.timeZone||a.timeZone,new Date(c+b)),isNaN(y))return new Date(NaN)}else y=Cr(new Date(c+b)),y=Cr(new Date(c+b+y));return new Date(c+b+y)}else return new Date(NaN)}function pi(n){const a={};let u=dt.dateTimePattern.exec(n),i;if(u?(a.date=u[1],i=u[3]):(u=dt.datePattern.exec(n),u?(a.date=u[1],i=u[2]):(a.date=null,i=n)),i){const e=dt.timeZone.exec(i);e?(a.time=i.replace(e[1],""),a.timeZone=e[1].trim()):a.time=i}return a}function _i(n,a){if(n){const u=dt.YYY[a],i=dt.YYYYY[a];let e=dt.YYYY.exec(n)||i.exec(n);if(e){const t=e[1];return{year:parseInt(t,10),restDateString:n.slice(t.length)}}if(e=dt.YY.exec(n)||u.exec(n),e){const t=e[1];return{year:parseInt(t,10)*100,restDateString:n.slice(t.length)}}}return{year:null}}function bi(n,a){if(a===null)return null;let u,i,e;if(!n||!n.length)return u=new Date(0),u.setUTCFullYear(a),u;let t=dt.MM.exec(n);if(t)return u=new Date(0),i=parseInt(t[1],10)-1,Ur(a,i)?(u.setUTCFullYear(a,i),u):new Date(NaN);if(t=dt.DDD.exec(n),t){u=new Date(0);const f=parseInt(t[1],10);return xi(a,f)?(u.setUTCFullYear(a,0,f),u):new Date(NaN)}if(t=dt.MMDD.exec(n),t){u=new Date(0),i=parseInt(t[1],10)-1;const f=parseInt(t[2],10);return Ur(a,i,f)?(u.setUTCFullYear(a,i,f),u):new Date(NaN)}if(t=dt.Www.exec(n),t)return e=parseInt(t[1],10)-1,Or(e)?Rr(a,e):new Date(NaN);if(t=dt.WwwD.exec(n),t){e=parseInt(t[1],10)-1;const f=parseInt(t[2],10)-1;return Or(e,f)?Rr(a,e,f):new Date(NaN)}return null}function gi(n){let a,u,i=dt.HH.exec(n);if(i)return a=parseFloat(i[1].replace(",",".")),qn(a)?a%24*jn:NaN;if(i=dt.HHMM.exec(n),i)return a=parseInt(i[1],10),u=parseFloat(i[2].replace(",",".")),qn(a,u)?a%24*jn+u*Mr:NaN;if(i=dt.HHMMSS.exec(n),i){a=parseInt(i[1],10),u=parseInt(i[2],10);const e=parseFloat(i[3].replace(",","."));return qn(a,u,e)?a%24*jn+u*Mr+e*1e3:NaN}return null}function Rr(n,a,u){a=a||0,u=u||0;const i=new Date(0);i.setUTCFullYear(n,0,4);const e=i.getUTCDay()||7,t=a*7+u+1-e;return i.setUTCDate(i.getUTCDate()+t),i}const yi=[31,28,31,30,31,30,31,31,30,31,30,31],wi=[31,29,31,30,31,30,31,31,30,31,30,31];function Vr(n){return n%400===0||n%4===0&&n%100!==0}function Ur(n,a,u){if(a<0||a>11)return!1;if(u!=null){if(u<1)return!1;const i=Vr(n);if(i&&u>wi[a]||!i&&u>yi[a])return!1}return!0}function xi(n,a){if(a<1)return!1;const u=Vr(n);return!(u&&a>366||!u&&a>365)}function Or(n,a){return!(n<0||n>52||a!=null&&(a<0||a>6))}function qn(n,a,u){return!(n<0||n>=25||a!=null&&(a<0||a>=60)||u!=null&&(u<0||u>=60))}function Xt(n,a,u){n=Jn(n,u);const i=or(a,n,!0),e=new Date(n.getTime()-i),t=new Date(0);return t.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),t.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),t}function qt(n,a,u){if(typeof n=="string"&&!n.match(Kr))return Jn(n,{...u,timeZone:a});n=Jn(n,u);const i=sr(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()).getTime(),e=or(a,new Date(i));return new Date(i+e)}const er=Wt([]);let It=null;async function $t(){return It||(It=(async()=>{const{data:n,error:a}=await Pe.from("calendar_events").select("*").order("start_time",{ascending:!0});if(a)throw It=null,a;const u=n||[];return er.set(u),setTimeout(()=>{It=null},100),u})(),It)}async function en(n){let a=pn(er);return a.length||(await $t(),a=pn(er)),a.find(u=>u.id===n)}async function lr(n){const{data:a,error:u}=await Pe.from("calendar_events").insert([n]).select();if(u)throw u;return It=null,await $t(),a?a[0]:void 0}async function Di(n){const{data:a,error:u}=await Pe.from("calendar_events").insert(n).select();if(u)throw u;return It=null,await $t(),a??[]}async function Tt(n,a){const{data:u,error:i}=await Pe.from("calendar_events").update(a).eq("id",n).select();if(i)throw i;return It=null,await $t(),u?u[0]:void 0}async function cr(n){const a=await en(n),{error:u}=await Pe.from("calendar_events").delete().eq("id",n);if(u)throw u;a?.attachments&&a.attachments.length>0&&await dr(a.attachments),It=null,await $t()}const Ei={bishop:{approval:"bishop_approval",timestamp:"bishop_approval_at",userId:"bishop_approval_by_user_id"},first_counselor:{approval:"first_counselor_approval",timestamp:"first_counselor_approval_at",userId:"first_counselor_approval_by_user_id"},second_counselor:{approval:"second_counselor_approval",timestamp:"second_counselor_approval_at",userId:"second_counselor_approval_by_user_id"}};async function Zr(n,a,u,i){const e=Ei[a],t=u?new Date().toISOString():null;return Tt(n,{[e.approval]:u,[e.timestamp]:t,[e.userId]:u?i??null:null})}async function Gr(n){return Tt(n,{is_published:!0})}async function Xr(n){return Tt(n,{is_published:!1})}async function Si(n=new Date){const a=n.toISOString(),{data:u,error:i}=await Pe.from("calendar_events").select("*").lt("start_time",a).eq("event_type","calendar_event");if(i)throw i;if(!u||u.length===0)return{deleted:0,skipped:0};const e=[],t=[];for(const c of u){if(c.recurrence_rule&&(!c.recurrence_end_date||c.recurrence_end_date&&new Date(c.recurrence_end_date)>=n)){t.push(c);continue}e.push(c)}let f=0;if(e.length>0){const c=e.map(b=>b.id).filter(b=>b!==void 0);if(c.length>0){const{data:b,error:y}=await Pe.from("calendar_events").delete().in("id",c).select("id");if(y)throw y;f=b?.length??0;for(const o of e)o.attachments&&o.attachments.length>0&&await dr(o.attachments)}}return It=null,await $t(),{deleted:f,skipped:t.length}}async function Jr(n,a){const u=n.name.split(".").pop()||"bin",i=a||"temp",t=`${crypto.randomUUID()}.${u}`,f=`${i}/${t}`,{error:c}=await Pe.storage.from("event-attachments").upload(f,n,{cacheControl:"3600",upsert:!1});if(c)throw c;const{data:{publicUrl:b}}=Pe.storage.from("event-attachments").getPublicUrl(f);return{id:crypto.randomUUID(),name:n.name,url:b,type:n.type,size:n.size,uploadedAt:new Date().toISOString()}}async function ea(n){const{error:a}=await Pe.storage.from("event-attachments").remove([n]);if(a)throw a}function ur(n){const a=n.match(/event-attachments\/(.+)$/);return a?a[1]:""}async function dr(n){if(!n||n.length===0)return;const a=n.map(u=>ur(u.url)).filter(u=>u);if(a.length>0){const{error:u}=await Pe.storage.from("event-attachments").remove(a);if(u)throw u}}const _l=Object.freeze(Object.defineProperty({__proto__:null,createCalendarEvent:lr,createCalendarEvents:Di,deleteCalendarEvent:cr,deleteEventAttachment:ea,deleteEventAttachments:dr,deletePastCalendarEvents:Si,extractStoragePath:ur,getAllCalendarEvents:$t,getCalendarEvent:en,publishCalendarEvent:Gr,unpublishCalendarEvent:Xr,updateBishopricApproval:Zr,updateCalendarEvent:Tt,uploadEventAttachment:Jr},Symbol.toStringTag,{value:"Module"})),Ai={all:{label:"All",key:"",sort_index:0,color_number:0},public:{label:"Public",key:"PUB",sort_index:0,color_number:1},church:{label:"Church",key:"CHU",sort_index:0,color_number:2},stake:{label:"Stake",key:"STK",sort_index:0,color_number:3},stakeReliefSociety:{label:"Stake | Relief Society",key:"SRS",sort_index:.1,color_number:5},stakeEldersQuorum:{label:"Stake | Elders Quorum",key:"SEQ",sort_index:.2,color_number:6},stakeYouth:{label:"Stake | Youth",key:"SYO",sort_index:.25,color_number:7},stakeYoungWomen:{label:"Stake | Young Women",key:"SYW",sort_index:.3,color_number:8},stakeYoungMen:{label:"Stake | Young Men",key:"SYM",sort_index:.4,color_number:12},stakePrimary:{label:"Stake | Primary",key:"SPR",sort_index:.5,color_number:16},stakeSundaySchool:{label:"Stake | Sunday School",key:"SSS",sort_index:.6,color_number:21},stakeYsa:{label:"Stake | YSA",key:"SYA",sort_index:.7,color_number:22},ward:{label:"Ward",key:"WRD",sort_index:1,color_number:4},reliefSociety:{label:"Relief Society",key:"RES",sort_index:2,color_number:5},eldersQuorum:{label:"Elders Quorum",key:"ELQ",sort_index:3,color_number:6},youth:{label:"Youth",key:"YOU",sort_index:4,color_number:7},youngWomen:{label:"Young Women",key:"YOW",sort_index:4,color_number:8},youngWomenPearls:{label:"Young Women | Pearls",key:"YWP",sort_index:5,color_number:9},youngWomenRubies:{label:"Young Women | Rubies",key:"YWR",sort_index:6,color_number:10},youngWomenDiamonds:{label:"Young Women | Diamonds",key:"YWD",sort_index:7,color_number:11},aaronicPriesthood:{label:"Young Men",key:"YOM",sort_index:8,color_number:12},aaronicPriesthoodDeacons:{label:"Young Men | Deacons",key:"YMD",sort_index:9,color_number:13},aaronicPriesthoodTeachers:{label:"Young Men | Teachers",key:"YMT",sort_index:10,color_number:14},aaronicPriesthoodPriests:{label:"Young Men | Priests",key:"YMP",sort_index:11,color_number:15},primary:{label:"Primary",key:"PRI",sort_index:12,color_number:16},primaryNursery:{label:"Primary | Nursery",key:"PRN",sort_index:13,color_number:17},primarySunbeams:{label:"Primary | Sunbeams",key:"PRS",sort_index:14,color_number:18},primaryCTR:{label:"Primary | CTR",key:"PRC",sort_index:15,color_number:19},primaryValiant:{label:"Primary | Valiant",key:"PRV",sort_index:16,color_number:20},sundaySchool:{label:"Sunday School",key:"SUS",sort_index:17,color_number:21},ysa:{label:"YSA",key:"YSA",sort_index:18,color_number:22}},In=Object.values(Ai).sort((n,a)=>n.sort_index-a.sort_index),Ii=n=>n?In.find(a=>a.key===n):void 0,ki=["STK","SRS","SEQ","SYO","SYW","SYM","SPR","SSS","SYA"],Ti=["WRD","RES","ELQ","YOU","YOW","YWP","YWR","YWD","YOM","YMD","YMT","YMP","PRI","PRN","PRS","PRC","PRV","SUS","YSA"],Ci={STK:ki,WRD:Ti,YOU:["YOU","YOW","YWP","YWR","YWD","YOM","YMD","YMT","YMP"],YOM:["YOM","YMD","YMT","YMP"],YOW:["YOW","YWP","YWR","YWD"]},Mi=n=>{if(!n)return[];const a=n.trim();if(!a)return[];const u=Ci[a]??[a];return Array.from(new Set(u))},Fr=(n,a)=>a?n?Mi(a).includes(n):!1:!0,Nr={bishop:"Bishop",first_counselor:"1st Counselor",second_counselor:"2nd Counselor"},fr=n=>{let a=0;return n.bishop_approval==="YES"&&a++,n.first_counselor_approval==="YES"&&a++,n.second_counselor_approval==="YES"&&a++,a},Ri=n=>fr(n)>0,Ui=n=>n.is_published?"published":fr(n)>0?"approved":n.bishop_approval==="NO"||n.first_counselor_approval==="NO"||n.second_counselor_approval==="NO"?"needs_review":"pending";let mn=null;const Oi=n=>n.replace(/<[^>]*>/g,"").toLowerCase(),Pr=(n,a)=>{if(!a.trim())return!0;const u=a.toLowerCase(),i=(n.title||"").toLowerCase(),e=Oi(n.description||""),t=(n.location||"").toLowerCase();return i.includes(u)||e.includes(u)||t.includes(u)},bl=(n,a)=>{if(!a.trim()||!n)return Yr(n||"");const u=Yr(n),i=new RegExp(`(${ta(a)})`,"gi");return u.replace(i,"<mark>$1</mark>")},gl=(n,a)=>{if(!a.trim()||!n)return n||"";const u=new RegExp(`(${ta(a)})`,"gi");return n.replace(/(<[^>]*>)|([^<]+)/g,(i,e,t)=>e||(t?t.replace(u,"<mark>$1</mark>"):i))},Yr=n=>{const a=typeof document<"u"?document.createElement("div"):null;return a?(a.textContent=n,a.innerHTML):n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},ta=n=>n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Fi=Rn()??null,Ni=Wr(!1),$n=Fi?.stores.authenticated??Ni,Pi=()=>{const n=Wt(!1),a=Wt([]),u=Wt([]),i=Wt(""),e=Wt(""),t=Wt(!1),f=(E,U)=>!(!E.is_published||!U&&E.is_public===!1),c=Kt([u,$n],([E,U])=>{const g=new Date,k=Vt(fn(g,3),{weekStartsOn:1}),d=new Set(E.filter(m=>m?.meta_data?.organization?.length).filter(m=>f(m,U)).filter(m=>{if(m.event_type==="calendar_event"){const w=m.start_time?Zt(m.start_time):null;return w?wn(w,{start:g,end:k}):!1}return!0}).map(m=>m.meta_data?.organization).filter(m=>m));return Array.from(d).map(m=>In.find(w=>w.key===m)).filter(m=>m!==void 0)}),b=Kt([i],([E])=>In.find(U=>U.key===E)),y=Kt([u,i,e,$n],([E,U,g,k])=>E.filter(d=>d.event_type==="calendar_event").filter(d=>{const m=d?.meta_data;return U&&m?Fr(m?.organization,U):!0}).filter(d=>Pr(d,g)).filter(d=>f(d,k)).filter(d=>{const m=d.start_time?Zt(d.start_time):null,w=Va();return m?Za(m,w)||m.getTime()>=w.getTime():!1})),o=Kt([u,i,e,$n],([E,U,g,k])=>E.filter(d=>d.event_type==="announcement").filter(d=>{const m=d?.meta_data;return U&&m?Fr(m?.organization,U):!0}).filter(d=>Pr(d,g)).filter(d=>f(d,k))),l=Kt([y],([E])=>E.filter(U=>{const g=U.start_time?Zt(U.start_time):null;return g?wn(g,{start:rn(new Date,{weekStartsOn:1}),end:Vt(new Date,{weekStartsOn:1})}):!1})),s=()=>{const E=rn(new Date,{weekStartsOn:1}),U=Vt(new Date,{weekStartsOn:1});return`${Ne(E,"MMM d").toUpperCase()} – ${Ne(U,"MMM d").toUpperCase()}`},h=Kt([y],([E])=>{const U=fn(rn(new Date,{weekStartsOn:1}),1),g=Vt(U,{weekStartsOn:1});return E.filter(k=>{const d=k.start_time?Zt(k.start_time):null;return d?wn(d,{start:U,end:g}):!1})}),v=()=>{const E=fn(rn(new Date,{weekStartsOn:1}),1),U=Vt(E,{weekStartsOn:1});return`${Ne(E,"MMM d").toUpperCase()} – ${Ne(U,"MMM d").toUpperCase()}`},C=Kt([y],([E])=>{const U=fn(rn(new Date,{weekStartsOn:1}),2),g=Vt(U,{weekStartsOn:1});return E.filter(k=>{const d=k.start_time?Zt(k.start_time):null;return d?wn(d,{start:U,end:g}):!1})}),F=()=>{const E=fn(rn(new Date,{weekStartsOn:1}),2),U=Vt(E,{weekStartsOn:1});return`${Ne(E,"MMM d").toUpperCase()} – ${Ne(U,"MMM d").toUpperCase()}`},D=E=>{const U=[],g=new Date,k=new Date;k.setFullYear(g.getFullYear()+1);for(const d of E)if(d.recurrence_rule&&d.start_time&&d.end_time)try{const m=Le.fromString(d.recurrence_rule),w=d.recurrence_end_date?m.all():m.between(g,k,!0),A=new Date(d.start_time),R=new Date(d.end_time).getTime()-A.getTime(),x=Xt(A,ft),O=x.getHours(),_=x.getMinutes(),p=x.getSeconds(),z=x.getMilliseconds(),T=d.recurrence_exceptions||[],Y=d.recurrence_overrides||{};w.forEach((Q,$)=>{const q=Xt(Q,ft),P=new Date(q);P.setHours(O,_,p,z);const N=qt(P,ft),K=N,ne=new Date(N.getTime()+R),G=Ne(Q,"yyyy-MM-dd"),V=Y[G];if(T.includes(G)&&!V)return;const ae={...d,id:void 0,start_time:K.toISOString(),end_time:ne.toISOString(),meta_data:{...d.meta_data,recurring_instance:!0,recurring_parent_id:d.id,recurring_instance_index:$}};V&&(V.title!==void 0&&(ae.title=V.title),V.description!==void 0&&(ae.description=V.description),V.location!==void 0&&(ae.location=V.location),V.start_time!==void 0&&(ae.start_time=V.start_time),V.end_time!==void 0&&(ae.end_time=V.end_time),V.is_all_day!==void 0&&(ae.is_all_day=V.is_all_day),V.meta_data!==void 0&&(ae.meta_data={...ae.meta_data,...V.meta_data})),U.push(ae)})}catch(m){console.error("Failed to expand recurring event:",d.id,m),U.push(d)}else U.push(d);return U},H=E=>E.length?D(E).map(g=>({...g,start_time:g?.start_time?Dr(g.start_time):void 0,end_time:g.end_time?Dr(g.end_time):void 0})):[];return mn={stores:{ready:n,data:a,dbData:u,announcements:o,calendarEvents:y,calendarEventsThisWeek:l,calendarEventsNextWeek:h,calendarEventsNextNextWeek:C,currentOrganizations:c,organizationFilter:i,searchQuery:e,currentOrganizationFilter:b,weeksExpanded:t},actions:{reload:async()=>{n.set(!1);const E=await $t();u.set(H(E)),n.set(!0)},calendarEventsThisWeekLabel:s,calendarEventsNextWeekLabel:v,calendarEventsNextNextWeekLabel:F}},mn},Yi=()=>mn?.stores&&Object.keys(mn.stores).length>0?mn:Pi();var Li=re('<div class="invalid-feedback d-block"> </div>'),Bi=re("<option> </option>"),Hi=re('<div class="invalid-feedback d-block"> </div>'),zi=re('<div class="invalid-feedback d-block"> </div>'),Wi=re(`<div class="d-flex flex-column gap-4"><div class="d-flex flex-column gap-2"><div>Title*</div> <input type="text" placeholder="" required/> <!> <small class="fw-lighter fst-italic">Displayed publicly on the calendar and announcements page. e.g. Ward Conference, Ward BBQ
			Night</small></div> <div class="d-flex flex-column gap-2"><div>Type*</div> <select class="form-select" aria-label="Select Type"><option>Calendar Event</option><option>Announcement</option></select></div> <div class="d-flex flex-column gap-2"><div>Organization*</div> <select aria-label="Select Organization"></select> <!> <small class="fw-lighter fst-italic">Displayed as a public badge on the event listing.</small></div> <div class="d-flex flex-column gap-2"><div>Visibility</div> <div class="form-check form-switch"><input class="form-check-input" type="checkbox"/> <label class="form-check-label">Public (visible without login)</label></div> <small class="fw-lighter fst-italic">Turn off to restrict this event/announcement to logged-in users only.</small></div> <div class="d-flex flex-column gap-2"><div>Description</div> <textarea rows="4" placeholder="Event description (optional)"></textarea> <!> <small class="fw-lighter fst-italic">Shown publicly when viewers expand the event details. Supports basic HTML formatting.</small></div></div>`);function ji(n,a){Ct(a,!1);const u=X(),i=X(),e=X();let t=se(a,"title",12,""),f=se(a,"eventType",12,"calendar_event"),c=se(a,"organization",12,""),b=se(a,"isPublic",12,!0),y=se(a,"description",12,""),o=se(a,"disabled",8,!1),l=se(a,"name",8,"event"),s=se(a,"validationErrors",24,()=>({})),h=X(),v=X();function C(){r(h)?.focus()}function F(){r(v)?.focus()}Ce(()=>le(s()),()=>{M(u,!!s().title)}),Ce(()=>le(s()),()=>{M(i,!!s().description)}),Ce(()=>le(s()),()=>{M(e,!!s().organization)}),Jt();var D={focusTitle:C,focusDescription:F};Ot();var H=Wi(),I=B(H),E=j(B(I),2);ut(E);let U;Lt(E,K=>M(h,K),()=>r(h));var g=j(E,2);{var k=K=>{var ne=Li(),G=B(ne,!0);L(ne),de(()=>ge(G,(le(s()),ee(()=>s().title)))),te(K,ne)};he(g,K=>{le(s()),ee(()=>s().title)&&K(k)})}at(2),L(I);var d=j(I,2),m=j(B(d),2);de(()=>{f(),Kn(()=>{o()})});var w=B(m);w.value=w.__value="calendar_event";var A=j(w);A.value=A.__value="announcement",L(m),L(d);var S=j(d,2),R=j(B(S),2);de(()=>{c(),Kn(()=>{r(e),o()})});let x;bn(R,5,()=>In,ar,(K,ne)=>{var G=Bi(),V=B(G,!0);L(G);var ae={};de(()=>{ge(V,(r(ne),ee(()=>r(ne).label))),ae!==(ae=(r(ne),ee(()=>r(ne).key)))&&(G.value=(G.__value=(r(ne),ee(()=>r(ne).key)))??"")}),te(K,G)}),L(R);var O=j(R,2);{var _=K=>{var ne=Hi(),G=B(ne,!0);L(ne),de(()=>ge(G,(le(s()),ee(()=>s().organization)))),te(K,ne)};he(O,K=>{le(s()),ee(()=>s().organization)&&K(_)})}at(2),L(S);var p=j(S,2),z=j(B(p),2),T=B(z);ut(T);var Y=j(T,2);L(z),at(2),L(p);var Q=j(p,2),$=j(B(Q),2);zr($);let q;Lt($,K=>M(v,K),()=>r(v));var P=j($,2);{var N=K=>{var ne=zi(),G=B(ne,!0);L(ne),de(()=>ge(G,(le(s()),ee(()=>s().description)))),te(K,ne)};he(P,K=>{le(s()),ee(()=>s().description)&&K(N)})}return at(2),L(Q),L(H),de(()=>{Oe(E,"name",`${l()??""}-title`),U=Qe(E,1,"form-control",null,U,{"is-invalid":r(u)}),E.disabled=o(),m.disabled=o(),x=Qe(R,1,"form-select",null,x,{"is-invalid":r(e)}),R.disabled=o(),Oe(T,"id",`${l()??""}-is-public`),T.disabled=o(),Oe(Y,"for",`${l()??""}-is-public`),Oe($,"name",`${l()??""}-description`),q=Qe($,1,"form-control",null,q,{"is-invalid":r(i)}),$.disabled=o()}),Se("focus",E,()=>r(h).select()),kt(E,t),Vn(m,f),Vn(R,c),ir(T,b),Se("focus",$,()=>r(v).select()),kt($,y),te(n,H),sn(a,"focusTitle",C),sn(a,"focusDescription",F),Mt(D)}var qi=re('<div class="invalid-feedback d-block"> </div>'),$i=re('<div class="invalid-feedback d-block"> </div>'),Qi=re('<div class="invalid-feedback d-block"> </div>'),Ki=re('<div class="d-flex flex-column gap-4 ps-4"><div class="d-flex flex-column gap-2"><div>Start time*</div> <input type="time" required/> <!></div> <div class="d-flex flex-column gap-2"><div>End time*</div> <input type="time" required/> <!></div></div>'),Vi=re('<div class="d-flex flex-column gap-4"><div class="d-flex flex-column gap-2"><div>Date*</div> <input type="date" required/> <!></div> <div><div class="form-check d-flex align-items-center gap-2"><input class="form-check-input" type="checkbox"/> <label class="form-check-label">All Day Event</label></div></div> <!></div>');function Zi(n,a){Ct(a,!1);const u=X(),i=X(),e=X();let t=se(a,"dateInput",12,""),f=se(a,"startTimeInput",12,""),c=se(a,"endTimeInput",12,""),b=se(a,"isAllDay",12,!1),y=se(a,"disabled",8,!1),o=se(a,"name",8,"event"),l=se(a,"validationErrors",24,()=>({})),s=X(),h=X(),v=X();const C=new Date().toISOString().split("T")[0];function F(){r(s)?.focus()}function D(){r(h)?.focus()}function H(){r(v)?.focus()}Ce(()=>le(l()),()=>{M(u,!!l().dateInput)}),Ce(()=>le(l()),()=>{M(i,!!l().startTimeInput)}),Ce(()=>le(l()),()=>{M(e,!!l().endTimeInput)}),Jt();var I={focusDate:F,focusStartTime:D,focusEndTime:H};Ot();var E=Vi(),U=B(E),g=j(B(U),2);ut(g);let k;Lt(g,_=>M(s,_),()=>r(s));var d=j(g,2);{var m=_=>{var p=qi(),z=B(p,!0);L(p),de(()=>ge(z,(le(l()),ee(()=>l().dateInput)))),te(_,p)};he(d,_=>{le(l()),ee(()=>l().dateInput)&&_(m)})}L(U);var w=j(U,2),A=B(w),S=B(A);ut(S);var R=j(S,2);L(A),L(w);var x=j(w,2);{var O=_=>{var p=Ki(),z=B(p),T=j(B(z),2);ut(T),Oe(T,"step",900);let Y;Lt(T,G=>M(h,G),()=>r(h));var Q=j(T,2);{var $=G=>{var V=$i(),ae=B(V,!0);L(V),de(()=>ge(ae,(le(l()),ee(()=>l().startTimeInput)))),te(G,V)};he(Q,G=>{le(l()),ee(()=>l().startTimeInput)&&G($)})}L(z);var q=j(z,2),P=j(B(q),2);ut(P),Oe(P,"step",900);let N;Lt(P,G=>M(v,G),()=>r(v));var K=j(P,2);{var ne=G=>{var V=Qi(),ae=B(V,!0);L(V),de(()=>ge(ae,(le(l()),ee(()=>l().endTimeInput)))),te(G,V)};he(K,G=>{le(l()),ee(()=>l().endTimeInput)&&G(ne)})}L(q),L(p),de(()=>{Oe(T,"name",`${o()??""}-start-time`),Y=Qe(T,1,"form-control",null,Y,{"is-invalid":r(i)}),T.disabled=y(),Oe(P,"name",`${o()??""}-end-time`),N=Qe(P,1,"form-control",null,N,{"is-invalid":r(e)}),P.disabled=y()}),Se("focus",T,()=>r(h).select()),kt(T,f),Se("focus",P,()=>r(v).select()),kt(P,c),te(_,p)};he(x,_=>{b()||_(O)})}return L(E),de(()=>{Oe(g,"name",`${o()??""}-date`),k=Qe(g,1,"form-control",null,k,{"is-invalid":r(u)}),g.disabled=y(),Oe(g,"min",C),Oe(S,"id",`${o()??""}-all-day-check`),S.disabled=y(),Oe(R,"for",`${o()??""}-all-day-check`)}),Se("focus",g,()=>r(s).select()),kt(g,t),ir(S,b),te(n,E),sn(a,"focusDate",F),sn(a,"focusStartTime",D),sn(a,"focusEndTime",H),Mt(I)}var Gi=re('<div class="form-check"><input class="form-check-input" type="checkbox"/> <label class="form-check-label"> </label></div>'),Xi=re('<div class="invalid-feedback d-block"> </div>'),Ji=re('<div class="d-flex flex-column gap-2"><div class="form-label fw-semibold">Repeat on these days<span class="text-danger">*</span></div> <div class="d-flex flex-wrap gap-2"></div> <!> <small class="text-muted">Select at least one day when this event repeats</small></div>'),es=re('<div class="d-flex flex-column gap-2"><div class="form-label fw-semibold" role="group" aria-label="Monthly recurrence">Monthly recurrence</div> <div class="d-flex flex-column gap-2"><div class="form-check"><input class="form-check-input" type="radio"/> <label class="form-check-label"> </label></div> <div class="form-check"><input class="form-check-input" type="radio"/> <label class="form-check-label"> </label></div></div></div>'),ts=re('<div class="invalid-feedback d-block"> </div>'),ns=re('<div class="d-flex flex-column gap-3 ps-4"><div class="d-flex flex-column gap-2"><div class="form-label fw-semibold" role="group" aria-label="Repeat pattern">Repeat pattern</div> <div class="row g-2 align-items-center"><div class="col-auto"><span class="text-muted">Every</span></div> <div class="col-auto"><input type="number" class="form-control" min="1" max="99" style="width: 80px;"/></div> <div class="col-auto"><select class="form-select"><option> </option><option> </option><option> </option><option> </option></select></div></div></div> <!> <!> <div class="d-flex flex-column gap-2"><label class="form-label fw-semibold">Repeat until<span class="text-danger">*</span></label> <input type="date" required/> <!> <small class="text-muted">The last date this event will occur</small></div></div>'),rs=re('<div class="d-flex flex-column gap-3"><div class="form-check"><input class="form-check-input" type="checkbox"/> <label class="form-check-label fw-semibold">Make this a recurring event</label></div> <!></div>');function as(n,a){Ct(a,!1);const u=[],i=[];let e=se(a,"isRecurring",12,!1),t=se(a,"recurrenceFrequency",12,"weekly"),f=se(a,"recurrenceInterval",12,1),c=se(a,"recurringDays",28,()=>[]),b=se(a,"recurrenceEndDate",12,""),y=se(a,"monthlyType",12,"date"),o=se(a,"dateInput",8,""),l=se(a,"disabled",8,!1),s=se(a,"name",8,"event"),h=se(a,"validationErrors",24,()=>({}));const v=[{label:"Sun",value:0},{label:"Mon",value:1},{label:"Tue",value:2},{label:"Wed",value:3},{label:"Thu",value:4},{label:"Fri",value:5},{label:"Sat",value:6}];function C(k){if(!k)return"Same weekday of the month";try{const d=new Date(k),m=Ne(d,"EEEE"),w=Math.ceil(d.getDate()/7);return`${["","1st","2nd","3rd","4th","5th"][w]} ${m} of the month`}catch{return"Same weekday of the month"}}function F(k){if(!k)return 1;try{return k.split("-").map(Number)[2]}catch{return 1}}Ot();var D=rs(),H=B(D),I=B(H);ut(I);var E=j(I,2);L(H);var U=j(H,2);{var g=k=>{var d=ns(),m=B(d),w=j(B(m),2),A=j(B(w),2),S=B(A);ut(S),L(A);var R=j(A,2),x=B(R);de(()=>{t(),Kn(()=>{l(),f()})});var O=B(x),_=B(O,!0);L(O),O.value=O.__value="daily";var p=j(O),z=B(p,!0);L(p),p.value=p.__value="weekly";var T=j(p),Y=B(T,!0);L(T),T.value=T.__value="monthly";var Q=j(T),$=B(Q,!0);L(Q),Q.value=Q.__value="yearly",L(x),L(R),L(w),L(m);var q=j(m,2);{var P=Ie=>{var Ae=Ji(),ve=j(B(Ae),2);bn(ve,5,()=>v,ar,(ie,fe)=>{var Ee=Gi(),me=B(Ee);ut(me);var ue,_e=j(me,2),pe=B(_e,!0);L(_e),L(Ee),de(()=>{Oe(me,"id",`${s()??""}-day-${r(fe),ee(()=>r(fe).value)??""}`),me.disabled=l(),ue!==(ue=(r(fe),ee(()=>r(fe).value)))&&(me.value=(me.__value=(r(fe),ee(()=>r(fe).value)))??""),Oe(_e,"for",`${s()??""}-day-${r(fe),ee(()=>r(fe).value)??""}`),ge(pe,(r(fe),ee(()=>r(fe).label)))}),Hn(u,[],me,()=>(r(fe),ee(()=>r(fe).value),c()),c),te(ie,Ee)}),L(ve);var Me=j(ve,2);{var ce=ie=>{var fe=Xi(),Ee=B(fe,!0);L(fe),de(()=>ge(Ee,(le(h()),ee(()=>h().recurringDays)))),te(ie,fe)};he(Me,ie=>{le(h()),ee(()=>h().recurringDays)&&ie(ce)})}at(2),L(Ae),te(Ie,Ae)};he(q,Ie=>{t()==="weekly"&&Ie(P)})}var N=j(q,2);{var K=Ie=>{var Ae=es(),ve=j(B(Ae),2),Me=B(ve),ce=B(Me);ut(ce),ce.value=ce.__value="date";var ie=j(ce,2),fe=B(ie);L(ie),L(Me);var Ee=j(Me,2),me=B(Ee);ut(me),me.value=me.__value="weekday";var ue=j(me,2),_e=B(ue);L(ue),L(Ee),L(ve),L(Ae),de((pe,Re)=>{Oe(ce,"id",`${s()??""}-monthly-date`),ce.disabled=l(),Oe(ie,"for",`${s()??""}-monthly-date`),ge(fe,`On day ${pe??""} of the month`),Oe(me,"id",`${s()??""}-monthly-weekday`),me.disabled=l(),Oe(ue,"for",`${s()??""}-monthly-weekday`),ge(_e,`On the ${Re??""}`)},[()=>(le(o()),ee(()=>F(o()))),()=>(le(o()),ee(()=>C(o())))]),Hn(i,[],ce,y,y),Hn(i,[],me,y,y),te(Ie,Ae)};he(N,Ie=>{t()==="monthly"&&Ie(K)})}var ne=j(N,2),G=B(ne),V=j(G,2);ut(V);let ae;var xe=j(V,2);{var ye=Ie=>{var Ae=ts(),ve=B(Ae,!0);L(Ae),de(()=>ge(ve,(le(h()),ee(()=>h().recurrenceEndDate)))),te(Ie,Ae)};he(xe,Ie=>{le(h()),ee(()=>h().recurrenceEndDate)&&Ie(ye)})}at(2),L(ne),L(d),de(()=>{S.disabled=l(),x.disabled=l(),ge(_,f()===1?"day":"days"),ge(z,f()===1?"week":"weeks"),ge(Y,f()===1?"month":"months"),ge($,f()===1?"year":"years"),Oe(G,"for",`${s()??""}-recurrence-end-date`),ae=Qe(V,1,"form-control",null,ae,{"is-invalid":!!h().recurrenceEndDate}),Oe(V,"id",`${s()??""}-recurrence-end-date`),V.disabled=l()}),kt(S,f),Vn(x,t),kt(V,b),te(k,d)};he(U,k=>{e()&&k(g)})}L(D),de(()=>{Oe(I,"id",`${s()??""}-is-recurring`),I.disabled=l(),Oe(E,"for",`${s()??""}-is-recurring`)}),ir(I,e),te(n,D),Mt()}var is=re('<div class="d-flex flex-column gap-2"><div>Location</div> <input type="text" class="form-control" placeholder="Event location (optional)"/> <small class="fw-lighter fst-italic">Displayed publicly on the event listing. e.g. Cultural Hall, Stake Center</small></div>');function ss(n,a){Ct(a,!1);let u=se(a,"value",12,""),i=se(a,"disabled",8,!1),e=se(a,"name",8,"location"),t=X();function f(){r(t)?.focus()}var c={focus:f},b=is(),y=j(B(b),2);return ut(y),Lt(y,o=>M(t,o),()=>r(t)),at(2),L(b),de(()=>{Oe(y,"name",e()),y.disabled=i()}),Se("focus",y,()=>r(t).select()),kt(y,u),te(n,b),sn(a,"focus",f),Mt(c)}var os=re('<input type="text" class="form-control form-control-sm"/> <small class="text-muted"> </small>',1),ls=re('<div class="fw-semibold"> </div> <small class="text-muted"> </small>',1),cs=re('<button type="button" class="btn btn-sm btn-success" title="Save"><i class="bi bi-check-lg"></i></button> <button type="button" class="btn btn-sm btn-secondary" title="Cancel"><i class="bi bi-x-lg"></i></button>',1),us=re('<button type="button" class="btn btn-sm btn-outline-primary" title="Edit name"><i class="bi bi-pencil"></i></button> <button type="button" class="btn btn-sm btn-outline-danger" title="Delete"><i class="bi bi-trash"></i></button>',1),ds=re('<div class="d-flex align-items-center gap-2 p-2 border rounded"><div class="flex-grow-1"><!></div> <!></div>'),fs=re('<div class="d-flex flex-column gap-2 mb-2"></div>'),vs=re('<div class="d-flex flex-column gap-2"><div>Attachments</div> <!> <div class="d-flex flex-column gap-2"><div class="d-flex gap-2 align-items-center"><input type="file" class="form-control" accept="image/*,application/pdf"/> <!></div> <small class="fw-lighter fst-italic">Publicly visible in the event details. Max 5MB per file. Supports: images, PDFs</small></div></div>');function ms(n,a){Ct(a,!1);let u=se(a,"attachments",24,()=>[]),i=se(a,"disabled",8,!1),e=se(a,"uploadingFile",8,!1);const t=ja();let f=X(),c=X(null),b=X("");const y=k=>{if(k===0)return"0 Bytes";const d=1024,m=["Bytes","KB","MB"],w=Math.floor(Math.log(k)/Math.log(d));return Math.round(k/Math.pow(d,w)*100)/100+" "+m[w]},o=k=>{const d=k.target;d.files&&d.files[0]&&(t("upload",d.files[0]),d.value="")},l=k=>{M(c,k.id),M(b,k.name)},s=k=>{r(b).trim()&&r(b)!==k.name&&t("edit",{attachment:k,newName:r(b).trim()}),M(c,null),M(b,"")},h=()=>{M(c,null),M(b,"")},v=k=>{t("remove",k)};Ot();var C=vs(),F=j(B(C),2);{var D=k=>{var d=fs();bn(d,5,u,m=>m.id,(m,w)=>{var A=ds(),S=B(A),R=B(S);{var x=T=>{var Y=os(),Q=bt(Y);ut(Q);var $=j(Q,2),q=B($,!0);L($),de(P=>{Q.disabled=i(),ge(q,P)},[()=>(r(w),ee(()=>y(r(w).size)))]),kt(Q,()=>r(b),P=>M(b,P)),Se("keydown",Q,P=>{P.key==="Enter"&&s(r(w)),P.key==="Escape"&&h()}),te(T,Y)},O=T=>{var Y=ls(),Q=bt(Y),$=B(Q,!0);L(Q);var q=j(Q,2),P=B(q,!0);L(q),de(N=>{ge($,(r(w),ee(()=>r(w).name))),ge(P,N)},[()=>(r(w),ee(()=>y(r(w).size)))]),te(T,Y)};he(R,T=>{r(c),r(w),ee(()=>r(c)===r(w).id)?T(x):T(O,!1)})}L(S);var _=j(S,2);{var p=T=>{var Y=cs(),Q=bt(Y),$=j(Q,2);de(()=>{Q.disabled=i(),$.disabled=i()}),Se("click",Q,()=>s(r(w))),Se("click",$,h),te(T,Y)},z=T=>{var Y=us(),Q=bt(Y),$=j(Q,2);de(()=>{Q.disabled=i(),$.disabled=i()}),Se("click",Q,()=>l(r(w))),Se("click",$,()=>v(r(w))),te(T,Y)};he(_,T=>{r(c),r(w),ee(()=>r(c)===r(w).id)?T(p):T(z,!1)})}L(A),te(m,A)}),L(d),te(k,d)};he(F,k=>{le(u()),ee(()=>u().length>0)&&k(D)})}var H=j(F,2),I=B(H),E=B(I);Lt(E,k=>M(f,k),()=>r(f));var U=j(E,2);{var g=k=>{jt(k,{size:"sm"})};he(U,k=>{e()&&k(g)})}L(I),at(2),L(H),L(C),de(()=>E.disabled=i()||e()),Se("change",E,o),te(n,C),Mt()}var hs=re('<div class="modal svelte-xtxevo" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Edit Recurring Event</h5> <button type="button" class="btn-close" aria-label="Close"></button></div> <div class="modal-body"><p class="mb-3"><strong> </strong> is a recurring event.</p> <p class="mb-3">How would you like to edit it?</p> <div class="d-flex flex-column gap-2"><button type="button" class="btn btn-outline-primary text-start p-3"><div class="fw-bold">This occurrence only</div> <small class="text-muted"> </small></button> <button type="button" class="btn btn-outline-primary text-start p-3"><div class="fw-bold">This and future occurrences</div> <small class="text-muted"> </small></button> <button type="button" class="btn btn-outline-primary text-start p-3"><div class="fw-bold">All occurrences</div> <small class="text-muted">The entire series</small></button></div></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Cancel</button></div></div></div></div>');function ps(n,a){Ct(a,!1);const u=X();let i=se(a,"eventTitle",8),e=se(a,"occurrenceDate",8),t=se(a,"callback",8);function f(A){t()(A)}function c(){t()(null)}Ce(()=>(le(e()),Ne),()=>{M(u,(()=>{try{const[A,S,R]=e().split("-").map(Number),x=new Date(A,S-1,R);return Ne(x,"EEEE, MMMM d, yyyy")}catch{return e()}})())}),Jt(),Ot();var b=hs(),y=B(b),o=B(y),l=B(o),s=j(B(l),2);L(l);var h=j(l,2),v=B(h),C=B(v),F=B(C);L(C),at(),L(v);var D=j(v,4),H=B(D),I=j(B(H),2),E=B(I,!0);L(I),L(H);var U=j(H,2),g=j(B(U),2),k=B(g);L(g),L(U);var d=j(U,2);L(D),L(h);var m=j(h,2),w=B(m);L(m),L(o),L(y),L(b),de(()=>{ge(F,`"${i()??""}"`),ge(E,r(u)),ge(k,`From ${r(u)??""} onwards`)}),Se("click",s,c),Se("click",H,()=>f("single")),Se("click",U,()=>f("future")),Se("click",d,()=>f("all")),Se("click",w,c),te(n,b),Mt()}var _s=re('<div class="modal svelte-gu1ski" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-danger text-white"><h5 class="modal-title">Delete Recurring Event</h5> <button type="button" class="btn-close btn-close-white" aria-label="Close"></button></div> <div class="modal-body"><p class="mb-3"><strong> </strong> is a recurring event.</p> <p class="mb-3">What would you like to delete?</p> <div class="d-flex flex-column gap-2"><button type="button" class="btn btn-outline-danger text-start p-3"><div class="fw-bold">This occurrence only</div> <small class="text-muted"> </small></button> <button type="button" class="btn btn-outline-danger text-start p-3"><div class="fw-bold">This and future occurrences</div> <small class="text-muted"> </small></button> <button type="button" class="btn btn-outline-danger text-start p-3"><div class="fw-bold">All occurrences</div> <small class="text-muted">Delete the entire series</small></button></div></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Cancel</button></div></div></div></div>');function bs(n,a){Ct(a,!1);const u=X();let i=se(a,"eventTitle",8),e=se(a,"occurrenceDate",8),t=se(a,"callback",8);function f(A){t()(A)}function c(){t()(null)}Ce(()=>(le(e()),Ne),()=>{M(u,(()=>{try{const[A,S,R]=e().split("-").map(Number),x=new Date(A,S-1,R);return Ne(x,"EEEE, MMMM d, yyyy")}catch{return e()}})())}),Jt(),Ot();var b=_s(),y=B(b),o=B(y),l=B(o),s=j(B(l),2);L(l);var h=j(l,2),v=B(h),C=B(v),F=B(C);L(C),at(),L(v);var D=j(v,4),H=B(D),I=j(B(H),2),E=B(I,!0);L(I),L(H);var U=j(H,2),g=j(B(U),2),k=B(g);L(g),L(U);var d=j(U,2);L(D),L(h);var m=j(h,2),w=B(m);L(m),L(o),L(y),L(b),de(()=>{ge(F,`"${i()??""}"`),ge(E,r(u)),ge(k,`From ${r(u)??""} onwards`)}),Se("click",s,c),Se("click",H,()=>f("single")),Se("click",U,()=>f("future")),Se("click",d,()=>f("all")),Se("click",w,c),te(n,b),Mt()}var gs=re('<div class="modal fade" tabindex="-1" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title"> </h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div> <div class="modal-body"><p> </p> <div class="mb-3"><label for="cloneDate" class="form-label">Event Date</label> <input type="date" class="form-control" id="cloneDate"/></div></div> <div class="modal-footer"><button type="button"> </button> <button type="button"> </button></div></div></div></div>');function ys(n,a){Ct(a,!1);let u=se(a,"title",8,"Clone Event"),i=se(a,"message",8,"Select a date for the cloned event:"),e=se(a,"confirmButtonLabel",8,"Clone"),t=se(a,"confirmButtonCSS",8,"btn-primary"),f=se(a,"rejectButtonLabel",8,"Cancel"),c=se(a,"rejectButtonCSS",8,"btn-secondary"),b=se(a,"defaultDate",8,void 0),y=se(a,"callback",8,()=>{}),o=X(),l=X(b()||Ne(new Date,"yyyy-MM-dd")),s=!1,h;rr(()=>{const _=window.bootstrap.Modal;new _(r(o)).show(),r(o).addEventListener("hidden.bs.modal",()=>{s?y()(!0,h):y()(!1)})});function v(){s=!0,h=r(l),window.bootstrap.Modal.getInstance(r(o)).hide()}function C(){s=!1,window.bootstrap.Modal.getInstance(r(o)).hide()}Ot();var F=gs(),D=B(F),H=B(D),I=B(H),E=B(I),U=B(E,!0);L(E),at(2),L(I);var g=j(I,2),k=B(g),d=B(k,!0);L(k);var m=j(k,2),w=j(B(m),2);ut(w),L(m),L(g);var A=j(g,2),S=B(A),R=B(S,!0);L(S);var x=j(S,2),O=B(x,!0);L(x),L(A),L(H),L(D),L(F),Lt(F,_=>M(o,_),()=>r(o)),de(()=>{ge(U,u()),ge(d,i()),Qe(S,1,`btn ${c()??""}`),ge(R,f()),Qe(x,1,`btn ${t()??""}`),ge(O,e())}),kt(w,()=>r(l),_=>M(l,_)),Se("click",S,C),Se("click",x,v),te(n,F),Mt()}let xn;function ws(n){if(typeof document>"u")return;const a=document.createElement("div");document.body.appendChild(a);const u={title:"Clone Event",message:"Select a date for the cloned event:",confirmButtonLabel:"Clone",confirmButtonCSS:"btn-primary",rejectButtonLabel:"Cancel",rejectButtonCSS:"btn-secondary",callback:()=>{console.log("callback")}};n.title&&(u.title=n.title),n.message&&(u.message=n.message),n.confirmButtonLabel&&(u.confirmButtonLabel=n.confirmButtonLabel),n.confirmButtonCSS&&(u.confirmButtonCSS=n.confirmButtonCSS),n.rejectButtonLabel&&(u.rejectButtonLabel=n.rejectButtonLabel),n.rejectButtonCSS&&(u.rejectButtonCSS=n.rejectButtonCSS),n.defaultDate&&(u.defaultDate=n.defaultDate),u.callback=(i,e)=>{console.log("Clone confirm result:",i,e),xn&&($a(xn),xn=void 0),a.remove(),n.callback&&typeof n.callback=="function"&&n.callback(i,e)},xn=qa(ys,{target:a,props:u})}const xs=Xa().shape({title:Rt().required("Title is required").min(3,"Title must be at least 3 characters").max(255,"Title cannot exceed 255 characters"),event_type:Rt().oneOf(["calendar_event","announcement"],"Invalid event type").required("Event type is required"),organization:Rt().required("Organization is required"),description:Rt().nullable().max(1e4,"Description is too long"),location:Rt().nullable().max(255,"Location cannot exceed 255 characters"),dateInput:Rt().when("event_type",{is:"calendar_event",then:n=>n.required("Date is required"),otherwise:n=>n.nullable()}),startTimeInput:Rt().when(["event_type","is_all_day"],{is:(n,a)=>n==="calendar_event"&&!a,then:n=>n.required("Start time is required"),otherwise:n=>n.nullable()}),endTimeInput:Rt().when(["event_type","is_all_day"],{is:(n,a)=>n==="calendar_event"&&!a,then:n=>n.required("End time is required"),otherwise:n=>n.nullable()}),isRecurring:Sr(),recurrenceFrequency:Rt().oneOf(["daily","weekly","monthly","yearly"]).nullable(),recurringDays:Ja().of(ei().min(0).max(6)).when(["isRecurring","recurrenceFrequency"],{is:(n,a)=>n&&a==="weekly",then:n=>n.min(1,"Select at least one day for weekly recurring events").required(),otherwise:n=>n.nullable()}),hasEndDate:Sr(),recurrenceEndDate:Rt().when(["isRecurring","hasEndDate"],{is:(n,a)=>n&&a,then:n=>n.required("End date is required").test("is-future","End date must be in the future",function(a){if(!a)return!1;const u=new Date(a),i=new Date;return i.setHours(0,0,0,0),u>=i}),otherwise:n=>n.nullable()})});function Ds(){const n=Wt({});async function a(e){try{return await xs.validate(e,{abortEarly:!1}),n.set({}),!0}catch(t){if(t instanceof ti){const f={};return t.inner.forEach(c=>{c.path&&(f[c.path]=c.message)}),n.set(f),!1}return!1}}function u(){n.set({})}function i(){return Object.values(pn(n)).filter(t=>t.length>0)}return{validationErrors:n,validate:a,clearErrors:u,getErrorMessages:i}}function vr(n){const{frequency:a,interval:u,recurringDays:i,recurrenceEndDate:e,hasEndDate:t,monthlyType:f,startTime:c}=n,b={0:Le.SU,1:Le.MO,2:Le.TU,3:Le.WE,4:Le.TH,5:Le.FR,6:Le.SA},y={daily:Le.DAILY,weekly:Le.WEEKLY,monthly:Le.MONTHLY,yearly:Le.YEARLY},o=new Date(c),l=Xt(o,ft),s=new Date(l);s.setHours(12,0,0,0);const h=qt(s,ft),v={freq:y[a],interval:u,dtstart:h};if(t&&e){const F=new Date(`${e}T23:59:59.999`),D=qt(F,ft);v.until=D}if(a==="weekly"&&i.length>0)v.byweekday=i.map(F=>b[F]);else if(a==="monthly")if(f==="date")v.bymonthday=[s.getDate()];else{const F=Math.ceil(s.getDate()/7),D=s.getDay(),H=[Le.SU,Le.MO,Le.TU,Le.WE,Le.TH,Le.FR,Le.SA];v.byweekday=[H[D].nth(F)]}else a==="yearly"&&(v.bymonth=[s.getMonth()+1],v.bymonthday=[s.getDate()]);return{recurrence_rule:new Le(v).toString(),recurrence_end_date:t&&e?v.until.toISOString():void 0}}function na(n,a){try{const i=Le.fromString(n).origOptions,e={6:0,0:1,1:2,2:3,3:4,4:5,5:6},t={[Le.DAILY]:"daily",[Le.WEEKLY]:"weekly",[Le.MONTHLY]:"monthly",[Le.YEARLY]:"yearly"},f=(i.freq!==void 0?t[i.freq]:null)||"weekly",c=i.interval||1;let b=[],y="date";i.byweekday&&f==="weekly"&&(b=(Array.isArray(i.byweekday)?i.byweekday:[i.byweekday]).map(s=>{const h=typeof s=="number"?s:s.weekday;return e[h]})),f==="monthly"&&(i.bymonthday&&Array.isArray(i.bymonthday)&&i.bymonthday.length>0?y="date":i.byweekday&&(y="weekday"));let o="",l=!1;if(a){l=!0;const s=Xt(new Date(a),ft);o=Ne(s,"yyyy-MM-dd")}else if(i.until){l=!0;const s=Xt(i.until,ft);o=Ne(s,"yyyy-MM-dd")}return{frequency:f,interval:c,recurringDays:b,recurrenceEndDate:o,hasEndDate:l,monthlyType:y}}catch(u){return console.error("Failed to parse recurrence rule:",u),null}}function ra(){return{recurrence_rule:void 0,recurrence_end_date:void 0}}function aa(){return{generateRecurrenceRule:vr,parseRecurrenceRule:na,clearRecurrence:ra}}const tr=Object.freeze(Object.defineProperty({__proto__:null,clearRecurrence:ra,generateRecurrenceRule:vr,parseRecurrenceRule:na,useRecurrenceLogic:aa},Symbol.toStringTag,{value:"Module"}));function Es(n,a){return a.forEach(function(u){u&&typeof u!="string"&&!Array.isArray(u)&&Object.keys(u).forEach(function(i){if(i!=="default"&&!(i in n)){var e=Object.getOwnPropertyDescriptor(u,i);Object.defineProperty(n,i,e.get?e:{enumerable:!0,get:function(){return u[i]}})}})}),Object.freeze(n)}function ia(n,a){return new Promise(function(u,i){let e;return Ss(n).then(function(t){try{return e=t,u(new Blob([a.slice(0,2),e,a.slice(2)],{type:"image/jpeg"}))}catch(f){return i(f)}},i)})}const Ss=n=>new Promise((a,u)=>{const i=new FileReader;i.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let f=0;if(t.getUint16(f)!==65496)return u("not a valid JPEG");for(f+=2;;){const c=t.getUint16(f);if(c===65498)break;const b=t.getUint16(f+2);if(c===65505&&t.getUint32(f+4)===1165519206){const y=f+10;let o;switch(t.getUint16(y)){case 18761:o=!0;break;case 19789:o=!1;break;default:return u("TIFF header contains invalid endian")}if(t.getUint16(y+2,o)!==42)return u("TIFF header contains invalid version");const l=t.getUint32(y+4,o),s=y+l+2+12*t.getUint16(y+l,o);for(let h=y+l+2;h<s;h+=12)if(t.getUint16(h,o)==274){if(t.getUint16(h+2,o)!==3)return u("Orientation data type is invalid");if(t.getUint32(h+4,o)!==1)return u("Orientation data count is invalid");t.setUint16(h+8,1,o);break}return a(e.slice(f,f+2+b))}f+=2+b}return a(new Blob)}),i.readAsArrayBuffer(n)});var kn={},As={get exports(){return kn},set exports(n){kn=n}};(function(n){var a,u,i={};As.exports=i,i.parse=function(e,t){for(var f=i.bin.readUshort,c=i.bin.readUint,b=0,y={},o=new Uint8Array(e),l=o.length-4;c(o,l)!=101010256;)l--;b=l,b+=4;var s=f(o,b+=4);f(o,b+=2);var h=c(o,b+=2),v=c(o,b+=4);b+=4,b=v;for(var C=0;C<s;C++){c(o,b),b+=4,b+=4,b+=4,c(o,b+=4),h=c(o,b+=4);var F=c(o,b+=4),D=f(o,b+=4),H=f(o,b+2),I=f(o,b+4);b+=6;var E=c(o,b+=8);b+=4,b+=D+H+I,i._readLocal(o,E,y,h,F,t)}return y},i._readLocal=function(e,t,f,c,b,y){var o=i.bin.readUshort,l=i.bin.readUint;l(e,t),o(e,t+=4),o(e,t+=2);var s=o(e,t+=2);l(e,t+=2),l(e,t+=4),t+=4;var h=o(e,t+=8),v=o(e,t+=2);t+=2;var C=i.bin.readUTF8(e,t,h);if(t+=h,t+=v,y)f[C]={size:b,csize:c};else{var F=new Uint8Array(e.buffer,t);if(s==0)f[C]=new Uint8Array(F.buffer.slice(t,t+c));else{if(s!=8)throw"unknown compression method: "+s;var D=new Uint8Array(b);i.inflateRaw(F,D),f[C]=D}}},i.inflateRaw=function(e,t){return i.F.inflate(e,t)},i.inflate=function(e,t){return e[0],e[1],i.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},i.deflate=function(e,t){t==null&&(t={level:6});var f=0,c=new Uint8Array(50+Math.floor(1.1*e.length));c[f]=120,c[f+1]=156,f+=2,f=i.F.deflateRaw(e,c,f,t.level);var b=i.adler(e,0,e.length);return c[f+0]=b>>>24&255,c[f+1]=b>>>16&255,c[f+2]=b>>>8&255,c[f+3]=b>>>0&255,new Uint8Array(c.buffer,0,f+4)},i.deflateRaw=function(e,t){t==null&&(t={level:6});var f=new Uint8Array(50+Math.floor(1.1*e.length)),c=i.F.deflateRaw(e,f,c,t.level);return new Uint8Array(f.buffer,0,c)},i.encode=function(e,t){t==null&&(t=!1);var f=0,c=i.bin.writeUint,b=i.bin.writeUshort,y={};for(var o in e){var l=!i._noNeed(o)&&!t,s=e[o],h=i.crc.crc(s,0,s.length);y[o]={cpr:l,usize:s.length,crc:h,file:l?i.deflateRaw(s):s}}for(var o in y)f+=y[o].file.length+30+46+2*i.bin.sizeUTF8(o);f+=22;var v=new Uint8Array(f),C=0,F=[];for(var o in y){var D=y[o];F.push(C),C=i._writeHeader(v,C,o,D,0)}var H=0,I=C;for(var o in y)D=y[o],F.push(C),C=i._writeHeader(v,C,o,D,1,F[H++]);var E=C-I;return c(v,C,101010256),C+=4,b(v,C+=4,H),b(v,C+=2,H),c(v,C+=2,E),c(v,C+=4,I),C+=4,C+=2,v.buffer},i._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},i._writeHeader=function(e,t,f,c,b,y){var o=i.bin.writeUint,l=i.bin.writeUshort,s=c.file;return o(e,t,b==0?67324752:33639248),t+=4,b==1&&(t+=2),l(e,t,20),l(e,t+=2,0),l(e,t+=2,c.cpr?8:0),o(e,t+=2,0),o(e,t+=4,c.crc),o(e,t+=4,s.length),o(e,t+=4,c.usize),l(e,t+=4,i.bin.sizeUTF8(f)),l(e,t+=2,0),t+=2,b==1&&(t+=2,t+=2,o(e,t+=6,y),t+=4),t+=i.bin.writeUTF8(e,t,f),b==0&&(e.set(s,t),t+=s.length),t},i.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var f=t,c=0;c<8;c++)1&f?f=3988292384^f>>>1:f>>>=1;e[t]=f}return e}(),update:function(e,t,f,c){for(var b=0;b<c;b++)e=i.crc.table[255&(e^t[f+b])]^e>>>8;return e},crc:function(e,t,f){return 4294967295^i.crc.update(4294967295,e,t,f)}},i.adler=function(e,t,f){for(var c=1,b=0,y=t,o=t+f;y<o;){for(var l=Math.min(y+5552,o);y<l;)b+=c+=e[y++];c%=65521,b%=65521}return b<<16|c},i.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,f){e[t]=255&f,e[t+1]=f>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,f){e[t]=255&f,e[t+1]=f>>8&255,e[t+2]=f>>16&255,e[t+3]=f>>24&255},readASCII:function(e,t,f){for(var c="",b=0;b<f;b++)c+=String.fromCharCode(e[t+b]);return c},writeASCII:function(e,t,f){for(var c=0;c<f.length;c++)e[t+c]=f.charCodeAt(c)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,f){for(var c,b="",y=0;y<f;y++)b+="%"+i.bin.pad(e[t+y].toString(16));try{c=decodeURIComponent(b)}catch{return i.bin.readASCII(e,t,f)}return c},writeUTF8:function(e,t,f){for(var c=f.length,b=0,y=0;y<c;y++){var o=f.charCodeAt(y);if(!(4294967168&o))e[t+b]=o,b++;else if(!(4294965248&o))e[t+b]=192|o>>6,e[t+b+1]=128|o>>0&63,b+=2;else if(!(4294901760&o))e[t+b]=224|o>>12,e[t+b+1]=128|o>>6&63,e[t+b+2]=128|o>>0&63,b+=3;else{if(4292870144&o)throw"e";e[t+b]=240|o>>18,e[t+b+1]=128|o>>12&63,e[t+b+2]=128|o>>6&63,e[t+b+3]=128|o>>0&63,b+=4}}return b},sizeUTF8:function(e){for(var t=e.length,f=0,c=0;c<t;c++){var b=e.charCodeAt(c);if(!(4294967168&b))f++;else if(!(4294965248&b))f+=2;else if(!(4294901760&b))f+=3;else{if(4292870144&b)throw"e";f+=4}}return f}},i.F={},i.F.deflateRaw=function(e,t,f,c){var b=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][c],y=i.F.U,o=i.F._goodIndex;i.F._hash;var l=i.F._putsE,s=0,h=f<<3,v=0,C=e.length;if(c==0){for(;s<C;)l(t,h,s+(A=Math.min(65535,C-s))==C?1:0),h=i.F._copyExact(e,s,A,t,h+8),s+=A;return h>>>3}var F=y.lits,D=y.strt,H=y.prev,I=0,E=0,U=0,g=0,k=0,d=0;for(C>2&&(D[d=i.F._hash(e,0)]=0),s=0;s<C;s++){if(k=d,s+1<C-2){d=i.F._hash(e,s+1);var m=s+1&32767;H[m]=D[d],D[d]=m}if(v<=s){(I>14e3||E>26697)&&C-s>100&&(v<s&&(F[I]=s-v,I+=2,v=s),h=i.F._writeBlock(s==C-1||v==C?1:0,F,I,g,e,U,s-U,t,h),I=E=g=0,U=s);var w=0;s<C-2&&(w=i.F._bestMatch(e,s,H,k,Math.min(b[2],C-s),b[3]));var A=w>>>16,S=65535&w;if(w!=0){S=65535&w;var R=o(A=w>>>16,y.of0);y.lhst[257+R]++;var x=o(S,y.df0);y.dhst[x]++,g+=y.exb[R]+y.dxb[x],F[I]=A<<23|s-v,F[I+1]=S<<16|R<<8|x,I+=2,v=s+A}else y.lhst[e[s]]++;E++}}for(U==s&&e.length!=0||(v<s&&(F[I]=s-v,I+=2,v=s),h=i.F._writeBlock(1,F,I,g,e,U,s-U,t,h),I=0,E=0,I=E=g=0,U=s);7&h;)h++;return h>>>3},i.F._bestMatch=function(e,t,f,c,b,y){var o=32767&t,l=f[o],s=o-l+32768&32767;if(l==o||c!=i.F._hash(e,t-s))return 0;for(var h=0,v=0,C=Math.min(32767,t);s<=C&&--y!=0&&l!=o;){if(h==0||e[t+h]==e[t+h-s]){var F=i.F._howLong(e,t,s);if(F>h){if(v=s,(h=F)>=b)break;s+2<F&&(F=s+2);for(var D=0,H=0;H<F-2;H++){var I=t-s+H+32768&32767,E=I-f[I]+32768&32767;E>D&&(D=E,l=I)}}}s+=(o=l)-(l=f[o])+32768&32767}return h<<16|v},i.F._howLong=function(e,t,f){if(e[t]!=e[t-f]||e[t+1]!=e[t+1-f]||e[t+2]!=e[t+2-f])return 0;var c=t,b=Math.min(e.length,t+258);for(t+=3;t<b&&e[t]==e[t-f];)t++;return t-c},i.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},i.saved=0,i.F._writeBlock=function(e,t,f,c,b,y,o,l,s){var h,v,C,F,D,H,I,E,U,g=i.F.U,k=i.F._putsF,d=i.F._putsE;g.lhst[256]++,v=(h=i.F.getTrees())[0],C=h[1],F=h[2],D=h[3],H=h[4],I=h[5],E=h[6],U=h[7];var m=32+(s+3&7?8-(s+3&7):0)+(o<<3),w=c+i.F.contSize(g.fltree,g.lhst)+i.F.contSize(g.fdtree,g.dhst),A=c+i.F.contSize(g.ltree,g.lhst)+i.F.contSize(g.dtree,g.dhst);A+=14+3*I+i.F.contSize(g.itree,g.ihst)+(2*g.ihst[16]+3*g.ihst[17]+7*g.ihst[18]);for(var S=0;S<286;S++)g.lhst[S]=0;for(S=0;S<30;S++)g.dhst[S]=0;for(S=0;S<19;S++)g.ihst[S]=0;var R=m<w&&m<A?0:w<A?1:2;if(k(l,s,e),k(l,s+1,R),s+=3,R==0){for(;7&s;)s++;s=i.F._copyExact(b,y,o,l,s)}else{var x,O;if(R==1&&(x=g.fltree,O=g.fdtree),R==2){i.F.makeCodes(g.ltree,v),i.F.revCodes(g.ltree,v),i.F.makeCodes(g.dtree,C),i.F.revCodes(g.dtree,C),i.F.makeCodes(g.itree,F),i.F.revCodes(g.itree,F),x=g.ltree,O=g.dtree,d(l,s,D-257),d(l,s+=5,H-1),d(l,s+=5,I-4),s+=4;for(var _=0;_<I;_++)d(l,s+3*_,g.itree[1+(g.ordr[_]<<1)]);s+=3*I,s=i.F._codeTiny(E,g.itree,l,s),s=i.F._codeTiny(U,g.itree,l,s)}for(var p=y,z=0;z<f;z+=2){for(var T=t[z],Y=T>>>23,Q=p+(8388607&T);p<Q;)s=i.F._writeLit(b[p++],x,l,s);if(Y!=0){var $=t[z+1],q=$>>16,P=$>>8&255,N=255&$;d(l,s=i.F._writeLit(257+P,x,l,s),Y-g.of0[P]),s+=g.exb[P],k(l,s=i.F._writeLit(N,O,l,s),q-g.df0[N]),s+=g.dxb[N],p+=Y}}s=i.F._writeLit(256,x,l,s)}return s},i.F._copyExact=function(e,t,f,c,b){var y=b>>>3;return c[y]=f,c[y+1]=f>>>8,c[y+2]=255-c[y],c[y+3]=255-c[y+1],y+=4,c.set(new Uint8Array(e.buffer,t,f),y),b+(f+4<<3)},i.F.getTrees=function(){for(var e=i.F.U,t=i.F._hufTree(e.lhst,e.ltree,15),f=i.F._hufTree(e.dhst,e.dtree,15),c=[],b=i.F._lenCodes(e.ltree,c),y=[],o=i.F._lenCodes(e.dtree,y),l=0;l<c.length;l+=2)e.ihst[c[l]]++;for(l=0;l<y.length;l+=2)e.ihst[y[l]]++;for(var s=i.F._hufTree(e.ihst,e.itree,7),h=19;h>4&&e.itree[1+(e.ordr[h-1]<<1)]==0;)h--;return[t,f,s,b,o,h,c,y]},i.F.getSecond=function(e){for(var t=[],f=0;f<e.length;f+=2)t.push(e[f+1]);return t},i.F.nonZero=function(e){for(var t="",f=0;f<e.length;f+=2)e[f+1]!=0&&(t+=(f>>1)+",");return t},i.F.contSize=function(e,t){for(var f=0,c=0;c<t.length;c++)f+=t[c]*e[1+(c<<1)];return f},i.F._codeTiny=function(e,t,f,c){for(var b=0;b<e.length;b+=2){var y=e[b],o=e[b+1];c=i.F._writeLit(y,t,f,c);var l=y==16?2:y==17?3:7;y>15&&(i.F._putsE(f,c,o,l),c+=l)}return c},i.F._lenCodes=function(e,t){for(var f=e.length;f!=2&&e[f-1]==0;)f-=2;for(var c=0;c<f;c+=2){var b=e[c+1],y=c+3<f?e[c+3]:-1,o=c+5<f?e[c+5]:-1,l=c==0?-1:e[c-1];if(b==0&&y==b&&o==b){for(var s=c+5;s+2<f&&e[s+2]==b;)s+=2;(h=Math.min(s+1-c>>>1,138))<11?t.push(17,h-3):t.push(18,h-11),c+=2*h-2}else if(b==l&&y==b&&o==b){for(s=c+5;s+2<f&&e[s+2]==b;)s+=2;var h=Math.min(s+1-c>>>1,6);t.push(16,h-3),c+=2*h-2}else t.push(b,0)}return f>>>1},i.F._hufTree=function(e,t,f){var c=[],b=e.length,y=t.length,o=0;for(o=0;o<y;o+=2)t[o]=0,t[o+1]=0;for(o=0;o<b;o++)e[o]!=0&&c.push({lit:o,f:e[o]});var l=c.length,s=c.slice(0);if(l==0)return 0;if(l==1){var h=c[0].lit;return s=h==0?1:0,t[1+(h<<1)]=1,t[1+(s<<1)]=1,1}c.sort(function(E,U){return E.f-U.f});var v=c[0],C=c[1],F=0,D=1,H=2;for(c[0]={lit:-1,f:v.f+C.f,l:v,r:C,d:0};D!=l-1;)v=F!=D&&(H==l||c[F].f<c[H].f)?c[F++]:c[H++],C=F!=D&&(H==l||c[F].f<c[H].f)?c[F++]:c[H++],c[D++]={lit:-1,f:v.f+C.f,l:v,r:C};var I=i.F.setDepth(c[D-1],0);for(I>f&&(i.F.restrictDepth(s,f,I),I=f),o=0;o<l;o++)t[1+(s[o].lit<<1)]=s[o].d;return I},i.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(i.F.setDepth(e.l,t+1),i.F.setDepth(e.r,t+1))},i.F.restrictDepth=function(e,t,f){var c=0,b=1<<f-t,y=0;for(e.sort(function(l,s){return s.d==l.d?l.f-s.f:s.d-l.d}),c=0;c<e.length&&e[c].d>t;c++){var o=e[c].d;e[c].d=t,y+=b-(1<<f-o)}for(y>>>=f-t;y>0;)(o=e[c].d)<t?(e[c].d++,y-=1<<t-o-1):c++;for(;c>=0;c--)e[c].d==t&&y<0&&(e[c].d--,y++);y!=0&&console.log("debt left")},i.F._goodIndex=function(e,t){var f=0;return t[16|f]<=e&&(f|=16),t[8|f]<=e&&(f|=8),t[4|f]<=e&&(f|=4),t[2|f]<=e&&(f|=2),t[1|f]<=e&&(f|=1),f},i.F._writeLit=function(e,t,f,c){return i.F._putsF(f,c,t[e<<1]),c+t[1+(e<<1)]},i.F.inflate=function(e,t){var f=Uint8Array;if(e[0]==3&&e[1]==0)return t||new f(0);var c=i.F,b=c._bitsF,y=c._bitsE,o=c._decodeTiny,l=c.makeCodes,s=c.codes2map,h=c._get17,v=c.U,C=t==null;C&&(t=new f(e.length>>>2<<3));for(var F,D,H=0,I=0,E=0,U=0,g=0,k=0,d=0,m=0,w=0;H==0;)if(H=b(e,w,1),I=b(e,w+1,2),w+=3,I!=0){if(C&&(t=i.F._check(t,m+(1<<17))),I==1&&(F=v.flmap,D=v.fdmap,k=511,d=31),I==2){E=y(e,w,5)+257,U=y(e,w+5,5)+1,g=y(e,w+10,4)+4,w+=14;for(var A=0;A<38;A+=2)v.itree[A]=0,v.itree[A+1]=0;var S=1;for(A=0;A<g;A++){var R=y(e,w+3*A,3);v.itree[1+(v.ordr[A]<<1)]=R,R>S&&(S=R)}w+=3*g,l(v.itree,S),s(v.itree,S,v.imap),F=v.lmap,D=v.dmap,w=o(v.imap,(1<<S)-1,E+U,e,w,v.ttree);var x=c._copyOut(v.ttree,0,E,v.ltree);k=(1<<x)-1;var O=c._copyOut(v.ttree,E,U,v.dtree);d=(1<<O)-1,l(v.ltree,x),s(v.ltree,x,F),l(v.dtree,O),s(v.dtree,O,D)}for(;;){var _=F[h(e,w)&k];w+=15&_;var p=_>>>4;if(!(p>>>8))t[m++]=p;else{if(p==256)break;var z=m+p-254;if(p>264){var T=v.ldef[p-257];z=m+(T>>>3)+y(e,w,7&T),w+=7&T}var Y=D[h(e,w)&d];w+=15&Y;var Q=Y>>>4,$=v.ddef[Q],q=($>>>4)+b(e,w,15&$);for(w+=15&$,C&&(t=i.F._check(t,m+(1<<17)));m<z;)t[m]=t[m++-q],t[m]=t[m++-q],t[m]=t[m++-q],t[m]=t[m++-q];m=z}}}else{7&w&&(w+=8-(7&w));var P=4+(w>>>3),N=e[P-4]|e[P-3]<<8;C&&(t=i.F._check(t,m+N)),t.set(new f(e.buffer,e.byteOffset+P,N),m),w=P+N<<3,m+=N}return t.length==m?t:t.slice(0,m)},i.F._check=function(e,t){var f=e.length;if(t<=f)return e;var c=new Uint8Array(Math.max(f<<1,t));return c.set(e,0),c},i.F._decodeTiny=function(e,t,f,c,b,y){for(var o=i.F._bitsE,l=i.F._get17,s=0;s<f;){var h=e[l(c,b)&t];b+=15&h;var v=h>>>4;if(v<=15)y[s]=v,s++;else{var C=0,F=0;v==16?(F=3+o(c,b,2),b+=2,C=y[s-1]):v==17?(F=3+o(c,b,3),b+=3):v==18&&(F=11+o(c,b,7),b+=7);for(var D=s+F;s<D;)y[s]=C,s++}}return b},i.F._copyOut=function(e,t,f,c){for(var b=0,y=0,o=c.length>>>1;y<f;){var l=e[y+t];c[y<<1]=0,c[1+(y<<1)]=l,l>b&&(b=l),y++}for(;y<o;)c[y<<1]=0,c[1+(y<<1)]=0,y++;return b},i.F.makeCodes=function(e,t){for(var f,c,b,y,o=i.F.U,l=e.length,s=o.bl_count,h=0;h<=t;h++)s[h]=0;for(h=1;h<l;h+=2)s[e[h]]++;var v=o.next_code;for(f=0,s[0]=0,c=1;c<=t;c++)f=f+s[c-1]<<1,v[c]=f;for(b=0;b<l;b+=2)(y=e[b+1])!=0&&(e[b]=v[y],v[y]++)},i.F.codes2map=function(e,t,f){for(var c=e.length,b=i.F.U.rev15,y=0;y<c;y+=2)if(e[y+1]!=0)for(var o=y>>1,l=e[y+1],s=o<<4|l,h=t-l,v=e[y]<<h,C=v+(1<<h);v!=C;)f[b[v]>>>15-t]=s,v++},i.F.revCodes=function(e,t){for(var f=i.F.U.rev15,c=15-t,b=0;b<e.length;b+=2){var y=e[b]<<t-e[b+1];e[b]=f[y]>>>c}},i.F._putsE=function(e,t,f){f<<=7&t;var c=t>>>3;e[c]|=f,e[c+1]|=f>>>8},i.F._putsF=function(e,t,f){f<<=7&t;var c=t>>>3;e[c]|=f,e[c+1]|=f>>>8,e[c+2]|=f>>>16},i.F._bitsE=function(e,t,f){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<f)-1},i.F._bitsF=function(e,t,f){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<f)-1},i.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},i.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},i.F.U=(a=Uint16Array,u=Uint32Array,{next_code:new a(16),bl_count:new a(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new a(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new u(32),flmap:new a(512),fltree:[],fdmap:new a(32),fdtree:[],lmap:new a(32768),ltree:[],ttree:[],dmap:new a(32768),dtree:[],imap:new a(512),itree:[],rev15:new a(32768),lhst:new u(286),dhst:new u(30),ihst:new u(19),lits:new u(15e3),strt:new a(65536),prev:new a(32768)}),function(){for(var e=i.F.U,t=0;t<32768;t++){var f=t;f=(4278255360&(f=(4042322160&(f=(3435973836&(f=(2863311530&f)>>>1|(1431655765&f)<<1))>>>2|(858993459&f)<<2))>>>4|(252645135&f)<<4))>>>8|(16711935&f)<<8,e.rev15[t]=(f>>>16|f<<16)>>>17}function c(b,y,o){for(;y--!=0;)b.push(0,o)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];c(e.fltree,144,8),c(e.fltree,112,9),c(e.fltree,24,7),c(e.fltree,8,8),i.F.makeCodes(e.fltree,9),i.F.codes2map(e.fltree,9,e.flmap),i.F.revCodes(e.fltree,9),c(e.fdtree,32,5),i.F.makeCodes(e.fdtree,5),i.F.codes2map(e.fdtree,5,e.fdmap),i.F.revCodes(e.fdtree,5),c(e.itree,19,0),c(e.ltree,286,0),c(e.dtree,30,0),c(e.ttree,320,0)}()})();var Is=Es({__proto__:null,default:kn},[kn]);const At=function(){var n={nextZero(o,l){for(;o[l]!=0;)l++;return l},readUshort:(o,l)=>o[l]<<8|o[l+1],writeUshort(o,l,s){o[l]=s>>8&255,o[l+1]=255&s},readUint:(o,l)=>16777216*o[l]+(o[l+1]<<16|o[l+2]<<8|o[l+3]),writeUint(o,l,s){o[l]=s>>24&255,o[l+1]=s>>16&255,o[l+2]=s>>8&255,o[l+3]=255&s},readASCII(o,l,s){let h="";for(let v=0;v<s;v++)h+=String.fromCharCode(o[l+v]);return h},writeASCII(o,l,s){for(let h=0;h<s.length;h++)o[l+h]=s.charCodeAt(h)},readBytes(o,l,s){const h=[];for(let v=0;v<s;v++)h.push(o[l+v]);return h},pad:o=>o.length<2?`0${o}`:o,readUTF8(o,l,s){let h,v="";for(let C=0;C<s;C++)v+=`%${n.pad(o[l+C].toString(16))}`;try{h=decodeURIComponent(v)}catch{return n.readASCII(o,l,s)}return h}};function a(o,l,s,h){const v=l*s,C=t(h),F=Math.ceil(l*C/8),D=new Uint8Array(4*v),H=new Uint32Array(D.buffer),{ctype:I}=h,{depth:E}=h,U=n.readUshort;if(I==6){const T=v<<2;if(E==8)for(var g=0;g<T;g+=4)D[g]=o[g],D[g+1]=o[g+1],D[g+2]=o[g+2],D[g+3]=o[g+3];if(E==16)for(g=0;g<T;g++)D[g]=o[g<<1]}else if(I==2){const T=h.tabs.tRNS;if(T==null){if(E==8)for(g=0;g<v;g++){var k=3*g;H[g]=255<<24|o[k+2]<<16|o[k+1]<<8|o[k]}if(E==16)for(g=0;g<v;g++)k=6*g,H[g]=255<<24|o[k+4]<<16|o[k+2]<<8|o[k]}else{var d=T[0];const Y=T[1],Q=T[2];if(E==8)for(g=0;g<v;g++){var m=g<<2;k=3*g,H[g]=255<<24|o[k+2]<<16|o[k+1]<<8|o[k],o[k]==d&&o[k+1]==Y&&o[k+2]==Q&&(D[m+3]=0)}if(E==16)for(g=0;g<v;g++)m=g<<2,k=6*g,H[g]=255<<24|o[k+4]<<16|o[k+2]<<8|o[k],U(o,k)==d&&U(o,k+2)==Y&&U(o,k+4)==Q&&(D[m+3]=0)}}else if(I==3){const T=h.tabs.PLTE,Y=h.tabs.tRNS,Q=Y?Y.length:0;if(E==1)for(var w=0;w<s;w++){var A=w*F,S=w*l;for(g=0;g<l;g++){m=S+g<<2;var R=3*(x=o[A+(g>>3)]>>7-((7&g)<<0)&1);D[m]=T[R],D[m+1]=T[R+1],D[m+2]=T[R+2],D[m+3]=x<Q?Y[x]:255}}if(E==2)for(w=0;w<s;w++)for(A=w*F,S=w*l,g=0;g<l;g++)m=S+g<<2,R=3*(x=o[A+(g>>2)]>>6-((3&g)<<1)&3),D[m]=T[R],D[m+1]=T[R+1],D[m+2]=T[R+2],D[m+3]=x<Q?Y[x]:255;if(E==4)for(w=0;w<s;w++)for(A=w*F,S=w*l,g=0;g<l;g++)m=S+g<<2,R=3*(x=o[A+(g>>1)]>>4-((1&g)<<2)&15),D[m]=T[R],D[m+1]=T[R+1],D[m+2]=T[R+2],D[m+3]=x<Q?Y[x]:255;if(E==8)for(g=0;g<v;g++){var x;m=g<<2,R=3*(x=o[g]),D[m]=T[R],D[m+1]=T[R+1],D[m+2]=T[R+2],D[m+3]=x<Q?Y[x]:255}}else if(I==4){if(E==8)for(g=0;g<v;g++){m=g<<2;var O=o[_=g<<1];D[m]=O,D[m+1]=O,D[m+2]=O,D[m+3]=o[_+1]}if(E==16)for(g=0;g<v;g++){var _;m=g<<2,O=o[_=g<<2],D[m]=O,D[m+1]=O,D[m+2]=O,D[m+3]=o[_+2]}}else if(I==0)for(d=h.tabs.tRNS?h.tabs.tRNS:-1,w=0;w<s;w++){const T=w*F,Y=w*l;if(E==1)for(var p=0;p<l;p++){var z=(O=255*(o[T+(p>>>3)]>>>7-(7&p)&1))==255*d?0:255;H[Y+p]=z<<24|O<<16|O<<8|O}else if(E==2)for(p=0;p<l;p++)z=(O=85*(o[T+(p>>>2)]>>>6-((3&p)<<1)&3))==85*d?0:255,H[Y+p]=z<<24|O<<16|O<<8|O;else if(E==4)for(p=0;p<l;p++)z=(O=17*(o[T+(p>>>1)]>>>4-((1&p)<<2)&15))==17*d?0:255,H[Y+p]=z<<24|O<<16|O<<8|O;else if(E==8)for(p=0;p<l;p++)z=(O=o[T+p])==d?0:255,H[Y+p]=z<<24|O<<16|O<<8|O;else if(E==16)for(p=0;p<l;p++)O=o[T+(p<<1)],z=U(o,T+(p<<1))==d?0:255,H[Y+p]=z<<24|O<<16|O<<8|O}return D}function u(o,l,s,h){const v=t(o),C=Math.ceil(s*v/8),F=new Uint8Array((C+1+o.interlace)*h);return l=o.tabs.CgBI?e(l,F):i(l,F),o.interlace==0?l=f(l,o,0,s,h):o.interlace==1&&(l=function(H,I){const E=I.width,U=I.height,g=t(I),k=g>>3,d=Math.ceil(E*g/8),m=new Uint8Array(U*d);let w=0;const A=[0,0,4,0,2,0,1],S=[0,4,0,2,0,1,0],R=[8,8,8,4,4,2,2],x=[8,8,4,4,2,2,1];let O=0;for(;O<7;){const p=R[O],z=x[O];let T=0,Y=0,Q=A[O];for(;Q<U;)Q+=p,Y++;let $=S[O];for(;$<E;)$+=z,T++;const q=Math.ceil(T*g/8);f(H,I,w,T,Y);let P=0,N=A[O];for(;N<U;){let K=S[O],ne=w+P*q<<3;for(;K<E;){var _;if(g==1&&(_=(_=H[ne>>3])>>7-(7&ne)&1,m[N*d+(K>>3)]|=_<<7-((7&K)<<0)),g==2&&(_=(_=H[ne>>3])>>6-(7&ne)&3,m[N*d+(K>>2)]|=_<<6-((3&K)<<1)),g==4&&(_=(_=H[ne>>3])>>4-(7&ne)&15,m[N*d+(K>>1)]|=_<<4-((1&K)<<2)),g>=8){const G=N*d+K*k;for(let V=0;V<k;V++)m[G+V]=H[(ne>>3)+V]}ne+=g,K+=z}P++,N+=p}T*Y!=0&&(w+=Y*(1+q)),O+=1}return m}(l,o)),l}function i(o,l){return e(new Uint8Array(o.buffer,2,o.length-6),l)}var e=function(){const o={H:{}};return o.H.N=function(l,s){const h=Uint8Array;let v,C,F=0,D=0,H=0,I=0,E=0,U=0,g=0,k=0,d=0;if(l[0]==3&&l[1]==0)return s||new h(0);const m=o.H,w=m.b,A=m.e,S=m.R,R=m.n,x=m.A,O=m.Z,_=m.m,p=s==null;for(p&&(s=new h(l.length>>>2<<5));F==0;)if(F=w(l,d,1),D=w(l,d+1,2),d+=3,D!=0){if(p&&(s=o.H.W(s,k+(1<<17))),D==1&&(v=_.J,C=_.h,U=511,g=31),D==2){H=A(l,d,5)+257,I=A(l,d+5,5)+1,E=A(l,d+10,4)+4,d+=14;let T=1;for(var z=0;z<38;z+=2)_.Q[z]=0,_.Q[z+1]=0;for(z=0;z<E;z++){const $=A(l,d+3*z,3);_.Q[1+(_.X[z]<<1)]=$,$>T&&(T=$)}d+=3*E,R(_.Q,T),x(_.Q,T,_.u),v=_.w,C=_.d,d=S(_.u,(1<<T)-1,H+I,l,d,_.v);const Y=m.V(_.v,0,H,_.C);U=(1<<Y)-1;const Q=m.V(_.v,H,I,_.D);g=(1<<Q)-1,R(_.C,Y),x(_.C,Y,v),R(_.D,Q),x(_.D,Q,C)}for(;;){const T=v[O(l,d)&U];d+=15&T;const Y=T>>>4;if(!(Y>>>8))s[k++]=Y;else{if(Y==256)break;{let Q=k+Y-254;if(Y>264){const K=_.q[Y-257];Q=k+(K>>>3)+A(l,d,7&K),d+=7&K}const $=C[O(l,d)&g];d+=15&$;const q=$>>>4,P=_.c[q],N=(P>>>4)+w(l,d,15&P);for(d+=15&P;k<Q;)s[k]=s[k++-N],s[k]=s[k++-N],s[k]=s[k++-N],s[k]=s[k++-N];k=Q}}}}else{7&d&&(d+=8-(7&d));const T=4+(d>>>3),Y=l[T-4]|l[T-3]<<8;p&&(s=o.H.W(s,k+Y)),s.set(new h(l.buffer,l.byteOffset+T,Y),k),d=T+Y<<3,k+=Y}return s.length==k?s:s.slice(0,k)},o.H.W=function(l,s){const h=l.length;if(s<=h)return l;const v=new Uint8Array(h<<1);return v.set(l,0),v},o.H.R=function(l,s,h,v,C,F){const D=o.H.e,H=o.H.Z;let I=0;for(;I<h;){const E=l[H(v,C)&s];C+=15&E;const U=E>>>4;if(U<=15)F[I]=U,I++;else{let g=0,k=0;U==16?(k=3+D(v,C,2),C+=2,g=F[I-1]):U==17?(k=3+D(v,C,3),C+=3):U==18&&(k=11+D(v,C,7),C+=7);const d=I+k;for(;I<d;)F[I]=g,I++}}return C},o.H.V=function(l,s,h,v){let C=0,F=0;const D=v.length>>>1;for(;F<h;){const H=l[F+s];v[F<<1]=0,v[1+(F<<1)]=H,H>C&&(C=H),F++}for(;F<D;)v[F<<1]=0,v[1+(F<<1)]=0,F++;return C},o.H.n=function(l,s){const h=o.H.m,v=l.length;let C,F,D,H;const I=h.j;for(var E=0;E<=s;E++)I[E]=0;for(E=1;E<v;E+=2)I[l[E]]++;const U=h.K;for(C=0,I[0]=0,F=1;F<=s;F++)C=C+I[F-1]<<1,U[F]=C;for(D=0;D<v;D+=2)H=l[D+1],H!=0&&(l[D]=U[H],U[H]++)},o.H.A=function(l,s,h){const v=l.length,C=o.H.m.r;for(let F=0;F<v;F+=2)if(l[F+1]!=0){const D=F>>1,H=l[F+1],I=D<<4|H,E=s-H;let U=l[F]<<E;const g=U+(1<<E);for(;U!=g;)h[C[U]>>>15-s]=I,U++}},o.H.l=function(l,s){const h=o.H.m.r,v=15-s;for(let C=0;C<l.length;C+=2){const F=l[C]<<s-l[C+1];l[C]=h[F]>>>v}},o.H.M=function(l,s,h){h<<=7&s;const v=s>>>3;l[v]|=h,l[v+1]|=h>>>8},o.H.I=function(l,s,h){h<<=7&s;const v=s>>>3;l[v]|=h,l[v+1]|=h>>>8,l[v+2]|=h>>>16},o.H.e=function(l,s,h){return(l[s>>>3]|l[1+(s>>>3)]<<8)>>>(7&s)&(1<<h)-1},o.H.b=function(l,s,h){return(l[s>>>3]|l[1+(s>>>3)]<<8|l[2+(s>>>3)]<<16)>>>(7&s)&(1<<h)-1},o.H.Z=function(l,s){return(l[s>>>3]|l[1+(s>>>3)]<<8|l[2+(s>>>3)]<<16)>>>(7&s)},o.H.i=function(l,s){return(l[s>>>3]|l[1+(s>>>3)]<<8|l[2+(s>>>3)]<<16|l[3+(s>>>3)]<<24)>>>(7&s)},o.H.m=function(){const l=Uint16Array,s=Uint32Array;return{K:new l(16),j:new l(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new l(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new s(32),J:new l(512),_:[],h:new l(32),$:[],w:new l(32768),C:[],v:[],d:new l(32768),D:[],u:new l(512),Q:[],r:new l(32768),s:new s(286),Y:new s(30),a:new s(19),t:new s(15e3),k:new l(65536),g:new l(32768)}}(),function(){const l=o.H.m;for(var s=0;s<32768;s++){let v=s;v=(2863311530&v)>>>1|(1431655765&v)<<1,v=(3435973836&v)>>>2|(858993459&v)<<2,v=(4042322160&v)>>>4|(252645135&v)<<4,v=(4278255360&v)>>>8|(16711935&v)<<8,l.r[s]=(v>>>16|v<<16)>>>17}function h(v,C,F){for(;C--!=0;)v.push(0,F)}for(s=0;s<32;s++)l.q[s]=l.S[s]<<3|l.T[s],l.c[s]=l.p[s]<<4|l.z[s];h(l._,144,8),h(l._,112,9),h(l._,24,7),h(l._,8,8),o.H.n(l._,9),o.H.A(l._,9,l.J),o.H.l(l._,9),h(l.$,32,5),o.H.n(l.$,5),o.H.A(l.$,5,l.h),o.H.l(l.$,5),h(l.Q,19,0),h(l.C,286,0),h(l.D,30,0),h(l.v,320,0)}(),o.H.N}();function t(o){return[1,null,3,1,2,null,4][o.ctype]*o.depth}function f(o,l,s,h,v){let C=t(l);const F=Math.ceil(h*C/8);let D,H;C=Math.ceil(C/8);let I=o[s],E=0;if(I>1&&(o[s]=[0,0,1][I-2]),I==3)for(E=C;E<F;E++)o[E+1]=o[E+1]+(o[E+1-C]>>>1)&255;for(let U=0;U<v;U++)if(D=s+U*F,H=D+U+1,I=o[H-1],E=0,I==0)for(;E<F;E++)o[D+E]=o[H+E];else if(I==1){for(;E<C;E++)o[D+E]=o[H+E];for(;E<F;E++)o[D+E]=o[H+E]+o[D+E-C]}else if(I==2)for(;E<F;E++)o[D+E]=o[H+E]+o[D+E-F];else if(I==3){for(;E<C;E++)o[D+E]=o[H+E]+(o[D+E-F]>>>1);for(;E<F;E++)o[D+E]=o[H+E]+(o[D+E-F]+o[D+E-C]>>>1)}else{for(;E<C;E++)o[D+E]=o[H+E]+c(0,o[D+E-F],0);for(;E<F;E++)o[D+E]=o[H+E]+c(o[D+E-C],o[D+E-F],o[D+E-C-F])}return o}function c(o,l,s){const h=o+l-s,v=h-o,C=h-l,F=h-s;return v*v<=C*C&&v*v<=F*F?o:C*C<=F*F?l:s}function b(o,l,s){s.width=n.readUint(o,l),l+=4,s.height=n.readUint(o,l),l+=4,s.depth=o[l],l++,s.ctype=o[l],l++,s.compress=o[l],l++,s.filter=o[l],l++,s.interlace=o[l],l++}function y(o,l,s,h,v,C,F,D,H){const I=Math.min(l,v),E=Math.min(s,C);let U=0,g=0;for(let O=0;O<E;O++)for(let _=0;_<I;_++)if(F>=0&&D>=0?(U=O*l+_<<2,g=(D+O)*v+F+_<<2):(U=(-D+O)*l-F+_<<2,g=O*v+_<<2),H==0)h[g]=o[U],h[g+1]=o[U+1],h[g+2]=o[U+2],h[g+3]=o[U+3];else if(H==1){var k=o[U+3]*.00392156862745098,d=o[U]*k,m=o[U+1]*k,w=o[U+2]*k,A=h[g+3]*(1/255),S=h[g]*A,R=h[g+1]*A,x=h[g+2]*A;const p=1-k,z=k+A*p,T=z==0?0:1/z;h[g+3]=255*z,h[g+0]=(d+S*p)*T,h[g+1]=(m+R*p)*T,h[g+2]=(w+x*p)*T}else if(H==2)k=o[U+3],d=o[U],m=o[U+1],w=o[U+2],A=h[g+3],S=h[g],R=h[g+1],x=h[g+2],k==A&&d==S&&m==R&&w==x?(h[g]=0,h[g+1]=0,h[g+2]=0,h[g+3]=0):(h[g]=d,h[g+1]=m,h[g+2]=w,h[g+3]=k);else if(H==3){if(k=o[U+3],d=o[U],m=o[U+1],w=o[U+2],A=h[g+3],S=h[g],R=h[g+1],x=h[g+2],k==A&&d==S&&m==R&&w==x)continue;if(k<220&&A>20)return!1}return!0}return{decode:function(l){const s=new Uint8Array(l);let h=8;const v=n,C=v.readUshort,F=v.readUint,D={tabs:{},frames:[]},H=new Uint8Array(s.length);let I,E=0,U=0;const g=[137,80,78,71,13,10,26,10];for(var k=0;k<8;k++)if(s[k]!=g[k])throw"The input is not a PNG file!";for(;h<s.length;){const O=v.readUint(s,h);h+=4;const _=v.readASCII(s,h,4);if(h+=4,_=="IHDR")b(s,h,D);else if(_=="iCCP"){for(var d=h;s[d]!=0;)d++;v.readASCII(s,h,d-h),s[d+1];const p=s.slice(d+2,h+O);let z=null;try{z=i(p)}catch{z=e(p)}D.tabs[_]=z}else if(_=="CgBI")D.tabs[_]=s.slice(h,h+4);else if(_=="IDAT"){for(k=0;k<O;k++)H[E+k]=s[h+k];E+=O}else if(_=="acTL")D.tabs[_]={num_frames:F(s,h),num_plays:F(s,h+4)},I=new Uint8Array(s.length);else if(_=="fcTL"){U!=0&&((x=D.frames[D.frames.length-1]).data=u(D,I.slice(0,U),x.rect.width,x.rect.height),U=0);const p={x:F(s,h+12),y:F(s,h+16),width:F(s,h+4),height:F(s,h+8)};let z=C(s,h+22);z=C(s,h+20)/(z==0?100:z);const T={rect:p,delay:Math.round(1e3*z),dispose:s[h+24],blend:s[h+25]};D.frames.push(T)}else if(_=="fdAT"){for(k=0;k<O-4;k++)I[U+k]=s[h+k+4];U+=O-4}else if(_=="pHYs")D.tabs[_]=[v.readUint(s,h),v.readUint(s,h+4),s[h+8]];else if(_=="cHRM")for(D.tabs[_]=[],k=0;k<8;k++)D.tabs[_].push(v.readUint(s,h+4*k));else if(_=="tEXt"||_=="zTXt"){D.tabs[_]==null&&(D.tabs[_]={});var m=v.nextZero(s,h),w=v.readASCII(s,h,m-h),A=h+O-m-1;if(_=="tEXt")R=v.readASCII(s,m+1,A);else{var S=i(s.slice(m+2,m+2+A));R=v.readUTF8(S,0,S.length)}D.tabs[_][w]=R}else if(_=="iTXt"){D.tabs[_]==null&&(D.tabs[_]={}),m=0,d=h,m=v.nextZero(s,d),w=v.readASCII(s,d,m-d);const p=s[d=m+1];var R;s[d+1],d+=2,m=v.nextZero(s,d),v.readASCII(s,d,m-d),d=m+1,m=v.nextZero(s,d),v.readUTF8(s,d,m-d),A=O-((d=m+1)-h),p==0?R=v.readUTF8(s,d,A):(S=i(s.slice(d,d+A)),R=v.readUTF8(S,0,S.length)),D.tabs[_][w]=R}else if(_=="PLTE")D.tabs[_]=v.readBytes(s,h,O);else if(_=="hIST"){const p=D.tabs.PLTE.length/3;for(D.tabs[_]=[],k=0;k<p;k++)D.tabs[_].push(C(s,h+2*k))}else if(_=="tRNS")D.ctype==3?D.tabs[_]=v.readBytes(s,h,O):D.ctype==0?D.tabs[_]=C(s,h):D.ctype==2&&(D.tabs[_]=[C(s,h),C(s,h+2),C(s,h+4)]);else if(_=="gAMA")D.tabs[_]=v.readUint(s,h)/1e5;else if(_=="sRGB")D.tabs[_]=s[h];else if(_=="bKGD")D.ctype==0||D.ctype==4?D.tabs[_]=[C(s,h)]:D.ctype==2||D.ctype==6?D.tabs[_]=[C(s,h),C(s,h+2),C(s,h+4)]:D.ctype==3&&(D.tabs[_]=s[h]);else if(_=="IEND")break;h+=O,v.readUint(s,h),h+=4}var x;return U!=0&&((x=D.frames[D.frames.length-1]).data=u(D,I.slice(0,U),x.rect.width,x.rect.height)),D.data=u(D,H,D.width,D.height),delete D.compress,delete D.interlace,delete D.filter,D},toRGBA8:function(l){const s=l.width,h=l.height;if(l.tabs.acTL==null)return[a(l.data,s,h,l).buffer];const v=[];l.frames[0].data==null&&(l.frames[0].data=l.data);const C=s*h*4,F=new Uint8Array(C),D=new Uint8Array(C),H=new Uint8Array(C);for(let E=0;E<l.frames.length;E++){const U=l.frames[E],g=U.rect.x,k=U.rect.y,d=U.rect.width,m=U.rect.height,w=a(U.data,d,m,l);if(E!=0)for(var I=0;I<C;I++)H[I]=F[I];if(U.blend==0?y(w,d,m,F,s,h,g,k,0):U.blend==1&&y(w,d,m,F,s,h,g,k,1),v.push(F.buffer.slice(0)),U.dispose!=0){if(U.dispose==1)y(D,d,m,F,s,h,g,k,0);else if(U.dispose==2)for(I=0;I<C;I++)F[I]=H[I]}}return v},_paeth:c,_copyTile:y,_bin:n}}();(function(){const{_copyTile:n}=At,{_bin:a}=At,u=At._paeth;var i={table:function(){const d=new Uint32Array(256);for(let m=0;m<256;m++){let w=m;for(let A=0;A<8;A++)1&w?w=3988292384^w>>>1:w>>>=1;d[m]=w}return d}(),update(d,m,w,A){for(let S=0;S<A;S++)d=i.table[255&(d^m[w+S])]^d>>>8;return d},crc:(d,m,w)=>4294967295^i.update(4294967295,d,m,w)};function e(d,m,w,A){m[w]+=d[0]*A>>4,m[w+1]+=d[1]*A>>4,m[w+2]+=d[2]*A>>4,m[w+3]+=d[3]*A>>4}function t(d){return Math.max(0,Math.min(255,d))}function f(d,m){const w=d[0]-m[0],A=d[1]-m[1],S=d[2]-m[2],R=d[3]-m[3];return w*w+A*A+S*S+R*R}function c(d,m,w,A,S,R,x){x==null&&(x=1);const O=A.length,_=[];for(var p=0;p<O;p++){const N=A[p];_.push([N>>>0&255,N>>>8&255,N>>>16&255,N>>>24&255])}for(p=0;p<O;p++){let N=4294967295;for(var z=0,T=0;T<O;T++){var Y=f(_[p],_[T]);T!=p&&Y<N&&(N=Y,z=T)}}const Q=new Uint32Array(S.buffer),$=new Int16Array(m*w*4),q=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(p=0;p<q.length;p++)q[p]=255*((q[p]+.5)/16-.5);for(let N=0;N<w;N++)for(let K=0;K<m;K++){var P;p=4*(N*m+K),x!=2?P=[t(d[p]+$[p]),t(d[p+1]+$[p+1]),t(d[p+2]+$[p+2]),t(d[p+3]+$[p+3])]:(Y=q[4*(3&N)+(3&K)],P=[t(d[p]+Y),t(d[p+1]+Y),t(d[p+2]+Y),t(d[p+3]+Y)]),z=0;let ne=16777215;for(T=0;T<O;T++){const ae=f(P,_[T]);ae<ne&&(ne=ae,z=T)}const G=_[z],V=[P[0]-G[0],P[1]-G[1],P[2]-G[2],P[3]-G[3]];x==1&&(K!=m-1&&e(V,$,p+4,7),N!=w-1&&(K!=0&&e(V,$,p+4*m-4,3),e(V,$,p+4*m,5),K!=m-1&&e(V,$,p+4*m+4,1))),R[p>>2]=z,Q[p>>2]=A[z]}}function b(d,m,w,A,S){S==null&&(S={});const{crc:R}=i,x=a.writeUint,O=a.writeUshort,_=a.writeASCII;let p=8;const z=d.frames.length>1;let T,Y=!1,Q=33+(z?20:0);if(S.sRGB!=null&&(Q+=13),S.pHYs!=null&&(Q+=21),S.iCCP!=null&&(T=pako.deflate(S.iCCP),Q+=21+T.length+4),d.ctype==3){for(var $=d.plte.length,q=0;q<$;q++)d.plte[q]>>>24!=255&&(Y=!0);Q+=8+3*$+4+(Y?8+1*$+4:0)}for(var P=0;P<d.frames.length;P++)z&&(Q+=38),Q+=(G=d.frames[P]).cimg.length+12,P!=0&&(Q+=4);Q+=12;const N=new Uint8Array(Q),K=[137,80,78,71,13,10,26,10];for(q=0;q<8;q++)N[q]=K[q];if(x(N,p,13),p+=4,_(N,p,"IHDR"),p+=4,x(N,p,m),p+=4,x(N,p,w),p+=4,N[p]=d.depth,p++,N[p]=d.ctype,p++,N[p]=0,p++,N[p]=0,p++,N[p]=0,p++,x(N,p,R(N,p-17,17)),p+=4,S.sRGB!=null&&(x(N,p,1),p+=4,_(N,p,"sRGB"),p+=4,N[p]=S.sRGB,p++,x(N,p,R(N,p-5,5)),p+=4),S.iCCP!=null){const V=13+T.length;x(N,p,V),p+=4,_(N,p,"iCCP"),p+=4,_(N,p,"ICC profile"),p+=11,p+=2,N.set(T,p),p+=T.length,x(N,p,R(N,p-(V+4),V+4)),p+=4}if(S.pHYs!=null&&(x(N,p,9),p+=4,_(N,p,"pHYs"),p+=4,x(N,p,S.pHYs[0]),p+=4,x(N,p,S.pHYs[1]),p+=4,N[p]=S.pHYs[2],p++,x(N,p,R(N,p-13,13)),p+=4),z&&(x(N,p,8),p+=4,_(N,p,"acTL"),p+=4,x(N,p,d.frames.length),p+=4,x(N,p,S.loop!=null?S.loop:0),p+=4,x(N,p,R(N,p-12,12)),p+=4),d.ctype==3){for(x(N,p,3*($=d.plte.length)),p+=4,_(N,p,"PLTE"),p+=4,q=0;q<$;q++){const V=3*q,ae=d.plte[q],xe=255&ae,ye=ae>>>8&255,Ie=ae>>>16&255;N[p+V+0]=xe,N[p+V+1]=ye,N[p+V+2]=Ie}if(p+=3*$,x(N,p,R(N,p-3*$-4,3*$+4)),p+=4,Y){for(x(N,p,$),p+=4,_(N,p,"tRNS"),p+=4,q=0;q<$;q++)N[p+q]=d.plte[q]>>>24&255;p+=$,x(N,p,R(N,p-$-4,$+4)),p+=4}}let ne=0;for(P=0;P<d.frames.length;P++){var G=d.frames[P];z&&(x(N,p,26),p+=4,_(N,p,"fcTL"),p+=4,x(N,p,ne++),p+=4,x(N,p,G.rect.width),p+=4,x(N,p,G.rect.height),p+=4,x(N,p,G.rect.x),p+=4,x(N,p,G.rect.y),p+=4,O(N,p,A[P]),p+=2,O(N,p,1e3),p+=2,N[p]=G.dispose,p++,N[p]=G.blend,p++,x(N,p,R(N,p-30,30)),p+=4);const V=G.cimg;x(N,p,($=V.length)+(P==0?0:4)),p+=4;const ae=p;_(N,p,P==0?"IDAT":"fdAT"),p+=4,P!=0&&(x(N,p,ne++),p+=4),N.set(V,p),p+=$,x(N,p,R(N,ae,p-ae)),p+=4}return x(N,p,0),p+=4,_(N,p,"IEND"),p+=4,x(N,p,R(N,p-4,4)),p+=4,N.buffer}function y(d,m,w){for(let A=0;A<d.frames.length;A++){const S=d.frames[A];S.rect.width;const R=S.rect.height,x=new Uint8Array(R*S.bpl+R);S.cimg=h(S.img,R,S.bpp,S.bpl,x,m,w)}}function o(d,m,w,A,S){const R=S[0],x=S[1],O=S[2],_=S[3],p=S[4],z=S[5];let T=6,Y=8,Q=255;for(var $=0;$<d.length;$++){const Me=new Uint8Array(d[$]);for(var q=Me.length,P=0;P<q;P+=4)Q&=Me[P+3]}const N=Q!=255,K=function(ce,ie,fe,Ee,me,ue){const _e=[];for(var pe=0;pe<ce.length;pe++){const Fe=new Uint8Array(ce[pe]),We=new Uint32Array(Fe.buffer);var Re;let je=0,it=0,Ke=ie,st=fe,Ft=Ee?1:0;if(pe!=0){const on=ue||Ee||pe==1||_e[pe-2].dispose!=0?1:2;let J=0,oe=1e9;for(let ke=0;ke<on;ke++){var Be=new Uint8Array(ce[pe-1-ke]);const $e=new Uint32Array(ce[pe-1-ke]);let pt=ie,Ve=fe,Te=-1,xt=-1;for(let Dt=0;Dt<fe;Dt++)for(let Et=0;Et<ie;Et++)We[Ye=Dt*ie+Et]!=$e[Ye]&&(Et<pt&&(pt=Et),Et>Te&&(Te=Et),Dt<Ve&&(Ve=Dt),Dt>xt&&(xt=Dt));Te==-1&&(pt=Ve=Te=xt=0),me&&((1&pt)==1&&pt--,(1&Ve)==1&&Ve--);const Qt=(Te-pt+1)*(xt-Ve+1);Qt<oe&&(oe=Qt,J=ke,je=pt,it=Ve,Ke=Te-pt+1,st=xt-Ve+1)}Be=new Uint8Array(ce[pe-1-J]),J==1&&(_e[pe-1].dispose=2),Re=new Uint8Array(Ke*st*4),n(Be,ie,fe,Re,Ke,st,-je,-it,0),Ft=n(Fe,ie,fe,Re,Ke,st,-je,-it,3)?1:0,Ft==1?s(Fe,ie,fe,Re,{x:je,y:it,width:Ke,height:st}):n(Fe,ie,fe,Re,Ke,st,-je,-it,0)}else Re=Fe.slice(0);_e.push({rect:{x:je,y:it,width:Ke,height:st},img:Re,blend:Ft,dispose:0})}if(Ee)for(pe=0;pe<_e.length;pe++){if((wt=_e[pe]).blend==1)continue;const Fe=wt.rect,We=_e[pe-1].rect,je=Math.min(Fe.x,We.x),it=Math.min(Fe.y,We.y),Ke={x:je,y:it,width:Math.max(Fe.x+Fe.width,We.x+We.width)-je,height:Math.max(Fe.y+Fe.height,We.y+We.height)-it};_e[pe-1].dispose=1,pe-1!=0&&l(ce,ie,fe,_e,pe-1,Ke,me),l(ce,ie,fe,_e,pe,Ke,me)}let He=0;if(ce.length!=1)for(var Ye=0;Ye<_e.length;Ye++){var wt;He+=(wt=_e[Ye]).rect.width*wt.rect.height}return _e}(d,m,w,R,x,O),ne={},G=[],V=[];if(A!=0){const Me=[];for(P=0;P<K.length;P++)Me.push(K[P].img.buffer);const ce=function(me){let ue=0;for(var _e=0;_e<me.length;_e++)ue+=me[_e].byteLength;const pe=new Uint8Array(ue);let Re=0;for(_e=0;_e<me.length;_e++){const Be=new Uint8Array(me[_e]),He=Be.length;for(let Ye=0;Ye<He;Ye+=4){let wt=Be[Ye],Fe=Be[Ye+1],We=Be[Ye+2];const je=Be[Ye+3];je==0&&(wt=Fe=We=0),pe[Re+Ye]=wt,pe[Re+Ye+1]=Fe,pe[Re+Ye+2]=We,pe[Re+Ye+3]=je}Re+=He}return pe.buffer}(Me),ie=C(ce,A);for(P=0;P<ie.plte.length;P++)G.push(ie.plte[P].est.rgba);let fe=0;for(P=0;P<K.length;P++){const Ee=(xe=K[P]).img.length;var ae=new Uint8Array(ie.inds.buffer,fe>>2,Ee>>2);V.push(ae);const me=new Uint8Array(ie.abuf,fe,Ee);z&&c(xe.img,xe.rect.width,xe.rect.height,G,me,ae),xe.img.set(me),fe+=Ee}}else for($=0;$<K.length;$++){var xe=K[$];const Me=new Uint32Array(xe.img.buffer);var ye=xe.rect.width;for(q=Me.length,ae=new Uint8Array(q),V.push(ae),P=0;P<q;P++){const ce=Me[P];if(P!=0&&ce==Me[P-1])ae[P]=ae[P-1];else if(P>ye&&ce==Me[P-ye])ae[P]=ae[P-ye];else{let ie=ne[ce];if(ie==null&&(ne[ce]=ie=G.length,G.push(ce),G.length>=300))break;ae[P]=ie}}}const Ie=G.length;for(Ie<=256&&p==0&&(Y=Ie<=2?1:Ie<=4?2:Ie<=16?4:8,Y=Math.max(Y,_)),$=0;$<K.length;$++){(xe=K[$]).rect.x,xe.rect.y,ye=xe.rect.width;const Me=xe.rect.height;let ce=xe.img;new Uint32Array(ce.buffer);let ie=4*ye,fe=4;if(Ie<=256&&p==0){ie=Math.ceil(Y*ye/8);var Ae=new Uint8Array(ie*Me);const Ee=V[$];for(let me=0;me<Me;me++){P=me*ie;const ue=me*ye;if(Y==8)for(var ve=0;ve<ye;ve++)Ae[P+ve]=Ee[ue+ve];else if(Y==4)for(ve=0;ve<ye;ve++)Ae[P+(ve>>1)]|=Ee[ue+ve]<<4-4*(1&ve);else if(Y==2)for(ve=0;ve<ye;ve++)Ae[P+(ve>>2)]|=Ee[ue+ve]<<6-2*(3&ve);else if(Y==1)for(ve=0;ve<ye;ve++)Ae[P+(ve>>3)]|=Ee[ue+ve]<<7-1*(7&ve)}ce=Ae,T=3,fe=1}else if(N==0&&K.length==1){Ae=new Uint8Array(ye*Me*3);const Ee=ye*Me;for(P=0;P<Ee;P++){const me=3*P,ue=4*P;Ae[me]=ce[ue],Ae[me+1]=ce[ue+1],Ae[me+2]=ce[ue+2]}ce=Ae,T=2,fe=3,ie=3*ye}xe.img=ce,xe.bpl=ie,xe.bpp=fe}return{ctype:T,depth:Y,plte:G,frames:K}}function l(d,m,w,A,S,R,x){const O=Uint8Array,_=Uint32Array,p=new O(d[S-1]),z=new _(d[S-1]),T=S+1<d.length?new O(d[S+1]):null,Y=new O(d[S]),Q=new _(Y.buffer);let $=m,q=w,P=-1,N=-1;for(let ne=0;ne<R.height;ne++)for(let G=0;G<R.width;G++){const V=R.x+G,ae=R.y+ne,xe=ae*m+V,ye=Q[xe];ye==0||A[S-1].dispose==0&&z[xe]==ye&&(T==null||T[4*xe+3]!=0)||(V<$&&($=V),V>P&&(P=V),ae<q&&(q=ae),ae>N&&(N=ae))}P==-1&&($=q=P=N=0),x&&((1&$)==1&&$--,(1&q)==1&&q--),R={x:$,y:q,width:P-$+1,height:N-q+1};const K=A[S];K.rect=R,K.blend=1,K.img=new Uint8Array(R.width*R.height*4),A[S-1].dispose==0?(n(p,m,w,K.img,R.width,R.height,-R.x,-R.y,0),s(Y,m,w,K.img,R)):n(Y,m,w,K.img,R.width,R.height,-R.x,-R.y,0)}function s(d,m,w,A,S){n(d,m,w,A,S.width,S.height,-S.x,-S.y,2)}function h(d,m,w,A,S,R,x){const O=[];let _,p=[0,1,2,3,4];R!=-1?p=[R]:(m*A>5e5||w==1)&&(p=[0]),x&&(_={level:0});const z=Is;for(var T=0;T<p.length;T++){for(let $=0;$<m;$++)v(S,d,$,A,w,p[T]);O.push(z.deflate(S,_))}let Y,Q=1e9;for(T=0;T<O.length;T++)O[T].length<Q&&(Y=T,Q=O[T].length);return O[Y]}function v(d,m,w,A,S,R){const x=w*A;let O=x+w;if(d[O]=R,O++,R==0)if(A<500)for(var _=0;_<A;_++)d[O+_]=m[x+_];else d.set(new Uint8Array(m.buffer,x,A),O);else if(R==1){for(_=0;_<S;_++)d[O+_]=m[x+_];for(_=S;_<A;_++)d[O+_]=m[x+_]-m[x+_-S]+256&255}else if(w==0){for(_=0;_<S;_++)d[O+_]=m[x+_];if(R==2)for(_=S;_<A;_++)d[O+_]=m[x+_];if(R==3)for(_=S;_<A;_++)d[O+_]=m[x+_]-(m[x+_-S]>>1)+256&255;if(R==4)for(_=S;_<A;_++)d[O+_]=m[x+_]-u(m[x+_-S],0,0)+256&255}else{if(R==2)for(_=0;_<A;_++)d[O+_]=m[x+_]+256-m[x+_-A]&255;if(R==3){for(_=0;_<S;_++)d[O+_]=m[x+_]+256-(m[x+_-A]>>1)&255;for(_=S;_<A;_++)d[O+_]=m[x+_]+256-(m[x+_-A]+m[x+_-S]>>1)&255}if(R==4){for(_=0;_<S;_++)d[O+_]=m[x+_]+256-u(0,m[x+_-A],0)&255;for(_=S;_<A;_++)d[O+_]=m[x+_]+256-u(m[x+_-S],m[x+_-A],m[x+_-S-A])&255}}}function C(d,m){const w=new Uint8Array(d),A=w.slice(0),S=new Uint32Array(A.buffer),R=F(A,m),x=R[0],O=R[1],_=w.length,p=new Uint8Array(_>>2);let z;if(w.length<2e7)for(var T=0;T<_;T+=4)z=D(x,Y=w[T]*(1/255),Q=w[T+1]*(1/255),$=w[T+2]*(1/255),q=w[T+3]*(1/255)),p[T>>2]=z.ind,S[T>>2]=z.est.rgba;else for(T=0;T<_;T+=4){var Y=w[T]*.00392156862745098,Q=w[T+1]*(1/255),$=w[T+2]*(1/255),q=w[T+3]*(1/255);for(z=x;z.left;)z=H(z.est,Y,Q,$,q)<=0?z.left:z.right;p[T>>2]=z.ind,S[T>>2]=z.est.rgba}return{abuf:A.buffer,inds:p,plte:O}}function F(d,m,w){w==null&&(w=1e-4);const A=new Uint32Array(d.buffer),S={i0:0,i1:d.length,bst:null,est:null,tdst:0,left:null,right:null};S.bst=U(d,S.i0,S.i1),S.est=g(S.bst);const R=[S];for(;R.length<m;){let O=0,_=0;for(var x=0;x<R.length;x++)R[x].est.L>O&&(O=R[x].est.L,_=x);if(O<w)break;const p=R[_],z=I(d,A,p.i0,p.i1,p.est.e,p.est.eMq255);if(p.i0>=z||p.i1<=z){p.est.L=0;continue}const T={i0:p.i0,i1:z,bst:null,est:null,tdst:0,left:null,right:null};T.bst=U(d,T.i0,T.i1),T.est=g(T.bst);const Y={i0:z,i1:p.i1,bst:null,est:null,tdst:0,left:null,right:null};for(Y.bst={R:[],m:[],N:p.bst.N-T.bst.N},x=0;x<16;x++)Y.bst.R[x]=p.bst.R[x]-T.bst.R[x];for(x=0;x<4;x++)Y.bst.m[x]=p.bst.m[x]-T.bst.m[x];Y.est=g(Y.bst),p.left=T,p.right=Y,R[_]=T,R.push(Y)}for(R.sort((O,_)=>_.bst.N-O.bst.N),x=0;x<R.length;x++)R[x].ind=x;return[S,R]}function D(d,m,w,A,S){if(d.left==null)return d.tdst=function(T,Y,Q,$,q){const P=Y-T[0],N=Q-T[1],K=$-T[2],ne=q-T[3];return P*P+N*N+K*K+ne*ne}(d.est.q,m,w,A,S),d;const R=H(d.est,m,w,A,S);let x=d.left,O=d.right;R>0&&(x=d.right,O=d.left);const _=D(x,m,w,A,S);if(_.tdst<=R*R)return _;const p=D(O,m,w,A,S);return p.tdst<_.tdst?p:_}function H(d,m,w,A,S){const{e:R}=d;return R[0]*m+R[1]*w+R[2]*A+R[3]*S-d.eMq}function I(d,m,w,A,S,R){for(A-=4;w<A;){for(;E(d,w,S)<=R;)w+=4;for(;E(d,A,S)>R;)A-=4;if(w>=A)break;const x=m[w>>2];m[w>>2]=m[A>>2],m[A>>2]=x,w+=4,A-=4}for(;E(d,w,S)>R;)w-=4;return w+4}function E(d,m,w){return d[m]*w[0]+d[m+1]*w[1]+d[m+2]*w[2]+d[m+3]*w[3]}function U(d,m,w){const A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S=[0,0,0,0],R=w-m>>2;for(let x=m;x<w;x+=4){const O=d[x]*.00392156862745098,_=d[x+1]*(1/255),p=d[x+2]*(1/255),z=d[x+3]*(1/255);S[0]+=O,S[1]+=_,S[2]+=p,S[3]+=z,A[0]+=O*O,A[1]+=O*_,A[2]+=O*p,A[3]+=O*z,A[5]+=_*_,A[6]+=_*p,A[7]+=_*z,A[10]+=p*p,A[11]+=p*z,A[15]+=z*z}return A[4]=A[1],A[8]=A[2],A[9]=A[6],A[12]=A[3],A[13]=A[7],A[14]=A[11],{R:A,m:S,N:R}}function g(d){const{R:m}=d,{m:w}=d,{N:A}=d,S=w[0],R=w[1],x=w[2],O=w[3],_=A==0?0:1/A,p=[m[0]-S*S*_,m[1]-S*R*_,m[2]-S*x*_,m[3]-S*O*_,m[4]-R*S*_,m[5]-R*R*_,m[6]-R*x*_,m[7]-R*O*_,m[8]-x*S*_,m[9]-x*R*_,m[10]-x*x*_,m[11]-x*O*_,m[12]-O*S*_,m[13]-O*R*_,m[14]-O*x*_,m[15]-O*O*_],z=p,T=k;let Y=[Math.random(),Math.random(),Math.random(),Math.random()],Q=0,$=0;if(A!=0)for(let P=0;P<16&&(Y=T.multVec(z,Y),$=Math.sqrt(T.dot(Y,Y)),Y=T.sml(1/$,Y),!(P!=0&&Math.abs($-Q)<1e-9));P++)Q=$;const q=[S*_,R*_,x*_,O*_];return{Cov:p,q,e:Y,L:Q,eMq255:T.dot(T.sml(255,q),Y),eMq:T.dot(Y,q),rgba:(Math.round(255*q[3])<<24|Math.round(255*q[2])<<16|Math.round(255*q[1])<<8|Math.round(255*q[0])<<0)>>>0}}var k={multVec:(d,m)=>[d[0]*m[0]+d[1]*m[1]+d[2]*m[2]+d[3]*m[3],d[4]*m[0]+d[5]*m[1]+d[6]*m[2]+d[7]*m[3],d[8]*m[0]+d[9]*m[1]+d[10]*m[2]+d[11]*m[3],d[12]*m[0]+d[13]*m[1]+d[14]*m[2]+d[15]*m[3]],dot:(d,m)=>d[0]*m[0]+d[1]*m[1]+d[2]*m[2]+d[3]*m[3],sml:(d,m)=>[d*m[0],d*m[1],d*m[2],d*m[3]]};At.encode=function(m,w,A,S,R,x,O){S==null&&(S=0),O==null&&(O=!1);const _=o(m,w,A,S,[!1,!1,!1,0,O,!1]);return y(_,-1),b(_,w,A,R,x)},At.encodeLL=function(m,w,A,S,R,x,O,_){const p={ctype:0+(S==1?0:2)+(R==0?0:4),depth:x,frames:[]},z=(S+R)*x,T=z*w;for(let Y=0;Y<m.length;Y++)p.frames.push({rect:{x:0,y:0,width:w,height:A},img:new Uint8Array(m[Y]),blend:0,dispose:1,bpp:Math.ceil(z/8),bpl:Math.ceil(T/8)});return y(p,0,!0),b(p,w,A,O,_)},At.encode.compress=o,At.encode.dither=c,At.quantize=C,At.quantize.getKDtree=F,At.quantize.getNearest=D})();const sa={toArrayBuffer(n,a){const u=n.width,i=n.height,e=u<<2,t=n.getContext("2d").getImageData(0,0,u,i),f=new Uint32Array(t.data.buffer),c=(32*u+31)/32<<2,b=c*i,y=122+b,o=new ArrayBuffer(y),l=new DataView(o),s=1<<20;let h,v,C,F,D=s,H=0,I=0,E=0;function U(d){l.setUint16(I,d,!0),I+=2}function g(d){l.setUint32(I,d,!0),I+=4}function k(d){I+=d}U(19778),g(y),k(4),g(122),g(108),g(u),g(-i>>>0),U(1),U(32),g(3),g(b),g(2835),g(2835),k(8),g(16711680),g(65280),g(255),g(4278190080),g(1466527264),function d(){for(;H<i&&D>0;){for(F=122+H*c,h=0;h<e;)D--,v=f[E++],C=v>>>24,l.setUint32(F+h,v<<8|C),h+=4;H++}E<f.length?(D=s,setTimeout(d,sa._dly)):a(o)}()},toBlob(n,a){this.toArrayBuffer(n,u=>{a(new Blob([u],{type:"image/bmp"}))})},_dly:9};var ht={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},ks={[ht.CHROME]:16384,[ht.FIREFOX]:11180,[ht.DESKTOP_SAFARI]:16384,[ht.IE]:8192,[ht.IOS]:4096,[ht.ETC]:8192};const mr=typeof window<"u",oa=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Tn=mr&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Ts=(mr||oa)&&(Tn&&Tn.getOriginalSymbol(window,"File")||typeof File<"u"&&File),la=(mr||oa)&&(Tn&&Tn.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function hr(n,a,u=Date.now()){return new Promise(i=>{const e=n.split(","),t=e[0].match(/:(.*?);/)[1],f=globalThis.atob(e[1]);let c=f.length;const b=new Uint8Array(c);for(;c--;)b[c]=f.charCodeAt(c);const y=new Blob([b],{type:t});y.name=a,y.lastModified=u,i(y)})}function ca(n){return new Promise((a,u)=>{const i=new la;i.onload=()=>a(i.result),i.onerror=e=>u(e),i.readAsDataURL(n)})}function ua(n){return new Promise((a,u)=>{const i=new Image;i.onload=()=>a(i),i.onerror=e=>u(e),i.src=n})}function Gt(){if(Gt.cachedResult!==void 0)return Gt.cachedResult;let n=ht.ETC;const{userAgent:a}=navigator;return/Chrom(e|ium)/i.test(a)?n=ht.CHROME:/iP(ad|od|hone)/i.test(a)&&/WebKit/i.test(a)?n=ht.IOS:/Safari/i.test(a)?n=ht.DESKTOP_SAFARI:/Firefox/i.test(a)?n=ht.FIREFOX:(/MSIE/i.test(a)||document.documentMode)&&(n=ht.IE),Gt.cachedResult=n,Gt.cachedResult}function da(n,a){const u=Gt(),i=ks[u];let e=n,t=a,f=e*t;const c=e>t?t/e:e/t;for(;f>i*i;){const b=(i+e)/2,y=(i+t)/2;b<y?(t=y,e=y*c):(t=b*c,e=b),f=e*t}return{width:e,height:t}}function Un(n,a){let u,i;try{if(u=new OffscreenCanvas(n,a),i=u.getContext("2d"),i===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{u=document.createElement("canvas"),i=u.getContext("2d")}return u.width=n,u.height=a,[u,i]}function fa(n,a){const{width:u,height:i}=da(n.width,n.height),[e,t]=Un(u,i);return a&&/jpe?g/.test(a)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(n,0,0,e.width,e.height),e}function Sn(){return Sn.cachedResult!==void 0||(Sn.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Sn.cachedResult}function Cn(n,a={}){return new Promise(function(u,i){let e,t;var f=function(){try{return t=fa(e,a.fileType||n.type),u([e,t])}catch(b){return i(b)}},c=function(b){try{var y=function(o){try{throw o}catch(l){return i(l)}};try{let o;return ca(n).then(function(l){try{return o=l,ua(o).then(function(s){try{return e=s,function(){try{return f()}catch(h){return i(h)}}()}catch(h){return y(h)}},y)}catch(s){return y(s)}},y)}catch(o){y(o)}}catch(o){return i(o)}};try{if(Sn()||[ht.DESKTOP_SAFARI,ht.MOBILE_SAFARI].includes(Gt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(n).then(function(b){try{return e=b,f()}catch{return c()}},c)}catch{c()}})}function Mn(n,a,u,i,e=1){return new Promise(function(t,f){let c;if(a==="image/png"){let y,o,l;return y=n.getContext("2d"),{data:o}=y.getImageData(0,0,n.width,n.height),l=At.encode([o.buffer],n.width,n.height,4096*e),c=new Blob([l],{type:a}),c.name=u,c.lastModified=i,b.call(this)}{let y=function(){return b.call(this)};if(a==="image/bmp")return new Promise(o=>sa.toBlob(n,o)).then(function(o){try{return c=o,c.name=u,c.lastModified=i,y.call(this)}catch(l){return f(l)}}.bind(this),f);{let o=function(){return y.call(this)};if(typeof OffscreenCanvas=="function"&&n instanceof OffscreenCanvas)return n.convertToBlob({type:a,quality:e}).then(function(l){try{return c=l,c.name=u,c.lastModified=i,o.call(this)}catch(s){return f(s)}}.bind(this),f);{let l;return l=n.toDataURL(a,e),hr(l,u,i).then(function(s){try{return c=s,o.call(this)}catch(h){return f(h)}}.bind(this),f)}}}function b(){return t(c)}})}function Ut(n){n.width=0,n.height=0}function an(){return new Promise(function(n,a){let u,i,e,t;return an.cachedResult!==void 0?n(an.cachedResult):hr("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(f){try{return u=f,Cn(u).then(function(c){try{return i=c[1],Mn(i,u.type,u.name,u.lastModified).then(function(b){try{return e=b,Ut(i),Cn(e).then(function(y){try{return t=y[0],an.cachedResult=t.width===1&&t.height===2,n(an.cachedResult)}catch(o){return a(o)}},a)}catch(y){return a(y)}},a)}catch(b){return a(b)}},a)}catch(c){return a(c)}},a)})}function va(n){return new Promise((a,u)=>{const i=new la;i.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return a(-2);const f=t.byteLength;let c=2;for(;c<f;){if(t.getUint16(c+2,!1)<=8)return a(-1);const b=t.getUint16(c,!1);if(c+=2,b==65505){if(t.getUint32(c+=2,!1)!=1165519206)return a(-1);const y=t.getUint16(c+=6,!1)==18761;c+=t.getUint32(c+4,y);const o=t.getUint16(c,y);c+=2;for(let l=0;l<o;l++)if(t.getUint16(c+12*l,y)==274)return a(t.getUint16(c+12*l+8,y))}else{if((65280&b)!=65280)break;c+=t.getUint16(c,!1)}}return a(-1)},i.onerror=e=>u(e),i.readAsArrayBuffer(n)})}function ma(n,a){const{width:u}=n,{height:i}=n,{maxWidthOrHeight:e}=a;let t,f=n;return isFinite(e)&&(u>e||i>e)&&([f,t]=Un(u,i),u>i?(f.width=e,f.height=i/u*e):(f.width=u/i*e,f.height=e),t.drawImage(n,0,0,f.width,f.height),Ut(n)),f}function ha(n,a){const{width:u}=n,{height:i}=n,[e,t]=Un(u,i);switch(a>4&&a<9?(e.width=i,e.height=u):(e.width=u,e.height=i),a){case 2:t.transform(-1,0,0,1,u,0);break;case 3:t.transform(-1,0,0,-1,u,i);break;case 4:t.transform(1,0,0,-1,0,i);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,i,0);break;case 7:t.transform(0,-1,-1,0,i,u);break;case 8:t.transform(0,-1,1,0,0,u)}return t.drawImage(n,0,0,u,i),Ut(n),e}function Lr(n,a,u=0){return new Promise(function(i,e){let t,f,c,b,y,o,l,s,h,v,C,F,D,H,I,E,U,g,k,d;function m(A=5){if(a.signal&&a.signal.aborted)throw a.signal.reason;t+=A,a.onProgress(Math.min(t,100))}function w(A){if(a.signal&&a.signal.aborted)throw a.signal.reason;t=Math.min(Math.max(A,t),100),a.onProgress(t)}return t=u,f=a.maxIteration||10,c=1024*a.maxSizeMB*1024,m(),Cn(n,a).then(function(A){try{return[,b]=A,m(),y=ma(b,a),m(),new Promise(function(S,R){var x;if(!(x=a.exifOrientation))return va(n).then(function(_){try{return x=_,O.call(this)}catch(p){return R(p)}}.bind(this),R);function O(){return S(x)}return O.call(this)}).then(function(S){try{return o=S,m(),an().then(function(R){try{return l=R?y:ha(y,o),m(),s=a.initialQuality||1,h=a.fileType||n.type,Mn(l,h,n.name,n.lastModified,s).then(function(x){try{{let _=function(){if(f--&&(I>c||I>D)){let z,T;return z=d?.95*k.width:k.width,T=d?.95*k.height:k.height,[U,g]=Un(z,T),g.drawImage(k,0,0,z,T),s*=h==="image/png"?.85:.95,Mn(U,h,n.name,n.lastModified,s).then(function(Y){try{return E=Y,Ut(k),k=U,I=E.size,w(Math.min(99,Math.floor((H-I)/(H-c)*100))),_}catch(Q){return e(Q)}},e)}return[1]},p=function(){return Ut(k),Ut(U),Ut(y),Ut(l),Ut(b),w(100),i(E)};if(v=x,m(),C=v.size>c,F=v.size>n.size,!C&&!F)return w(100),i(v);var O;return D=n.size,H=v.size,I=H,k=l,d=!a.alwaysKeepResolution&&C,(O=function(z){for(;z;){if(z.then)return void z.then(O,e);try{if(z.pop){if(z.length)return z.pop()?p.call(this):z;z=_}else z=z.call(this)}catch(T){return e(T)}}}.bind(this))(_)}}catch(_){return e(_)}}.bind(this),e)}catch(x){return e(x)}}.bind(this),e)}catch(R){return e(R)}}.bind(this),e)}catch(S){return e(S)}}.bind(this),e)})}const Cs=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Qn;function Ms(n,a){return new Promise((u,i)=>{Qn||(Qn=function(f){const c=[];return c.push(f),URL.createObjectURL(new Blob(c))}(Cs));const e=new Worker(Qn);e.addEventListener("message",function(f){if(a.signal&&a.signal.aborted)e.terminate();else if(f.data.progress===void 0){if(f.data.error)return i(new Error(f.data.error)),void e.terminate();u(f.data.file),e.terminate()}else a.onProgress(f.data.progress)}),e.addEventListener("error",i),a.signal&&a.signal.addEventListener("abort",()=>{i(a.signal.reason),e.terminate()}),e.postMessage({file:n,imageCompressionLibUrl:a.libURL,options:{...a,onProgress:void 0,signal:void 0}})})}function nt(n,a){return new Promise(function(u,i){let e,t,f,c,b,y;if(e={...a},f=0,{onProgress:c}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,b=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=h=>{f=h,typeof c=="function"&&c(f)},!(n instanceof Blob||n instanceof Ts))return i(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(n.type))return i(new Error("The file given is not an image"));if(y=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!b||typeof Worker!="function"||y)return Lr(n,e).then(function(h){try{return t=h,s.call(this)}catch(v){return i(v)}}.bind(this),i);var o=function(){try{return s.call(this)}catch(h){return i(h)}}.bind(this),l=function(h){try{return Lr(n,e).then(function(v){try{return t=v,o()}catch(C){return i(C)}},i)}catch(v){return i(v)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Ms(n,e).then(function(h){try{return t=h,o()}catch{return l()}},l)}catch{l()}function s(){try{t.name=n.name,t.lastModified=n.lastModified}catch{}try{e.preserveExif&&n.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===n.type)&&(t=ia(n,t))}catch{}return u(t)}})}nt.getDataUrlFromFile=ca,nt.getFilefromDataUrl=hr,nt.loadImage=ua,nt.drawImageInCanvas=fa,nt.drawFileInCanvas=Cn,nt.canvasToFile=Mn,nt.getExifOrientation=va,nt.handleMaxWidthOrHeight=ma,nt.followExifOrientation=ha,nt.cleanupCanvasMemory=Ut,nt.isAutoOrientationInBrowser=an,nt.approximateBelowMaximumCanvasSizeOfBrowser=da,nt.copyExifWithoutOrientation=ia,nt.getBrowserName=Gt,nt.version="2.0.2";const Rs={maxSizeMB:.8,maxWidthOrHeight:2400,initialQuality:.9,useWebWorker:!0,compressionThresholdMB:1};async function Us(n,a,u={},i){const e={...Rs,...u};try{let t=n;if(n.type.startsWith("image/")&&n.size>e.compressionThresholdMB*1024*1024){i?.("Compressing image...");try{const b=await nt(n,{maxSizeMB:e.maxSizeMB,maxWidthOrHeight:e.maxWidthOrHeight,initialQuality:e.initialQuality,useWebWorker:e.useWebWorker});t=b;const y=(n.size/(1024*1024)).toFixed(2),o=(b.size/(1024*1024)).toFixed(2),l=((1-b.size/n.size)*100).toFixed(0);console.log(`Image compressed: ${y}MB → ${o}MB (${l}% smaller)`)}catch(b){console.warn("Image compression failed, uploading original:",b)}}return i?.("Uploading file..."),{success:!0,attachment:await Jr(t,a)}}catch(t){return console.error("File upload failed:",t),{success:!1,error:t instanceof Error?t.message:"Upload failed"}}}async function Os(n){try{const a=ur(n.url);return await ea(a),!0}catch(a){return console.error("Failed to remove attachment:",a),!1}}function Fs(n,a,u){return n.map(i=>i.id===a?{...i,name:u}:i)}function Ns(n,a=5){const u=n.type.startsWith("image/"),i=a*1024*1024;if(!u&&n.size>i){const e=(n.size/1048576).toFixed(2);return{valid:!1,error:`Non-image files must be under ${a}MB (selected file is ${e}MB)`}}return{valid:!0}}function Ps(n){return{uploadAttachment:(a,u,i)=>Us(a,u,n,i),removeAttachment:Os,updateAttachmentName:Fs,validateFile:Ns}}function Br(n,a){const[u,i]=a.split(":").map(Number);let e=ri(n,u);return e=ai(e,i),e}function Hr(n){return Array.from(new Set(n)).sort((a,u)=>a-u)}function Ys(n,a){if(a.includes(n))return 0;const u=a.find(i=>i>n);return u!==void 0?u-n:7-n+a[0]}function Ls(n,a,u){const i=new Date(n),e=Xt(i,ft),t=e.getDay(),f=Ys(t,u);if(f===0)return{start_time:n,end_time:a};const c=_n(e,f),b=qt(c,ft);let y=a;if(a){const o=Xt(new Date(a),ft),l=_n(o,f);y=qt(l,ft).toISOString()}return{start_time:b.toISOString(),end_time:y}}function pa({eventItem:n,dateInput:a,startTimeInput:u,endTimeInput:i,attachments:e,isRecurring:t,recurrenceFrequency:f,recurrenceInterval:c,recurringDays:b,recurrenceEndDate:y,hasEndDate:o,monthlyType:l}){const s=!n.id,h={...n.meta_data??{}};if(n.organization){h.organization=n.organization;const g=Ii(n.organization);g?.label&&(h.organization_label=g.label)}const v=Rn(),C=v?pn(v.stores.currentUser):void 0;if(s){const g=v?pn(v.stores.userOrganizations):void 0,k=C?.displayName||C?.username,d=C?.id;k&&!h.submitted_by_name&&(h.submitted_by_name=k),d&&!h.submitted_by_user_id&&(h.submitted_by_user_id=d);const m=g?Array.from(g):[];m.length&&!h.submitted_by_organizations&&(h.submitted_by_organizations=m),h.submitted_at||(h.submitted_at=new Date().toISOString())}else{const g=C?.displayName||C?.username;g&&(h.edited_by_name=g),C?.id&&(h.edited_by_user_id=C.id),h.edited_at=new Date().toISOString()}const F=Object.keys(h).length?h:void 0,D={title:n.title,description:n.description,location:n.location,is_public:n.is_public??!0,event_type:n.event_type,meta_data:F,attachments:e.length>0?e:null};if(n.event_type!=="calendar_event")return{...D,start_time:void 0,end_time:void 0,is_all_day:void 0,recurrence_rule:void 0,recurrence_end_date:void 0};const H=a?An(a,"yyyy-MM-dd",new Date):new Date;let I,E;if(n.is_all_day){const g=qt(H,ft);I=g.toISOString(),E=g.toISOString()}else{const g=new Date(H.getTime()),k=new Date(H.getTime()),d=u?Br(g,u):H,m=i?Br(k,i):H;I=qt(d,ft).toISOString(),E=qt(m,ft).toISOString()}const U={...D,start_time:I,end_time:E,is_all_day:n.is_all_day};if(t&&U.start_time){if(f==="weekly"&&b.length>0){const k=Hr(b),d=Ls(U.start_time,U.end_time,k);U.start_time=d.start_time,U.end_time=d.end_time}if(f==="daily"||f==="yearly"||f==="weekly"&&b.length>0||f==="monthly"){const{recurrence_rule:k,recurrence_end_date:d}=vr({frequency:f,interval:c,recurringDays:f==="weekly"?Hr(b):[],recurrenceEndDate:y,hasEndDate:o,monthlyType:l,startTime:U.start_time});U.recurrence_rule=k,U.recurrence_end_date=d}else U.recurrence_rule=void 0,U.recurrence_end_date=void 0}else U.recurrence_rule=void 0,U.recurrence_end_date=void 0;return U}async function Bs({id:n,...a}){const u=pa(a);return n?(a.eventItem.bishop_approval==="NO"&&Object.assign(u,{bishop_approval:null,bishop_approval_at:null,bishop_approval_by_user_id:null,first_counselor_approval:null,first_counselor_approval_at:null,first_counselor_approval_by_user_id:null,second_counselor_approval:null,second_counselor_approval_at:null,second_counselor_approval_by_user_id:null}),{action:"update",event:await Tt(n,u)}):{action:"create",event:await lr(u)}}async function Hs(n){await cr(n)}function zs({event:n,newDate:a}){const u=n.start_time?new Date(n.start_time):new Date,i=n.end_time?new Date(n.end_time):new Date,[e,t,f]=a.split("-").map(Number),c=new Date(u);c.setFullYear(e,t-1,f);const b=new Date(i);return b.setFullYear(e,t-1,f),{...n,id:void 0,title:`CLONED - ${n.title}`,start_time:c.toISOString(),end_time:b.toISOString(),attachments:[],recurrence_rule:void 0,recurrence_end_date:void 0}}async function Ws(n,a,u){const i=await en(n);if(!i)throw new Error("Event not found");const e=i.recurrence_exceptions||[];e.includes(a)||e.push(a);const t=i.recurrence_overrides||{};t[a]={title:u.title,description:u.description,location:u.location,start_time:u.start_time,end_time:u.end_time,is_all_day:u.is_all_day,meta_data:u.meta_data},await Tt(n,{recurrence_exceptions:e,recurrence_overrides:t})}async function js(n,a,u){const i=await en(n);if(!i||!i.recurrence_rule||!i.start_time)throw new Error("Event not found or is not recurring");const{parseRecurrenceRule:e,generateRecurrenceRule:t}=await hn(async()=>{const{parseRecurrenceRule:I,generateRecurrenceRule:E}=await Promise.resolve().then(()=>tr);return{parseRecurrenceRule:I,generateRecurrenceRule:E}},void 0,import.meta.url),f=e(i.recurrence_rule,i.recurrence_end_date);if(!f)throw new Error("Failed to parse recurrence rule");const c=Ne(new Date(i.start_time),"yyyy-MM-dd"),b=An(a,"yyyy-MM-dd",new Date),y=An(c,"yyyy-MM-dd",new Date);if(b<=y)return await Tt(n,u),n;const o=_n(b,-1),l=Ne(o,"yyyy-MM-dd"),{recurrence_rule:s,recurrence_end_date:h}=t({frequency:f.frequency,interval:f.interval,recurringDays:f.recurringDays,recurrenceEndDate:l,hasEndDate:!0,monthlyType:f.monthlyType,startTime:i.start_time});await Tt(n,{recurrence_rule:s,recurrence_end_date:h});const v=f.hasEndDate?f.recurrenceEndDate:"",{recurrence_rule:C,recurrence_end_date:F}=t({frequency:f.frequency,interval:f.interval,recurringDays:f.recurringDays,recurrenceEndDate:v,hasEndDate:f.hasEndDate,monthlyType:f.monthlyType,startTime:u.start_time||i.start_time}),D={...u,recurrence_rule:C,recurrence_end_date:F};return(await lr(D))?.id||0}async function qs(n,a){const u=await en(n);if(!u)throw new Error("Event not found");const i={title:a.title,description:a.description,location:a.location,event_type:a.event_type,meta_data:a.meta_data,attachments:a.attachments,is_all_day:a.is_all_day,start_time:u.start_time,end_time:u.end_time,recurrence_rule:u.recurrence_rule,recurrence_end_date:u.recurrence_end_date,recurrence_exceptions:[],recurrence_overrides:{}};await Tt(n,i)}async function $s(n,a){const u=await en(n);if(!u)throw new Error("Event not found");const i=u.recurrence_exceptions||[];i.includes(a)||i.push(a);const e=u.recurrence_overrides||{};e[a]&&delete e[a],await Tt(n,{recurrence_exceptions:i,recurrence_overrides:e})}async function Qs(n,a){const u=await en(n);if(!u||!u.recurrence_rule||!u.start_time)throw new Error("Event not found or is not recurring");const i=An(a,"yyyy-MM-dd",new Date),e=_n(i,-1),t=Ne(e,"yyyy-MM-dd"),{parseRecurrenceRule:f}=await hn(async()=>{const{parseRecurrenceRule:l}=await Promise.resolve().then(()=>tr);return{parseRecurrenceRule:l}},void 0,import.meta.url),c=f(u.recurrence_rule,u.recurrence_end_date);if(!c)throw new Error("Failed to parse recurrence rule");const{generateRecurrenceRule:b}=await hn(async()=>{const{generateRecurrenceRule:l}=await Promise.resolve().then(()=>tr);return{generateRecurrenceRule:l}},void 0,import.meta.url),{recurrence_rule:y,recurrence_end_date:o}=b({frequency:c.frequency,interval:c.interval,recurringDays:c.recurringDays,recurrenceEndDate:t,hasEndDate:!0,monthlyType:c.monthlyType,startTime:u.start_time});await Tt(n,{recurrence_rule:y,recurrence_end_date:o})}async function Ks(n){await cr(n)}function Vs(){return{saveEvent:Bs,deleteEventById:Hs,cloneEventForDate:zs,buildEventPayload:pa,saveSingleInstance:Ws,saveFutureInstances:js,saveAllInstances:qs,deleteSingleInstance:$s,deleteFutureInstances:Qs,deleteAllInstances:Ks}}var Zs=re('<div class="d-flex justify-content-center py-3"><!></div>'),Gs=re('<div class="text-muted text-center py-3 small">No messages yet</div>'),Xs=re('<div class="message-meta text-muted mt-1 text-end svelte-12d50yj"><div> </div> <div> </div></div>'),Js=re('<div class="message-meta text-muted mt-1 text-end svelte-12d50yj"> </div>'),eo=re('<i class="bi bi-trash"></i>'),to=re('<button type="button" class="btn btn-link btn-sm text-danger p-0 mt-1 delete-btn d-block ms-auto svelte-12d50yj" title="Delete message"><!></button>'),no=re('<div><div><div class="message-text svelte-12d50yj"> </div> <!> <!></div></div>'),ro=re('<i class="bi bi-send"></i>'),ao=re('<div class="messages-container svelte-12d50yj"><!></div> <div class="input-area d-flex gap-2 pt-2 svelte-12d50yj"><textarea class="form-control svelte-12d50yj" rows="2" placeholder="Type a message..."></textarea> <button type="button" class="btn btn-primary btn-sm align-self-end" title="Send message"><!></button></div>',1),io=re("<div><!></div>");function nr(n,a){Ct(a,!1);let u=se(a,"comments",24,()=>[]),i=se(a,"currentUserId",8),e=se(a,"onSend",8),t=se(a,"onDelete",8),f=se(a,"loading",8,!1),c=se(a,"disabled",8,!1),b=se(a,"fullHeight",8,!1),y=X(""),o=X(!1),l=X(null),s=X();function h(){r(s)&&requestAnimationFrame(()=>{Dn(s,r(s).scrollTop=r(s).scrollHeight)})}function v(d){try{return ni(Zt(d),{addSuffix:!0})}catch{return""}}function C(d){return d.user_id===i()}async function F(){const d=r(y).trim();if(!(!d||r(o)||c())){M(o,!0);try{await e()(d),M(y,""),h()}catch(m){console.error("Failed to send message:",m)}finally{M(o,!1)}}}async function D(d){if(!(r(l)||c())){M(l,d);try{await t()(d)}catch(m){console.error("Failed to delete message:",m)}finally{M(l,null)}}}function H(d){d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),F())}Ce(()=>le(u()),()=>{u().length&&h()}),Jt(),Ot();var I=io();let E;var U=B(I);{var g=d=>{var m=Zs(),w=B(m);jt(w,{size:"sm"}),L(m),te(d,m)},k=d=>{var m=ao(),w=bt(m),A=B(w);{var S=Y=>{var Q=Gs();te(Y,Q)},R=Y=>{var Q=Wa(),$=bt(Q);bn($,1,u,q=>q.id,(q,P)=>{const N=rt(()=>(r(P),ee(()=>C(r(P)))));var K=no();let ne;var G=B(K);let V;var ae=B(G),xe=B(ae,!0);L(ae);var ye=j(ae,2);{var Ie=ce=>{var ie=Xs(),fe=B(ie),Ee=B(fe,!0);L(fe);var me=j(fe,2),ue=B(me,!0);L(me),L(ie),de(_e=>{ge(Ee,(r(P),ee(()=>r(P).user_display_name))),ge(ue,_e)},[()=>(r(P),ee(()=>v(r(P).created_at)))]),te(ce,ie)},Ae=ce=>{var ie=Js(),fe=B(ie,!0);L(ie),de(Ee=>ge(fe,Ee),[()=>(r(P),ee(()=>v(r(P).created_at)))]),te(ce,ie)};he(ye,ce=>{r(N)?ce(Ae,!1):ce(Ie)})}var ve=j(ye,2);{var Me=ce=>{var ie=to(),fe=B(ie);{var Ee=ue=>{jt(ue,{size:"xs"})},me=ue=>{var _e=eo();te(ue,_e)};he(fe,ue=>{r(l),r(P),ee(()=>r(l)===r(P).id)?ue(Ee):ue(me,!1)})}L(ie),de(()=>ie.disabled=(r(l),r(P),ee(()=>r(l)===r(P).id))),Se("click",ie,()=>D(r(P).id)),te(ce,ie)};he(ve,ce=>{r(N)&&ce(Me)})}L(G),L(K),de(()=>{ne=Qe(K,1,"d-flex mb-2",null,ne,{"justify-content-end":r(N),"justify-content-start":!r(N)}),V=Qe(G,1,"message-bubble svelte-12d50yj",null,V,{own:r(N),other:!r(N)}),ge(xe,(r(P),ee(()=>r(P).message)))}),te(q,K)}),te(Y,Q)};he(A,Y=>{le(u()),ee(()=>u().length===0)?Y(S):Y(R,!1)})}L(w),Lt(w,Y=>M(s,Y),()=>r(s));var x=j(w,2),O=B(x);zr(O);var _=j(O,2),p=B(_);{var z=Y=>{jt(Y,{size:"xs"})},T=Y=>{var Q=ro();te(Y,Q)};he(p,Y=>{r(o)?Y(z):Y(T,!1)})}L(_),L(x),de(Y=>{O.disabled=c()||r(o),_.disabled=Y},[()=>(le(c()),r(o),r(y),ee(()=>c()||r(o)||!r(y).trim()))]),kt(O,()=>r(y),Y=>M(y,Y)),Se("keydown",O,H),Se("click",_,F),te(d,m)};he(U,d=>{f()?d(g):d(k,!1)})}L(I),de(()=>E=Qe(I,1,"chat-thread d-flex flex-column svelte-12d50yj",null,E,{"chat-thread-full":b()})),te(n,I),Mt()}async function so(n){const{data:a,error:u}=await Pe.from("event_bishopric_comments").select("*").eq("event_id",n).order("created_at",{ascending:!0});if(u)throw u;return a??[]}async function oo(n,a,u,i){const{data:e,error:t}=await Pe.from("event_bishopric_comments").insert([{event_id:n,user_id:a,user_display_name:u,message:i}]).select().single();if(t)throw t;return e}async function lo(n){const{error:a}=await Pe.from("event_bishopric_comments").delete().eq("id",n);if(a)throw a}async function _a(n){const{data:a,error:u}=await Pe.from("event_submitter_comments").select("*").eq("event_id",n).order("created_at",{ascending:!0});if(u)throw u;return a??[]}async function ba(n,a,u,i){const{data:e,error:t}=await Pe.from("event_submitter_comments").insert([{event_id:n,user_id:a,user_display_name:u,message:i}]).select().single();if(t)throw t;return e}async function ga(n){const{error:a}=await Pe.from("event_submitter_comments").delete().eq("id",n);if(a)throw a}const co=`${$r}/functions/v1/calendar-approval-reply`;async function ya(n){if(!(typeof fetch>"u"))try{const a=await fetch(co,{method:"POST",headers:Qr(!0,{useAuthToken:!0}),body:JSON.stringify(n)});a.ok||console.error("Failed to send approval reply notification:",await a.text())}catch(a){console.error("Error sending approval reply notification:",a)}}function uo(n,a,u){return ya({event_id:n,action:"vote",role:a,status:u})}function fo(n,a){return ya({event_id:n,action:a})}var vo=re("<span> </span>"),mo=re('<div class="alert alert-info mb-0" role="alert">Save this event or announcement before requesting bishopric approvals.</div>'),ho=re('<span class="badge bg-secondary-subtle text-secondary-emphasis"> </span>'),po=re('<span class="badge bg-secondary-subtle text-secondary-emphasis"> </span>'),_o=re('<div class="card"><button type="button" class="btn btn-link text-start text-decoration-none d-flex align-items-center gap-3 p-3 w-100 chat-toggle svelte-jfsv9u"><i class="bi bi-chat-dots"></i> <div class="d-flex flex-column align-items-start"><span class="fw-semibold">Bishopric Discussion</span> <small class="text-muted">Private notes between bishopric members</small></div> <div class="ms-auto d-flex align-items-center gap-2"><!> <i class="bi bi-chevron-right"></i></div></button></div> <!> <div class="card"><button type="button" class="btn btn-link text-start text-decoration-none d-flex align-items-center gap-3 p-3 w-100 chat-toggle svelte-jfsv9u"><i class="bi bi-chat-left-dots"></i> <div class="d-flex flex-column align-items-start"><span class="fw-semibold">Discussion with Submitter</span> <small class="text-muted"> </small></div> <div class="ms-auto d-flex align-items-center gap-2"><!> <i class="bi bi-chevron-right"></i></div></button></div> <!>',1),bo=re('<small class="text-muted"> </small>'),go=re("<span><!></span>"),yo=re('<div class="decision-buttons d-grid gap-2 gap-md-3 svelte-jfsv9u"><button type="button"><i class="bi bi-check-circle-fill"></i> <div><div class="action-label svelte-jfsv9u">Approve</div> <small class="text-muted">Vote to approve</small></div></button> <button type="button"><i class="bi bi-pencil-square"></i> <div><div class="action-label svelte-jfsv9u">Request Changes</div> <small class="text-muted">Ask submitter to revise</small></div></button> <button type="button"><i class="bi bi-hourglass-split"></i> <div><div class="action-label svelte-jfsv9u">Mark Pending</div> <small class="text-muted">No decision yet</small></div></button> <!></div>'),wo=re("<span> </span>"),xo=re('<div class="list-group-item"><div class="d-flex flex-column gap-2"><div><div class="fw-semibold"> </div> <!></div> <div><!></div></div></div>'),Do=re('<i class="bi bi-globe-americas"></i>'),Eo=re('<button type="button" class="btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center gap-2"><!> Unpublish</button>'),So=re('<i class="bi bi-globe"></i>'),Ao=re('<small class="text-muted text-center">At least one approval required to publish</small>'),Io=re('<button type="button" class="btn btn-success w-100 d-flex align-items-center justify-content-center gap-2"><!> Publish to Ward</button> <!>',1),ko=re('<div class="card-footer text-danger small"> </div>'),To=re('<!> <div class="card"><div class="list-group list-group-flush"></div> <div class="publish-section d-flex flex-column gap-2 p-3 svelte-jfsv9u"><div class="d-flex justify-content-between align-items-center"><span class="text-muted small fw-semibold"> </span></div> <!></div> <!></div>',1),Co=re('<div class="d-flex flex-column gap-3"><div class="d-flex flex-wrap align-items-center justify-content-between gap-2"><h3 class="h5 mb-0">Bishopric Approval</h3> <!></div> <!></div>');function Mo(n,a){Ct(a,!1);const u=()=>En(w,"$currentUserStore",i),[i,e]=qr(),t=X(),f=X(),c=X(),b=X(),y=X(),o=X(),l=X(),s=X(),h=X(),v=X(),C=X(),F=X(),D=X(),H=X();let I=se(a,"eventItem",12),E=se(a,"disabled",8,!1),U=se(a,"reloadEvents",8,null);const g={bishop:"bishopric-bishop",first_counselor:"bishopric-first-counselor",second_counselor:"bishopric-second-counselor"},k={pending:{text:"Pending Approval",class:"bg-warning-subtle text-warning-emphasis"},approved:{text:"Approved",class:"bg-success-subtle text-success-emphasis"},needs_review:{text:"Needs Review",class:"bg-info-subtle text-info-emphasis"},published:{text:"Published",class:"bg-primary-subtle text-primary-emphasis"}},d=Rn()??null,m=Wr(Qa),w=d?.stores.currentUser??m,A=["bishop","first_counselor","second_counselor"];let S=X(""),R=X(null),x=X(!1),O=X([]),_=X(!1),p=!1;const z=`bishopric-chat-${Zn()}`;let T=X(null),Y=X([]),Q=X(!1),$=!1;const q=`submitter-chat-${Zn()}`;let P=null;rr(async()=>{typeof window<"u"&&(P=(await hn(()=>import("./tUu8UEjF.js").then(oe=>oe.o),__vite__mapDeps([0,1]),import.meta.url)).default)});function N(){if(!P)return;const J=document.getElementById(z);if(!J)return;P.getOrCreateInstance(J).show()}function K(){if(!P)return;const J=document.getElementById(q);if(!J)return;P.getOrCreateInstance(J).show()}function ne(J){const oe=g[J];return r(t)?.roles?.includes(oe)??!1}function G(J){if(!J)return null;try{return Ne(Zt(J),"MMM d, yyyy 'at' h:mm a")}catch(oe){return console.error("Failed to format timestamp",oe),null}}async function V(){typeof U()=="function"&&await U()()}async function ae(J,oe){const ke=I()?.id;if(ke!=null){M(S,""),M(R,J);try{const $e=await Zr(ke,J,oe,r(t)?.id);$e&&(I({...I(),bishop_approval:$e.bishop_approval,first_counselor_approval:$e.first_counselor_approval,second_counselor_approval:$e.second_counselor_approval,bishop_approval_at:$e.bishop_approval_at,first_counselor_approval_at:$e.first_counselor_approval_at,second_counselor_approval_at:$e.second_counselor_approval_at,bishop_approval_by_user_id:$e.bishop_approval_by_user_id,first_counselor_approval_by_user_id:$e.first_counselor_approval_by_user_id,second_counselor_approval_by_user_id:$e.second_counselor_approval_by_user_id,is_published:$e.is_published}),uo(ke,J,oe)),await V()}catch($e){console.error("Failed to update approval",$e),M(S,"Unable to update approval. Please try again.")}finally{M(R,null)}}}async function xe(J){await ae(J,null)}async function ye(){const J=I()?.id;if(J!=null){M(S,""),M(x,!0);try{const oe=r(o)?"unpublished":"published",ke=r(o)?await Xr(J):await Gr(J);ke&&(I({...I(),is_published:ke.is_published}),fo(J,oe)),await V()}catch(oe){console.error("Failed to update publish status",oe),M(S,"Unable to update publish status. Please try again.")}finally{M(x,!1)}}}let Ie=null,Ae=null;function ve(){M(O,[]),p=!1,M(_,!1),M(Y,[]),$=!1,M(Q,!1)}jr(()=>{ce(),ue()});function Me(J){const oe=J??I()?.id??null;if(Ie||!oe)return;const ke=typeof window<"u"?localStorage.getItem("authToken"):null;ke&&Pe.realtime.setAuth(ke),Ie=Pe.channel(`bishopric-comments-${oe}`).on("postgres_changes",{event:"*",schema:"public",table:"event_bishopric_comments",filter:`event_id=eq.${oe}`},()=>{ie(oe)}).subscribe()}function ce(){Ie&&(Pe.removeChannel(Ie),Ie=null)}async function ie(J){const oe=J??I()?.id??null;if(oe){p||M(_,!0);try{const ke=await so(oe);oe===(I()?.id??null)&&(M(O,ke),p=!0)}catch(ke){console.error("Failed to load bishopric comments:",ke)}finally{oe===(I()?.id??null)&&M(_,!1)}}}async function fe(J){if(!I()?.id||!r(t)?.id)return;const oe=r(t).displayName||r(t).username||"Unknown";await oo(I().id,r(t).id,oe,J),await ie()}async function Ee(J){await lo(J),await ie()}function me(J){const oe=J??I()?.id??null;if(Ae||!oe)return;const ke=typeof window<"u"?localStorage.getItem("authToken"):null;ke&&Pe.realtime.setAuth(ke),Ae=Pe.channel(`submitter-comments-${oe}`).on("postgres_changes",{event:"*",schema:"public",table:"event_submitter_comments",filter:`event_id=eq.${oe}`},()=>{_e(oe)}).subscribe()}function ue(){Ae&&(Pe.removeChannel(Ae),Ae=null)}async function _e(J){const oe=J??I()?.id??null;if(oe){$||M(Q,!0);try{const ke=await _a(oe);oe===(I()?.id??null)&&(M(Y,ke),$=!0)}catch(ke){console.error("Failed to load submitter comments:",ke)}finally{oe===(I()?.id??null)&&M(Q,!1)}}}async function pe(J){if(!I()?.id||!r(t)?.id)return;const oe=r(t).displayName||r(t).username||"Unknown";await ba(I().id,r(t).id,oe,J),await _e()}async function Re(J){await ga(J),await _e()}function Be(J){return J==="YES"?{text:"Approved",class:"bg-success-subtle text-success-emphasis"}:J==="NO"?{text:"Requested Changes",class:"bg-info-subtle text-info-emphasis"}:{text:"No Input Yet",class:"bg-secondary-subtle text-secondary-emphasis"}}const He="btn btn-sm action-btn w-100 text-start d-flex align-items-center gap-2";function Ye(J){return`${He} ${J==="YES"?"btn-success text-white":"btn-outline-success"}`}function wt(J){return`${He} ${J==="NO"?"btn-info text-dark":"btn-outline-info"}`}function Fe(J){const oe=J==null;return`${He} ${oe?"btn-secondary text-white":"btn-outline-secondary"}`}Ce(()=>u(),()=>{M(t,u())}),Ce(()=>le(I()),()=>{M(f,Ui(I()))}),Ce(()=>r(f),()=>{M(c,k[r(f)])}),Ce(()=>le(I()),()=>{M(b,fr(I()))}),Ce(()=>le(I()),()=>{M(y,Ri(I()))}),Ce(()=>le(I()),()=>{M(o,I()?.is_published??!1)}),Ce(()=>le(I()),()=>{M(l,{bishop:I()?.bishop_approval,first_counselor:I()?.first_counselor_approval,second_counselor:I()?.second_counselor_approval})}),Ce(()=>le(I()),()=>{M(s,{bishop:I()?.bishop_approval_at,first_counselor:I()?.first_counselor_approval_at,second_counselor:I()?.second_counselor_approval_at})}),Ce(()=>r(t),()=>{M(h,r(t)?.roles?.includes("bishopric-bishop")??!1)}),Ce(()=>r(t),()=>{M(v,r(t)?.roles?.includes("bishopric-first-counselor")??!1)}),Ce(()=>r(t),()=>{M(C,r(t)?.roles?.includes("bishopric-second-counselor")??!1)}),Ce(()=>(r(h),r(v),r(C)),()=>{M(F,r(h)||r(v)||r(C))}),Ce(()=>{},()=>{M(D,A)}),Ce(()=>(le(I()),r(T)),()=>{const J=I()?.id??null;J&&J!==r(T)?(M(T,J),ve(),ce(),ue(),ie(J),_e(J),Me(J),me(J)):!J&&r(T)!==null&&(M(T,null),ve(),ce(),ue())}),Ce(()=>le(I()),()=>{M(H,I()?.meta_data?.submitted_by_name??"Submitter")}),Jt(),Ot();var We=Co(),je=B(We),it=j(B(je),2);{var Ke=J=>{var oe=vo(),ke=B(oe,!0);L(oe),de(()=>{Qe(oe,1,(r(c),ee(()=>`badge ${r(c).class}`)),"svelte-jfsv9u"),ge(ke,(r(c),ee(()=>r(c).text)))}),te(J,oe)};he(it,J=>{le(I()),ee(()=>I()?.id)&&J(Ke)})}L(je);var st=j(je,2);{var Ft=J=>{var oe=mo();te(J,oe)},on=J=>{var oe=To(),ke=bt(oe);{var $e=Ze=>{var we=_o(),ze=bt(we),vt=B(ze),gt=j(B(vt),4),Ge=B(gt);{var St=qe=>{var lt=ho(),Nt=B(lt,!0);L(lt),de(()=>ge(Nt,(r(O),ee(()=>r(O).length)))),te(qe,lt)};he(Ge,qe=>{r(O),ee(()=>r(O).length>0)&&qe(St)})}at(2),L(gt),L(vt),L(ze);var Bt=j(ze,2);{let qe=rt(()=>(le(I()),ee(()=>I()?.title||"Event")));Gn(Bt,{get id(){return z},subtitle:"Discussion",get title(){return r(qe)},className:"chat-drawer-stacked",bodyClass:"overflow-hidden d-flex flex-column",children:(lt,Nt)=>{{let yt=rt(()=>(r(t),ee(()=>r(t)?.id??-1)));nr(lt,{get comments(){return r(O)},get currentUserId(){return r(yt)},onSend:fe,onDelete:Ee,get loading(){return r(_)},fullHeight:!0,get disabled(){return E()}})}},$$slots:{default:!0}})}var Xe=j(Bt,2),_t=B(Xe),Ht=j(B(_t),2),tn=j(B(Ht),2),nn=B(tn,!0);L(tn),L(Ht);var tt=j(Ht,2),et=B(tt);{var ot=qe=>{var lt=po(),Nt=B(lt,!0);L(lt),de(()=>ge(Nt,(r(Y),ee(()=>r(Y).length)))),te(qe,lt)};he(et,qe=>{r(Y),ee(()=>r(Y).length>0)&&qe(ot)})}at(2),L(tt),L(_t),L(Xe);var mt=j(Xe,2);{let qe=rt(()=>(le(I()),ee(()=>I()?.title||"Event")));Gn(mt,{get id(){return q},subtitle:"Discussion with Submitter",get title(){return r(qe)},className:"chat-drawer-stacked",bodyClass:"overflow-hidden d-flex flex-column",children:(lt,Nt)=>{{let yt=rt(()=>(r(t),ee(()=>r(t)?.id??-1)));nr(lt,{get comments(){return r(Y)},get currentUserId(){return r(yt)},onSend:pe,onDelete:Re,get loading(){return r(Q)},fullHeight:!0,get disabled(){return E()}})}},$$slots:{default:!0}})}de(()=>{Oe(vt,"aria-controls",z),Oe(_t,"aria-controls",q),ge(nn,r(H))}),Se("click",vt,N),Se("click",_t,K),te(Ze,we)};he(ke,Ze=>{r(F)&&Ze($e)})}var pt=j(ke,2),Ve=B(pt);bn(Ve,5,()=>r(D),ar,(Ze,we)=>{var ze=xo(),vt=B(ze),gt=B(vt),Ge=B(gt),St=B(Ge,!0);L(Ge);var Bt=j(Ge,2);{var Xe=tt=>{var et=bo(),ot=B(et,!0);L(et),de(mt=>ge(ot,mt),[()=>(r(s),r(we),ee(()=>G(r(s)[r(we)])))]),te(tt,et)};he(Bt,tt=>{r(s),r(we),ee(()=>r(s)[r(we)])&&tt(Xe)})}L(gt);var _t=j(gt,2),Ht=B(_t);{var tn=tt=>{var et=yo(),ot=B(et),mt=j(ot,2),qe=j(mt,2),lt=j(qe,2);{var Nt=yt=>{var Pt=go(),ln=B(Pt);jt(ln,{size:"xs"}),L(Pt),te(yt,Pt)};he(lt,yt=>{r(R)===r(we)&&yt(Nt)})}L(et),de((yt,Pt,ln)=>{Qe(ot,1,yt,"svelte-jfsv9u"),ot.disabled=E()||r(R)===r(we),Qe(mt,1,Pt,"svelte-jfsv9u"),mt.disabled=E()||r(R)===r(we),Qe(qe,1,ln,"svelte-jfsv9u"),qe.disabled=E()||r(R)===r(we)},[()=>Bn((r(l),r(we),ee(()=>Ye(r(l)[r(we)])))),()=>Bn((r(l),r(we),ee(()=>wt(r(l)[r(we)])))),()=>Bn((r(l),r(we),ee(()=>Fe(r(l)[r(we)]))))]),Se("click",ot,()=>ae(r(we),"YES")),Se("click",mt,()=>ae(r(we),"NO")),Se("click",qe,()=>xe(r(we))),te(tt,et)},nn=tt=>{const et=rt(()=>(r(l),r(we),ee(()=>Be(r(l)[r(we)]))));var ot=wo(),mt=B(ot,!0);L(ot),de(()=>{Qe(ot,1,(le(r(et)),ee(()=>`badge ${r(et).class}`)),"svelte-jfsv9u"),ge(mt,(le(r(et)),ee(()=>r(et).text)))}),te(tt,ot)};he(Ht,tt=>{r(we),ee(()=>ne(r(we)))?tt(tn):tt(nn,!1)})}L(_t),L(vt),L(ze),de(()=>ge(St,(le(Nr),r(we),ee(()=>Nr[r(we)])))),te(Ze,ze)}),L(Ve);var Te=j(Ve,2),xt=B(Te),Qt=B(xt),Dt=B(Qt);L(Qt),L(xt);var Et=j(xt,2);{var On=Ze=>{var we=Eo(),ze=B(we);{var vt=Ge=>{jt(Ge,{size:"xs"})},gt=Ge=>{var St=Do();te(Ge,St)};he(ze,Ge=>{r(x)?Ge(vt):Ge(gt,!1)})}at(),L(we),de(()=>we.disabled=E()||r(x)),Se("click",we,ye),te(Ze,we)},Fn=Ze=>{var we=Io(),ze=bt(we),vt=B(ze);{var gt=Xe=>{jt(Xe,{size:"xs"})},Ge=Xe=>{var _t=So();te(Xe,_t)};he(vt,Xe=>{r(x)?Xe(gt):Xe(Ge,!1)})}at(),L(ze);var St=j(ze,2);{var Bt=Xe=>{var _t=Ao();te(Xe,_t)};he(St,Xe=>{r(y)||Xe(Bt)})}de(()=>{ze.disabled=E()||r(x)||!r(y),Oe(ze,"title",r(y)?"":"At least one approval required to publish")}),Se("click",ze,ye),te(Ze,we)};he(Et,Ze=>{r(o)?Ze(On):Ze(Fn,!1)})}L(Te);var Nn=j(Te,2);{var Pn=Ze=>{var we=ko(),ze=B(we,!0);L(we),de(()=>ge(ze,r(S))),te(Ze,we)};he(Nn,Ze=>{r(S)&&Ze(Pn)})}L(pt),de(()=>ge(Dt,`Approvals: ${r(b)??""} of 3`)),te(J,oe)};he(st,J=>{le(I()),ee(()=>!I()?.id)?J(Ft):J(on,!1)})}L(We),te(n,We),Mt(),e()}const Ro=`${$r}/functions/v1/calendar-approval-notify`;async function Uo(n,a){if(!(!n||typeof fetch>"u"))try{const u=await fetch(Ro,{method:"POST",headers:Qr(!0,{useAuthToken:!0}),body:JSON.stringify({event_id:n,reason:a})});if(!u.ok){const i=await u.text();console.error("Failed to send approval notification:",i)}}catch(u){console.error("Error sending approval notification:",u)}}var Oo=re('<div class="alert alert-info d-flex align-items-center gap-2 mb-0" role="alert"><i class="bi bi-arrow-repeat"></i> <div><strong>Recurring Event</strong> <div class="small">Changes to this event will apply to all future occurrences.</div></div></div>'),Fo=re('<button class="btn btn-primary btn-sm"><i class="bi bi-files"></i> <span class="ms-1">Clone</span></button>'),No=re("<!> <!>",1),Po=re('<span class="badge bg-secondary-subtle text-secondary-emphasis"> </span>'),Yo=re('<div class="card"><button type="button" class="btn btn-link text-start text-decoration-none d-flex align-items-center gap-3 p-3 w-100 submitter-chat-toggle svelte-1ujj5ue"><i class="bi bi-chat-left-dots"></i> <div class="d-flex flex-column align-items-start"><span class="fw-semibold">Discussion with Bishopric</span> <small class="text-muted">Ask questions or respond to feedback</small></div> <div class="ms-auto d-flex align-items-center gap-2"><!> <i class="bi bi-chevron-right"></i></div></button></div> <!>',1),Lo=re('<div class="alert alert-info small mb-0 d-flex align-items-start gap-2"><i class="bi bi-info-circle mt-1"></i> <span>All submissions require bishopric approval before they appear on the public calendar.</span></div> <!>',1),Bo=re('<button class="btn btn-danger position-relative"><span>Delete</span></button>'),Ho=re("<span>Save</span>"),zo=re("<span>Create</span>"),Wo=re('<span class="position-absolute top-0 start-100 translate-middle p-2 bg-danger border border-light rounded-circle"><span class="visually-hidden">Item not saved</span></span>'),jo=re('<button class="btn btn-primary position-relative"><!> <!></button>'),qo=re('<div class="d-flex flex-column gap-4"><!> <div class="d-flex flex-column gap-3"><div class="d-flex justify-content-between align-items-center gap-3 flex-wrap"><h2 class="h5 mb-0">Event Details</h2> <!></div> <!></div> <!> <!> <!> <!> <div class="d-flex justify-content-between align-items-center gap-2 flex-row"><div class="d-flex flex-row gap-2"><!></div> <div class="d-flex flex-row gap-2"><button class="btn btn-secondary position-relative">Cancel</button> <!></div></div> <div class="d-flex justify-content-end align-items-center gap-2 flex-row"><small> </small> <span><!></span></div> <!></div> <!> <!>',1);function yl(n,a){Ct(a,!1);const u=()=>En(H,"$userOrganizations",t),i=()=>En(I,"$currentUser",t),e=()=>En(E,"$validationErrors",t),[t,f]=qr(),c=X(),b=X(),y=X(),o=X(),l=X();let s=se(a,"name",8,""),h=se(a,"drawerId",8,""),v=se(a,"eventItem",12,Ka),C=se(a,"canDelete",8,!0),F=se(a,"canCreate",8,!0);const{actions:{reload:D}}=Yi(),{stores:{userOrganizations:H,currentUser:I}}=Rn(),{validationErrors:E,validate:U,getErrorMessages:g,clearErrors:k}=Ds(),{parseRecurrenceRule:d}=aa(),{uploadAttachment:m,removeAttachment:w,updateAttachmentName:A,validateFile:S}=Ps(),{saveEvent:R,deleteEventById:x,cloneEventForDate:O,buildEventPayload:_,saveSingleInstance:p,saveFutureInstances:z,saveAllInstances:T,deleteSingleInstance:Y,deleteFutureInstances:Q,deleteAllInstances:$}=Vs();let q=X(!1),P=X(!1),N=X(!1),K=X("weekly"),ne=X(1),G=X([]),V=X(""),ae=X(!0),xe=X("date"),ye=X([]),Ie=X(!1),Ae=X(!1),ve=X(void 0),Me=X(void 0),ce=X(!1),ie=X(null),fe=X(!1),Ee=X(null),me=X(0),ue=X({title:"",description:"",start_time:"",end_time:"",location:"",is_all_day:!1,event_type:"announcement"}),_e=X({message:"",type:"info"}),pe=X(""),Re=X(""),Be=X(""),He=X({dateInput:"",startTimeInput:"",endTimeInput:"",isRecurring:!1,recurrenceFrequency:"weekly",recurrenceInterval:1,recurringDays:[],recurrenceEndDate:"",hasEndDate:!0,monthlyType:"date"}),Ye=X(!1);const wt=(Z,W)=>Z.length===W.length&&Z.every((be,De)=>be===W[De]);let Fe=X([]),We=X(!1),je=X(!1);const it=`submitter-chat-form-${Zn()}`;let Ke=X(null),st=null,Ft=null;rr(async()=>{typeof window<"u"&&(Ft=(await hn(()=>import("./tUu8UEjF.js").then(W=>W.o),__vite__mapDeps([0,1]),import.meta.url)).default)}),jr(()=>{oe()});function on(){if(!Ft)return;const Z=document.getElementById(it);if(!Z)return;Ft.getOrCreateInstance(Z).show()}function J(Z){const W=Z??v()?.id??null;if(st||!W)return;const be=typeof window<"u"?localStorage.getItem("authToken"):null;be&&Pe.realtime.setAuth(be),st=Pe.channel(`submitter-comments-form-${W}`).on("postgres_changes",{event:"*",schema:"public",table:"event_submitter_comments",filter:`event_id=eq.${W}`},()=>{ke(W)}).subscribe()}function oe(){st&&(Pe.removeChannel(st),st=null)}async function ke(Z){const W=Z??v()?.id??null;if(W){r(je)||M(We,!0);try{const be=await _a(W);W===(v()?.id??null)&&(M(Fe,be),M(je,!0))}catch(be){console.error("Failed to load submitter comments:",be)}finally{W===(v()?.id??null)&&M(We,!1)}}}async function $e(Z){if(!v()?.id||!i()?.id)return;const W=i().displayName||i().username||"Unknown";await ba(v().id,i().id,W,Z),await ke()}async function pt(Z){await ga(Z),await ke()}const Ve=()=>{const Z=`[data-bs-target="#${h()}"]`,W=document.querySelector(Z);W&&W.click()},Te=(Z,W=0,be="info")=>{Dn(_e,r(_e).message=Z),Dn(_e,r(_e).type=be),W&&setTimeout(()=>{Dn(_e,r(_e).message="")},W)},xt=async Z=>{const W=Z.detail;if(!W)return;const be=S(W);if(!be.valid){Te(be.error??"Invalid file selected",7e3,"danger");return}M(P,!0);try{const De=await m(W,r(c)??"temp",Je=>Te(Je));if(!De.success||!De.attachment)throw new Error(De.error??"Upload failed");M(ye,[...r(ye),De.attachment]),M(Ie,!0),Te("File uploaded!",3e3,"success")}catch(De){console.error("File upload failed:",De),Te("Failed to upload file. Please try again.",7e3,"danger")}finally{M(P,!1)}},Qt=Z=>{const{attachment:W,newName:be}=Z.detail;M(ye,A(r(ye),W.id,be)),M(Ie,!0),Te("Attachment name updated!",3e3,"success")},Dt=async Z=>{const W=Z.detail;if(W){M(P,!0);try{if(!await w(W))throw new Error("Failed to remove attachment");M(ye,r(ye).filter(De=>De.id!==W.id)),M(Ie,!0),Te("Attachment removed!",3e3,"success")}catch(be){console.error("Failed to remove attachment:",be),Te("Failed to remove attachment. Please try again.",7e3,"danger")}finally{M(P,!1)}}},Et=async()=>{if(!r(c)){Te("ID is not defined",0,"danger");return}try{await x(r(c)),await D(),Yt("set_calendar_event_success","interaction","Delete Calendar Event Successful",1),setTimeout(()=>{M(q,!1),M(ue,{...v(),id:r(c)}),Te("Event Deleted",3e3,"success"),Ve()},800)}catch(Z){Yt("set_calendar_event_failed","interaction","Delete Calendar Event Failed",1),setTimeout(()=>{M(q,!1),console.error("Delete failed:",Z),Te("Failed to delete event. Please try again.",7e3,"danger")},800)}},On=()=>!!v().recurrence_rule,Fn=async()=>{const Z=r(c)||v().meta_data?.recurring_parent_id;if(Z&&r(Ae)&&r(Me)&&r(ve)){if(M(Ee,null),M(fe,!0),await new Promise(W=>{const be=setInterval(()=>{r(fe)||(clearInterval(be),W())},50)}),!r(Ee))return;M(q,!0);try{r(Ee)==="single"?await Y(Z,r(ve)):r(Ee)==="future"?await Q(Z,r(ve)):r(Ee)==="all"&&await $(Z),await D(),Yt("set_calendar_event_success","interaction","Delete Calendar Event Successful",1),setTimeout(()=>{M(q,!1),M(ue,{...v(),id:r(c)}),Te("Event Deleted",3e3,"success"),Ve()},800)}catch(W){Yt("set_calendar_event_failed","interaction","Delete Calendar Event Failed",1),setTimeout(()=>{M(q,!1),console.error("Delete failed:",W),Te("Failed to delete event. Please try again.",7e3,"danger")},800)}}else M(q,!0),Ga({title:"Delete Confirmation",message:On()?"This recurring event and every occurrence, past and future, will be removed. You won't be able to undo this. Continue?":"Are you sure you want to do this? You won't be able to undo this.",confirmButtonLabel:"Yes",confirmButtonCSS:"btn-danger",callback:W=>{W?Et():M(q,!1)}})},Nn=Z=>{if(r(c))try{const W=O({event:v(),newDate:Z});Yt("clone_calendar_event_form_loaded","interaction","Clone Calendar Event Form Loaded",1),Te("Event cloned. Review and click Create to save.",5e3,"success"),v(W),M(pe,W.start_time?Ne(new Date(W.start_time),"yyyy-MM-dd"):""),M(Re,W.start_time?Ne(new Date(W.start_time),"HH:mm"):""),M(Be,W.end_time?Ne(new Date(W.end_time),"HH:mm"):""),M(ye,[]),M(N,!1),M(G,[]),M(V,""),M(ae,!0),M(Ie,!0),M(me,void 0),M(ue,{...W}),M(He,{dateInput:r(pe),startTimeInput:r(Re),endTimeInput:r(Be),isRecurring:!1,recurrenceFrequency:"weekly",recurrenceInterval:1,recurringDays:[],recurrenceEndDate:"",hasEndDate:!0,monthlyType:"date"})}catch(W){console.error("Clone failed:",W),Te("Failed to clone event. Please try again.",7e3,"danger")}},Pn=()=>{ws({title:"Clone Event",message:"Select a date for the cloned event:",confirmButtonLabel:"Clone",confirmButtonCSS:"btn-primary",defaultDate:r(pe),callback:(Z,W)=>{Z&&W&&Nn(W)}})},Ze=async()=>{if(r(c)&&!r(y)){Te("Sorry nothing has changed, therefore, there is nothing to save.",7e3);return}if(!await U({title:v().title,event_type:v().event_type,organization:v().organization??"",description:v().description,location:v().location,is_all_day:v().is_all_day,dateInput:r(pe),startTimeInput:r(Re),endTimeInput:r(Be),isRecurring:r(N),recurrenceFrequency:r(K),recurringDays:r(N)?r(G):[],recurrenceEndDate:r(N)?r(V):void 0,hasEndDate:r(ae)})){const be=g();be.length&&Te(be.join(". ")+".  Please address accordingly.",0,"danger");return}const W=r(c)||v().meta_data?.recurring_parent_id;if(W&&r(Ae)&&r(Me)&&r(ve)){if(M(ie,null),M(ce,!0),await new Promise(De=>{const Je=setInterval(()=>{r(ce)||(clearInterval(Je),De())},100)}),!r(ie)||r(q))return;Te("Saving ..."),M(q,!0);const be=_({eventItem:v(),dateInput:r(pe),startTimeInput:r(Re),endTimeInput:r(Be),attachments:r(ye),isRecurring:r(b)&&r(N),recurrenceFrequency:r(K),recurrenceInterval:r(ne),recurringDays:r(N)?r(G):[],recurrenceEndDate:r(N)?r(V):"",hasEndDate:r(ae),monthlyType:r(xe)});try{let De;r(ie)==="single"?await p(W,r(ve),be):r(ie)==="future"?De=await z(W,r(ve),be):r(ie)==="all"&&await T(W,be),await D(),await Ha(),Yt("set_calendar_event_success","interaction",`Set Calendar Event Successful ${v().title}`,1),M(q,!1),De&&v({...v(),id:De}),v(v().attachments=r(ye),!0),M(ue,{...v(),id:De||W}),M(Ie,!1),Te("Saved",3e3,"success"),Ve()}catch(De){Yt("set_calendar_event_failed","interaction",`Set Calendar Event Failed ${v().title}`,1),setTimeout(()=>{M(q,!1),console.error("Save failed:",De),Te("Failed to save event. Please try again.",7e3,"danger")},800)}}else{if(r(q))return;Te("Saving ..."),M(q,!0);const be=!!r(c)&&(v().bishop_approval==="NO"||v().first_counselor_approval==="NO"||v().second_counselor_approval==="NO");try{const De=await R({id:r(c),eventItem:v(),dateInput:r(pe),startTimeInput:r(Re),endTimeInput:r(Be),attachments:r(ye),isRecurring:r(b)&&r(N),recurrenceFrequency:r(K),recurrenceInterval:r(ne),recurringDays:r(N)?r(G):[],recurrenceEndDate:r(N)?r(V):"",hasEndDate:r(ae),monthlyType:r(xe)});let Je=null;De.action==="create"?Je="created":be&&(Je="resubmitted"),De.event&&v({...v(),...De.event}),v(v().attachments=r(ye),!0),await D();const Ue=De.event?.id??r(c);Je&&Ue&&Uo(Ue,Je),Yt("set_calendar_event_success","interaction",`Set Calendar Event Successful ${v().title}`,1),setTimeout(()=>{M(q,!1),M(ue,{...v(),id:r(c)}),M(Ie,!1),Te("Saved",3e3,"success"),Ve()},800)}catch(De){Yt("set_calendar_event_failed","interaction",`Set Calendar Event Failed ${v().title}`,1),setTimeout(()=>{M(q,!1),console.error("Save failed:",De),Te("Failed to save event. Please try again.",7e3,"danger")},800)}}};Ce(()=>le(v()),()=>{M(c,v().id)}),Ce(()=>le(v()),()=>{M(b,v().event_type==="calendar_event")}),Ce(()=>(r(b),r(N),r(G),r(V)),()=>{!r(b)&&(r(N)||r(G).length>0||r(V))&&(M(N,!1),M(K,"weekly"),M(ne,1),M(G,[]),M(V,""),M(ae,!0),M(xe,"date"))}),Ce(()=>(le(v()),r(me),r(ue),r(Ie),r(pe),r(Re),r(Be),r(N),r(K),r(ne),r(G),r(V),r(ae),r(xe)),()=>{if(v()?.id!==r(me)||v()?.start_time!==r(ue).start_time||v()?.meta_data?.recurring_instance_index!==r(ue).meta_data?.recurring_instance_index){M(q,!0);const Z=r(Ie),W=v();setTimeout(()=>{const be=W.event_type==="calendar_event";if(M(pe,be&&W.start_time?Ne(new Date(W.start_time),"yyyy-MM-dd"):""),M(Re,be&&W.start_time?Ne(new Date(W.start_time),"HH:mm"):""),M(Be,be&&W.end_time?Ne(new Date(W.end_time),"HH:mm"):""),Z||M(ye,W.attachments?[...W.attachments]:[]),W.meta_data?.recurring_instance&&W.start_time?(M(Me,W.recurrence_rule),M(Ae,!0),M(ve,Ne(new Date(W.start_time),"yyyy-MM-dd"))):(M(Me,void 0),M(Ae,!1),M(ve,void 0)),W.recurrence_rule){const De=d(W.recurrence_rule,W.recurrence_end_date);De?(M(N,!0),M(K,De.frequency),M(ne,De.interval),M(G,De.recurringDays),M(V,De.recurrenceEndDate),M(ae,De.hasEndDate),M(xe,De.monthlyType)):(M(N,!1),M(K,"weekly"),M(ne,1),M(G,[]),M(V,""),M(ae,!0),M(xe,"date"))}else M(N,!1),M(K,"weekly"),M(ne,1),M(G,[]),M(V,""),M(ae,!0),M(xe,"date");M(me,W.id),M(ue,{...W}),M(q,!1),M(Ie,!1),k(),M(He,{dateInput:r(pe),startTimeInput:r(Re),endTimeInput:r(Be),isRecurring:r(N),recurrenceFrequency:r(K),recurrenceInterval:r(ne),recurringDays:[...r(G)],recurrenceEndDate:r(V),hasEndDate:r(ae),monthlyType:r(xe)})},200)}}),Ce(()=>(r(ue),le(v()),r(ye),r(pe),r(He),r(Re),r(Be),r(N),r(K),r(ne),r(G),r(V),r(ae),r(xe)),()=>{M(y,r(ue).title!==v().title||r(ue).start_time!==v().start_time||r(ue).end_time!==v().end_time||r(ue).description!==v().description||r(ue).location!==v().location||r(ue).is_public!==v().is_public||r(ue).organization!==v().organization||r(ue).is_all_day!==v().is_all_day||JSON.stringify(r(ye))!==JSON.stringify(v().attachments||[])||r(ue).recurrence_rule!==v().recurrence_rule||r(ue).recurrence_end_date!==v().recurrence_end_date||r(pe)!==r(He).dateInput||r(Re)!==r(He).startTimeInput||r(Be)!==r(He).endTimeInput||r(N)!==r(He).isRecurring||r(K)!==r(He).recurrenceFrequency||r(ne)!==r(He).recurrenceInterval||!wt(r(G),r(He).recurringDays)||r(V)!==r(He).recurrenceEndDate||r(ae)!==r(He).hasEndDate||r(xe)!==r(He).monthlyType)}),Ce(()=>(u(),Er),()=>{M(Ye,u().has(Er.Bishopric))}),Ce(()=>(le(v()),i()),()=>{M(o,!!v()?.id&&!!i()?.id&&v().meta_data?.submitted_by_user_id===i().id)}),Ce(()=>(r(o),r(Ye)),()=>{M(l,r(o)&&!r(Ye))}),Ce(()=>(r(l),le(v()),r(Ke)),()=>{const Z=r(l)?v()?.id??null:null;Z&&Z!==r(Ke)?(M(Ke,Z),M(Fe,[]),M(je,!1),M(We,!1),oe(),ke(Z),J(Z)):!Z&&r(Ke)!==null&&(M(Ke,null),M(Fe,[]),M(je,!1),M(We,!1),oe())}),Jt(),Ot();var we=qo(),ze=bt(we),vt=B(ze);{var gt=Z=>{var W=Oo();te(Z,W)};he(vt,Z=>{le(v()),r(c),ee(()=>v().recurrence_rule&&r(c))&&Z(gt)})}var Ge=j(vt,2),St=B(Ge),Bt=j(B(St),2);{var Xe=Z=>{var W=Fo();de(()=>W.disabled=r(q)||r(P)),Se("click",W,Pn),te(Z,W)};he(Bt,Z=>{r(c)&&Z(Xe)})}L(St);var _t=j(St,2);{let Z=rt(()=>r(q)||r(P));ji(_t,{get disabled(){return r(Z)},get name(){return s()},get validationErrors(){return e()},get title(){return v().title},set title(W){v(v().title=W,!0)},get eventType(){return v().event_type},set eventType(W){v(v().event_type=W,!0)},get organization(){return v().organization},set organization(W){v(v().organization=W,!0)},get isPublic(){return v().is_public},set isPublic(W){v(v().is_public=W,!0)},get description(){return v().description},set description(W){v(v().description=W,!0)},$$legacy:!0})}L(Ge);var Ht=j(Ge,2);{var tn=Z=>{var W=No(),be=bt(W);{let Je=rt(()=>r(q)||r(P));Zi(be,{get disabled(){return r(Je)},get name(){return s()},get validationErrors(){return e()},get dateInput(){return r(pe)},set dateInput(Ue){M(pe,Ue)},get startTimeInput(){return r(Re)},set startTimeInput(Ue){M(Re,Ue)},get endTimeInput(){return r(Be)},set endTimeInput(Ue){M(Be,Ue)},get isAllDay(){return v().is_all_day},set isAllDay(Ue){v(v().is_all_day=Ue,!0)},$$legacy:!0})}var De=j(be,2);{let Je=rt(()=>r(q)||r(P));as(De,{get disabled(){return r(Je)},get name(){return s()},get validationErrors(){return e()},get isRecurring(){return r(N)},set isRecurring(Ue){M(N,Ue)},get recurrenceFrequency(){return r(K)},set recurrenceFrequency(Ue){M(K,Ue)},get recurrenceInterval(){return r(ne)},set recurrenceInterval(Ue){M(ne,Ue)},get recurringDays(){return r(G)},set recurringDays(Ue){M(G,Ue)},get recurrenceEndDate(){return r(V)},set recurrenceEndDate(Ue){M(V,Ue)},get monthlyType(){return r(xe)},set monthlyType(Ue){M(xe,Ue)},get dateInput(){return r(pe)},set dateInput(Ue){M(pe,Ue)},$$legacy:!0})}te(Z,W)};he(Ht,Z=>{r(b)&&Z(tn)})}var nn=j(Ht,2);{let Z=rt(()=>r(q)||r(P));ms(nn,{get attachments(){return r(ye)},get uploadingFile(){return r(P)},get disabled(){return r(Z)},$$events:{upload:xt,edit:Qt,remove:Dt}})}var tt=j(nn,2);{let Z=rt(()=>r(q)||r(P)),W=rt(()=>`${s()}-location`);ss(tt,{get disabled(){return r(Z)},get name(){return r(W)},get value(){return v().location},set value(be){v(v().location=be,!0)},$$legacy:!0})}var et=j(tt,2);{var ot=Z=>{var W=Lo(),be=j(bt(W),2);{var De=Je=>{var Ue=Yo(),cn=bt(Ue),ct=B(cn),zt=j(B(ct),4),Ta=B(zt);{var Ca=un=>{var dn=Po(),br=B(dn,!0);L(dn),de(()=>ge(br,(r(Fe),ee(()=>r(Fe).length)))),te(un,dn)};he(Ta,un=>{r(Fe),ee(()=>r(Fe).length>0)&&un(Ca)})}at(2),L(zt),L(ct),L(cn);var Ma=j(cn,2);{let un=rt(()=>(le(v()),ee(()=>v()?.title||"Event")));Gn(Ma,{get id(){return it},subtitle:"Discussion with Bishopric",get title(){return r(un)},className:"submitter-chat-drawer-stacked",bodyClass:"overflow-hidden d-flex flex-column",children:(dn,br)=>{{let Ra=rt(()=>(i(),ee(()=>i()?.id??-1))),Ua=rt(()=>r(q)||r(P));nr(dn,{get comments(){return r(Fe)},get currentUserId(){return r(Ra)},onSend:$e,onDelete:pt,get loading(){return r(We)},fullHeight:!0,get disabled(){return r(Ua)}})}},$$slots:{default:!0}})}de(()=>Oe(ct,"aria-controls",it)),Se("click",ct,on),te(Je,Ue)};he(be,Je=>{r(l)&&Je(De)})}te(Z,W)};he(et,Z=>{r(Ye)||Z(ot)})}var mt=j(et,2),qe=B(mt),lt=B(qe);{var Nt=Z=>{var W=Bo();de(()=>W.disabled=r(q)||r(P)),Se("click",W,Fn),te(Z,W)};he(lt,Z=>{(r(c)||r(Ae))&&C()&&Z(Nt)})}L(qe);var yt=j(qe,2),Pt=B(yt),ln=j(Pt,2);{var wa=Z=>{var W=jo(),be=B(W);{var De=ct=>{var zt=Ho();te(ct,zt)},Je=ct=>{var zt=zo();te(ct,zt)};he(be,ct=>{r(c)||r(Ae)?ct(De):ct(Je,!1)})}var Ue=j(be,2);{var cn=ct=>{var zt=Wo();te(ct,zt)};he(Ue,ct=>{r(y)&&ct(cn)})}L(W),de(()=>W.disabled=r(q)||r(P)),Se("click",W,Ze),te(Z,W)};he(ln,Z=>{(r(c)||r(Ae)||F())&&Z(wa)})}L(yt),L(mt);var Yn=j(mt,2),gn=B(Yn),xa=B(gn,!0);L(gn);var Ln=j(gn,2);let pr;var Da=B(Ln);jt(Da,{size:"xs"}),L(Ln),L(Yn);var Ea=j(Yn,2);{var Sa=Z=>{{let W=rt(()=>r(q)||r(P));Mo(Z,{get disabled(){return r(W)},get reloadEvents(){return D},get eventItem(){return v()},set eventItem(be){v(be)},$$legacy:!0})}};he(Ea,Z=>{r(Ye),le(v()),ee(()=>r(Ye)&&!v()?.is_published)&&Z(Sa)})}L(ze);var _r=j(ze,2);{var Aa=Z=>{ps(Z,{get eventTitle(){return le(v()),ee(()=>v().title)},get occurrenceDate(){return r(ve)},callback:W=>{M(ie,W),M(ce,!1)}})};he(_r,Z=>{r(ce)&&r(ve)&&Z(Aa)})}var Ia=j(_r,2);{var ka=Z=>{bs(Z,{get eventTitle(){return le(v()),ee(()=>v().title)},get occurrenceDate(){return r(ve)},callback:W=>{M(Ee,W),M(fe,!1)}})};he(Ia,Z=>{r(fe)&&r(ve)&&Z(ka)})}de(()=>{Pt.disabled=r(q)||r(P),Qe(gn,1,`fw-lighter fst-italic text-${r(_e),ee(()=>r(_e).type)??""}`,"svelte-1ujj5ue"),ge(xa,(r(_e),ee(()=>r(_e).message))),pr=Qe(Ln,1,"",null,pr,{"d-none":!r(q)})}),Se("click",Pt,Ve),te(n,we),Mt(),f()}export{Mo as B,yl as C,Ui as a,Ii as b,bl as c,gl as d,Ai as e,Di as f,Yi as g,pl as h,qt as i,fn as j,Si as k,fr as l,Fr as m,_l as n,Xt as t};
