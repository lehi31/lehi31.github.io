import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{d as Tt,o as Ot,g as Dt}from"./DHXte27T.js";import{p as Wt,ai as N,g as e,aj as St,f as De,a as It,E as _,s as l,D as m,c as a,r as t,t as k,u as n,F as oe}from"./CPOcesE7.js";import{p as Et,b as d,i as p,a as Mt,e as me,s as I}from"./CCh4w6lW.js";import{e as ge,i as ot}from"./DAwrR-3T.js";import{f as o,a as r,t as Ut,c as $t}from"./YsHTGu5k.js";import{s as Q}from"./CGwXOSlZ.js";import{g as Pt,p as Ze,O as ct,P as Z,f as lt,c as vt}from"./Dlh-YxiV.js";import{i as Ft}from"./C2Q_9cr2.js";import{S as Ct}from"./ef-6hLZm.js";import{g as jt,d as Yt}from"./Yr1apH5u.js";import{A as Qt,a as zt,E as wt,c as Bt,b as Zt}from"./Sra4w5Jg.js";import{v as Rt,D as Ht}from"./BvciXj8s.js";import{s as kt}from"./BMk_lR9O.js";var Gt=o('<button class="btn btn-sm btn-outline-danger" type="button"><!></button>'),ea=o('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add event"><i class="bi bi-plus"></i></button>'),ta=o('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),aa=o('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),ra=o('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),sa=o("<span> </span>"),na=o('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),ia=o('<ul class="list-group list-group-flush"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">This Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),la=o('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),oa=o('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),va=o('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),ca=o("<span> </span>"),da=o('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),ua=o('<ul class="list-group list-group-flush border-top-0"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">Next Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),ga=o('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),ma=o('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),fa=o('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),_a=o("<span> </span>"),pa=o('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),ba=o('<ul class="list-group list-group-flush border-top-0"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">The Following Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),ya=o('<div class="d-flex flex-column gap-4"><div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center gap-3 flex-wrap"><span>Events</span> <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end"><!> <!> <!></div></div></div> <!> <!> <!></div></div>'),xa=o('<div class="d-flex flex-column gap-4"><!></div>'),ha=o("<!> <!>",1);function La(dt,fe){Wt(fe,!1);const Ue=()=>d(rt,"$currentUser",T),Oe=()=>d(xt,"$userOrganizations",T),M=()=>d(xe,"$currentUserHasPermission",T),_e=()=>d(Fe,"$currentUserIsRoot",T),We=()=>d(st,"$currentUserIsAdmin",T),Ge=()=>d(at,"$calendarEventsThisWeek",T),pe=()=>d(yt,"$calendarEventsNextWeek",T),et=()=>d(ne,"$calendarEventsNextNextWeek",T),tt=()=>d(_t,"$ready",T),re=()=>d(nt,"$hasPastEvents",T),F=()=>d(C,"$pastEventsCount",T),Se=()=>d(be,"$searchQuery",T),se=()=>d(pt,"$categoryFilter",T),b=()=>d(bt,"$currentCategoryFilter",T),[T,ut]=Mt();let gt=Et(fe,"showThisWeek",8,!0),mt=Et(fe,"showNextWeek",8,!0),ft=Et(fe,"showNextNextWeek",8,!0);const{stores:{ready:_t,categoryFilter:pt,currentCategoryFilter:bt,calendarEventsNextWeek:yt,calendarEventsThisWeek:at,calendarEventsNextNextWeek:ne,calendarEvents:Ie,searchQuery:be},actions:{reload:ve,calendarEventsThisWeekLabel:Me,calendarEventsNextWeekLabel:Pe,calendarEventsNextNextWeekLabel:ye}}=jt(),{stores:{currentUserHasPermission:xe,currentUser:rt,currentUserIsAdmin:st,currentUserIsRoot:Fe,userOrganizations:xt}}=Pt();let he=_(!1),ce=_(!1),Ee=_(),Ce=_(!1),je=_(!1),w=_(!1),G=_(new Set);const Qe={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0},O=Rt();let ze=_(""),Be=_({...Qe});const de=i=>{m(ze,"Event Item"),m(Be,{...i,category:i?.meta_data?.category})},Re=i=>{if(!i||!i.length)return[];const y=new Map;for(const s of i){if(!s.start_time)continue;const E=Ze(s.start_time);if(Number.isNaN(E.getTime()))continue;const U=lt(E,"yyyy-MM-dd");let V=y.get(U);V||(V={key:U,displayDay:lt(E,"EEE"),displayDate:lt(E,"MMM d"),events:[]},y.set(U,V)),V.events.push(s)}return Array.from(y.values()).sort((s,E)=>s.key<E.key?-1:s.key>E.key?1:0).map(s=>({...s,events:s.events.slice().sort((E,U)=>{const V=E.is_all_day?0:1,He=U.is_all_day?0:1;if(V!==He)return V-He;const it=E.start_time?Ze(E.start_time).getTime():Number.MAX_SAFE_INTEGER,ht=U.start_time?Ze(U.start_time).getTime():Number.MAX_SAFE_INTEGER;return it-ht})}))};let $e=_([]),ue=_([]),we=_([]),ke=_(!1);const nt=Tt(Ie,i=>{if(!i||!i.length)return!1;const y=kt().getTime();return i.some(s=>s.event_type==="calendar_event"&&s.start_time&&Ze(s.start_time).getTime()<y)}),C=Tt(Ie,i=>{if(!i||!i.length)return 0;const y=kt().getTime();return i.filter(s=>s.event_type==="calendar_event"&&s.start_time&&Ze(s.start_time).getTime()<y).length}),D=i=>Bt(i,{currentUserId:e(Ee),isPrivileged:e(ce),canEditOwnOrgEvents:e(w),userOrganizations:e(G)}),Ae=async()=>{if(!e(he)||!Dt(Fe)||!Dt(nt))return;const i=kt(),y=lt(i,"MMM d, yyyy");if(confirm(`Delete all events that occurred before ${y}?`)){m(ke,!0);try{const s=await Yt(i);await ve(),s.deleted>0&&console.info(`Deleted ${s.deleted} past events.`),s.skipped>0&&console.info(`Skipped ${s.skipped} recurring events with active future instances.`),s.deleted===0&&s.skipped===0&&console.info("No past events matched the delete criteria.")}catch(s){console.error("Failed to delete past events",s),alert("Failed to delete past events. Please try again.")}finally{m(ke,!1)}}};Ot(async()=>{await ve()}),N(()=>Ue(),()=>{m(Ee,Ue()?.id)}),N(()=>Oe(),()=>{m(G,Oe())}),N(()=>e(Ee),()=>{m(je,!!e(Ee))}),N(()=>(e(G),ct),()=>{m(Ce,e(G).has(ct.Bishopric))}),N(()=>(M(),Z),()=>{m(w,M()(Z.EditOwnOrgEvents))}),N(()=>(_e(),We(),e(Ce),M(),Z),()=>{m(ce,_e()||We()||e(Ce)||M()(Z.EditAllEvents))}),N(()=>(e(ce),M(),e(w),e(je)),()=>{m(he,e(ce)||M()(Z.CreateEvents)||e(w)||e(je))}),N(()=>Ge(),()=>{m($e,Re(Ge()))}),N(()=>pe(),()=>{m(ue,Re(pe()))}),N(()=>et(),()=>{m(we,Re(et()))}),St(),Ft();var Ne=ha(),ee=De(Ne);Ht(ee,{get title(){return e(ze)},get id(){return O},children:(i,y)=>{Qt(i,{get eventItem(){return e(Be)},get drawerId(){return O},name:"event-item-form"})},$$slots:{default:!0}});var te=l(ee,2);{var ae=i=>{var y=ya(),s=a(y),E=a(s),U=a(E),V=l(a(U),2),He=a(V);zt(He,{});var it=l(He,2);{var ht=$=>{var f=Gt(),P=a(f);{var X=j=>{var Y=Ut("Deletingâ€¦");r(j,Y)},J=j=>{var Y=Ut();k(()=>I(Y,`Delete Past Events (${F()??""})`)),r(j,Y)};p(P,j=>{e(ke)?j(X):j(J,!1)})}t(f),k(()=>f.disabled=e(ke)),me("click",f,Ae),r($,f)};p(it,$=>{_e()&&re()&&$(ht)})}var Lt=l(it,2);{var qt=$=>{var f=ea();k(()=>{Q(f,"data-bs-target",`#${O??""}`),Q(f,"aria-controls",O)}),me("click",f,()=>de({...Qe,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),r($,f)};p(Lt,$=>{e(he)&&$(qt)})}t(V),t(U),t(E);var At=l(E,2);{var Kt=$=>{var f=ia(),P=a(f),X=a(P),J=l(a(X),2),j=a(J,!0);t(J),t(X),t(P);var Y=l(P,2);{var Le=v=>{var x=$t(),W=De(x);ge(W,1,()=>e($e),ot,(z,c)=>{var u=ra(),g=a(u),A=a(g),B=a(A),Ke=a(B,!0);t(B);var ie=l(B,2),Ve=a(ie,!0);t(ie),t(A);var le=l(A,2);ge(le,7,()=>(e(c),n(()=>e(c).events)),(S,h)=>`${S.id??"new"}-${S.start_time}-${h}`,(S,h)=>{var R=aa(),H=a(R),Xe=a(H);wt(Xe,{get item(){return e(h)},showDate:!1,get searchQuery(){return Se()}}),t(H);var Je=l(H,2);{var Ye=L=>{var q=ta(),K=a(q);t(q),k(()=>{Q(K,"data-bs-target",`#${O??""}`),Q(K,"aria-controls",O)}),me("click",K,()=>de(e(h))),r(L,q)};p(Je,L=>{e(h),n(()=>D(e(h)))&&L(Ye)})}t(R),r(S,R)}),t(le),t(g),t(u),k(()=>{I(Ke,(e(c),n(()=>e(c).displayDay))),I(Ve,(e(c),n(()=>e(c).displayDate)))}),r(z,u)}),r(v,x)},qe=v=>{var x=na(),W=a(x),z=l(a(W));{var c=u=>{var g=sa(),A=a(g,!0);t(g),k(()=>{vt(g,1,`ms-1 me-1 badge rounded-pill bg-color-${b(),n(()=>b().color_number)??""}`,"svelte-19k62y7"),I(A,(b(),n(()=>b().label)))}),r(u,g)};p(z,u=>{se(),b(),n(()=>se()&&b()?.label?.length)&&u(c)})}oe(),t(W),t(x),r(v,x)};p(Y,v=>{e($e),n(()=>e($e).length)?v(Le):v(qe,!1)})}oe(2),t(f),k(v=>I(j,v),[()=>n(Me)]),r($,f)};p(At,$=>{gt()&&$(Kt)})}var Nt=l(At,2);{var Vt=$=>{var f=ua(),P=a(f),X=a(P),J=l(a(X),2),j=a(J,!0);t(J),t(X),t(P);var Y=l(P,2);{var Le=v=>{var x=$t(),W=De(x);ge(W,1,()=>e(ue),ot,(z,c)=>{var u=va(),g=a(u),A=a(g),B=a(A),Ke=a(B,!0);t(B);var ie=l(B,2),Ve=a(ie,!0);t(ie),t(A);var le=l(A,2);ge(le,7,()=>(e(c),n(()=>e(c).events)),(S,h)=>`${S.id??"new"}-${S.start_time}-${h}`,(S,h)=>{var R=oa(),H=a(R),Xe=a(H);wt(Xe,{get item(){return e(h)},showDate:!1,get searchQuery(){return Se()}}),t(H);var Je=l(H,2);{var Ye=L=>{var q=la(),K=a(q);t(q),k(()=>{Q(K,"data-bs-target",`#${O??""}`),Q(K,"aria-controls",O)}),me("click",K,()=>de(e(h))),r(L,q)};p(Je,L=>{e(h),n(()=>D(e(h)))&&L(Ye)})}t(R),r(S,R)}),t(le),t(g),t(u),k(()=>{I(Ke,(e(c),n(()=>e(c).displayDay))),I(Ve,(e(c),n(()=>e(c).displayDate)))}),r(z,u)}),r(v,x)},qe=v=>{var x=da(),W=a(x),z=l(a(W));{var c=u=>{var g=ca(),A=a(g,!0);t(g),k(()=>{vt(g,1,`ms-1 me-1 badge rounded-pill bg-color-${b(),n(()=>b().color_number)??""}`,"svelte-19k62y7"),I(A,(b(),n(()=>b().label)))}),r(u,g)};p(z,u=>{se(),b(),n(()=>se()&&b()?.label?.length)&&u(c)})}oe(),t(W),t(x),r(v,x)};p(Y,v=>{e(ue),n(()=>e(ue).length)?v(Le):v(qe,!1)})}oe(2),t(f),k(v=>I(j,v),[()=>n(Pe)]),r($,f)};p(Nt,$=>{mt()&&$(Vt)})}var Xt=l(Nt,2);{var Jt=$=>{var f=ba(),P=a(f),X=a(P),J=l(a(X),2),j=a(J,!0);t(J),t(X),t(P);var Y=l(P,2);{var Le=v=>{var x=$t(),W=De(x);ge(W,1,()=>e(we),ot,(z,c)=>{var u=fa(),g=a(u),A=a(g),B=a(A),Ke=a(B,!0);t(B);var ie=l(B,2),Ve=a(ie,!0);t(ie),t(A);var le=l(A,2);ge(le,7,()=>(e(c),n(()=>e(c).events)),(S,h)=>`${S.id??"new"}-${S.start_time}-${h}`,(S,h)=>{var R=ma(),H=a(R),Xe=a(H);wt(Xe,{get item(){return e(h)},showDate:!1,get searchQuery(){return Se()}}),t(H);var Je=l(H,2);{var Ye=L=>{var q=ga(),K=a(q);t(q),k(()=>{Q(K,"data-bs-target",`#${O??""}`),Q(K,"aria-controls",O)}),me("click",K,()=>de(e(h))),r(L,q)};p(Je,L=>{e(h),n(()=>D(e(h)))&&L(Ye)})}t(R),r(S,R)}),t(le),t(g),t(u),k(()=>{I(Ke,(e(c),n(()=>e(c).displayDay))),I(Ve,(e(c),n(()=>e(c).displayDate)))}),r(z,u)}),r(v,x)},qe=v=>{var x=pa(),W=a(x),z=l(a(W));{var c=u=>{var g=_a(),A=a(g,!0);t(g),k(()=>{vt(g,1,`ms-1 me-1 badge rounded-pill bg-color-${b(),n(()=>b().color_number)??""}`,"svelte-19k62y7"),I(A,(b(),n(()=>b().label)))}),r(u,g)};p(z,u=>{se(),b(),n(()=>se()&&b()?.label?.length)&&u(c)})}oe(),t(W),t(x),r(v,x)};p(Y,v=>{e(we),n(()=>e(we).length)?v(Le):v(qe,!1)})}oe(2),t(f),k(v=>I(j,v),[()=>n(ye)]),r($,f)};p(Xt,$=>{ft()&&$(Jt)})}t(s),t(y),r(i,y)},Te=i=>{var y=xa(),s=a(y);Ct(s,{}),t(y),r(i,y)};p(te,i=>{tt()?i(ae):i(Te,!1)})}r(dt,Ne),It(),ut()}var Ea=o('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add announcement"><i class="bi bi-plus"></i></button>'),$a=o('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit announcement"><i class="bi bi-pencil-square"></i></button>'),wa=o('<li class="list-group-item"><div class="d-flex justify-content-between"><!> <div><!></div></div></li>'),ka=o('<!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li>',1),Aa=o("<span> </span>"),Na=o('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> announcements</div></li>'),Ta=o('<div class="d-flex flex-column gap-4"><div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center"><span>Announcements</span> <div class="d-flex align-items-center gap-2"><!> <!></div></div></div> <ul class="list-group list-group-flush"><!></ul></div></div>'),Da=o("<!> <!>",1);function qa(dt,fe){Wt(fe,!1);const Ue=()=>d(se,"$currentUser",F),Oe=()=>d(gt,"$userOrganizations",F),M=()=>d(b,"$currentUserHasPermission",F),_e=()=>d(ut,"$currentUserIsRoot",F),We=()=>d(T,"$currentUserIsAdmin",F),Ge=()=>d(mt,"$ready",F),pe=()=>d(pt,"$announcements",F),et=()=>d(bt,"$searchQuery",F),tt=()=>d(ft,"$categoryFilter",F),re=()=>d(_t,"$currentCategoryFilter",F),[F,Se]=Mt(),{stores:{currentUser:se,currentUserHasPermission:b,currentUserIsAdmin:T,currentUserIsRoot:ut,userOrganizations:gt}}=Pt(),{stores:{ready:mt,categoryFilter:ft,currentCategoryFilter:_t,announcements:pt,searchQuery:bt},actions:{reload:yt}}=jt(),at={title:"Announcement",description:"",location:"",event_type:"announcement",is_public:!0},ne=Rt();let Ie=_(!1),be=_(!1),ve=_(),Me=_(!1),Pe=_(!1),ye=_(!1),xe=_(new Set),rt=_(""),st=_({...at});const Fe=w=>{m(rt,"Announcement Form"),m(st,{...w,category:w?.meta_data?.category})},xt=w=>Bt(w,{currentUserId:e(ve),isPrivileged:e(be),canEditOwnOrgEvents:e(ye),userOrganizations:e(xe)});Ot(async()=>{await yt()}),N(()=>Ue(),()=>{m(ve,Ue()?.id)}),N(()=>Oe(),()=>{m(xe,Oe())}),N(()=>e(ve),()=>{m(Pe,!!e(ve))}),N(()=>(e(xe),ct),()=>{m(Me,e(xe).has(ct.Bishopric))}),N(()=>(M(),Z),()=>{m(ye,M()(Z.EditOwnOrgEvents))}),N(()=>(_e(),We(),e(Me),M(),Z),()=>{m(be,_e()||We()||e(Me)||M()(Z.EditAllEvents))}),N(()=>(e(be),M(),e(ye),e(Pe)),()=>{m(Ie,e(be)||M()(Z.CreateEvents)||e(ye)||e(Pe))}),St(),Ft();var he=Da(),ce=De(he);Ht(ce,{get title(){return e(rt)},get id(){return ne},children:(w,G)=>{Qt(w,{get eventItem(){return e(st)},get drawerId(){return ne},name:"announcement-item-form"})},$$slots:{default:!0}});var Ee=l(ce,2);{var Ce=w=>{var G=Ta(),Qe=a(G),O=a(Qe),ze=a(O),Be=l(a(ze),2),de=a(Be);zt(de,{});var Re=l(de,2);{var $e=C=>{var D=Ea();k(()=>{Q(D,"data-bs-target",`#${ne??""}`),Q(D,"aria-controls",ne)}),me("click",D,()=>Fe({...at,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),r(C,D)};p(Re,C=>{e(Ie)&&C($e)})}t(Be),t(ze),t(O);var ue=l(O,2),we=a(ue);{var ke=C=>{var D=ka(),Ae=De(D);ge(Ae,1,pe,ot,(Ne,ee)=>{var te=wa(),ae=a(te),Te=a(ae);Zt(Te,{get item(){return e(ee)},get searchQuery(){return et()}});var i=l(Te,2),y=a(i);{var s=E=>{var U=$a();k(()=>{Q(U,"data-bs-target",`#${ne??""}`),Q(U,"aria-controls",ne)}),me("click",U,()=>Fe(e(ee))),r(E,U)};p(y,E=>{e(ee),n(()=>xt(e(ee)))&&E(s)})}t(i),t(ae),t(te),r(Ne,te)}),oe(2),r(C,D)},nt=C=>{var D=Na(),Ae=a(D),Ne=l(a(Ae));{var ee=te=>{var ae=Aa(),Te=a(ae,!0);t(ae),k(()=>{vt(ae,1,`ms-1 me-1 badge rounded-pill bg-color-${re(),n(()=>re().color_number)??""}`),I(Te,(re(),n(()=>re().label)))}),r(te,ae)};p(Ne,te=>{tt(),re(),n(()=>tt()&&re()?.label?.length)&&te(ee)})}oe(),t(Ae),t(D),r(C,D)};p(we,C=>{pe(),n(()=>pe()?.length)?C(ke):C(nt,!1)})}t(ue),t(Qe),t(G),r(w,G)},je=w=>{Ct(w,{})};p(Ee,w=>{Ge()?w(Ce):w(je,!1)})}r(dt,he),It(),Se()}export{qa as A,La as E};
