const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ChE2dj8K.js","./BWCcv1pC.js","./DIeogL5L.js","./DqgkBxsg.js","./CmsKOCeN.js","./NZTpNUN0.js","./69_IOA4Y.js","./CuVcyAaV.js","./KiCntiD6.js","./CvOYN50o.js","./BhDwlPrK.js","./GZlrwSKv.js","./ClZ-LT-y.js","./BUApaBEI.js","./BeNQ5BU7.js","./Df_v6ygR.js","../assets/Spinner.DTjfhZ6-.css","./MVigv8mq.js","./C7eOEiMq.js","./CzDGc265.js","./Drf-2KpF.js","./BNfJ4rVB.js","./qVIilodb.js","./Ca1eXe1w.js","./Day_xCQb.js","./DyfVHEYA.js","../assets/BishopricApprovalSection.DRGo_BHg.css"])))=>i.map(i=>d[i]);
import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{o as fa,w as Pa,g as ca}from"./CuVcyAaV.js";import{p as Ae,ai as C,m as t,aj as ga,f as F,a as Te,E as _,s as l,D as u,c as n,r,u as d,B,F as ye,C as da,R as ve,aq as Wa,n as qt,ar as La}from"./BWCcv1pC.js";import{b as H,i as h,a as Ue,e as $t,s as ct,d as Va,p as Se,j as za,k as Ba}from"./KiCntiD6.js";import{e as re,i as Xe}from"./CvOYN50o.js";import{f as v,a as o,c as Vt,t as ue}from"./DqgkBxsg.js";import{s as zt,e as Ha,b as ja}from"./BhDwlPrK.js";import{i as Fe}from"./BeNQ5BU7.js";import{u as Kt,v as va,w as Ya,t as Qa,d as Ze,O as Ie,P as lt,x as qa,A as Ce,e as he,p as Tt,i as ut}from"./GZlrwSKv.js";import{C as ya,A as Ka,c as ba,E as Xa}from"./BhPhX5cW.js";import{g as Je,C as ha,c as Za,f as De,e as Ke}from"./ChE2dj8K.js";import{S as Oe}from"./Df_v6ygR.js";import{v as Ea,D as Ma}from"./MVigv8mq.js";import{_ as Ja}from"./CmsKOCeN.js";import{P as Ga}from"./BgB8pT2-.js";import{p as tr}from"./BaPyB73e.js";import{s as er}from"./DyfVHEYA.js";import{e as be}from"./Ca1eXe1w.js";function ua(c,s,e){const a=Kt(c,e),m=Kt(s,e),w=+a-va(a),S=+m-va(m);return Math.round((w-S)/Ya)}function ma(c){const s=Qa(c);return s.setDate(1),s.setHours(0,0,0,0),s}var ar=v('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add announcement"><i class="bi bi-plus"></i></button>'),rr=v('<div class="announcement-actions svelte-1yokbat"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit announcement"><i class="bi bi-pencil-square"></i></button></div>'),nr=v('<li class="list-group-item py-2"><div class="announcement-row svelte-1yokbat"><div class="announcement-content svelte-1yokbat"><!></div> <!></div></li>'),sr=v('<div class="card-footer d-flex align-items-center justify-content-between"><small> </small> <button class="btn btn-primary btn-sm">More</button></div>'),or=v('<ul class="list-group list-group-flush border-top-0"></ul> <!>',1),ir=v('<div class="card-body text-muted small"><!></div>'),lr=v('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center"><span>Announcements</span> <!></div></div> <!></div>'),cr=v('<div class="d-flex flex-column gap-4"><!></div>'),dr=v("<!> <!>",1);function En(c,s){Ae(s,!1);const e=()=>H(ne,"$searchQuery",W),a=()=>H(N,"$announcements",W),m=()=>H(dt,"$currentUser",W),w=()=>H(_t,"$userOrganizations",W),S=()=>H(mt,"$currentUserHasPermission",W),f=()=>H(Z,"$currentUserIsRoot",W),I=()=>H(T,"$currentUserIsAdmin",W),j=()=>H(Bt,"$ready",W),[W,R]=Ue(),X=_(),J=_(),ht=_(),{stores:{currentUser:dt,currentUserHasPermission:mt,currentUserIsAdmin:T,currentUserIsRoot:Z,userOrganizations:_t}}=Ze(),{stores:{ready:Bt,announcements:N,searchQuery:ne},actions:{reload:Xt}}=Je(),se={title:"Announcement",description:"",location:"",event_type:"announcement",is_public:!0},Ct=Ea();let oe=_(!1),Ut=_(!1),Ht=_(),Zt=_(!1),Jt=_(!1),jt=_(!1),Ft=_(new Set),y=_(""),E=_({...se});const rt=5,pt=5;let G=_(rt);function U(){u(G,t(G)+pt)}const tt=k=>ba(k,{currentUserId:t(Ht),isPrivileged:t(Ut),canEditOwnOrgEvents:t(jt),userOrganizations:t(Ft)});fa(async()=>{await Xt()});const Y=k=>{u(y,"Announcement Form"),u(E,{...k,category:k?.meta_data?.category})};C(()=>(e(),a(),t(G)),()=>{u(X,e()?a()??[]:(a()??[]).slice(0,t(G)))}),C(()=>(e(),a(),t(G)),()=>{u(J,!e()&&(a()?.length??0)>t(G))}),C(()=>m(),()=>{u(Ht,m()?.id)}),C(()=>t(Ht),()=>{u(Jt,!!t(Ht))}),C(()=>w(),()=>{u(Ft,w())}),C(()=>(t(Ft),Ie),()=>{u(Zt,t(Ft).has(Ie.Bishopric))}),C(()=>(S(),lt),()=>{u(jt,S()(lt.EditOwnOrgEvents))}),C(()=>(f(),I(),t(Zt),S(),lt),()=>{u(Ut,f()||I()||t(Zt)||S()(lt.EditAllEvents))}),C(()=>(t(Ut),S(),t(jt),t(Jt)),()=>{u(oe,t(Ut)||S()(lt.CreateEvents)||t(jt)||t(Jt))}),C(()=>(S(),lt),()=>{u(ht,S()(lt.DeleteEvents))}),ga(),Fe();var nt=dr(),st=F(nt);Ma(st,{get title(){return t(y)},get id(){return Ct},children:(k,D)=>{ya(k,{get eventItem(){return t(E)},get drawerId(){return Ct},name:"announcement-item-form",get canDelete(){return t(ht)}})},$$slots:{default:!0}});var O=l(st,2);{var L=k=>{var D=lr(),P=n(D),ot=n(P),Dt=l(n(ot),2);{var Mt=q=>{var V=ar();B(()=>{zt(V,"data-bs-target",`#${Ct??""}`),zt(V,"aria-controls",Ct)}),$t("click",V,()=>Y({...se,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),o(q,V)};h(Dt,q=>{t(oe)&&q(Mt)})}r(ot),r(P);var St=l(P,2);{var Rt=q=>{var V=or(),ft=F(V);re(ft,5,()=>t(X),Xe,(M,x)=>{var z=nr(),gt=n(z),et=n(gt),i=n(et);Ka(i,{get item(){return t(x)},get searchQuery(){return e()}}),r(et);var g=l(et,2);{var $=A=>{var p=rr(),b=n(p);r(p),B(()=>{zt(b,"data-bs-target",`#${Ct??""}`),zt(b,"aria-controls",Ct)}),$t("click",b,()=>Y(t(x))),o(A,p)};h(g,A=>{t(x),d(()=>tt(t(x)))&&A($)})}r(gt),r(z),o(M,z)}),r(ft);var Et=l(ft,2);{var vt=M=>{var x=sr(),z=n(x),gt=n(z);r(z);var et=l(z,2);r(x),B(()=>ct(gt,`Showing ${t(G)??""} of ${a(),d(()=>a()?.length??0)??""}`)),$t("click",et,U),o(M,x)};h(Et,M=>{t(J)&&M(vt)})}o(q,V)},Nt=q=>{var V=Vt(),ft=F(V);{var Et=vt=>{var M=ir(),x=n(M);{var z=et=>{var i=ue("No announcements match your search.");o(et,i)},gt=et=>{var i=ue("There are no announcements yet.");o(et,i)};h(x,et=>{e()?et(z):et(gt,!1)})}r(M),o(vt,M)};h(ft,vt=>{a(),d(()=>a()?.length===0)&&vt(Et)},!0)}o(q,V)};h(St,q=>{t(X),d(()=>t(X).length)?q(Rt):q(Nt,!1)})}r(D),o(k,D)},Q=k=>{var D=cr(),P=n(D);Oe(P,{}),r(D),o(k,D)};h(O,k=>{j()?k(L):k(Q,!1)})}o(c,nt),Te(),R()}const wa={};for(const c of Object.values(ha))c.key&&(wa[c.label.toLowerCase()]=c.key);const vr=new Set(Object.values(ha).map(c=>c.key).filter(Boolean));function ur(c){const s=c.trim();if(s)return vr.has(s.toUpperCase())?s.toUpperCase():wa[s.toLowerCase()]}async function mr(c){return new Promise((s,e)=>{Ga.parse(c,{header:!0,skipEmptyLines:!0,complete:a=>{const m=a.data,w=a.meta.fields||[];s({data:m,columns:w})},error:a=>e(a)})})}function _r(c){return c.map(s=>{const e=s.toLowerCase().trim();return e==="title"||e==="event"||e==="event name"||e==="name"?{csvColumn:s,eventField:"title"}:e==="description"||e==="details"||e==="notes"?{csvColumn:s,eventField:"description"}:e==="start date"||e==="start_date"||e==="date"||e==="event date"?{csvColumn:s,eventField:"start_date"}:e==="start time"||e==="start_time"||e==="time"||e==="event time"?{csvColumn:s,eventField:"start_time"}:e==="end date"||e==="end_date"?{csvColumn:s,eventField:"end_date"}:e==="end time"||e==="end_time"?{csvColumn:s,eventField:"end_time"}:e==="location"||e==="place"||e==="venue"?{csvColumn:s,eventField:"location"}:e==="category"||e==="group"||e==="organization"||e==="org"?{csvColumn:s,eventField:"category"}:e==="all day"||e==="all_day"||e==="is_all_day"||e==="allday"?{csvColumn:s,eventField:"is_all_day"}:{csvColumn:s,eventField:null}})}function Lt(c,s,e){const a=s.find(m=>m.eventField===e);return a?(c[a.csvColumn]||"").trim():""}function _a(c){const s=["yyyy-MM-dd","MM/dd/yyyy","M/d/yyyy","MM-dd-yyyy","M-d-yyyy","MM/dd/yy","M/d/yy","yyyy/MM/dd","MMM d, yyyy","MMMM d, yyyy","MMM d yyyy","d MMM yyyy"];for(const e of s){const a=tr(c,e,new Date);if(qa(a))return a}return null}function pa(c){const s=c.match(/^(\d{1,2}):(\d{2})$/);if(s){const a=parseInt(s[1],10),m=parseInt(s[2],10);if(a>=0&&a<=23&&m>=0&&m<=59)return{hours:a,minutes:m}}const e=c.match(/^(\d{1,2})(?::(\d{2}))?\s*(am|pm)$/i);if(e){let a=parseInt(e[1],10);const m=e[2]?parseInt(e[2],10):0,w=e[3].toLowerCase();if(a>=1&&a<=12&&m>=0&&m<=59)return w==="pm"&&a!==12&&(a+=12),w==="am"&&a===12&&(a=0),{hours:a,minutes:m}}return null}function pr(c){const s=c.toLowerCase().trim();return["true","yes","1","y","x"].includes(s)}function fr(c,s,e){const a=[],m=Lt(c,s,"title"),w=Lt(c,s,"description"),S=Lt(c,s,"start_date"),f=Lt(c,s,"start_time"),I=Lt(c,s,"end_date"),j=Lt(c,s,"end_time"),W=Lt(c,s,"location"),R=Lt(c,s,"category"),X=Lt(c,s,"is_all_day");if(!m)return a.push({row:e,field:"title",message:"Title is required"}),{event:null,errors:a};if(m.length<3)return a.push({row:e,field:"title",message:"Title must be at least 3 characters"}),{event:null,errors:a};if(m.length>255)return a.push({row:e,field:"title",message:"Title cannot exceed 255 characters"}),{event:null,errors:a};if(!S)return a.push({row:e,field:"start_date",message:"Start date is required"}),{event:null,errors:a};const J=_a(S);if(!J)return a.push({row:e,field:"start_date",message:`Invalid date format: "${S}"`}),{event:null,errors:a};const ht=X?pr(X):!f;let dt;if(!ht&&f){const N=pa(f);if(!N)return a.push({row:e,field:"start_time",message:`Invalid time format: "${f}"`}),{event:null,errors:a};J.setHours(N.hours,N.minutes,0,0),dt=De(J,Ce)}else J.setHours(0,0,0,0),dt=De(J,Ce);let mt;const T=I?_a(I):new Date(J);if(T&&!ht&&j){const N=pa(j);if(!N)return a.push({row:e,field:"end_time",message:`Invalid time format: "${j}"`}),{event:null,errors:a};T.setHours(N.hours,N.minutes,0,0),mt=De(T,Ce)}else if(!ht&&f)mt=new Date(dt.getTime()+60*60*1e3);else{const N=T||new Date(J);N.setHours(23,59,59,0),mt=De(N,Ce)}let Z;if(R&&(Z=ur(R),!Z))return a.push({row:e,field:"category",message:`Unknown category: "${R}"`}),{event:null,errors:a};if(W&&W.length>255)return a.push({row:e,field:"location",message:"Location cannot exceed 255 characters"}),{event:null,errors:a};const _t={};return Z&&(_t.category=Z),{event:{title:m,event_type:"calendar_event",start_time:dt.toISOString(),end_time:mt.toISOString(),is_all_day:ht,is_public:!0,is_published:!1,meta_data:_t,...w?{description:w}:{},...W?{location:W}:{}},errors:[]}}async function gr(c,s){const e={success:0,validationErrors:0,errors:[]},a=[];for(let f=0;f<c.length;f++){const{event:I,errors:j}=fr(c[f],s,f+1);if(j.length>0){e.validationErrors++,e.errors.push(...j);continue}I&&a.push(I)}const m=Ze(),w=m?ca(m.stores.currentUser):void 0,S=m?ca(m.stores.userOrganizations):void 0;if(w){const f=w.displayName||w.username,I=w.id,j=S?Array.from(S):[],W=new Date().toISOString();for(const R of a){const X=R.meta_data||{};f&&(X.submitted_by_name=f),I&&(X.submitted_by_user_id=I),j.length&&(X.submitted_by_organizations=j),X.submitted_at=W,R.meta_data=X}}return a.length>0&&(await Za(a),e.success=a.length),e}function yr(){const c=Pa({step:"upload",csvData:[],csvColumns:[],columnMappings:[],importResult:null});return{state:c,parseCsvFile:mr,autoDetectMappings:_r,importEvents:gr,reset:()=>c.set({step:"upload",csvData:[],csvColumns:[],columnMappings:[],importResult:null})}}var br=v(`<p class="text-muted small mb-3">Upload a CSV file to bulk-import calendar events. Need a starting point? <a href="/sample-events.csv" download="">Download sample CSV template</a>.</p> <div class="mb-3"><label for="csvFile" class="form-label">Select CSV File</label> <input type="file" class="form-control" id="csvFile" accept=".csv"/></div> <div class="alert alert-warning small mb-3 d-flex align-items-start gap-2"><i class="bi bi-info-circle mt-1"></i> <span>All imported events require <strong>bishopric approval</strong> before they appear on the
							public calendar.</span></div> <div class="alert alert-info small mb-0"><strong>Format Guide:</strong> <ul class="mb-0 mt-1"><li><strong>Required columns:</strong> Title, Date</li> <li><strong>Optional columns:</strong> Start Time, End Time, Location, Category, Description</li> <li>Dates: YYYY-MM-DD, MM/DD/YYYY, Jan 1, 2025, etc.</li> <li>Times: 7:00 PM, 19:00, etc. (omit for all-day events)</li> <li>Categories: Ward, Relief Society, Elders Quorum, Youth, Young Women, Young Men,
								Primary, etc.</li></ul></div>`,1),hr=v('<tr><td> </td><td><select class="form-select form-select-sm"><option>-- Skip --</option><option>Title</option><option>Description</option><option>Start Date</option><option>Start Time</option><option>End Date</option><option>End Time</option><option>Location</option><option>Category</option><option>All Day</option></select></td></tr>'),Er=v('<h6>Map CSV Columns to Event Fields</h6> <p class="text-muted"> </p> <table class="table table-sm"><thead><tr><th>CSV Column</th><th>Maps To</th></tr></thead><tbody></tbody></table>',1),Mr=v('<div class="text-center py-5"><!> <p class="mt-3">Importing events...</p></div>'),wr=v("<li><strong> </strong> rows had validation errors</li>"),kr=v(`<div class="alert alert-info small">Imported events are <strong>unpublished</strong> and will need bishopric approval before
							they appear on the public calendar.</div>`),xr=v("<li> </li>"),$r=v("<li><em> </em></li>"),Cr=v('<div class="alert alert-warning"><h6>Validation Errors:</h6> <ul class="mb-0" style="max-height: 200px; overflow-y: auto;"><!> <!></ul></div>'),Dr=v('<div class="alert alert-success"><h6>Import Complete</h6> <ul class="mb-0"><li><strong> </strong> events imported successfully</li> <!></ul></div> <!> <!>',1),Sr=v('<button type="button" class="btn btn-secondary">Cancel</button>'),Ir=v('<button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-primary"> </button>',1),Or=v('<button type="button" class="btn btn-secondary" disabled>Cancel</button> <button type="button" class="btn btn-primary" disabled><!> Importing...</button>',1),Ar=v('<button type="button" class="btn btn-primary">Done</button>'),Tr=v('<div class="modal-backdrop fade show"></div>'),Ur=v('<div tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Import Events from CSV</h5> <button type="button" class="btn-close" aria-label="Close import modal"></button></div> <div class="modal-body"><!></div> <div class="modal-footer"><!></div></div></div></div> <!>',1);function Fr(c,s){Ae(s,!1);const e=()=>H(I,"$state",a),[a,m]=Ue();let w=Se(s,"isOpen",8,!1),S=Se(s,"onClose",8),f=Se(s,"onComplete",8);const{state:I,parseCsvFile:j,autoDetectMappings:W,importEvents:R,reset:X}=yr();async function J(y){const E=y.target.files?.[0];if(E)try{const{data:rt,columns:pt}=await j(E),G=W(pt);I.update(U=>({...U,step:"mapping",csvData:rt,csvColumns:pt,columnMappings:G}))}catch(rt){console.error("Failed to parse CSV:",rt),alert("Failed to parse CSV file. Please check the file format.")}}async function ht(){I.update(y=>({...y,step:"importing"}));try{const y=await R(e().csvData,e().columnMappings);I.update(E=>({...E,step:"complete",importResult:y})),f()()}catch(y){console.error("Failed to import events:",y),alert("Failed to import events. Please try again."),I.update(E=>({...E,step:"mapping"}))}}function dt(){X(),S()()}Fe();var mt=Ur(),T=F(mt);let Z;var _t=n(T),Bt=n(_t),N=n(Bt),ne=l(n(N),2);ne.__click=dt,r(N);var Xt=l(N,2),se=n(Xt);{var Ct=y=>{var E=br(),rt=l(F(E),2),pt=l(n(rt),2);pt.__change=J,r(rt),ye(4),o(y,E)},oe=y=>{var E=Vt(),rt=F(E);{var pt=U=>{var tt=Er(),Y=l(F(tt),2),nt=n(Y);r(Y);var st=l(Y,2),O=l(n(st));re(O,5,()=>(e(),d(()=>e().columnMappings)),Xe,(L,Q,k)=>{var D=hr(),P=n(D),ot=n(P,!0);r(P);var Dt=l(P),Mt=n(Dt);B(()=>{t(Q),da(()=>{})});var St=n(Mt);St.value=(St.__value=null)??"";var Rt=l(St);Rt.value=Rt.__value="title";var Nt=l(Rt);Nt.value=Nt.__value="description";var q=l(Nt);q.value=q.__value="start_date";var V=l(q);V.value=V.__value="start_time";var ft=l(V);ft.value=ft.__value="end_date";var Et=l(ft);Et.value=Et.__value="end_time";var vt=l(Et);vt.value=vt.__value="location";var M=l(vt);M.value=M.__value="category";var x=l(M);x.value=x.__value="is_all_day",r(Mt),r(Dt),r(D),B(()=>ct(ot,(t(Q),d(()=>t(Q).csvColumn)))),ja(Mt,()=>t(Q).eventField,z=>(t(Q).eventField=z,da(()=>e()),za(a,"$state"))),o(L,D)}),r(O),r(st),B(()=>ct(nt,`Found ${e(),d(()=>e().csvData.length)??""} rows in CSV`)),o(U,tt)},G=U=>{var tt=Vt(),Y=F(tt);{var nt=O=>{var L=Mr(),Q=n(L);Oe(Q,{}),ye(2),r(L),o(O,L)},st=O=>{var L=Vt(),Q=F(L);{var k=D=>{var P=Dr(),ot=F(P),Dt=l(n(ot),2),Mt=n(Dt),St=n(Mt),Rt=n(St,!0);r(St),ye(),r(Mt);var Nt=l(Mt,2);{var q=M=>{var x=wr(),z=n(x),gt=n(z,!0);r(z),ye(),r(x),B(()=>ct(gt,(e(),d(()=>e().importResult.validationErrors)))),o(M,x)};h(Nt,M=>{e(),d(()=>e().importResult?.validationErrors&&e().importResult.validationErrors>0)&&M(q)})}r(Dt),r(ot);var V=l(ot,2);{var ft=M=>{var x=kr();o(M,x)};h(V,M=>{e(),d(()=>e().importResult?.success&&e().importResult.success>0)&&M(ft)})}var Et=l(V,2);{var vt=M=>{var x=Cr(),z=l(n(x),2),gt=n(z);re(gt,1,()=>(e(),d(()=>e().importResult.errors.slice(0,10))),Xe,(g,$)=>{var A=xr(),p=n(A);r(A),B(()=>ct(p,`Row ${t($),d(()=>t($).row)??""}: ${t($),d(()=>t($).message)??""}`)),o(g,A)});var et=l(gt,2);{var i=g=>{var $=$r(),A=n($),p=n(A);r(A),r($),B(()=>ct(p,`... and ${e(),d(()=>e().importResult.errors.length-10)??""} more errors`)),o(g,$)};h(et,g=>{e(),d(()=>e().importResult.errors.length>10)&&g(i)})}r(z),r(x),o(M,x)};h(Et,M=>{e(),d(()=>e().importResult?.errors&&e().importResult.errors.length>0)&&M(vt)})}B(()=>ct(Rt,(e(),d(()=>e().importResult?.success||0)))),o(D,P)};h(Q,D=>{e(),d(()=>e().step==="complete")&&D(k)},!0)}o(O,L)};h(Y,O=>{e(),d(()=>e().step==="importing")?O(nt):O(st,!1)},!0)}o(U,tt)};h(rt,U=>{e(),d(()=>e().step==="mapping")?U(pt):U(G,!1)},!0)}o(y,E)};h(se,y=>{e(),d(()=>e().step==="upload")?y(Ct):y(oe,!1)})}r(Xt);var Ut=l(Xt,2),Ht=n(Ut);{var Zt=y=>{var E=Sr();E.__click=dt,o(y,E)},Jt=y=>{var E=Vt(),rt=F(E);{var pt=U=>{var tt=Ir(),Y=F(tt);Y.__click=dt;var nt=l(Y,2);nt.__click=ht;var st=n(nt);r(nt),B(()=>ct(st,`Import ${e(),d(()=>e().csvData.length)??""} Events`)),o(U,tt)},G=U=>{var tt=Vt(),Y=F(tt);{var nt=O=>{var L=Or(),Q=l(F(L),2),k=n(Q);Oe(k,{size:"sm"}),ye(),r(Q),o(O,L)},st=O=>{var L=Vt(),Q=F(L);{var k=D=>{var P=Ar();P.__click=dt,o(D,P)};h(Q,D=>{e(),d(()=>e().step==="complete")&&D(k)},!0)}o(O,L)};h(Y,O=>{e(),d(()=>e().step==="importing")?O(nt):O(st,!1)},!0)}o(U,tt)};h(rt,U=>{e(),d(()=>e().step==="mapping")?U(pt):U(G,!1)},!0)}o(y,E)};h(Ht,y=>{e(),d(()=>e().step==="upload")?y(Zt):y(Jt,!1)})}r(Ut),r(Bt),r(_t),r(T);var jt=l(T,2);{var Ft=y=>{var E=Tr();o(y,E)};h(jt,y=>{w()&&y(Ft)})}B(()=>{Z=he(T,1,"modal fade",null,Z,{show:w()}),Ha(T,`display: ${w()?"block":"none"}`)}),o(c,mt),Te(),m()}Va(["click","change"]);var Rr=v('<button class="btn btn-sm btn-outline-secondary flex-shrink-0"><i></i> </button>');function Nr(c,s){Ae(s,!1);const e=()=>H(w,"$weeksExpanded",a),[a,m]=Ue(),{stores:{weeksExpanded:w}}=Je();function S(){Ba(w,!e())}Fe();var f=Rr(),I=n(f),j=l(I);r(f),B(()=>{he(I,1,`bi ${e()?"bi-chevron-up":"bi-chevron-down"}`),ct(j,` ${e()?"Collapse All":"Expand All"}`)}),$t("click",f,S),o(c,f),Te(),m()}var Pr=v('<div class="dropdown"><button class="btn btn-sm btn-primary dropdown-toggle" type="button" id="addEventDropdown" data-bs-toggle="dropdown" aria-label="Add event actions" aria-expanded="false"><i class="bi bi-plus"></i></button> <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="addEventDropdown"><li><button class="dropdown-item" type="button" data-bs-toggle="offcanvas"><i class="bi bi-calendar-plus me-2"></i>Create Event</button></li> <li><button class="dropdown-item" type="button"><i class="bi bi-file-earmark-arrow-up me-2"></i>Import CSV</button></li></ul></div>'),Wr=v('<div class="event-actions svelte-1p8xa6u"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),Lr=v('<div class="daily-event-row svelte-1p8xa6u"><div class="event-content svelte-1p8xa6u"><!></div> <!></div>'),Vr=v('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-1p8xa6u"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),zr=v('<li class="list-group-item py-3 text-muted">No events scheduled this week.</li>'),Br=v('<li class="list-group-item list-group-item-light text-uppercase small fw-lighter p-0"><button><span class="d-flex align-items-center gap-2"><i></i> <span class="text-muted"> </span></span> <span> </span></button></li> <!>',1),Hr=v('<li class="list-group-item bg-secondary text-white fw-semibold"> </li> <!>',1),jr=v('<ul class="list-group list-group-flush border-top-0"></ul>'),Yr=v('<div class="card-body text-muted small"><!></div>'),Qr=v('<button class="btn btn-outline-secondary btn-sm">Reset</button>'),qr=v('<div class="d-flex gap-2"><button class="btn btn-primary btn-sm">More</button> <button class="btn btn-outline-primary btn-sm">All</button></div>'),Kr=v('<div class="card-footer d-flex align-items-center justify-content-between"><small> </small> <!></div>'),Xr=v("<!> <!>",1),Zr=v('<div class="card-body text-muted small"><!></div>'),Jr=v('<div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center"><span>Events</span> <div class="d-flex align-items-center gap-2"><!> <!></div></div></div> <!></div>'),Gr=v('<div class="d-flex flex-column gap-4"><!></div>'),tn=v("<!> <!> <!>",1);function Mn(c,s){Ae(s,!1);const e=()=>H(Jt,"$weeksExpanded",R),a=()=>H(jt,"$searchQuery",R),m=()=>H(Zt,"$calendarEvents",R),w=()=>H(Xt,"$currentUser",R),S=()=>H(Ut,"$userOrganizations",R),f=()=>H(se,"$currentUserHasPermission",R),I=()=>H(oe,"$currentUserIsRoot",R),j=()=>H(Ct,"$currentUserIsAdmin",R),W=()=>H(Ht,"$ready",R),[R,X]=Ue(),J=_(),ht=_(),dt=_(),mt=_(),T=_(),Z=_(),_t=_(),Bt=_(),N=_(),ne=_(),{stores:{currentUser:Xt,currentUserHasPermission:se,currentUserIsAdmin:Ct,currentUserIsRoot:oe,userOrganizations:Ut}}=Ze(),{stores:{ready:Ht,calendarEvents:Zt,weeksExpanded:Jt,searchQuery:jt},actions:{reload:Ft}}=Je(),y={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0};let E=Se(s,"formId",24,Ea),rt=_(!1),pt=_(!1),G=_(),U=_(!1),tt=_(!1),Y=_(new Set),nt=_(""),st=_({...y}),O=_(!1);const L=8,Q=8;let k=_(L),D=_(!1);const P=er();let ot=_({});function Dt(i){return i===t(ht)||i===t(dt)}function Mt(i){const g=t(ot)[i]??Dt(i);u(ot,{...t(ot),[i]:!g})}const St=i=>{const g=new Map;for(const p of i){if(!p.start_time)continue;const b=Tt(p.start_time);if(Number.isNaN(b.getTime()))continue;const K=Kt(b,{weekStartsOn:1}),It=be(b,{weekStartsOn:1}),wt=ut(K,"yyyy-MM-dd"),ie=`${ut(K,"MMM d")} – ${ut(It,"MMM d")}`;let Pt=g.get(wt);Pt||(Pt={key:wt,label:ie,days:new Map},g.set(wt,Pt));const at=ut(b,"yyyy-MM-dd");let it=Pt.days.get(at);it||(it={key:at,displayDay:ut(b,"EEE"),displayDate:ut(b,"MMM d"),events:[]},Pt.days.set(at,it)),it.events.push(p)}const $=p=>{const b=ut(p,"yyyy-MM-dd");g.has(b)||g.set(b,{key:b,label:`${ut(p,"MMM d")} – ${ut(be(p,{weekStartsOn:1}),"MMM d")}`,days:new Map})},A=Array.from(g.values());if(A.length){const p=A.reduce((It,wt)=>wt.key>It?wt.key:It,A[0].key),b=Tt(p);let K=Kt(new Date,{weekStartsOn:1});if(K>b)$(K);else for(;K<=b;)$(K),K=Ke(K,1)}return Array.from(g.values()).sort((p,b)=>p.key<b.key?-1:p.key>b.key?1:0).map(p=>({key:p.key,label:p.label,days:Array.from(p.days.values()).sort((b,K)=>b.key<K.key?-1:b.key>K.key?1:0).map(b=>({...b,events:b.events.slice().sort((K,It)=>{const wt=K.is_all_day?0:1,ie=It.is_all_day?0:1;if(wt!==ie)return wt-ie;const Pt=K.start_time?Tt(K.start_time).getTime():Number.MAX_SAFE_INTEGER,at=It.start_time?Tt(It.start_time).getTime():Number.MAX_SAFE_INTEGER;return Pt-at})}))}))};function Rt(){u(k,t(k)+Q)}function Nt(){u(k,520),u(D,!0)}function q(){u(k,L),u(D,!1)}const V=i=>ba(i,{currentUserId:t(G),isPrivileged:t(pt),canEditOwnOrgEvents:t(tt),userOrganizations:t(Y)});function ft(){Ft()}fa(async()=>{await Ft()});const Et=async i=>{if(u(nt,"Item Form"),i?.meta_data?.recurring_instance&&i?.meta_data?.recurring_parent_id){const{getCalendarEvent:g}=await Ja(async()=>{const{getCalendarEvent:A}=await import("./ChE2dj8K.js").then(p=>p.x);return{getCalendarEvent:A}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url),$=await g(i.meta_data.recurring_parent_id);if($){u(st,{...$,category:$?.meta_data?.category,start_time:i.start_time,end_time:i.end_time,meta_data:{...$.meta_data,recurring_instance:!0,recurring_parent_id:i.meta_data.recurring_parent_id,recurring_instance_index:i.meta_data.recurring_instance_index}});return}}u(st,{...i,category:i?.meta_data?.category})};C(()=>t(k),()=>{u(J,Ke(P,t(k)))}),C(()=>Kt,()=>{u(ht,ut(Kt(P,{weekStartsOn:1}),"yyyy-MM-dd"))}),C(()=>Kt,()=>{u(dt,ut(Ke(Kt(P,{weekStartsOn:1}),1),"yyyy-MM-dd"))}),C(()=>(e(),a(),t(ot)),()=>{u(mt,i=>e()||a()?!0:t(ot)[i]!==void 0?t(ot)[i]:Dt(i))}),C(()=>(m(),Tt),()=>{u(T,(m()??[]).filter(i=>i.start_time?Tt(i.start_time)>=P:!1))}),C(()=>(a(),t(T),t(J)),()=>{u(Z,a()?t(T):t(T).filter(i=>Tt(i.start_time)<=t(J)))}),C(()=>t(Z),()=>{u(_t,St(t(Z)))}),C(()=>(a(),t(T),t(Z)),()=>{u(Bt,!a()&&t(T).length>t(Z).length)}),C(()=>(t(_t),ut),()=>{u(N,t(_t).reduce((i,g)=>{const $=Tt(g.key),A=be($,{weekStartsOn:1}),p=ut(A,"yyyy-MM"),b=ut(A,"MMMM yyyy");return i[p]||(i[p]={label:b,weeks:[]}),i[p].weeks.push(g),i},{}))}),C(()=>w(),()=>{u(G,w()?.id)}),C(()=>S(),()=>{u(Y,S())}),C(()=>(t(Y),Ie),()=>{u(U,t(Y).has(Ie.Bishopric))}),C(()=>(f(),lt),()=>{u(tt,f()(lt.EditOwnOrgEvents))}),C(()=>(I(),j(),t(U),f(),lt),()=>{u(pt,I()||j()||t(U)||f()(lt.EditAllEvents))}),C(()=>(f(),lt),()=>{u(rt,f()(lt.CreateEvents))}),C(()=>(f(),lt),()=>{u(ne,f()(lt.DeleteEvents))}),ga(),Fe();var vt=tn(),M=F(vt);Ma(M,{get title(){return t(nt)},get id(){return E()},children:(i,g)=>{ya(i,{get eventItem(){return t(st)},get drawerId(){return E()},name:"event-item-form",get canDelete(){return t(ne)}})},$$slots:{default:!0}});var x=l(M,2);Fr(x,{get isOpen(){return t(O)},onClose:()=>u(O,!1),onComplete:ft});var z=l(x,2);{var gt=i=>{var g=Jr(),$=n(g),A=n($),p=l(n(A),2),b=n(p);Nr(b,{});var K=l(b,2);{var It=at=>{var it=Pr(),Gt=l(n(it),2),te=n(Gt),ee=n(te);r(te);var kt=l(te,2),ae=n(kt);r(kt),r(Gt),r(it),B(()=>{zt(ee,"data-bs-target",`#${E()??""}`),zt(ee,"aria-controls",E())}),$t("click",ee,()=>Et({...y,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),$t("click",ae,()=>u(O,!0)),o(at,it)};h(K,at=>{t(rt)&&at(It)})}r(p),r(A),r($);var wt=l($,2);{var ie=at=>{var it=Xr(),Gt=F(it);{var te=Ot=>{var xt=jr();re(xt,5,()=>(t(N),d(()=>Object.entries(t(N)))),([Wt,le])=>Wt,(Wt,le)=>{var me=Wa(()=>La(t(le),2));let yt=()=>t(me)[1];var Yt=Hr(),At=F(Yt),Qt=n(At,!0);r(At);var Ee=l(At,2);re(Ee,1,()=>(yt(),d(()=>yt().weeks)),_e=>_e.key,(_e,bt)=>{const Ge=ve(()=>(qt(Tt),t(bt),d(()=>Tt(t(bt).key)))),Me=ve(()=>(qt(be),qt(t(Ge)),d(()=>be(t(Ge),{weekStartsOn:1})))),ta=ve(()=>(qt(ma),qt(t(Me)),d(()=>ma(t(Me))))),ka=ve(()=>(qt(ua),qt(t(Me)),qt(t(ta)),d(()=>ua(t(Me),t(ta),{weekStartsOn:1})+1))),Re=ve(()=>(t(mt),t(bt),d(()=>t(mt)(t(bt).key)))),we=ve(()=>(t(bt),d(()=>t(bt).days.reduce((fe,ke)=>fe+ke.events.length,0))));var ea=Br(),Ne=F(ea),pe=n(Ne);let aa;var Pe=n(pe),ra=n(Pe),na=l(ra,2),xa=n(na);r(na),r(Pe);var We=l(Pe,2);let sa;var $a=n(We,!0);r(We),r(pe),r(Ne);var Ca=l(Ne,2);{var Da=fe=>{var ke=Vt(),Sa=F(ke);{var Ia=ce=>{var xe=Vt(),Aa=F(xe);re(Aa,1,()=>(t(bt),d(()=>t(bt).days)),Le=>Le.key,(Le,de)=>{var Ve=Vr(),oa=n(Ve),ze=n(oa),Be=n(ze),Ta=n(Be,!0);r(Be);var ia=l(Be,2),Ua=n(ia,!0);r(ia),r(ze);var la=l(ze,2);re(la,5,()=>(t(de),d(()=>t(de).events)),ge=>ge.id??`${ge.start_time}-${ge.meta_data?.recurring_instance_index??0}`,(ge,$e)=>{var He=Lr(),je=n(He),Fa=n(je);Xa(Fa,{get item(){return t($e)},showDate:!1,get searchQuery(){return a()}}),r(je);var Ra=l(je,2);{var Na=Ye=>{var Qe=Wr(),qe=n(Qe);r(Qe),B(()=>{zt(qe,"data-bs-target",`#${E()??""}`),zt(qe,"aria-controls",E())}),$t("click",qe,()=>Et(t($e))),o(Ye,Qe)};h(Ra,Ye=>{t($e),d(()=>V(t($e)))&&Ye(Na)})}r(He),o(ge,He)}),r(la),r(oa),r(Ve),B(()=>{ct(Ta,(t(de),d(()=>t(de).displayDay))),ct(Ua,(t(de),d(()=>t(de).displayDate)))}),o(Le,Ve)}),o(ce,xe)},Oa=ce=>{var xe=zr();o(ce,xe)};h(Sa,ce=>{t(bt),d(()=>t(bt).days.length)?ce(Ia):ce(Oa,!1)})}o(fe,ke)};h(Ca,fe=>{t(Re)&&fe(Da)})}B(()=>{aa=he(pe,1,"week-header w-100 d-flex justify-content-between align-items-center border-0 bg-transparent p-2 text-start svelte-1p8xa6u",null,aa,{"text-muted":t(we)===0}),zt(pe,"title",t(Re)?"Click to collapse week":"Click to expand week"),he(ra,1,`bi ${t(Re)?"bi-chevron-up":"bi-chevron-down"}`),ct(xa,`Week ${t(ka)??""} [${t(we)??""} Event${t(we)===1?"":"s"}]`),sa=he(We,1,"",null,sa,{"opacity-50":t(we)===0}),ct($a,(t(bt),d(()=>t(bt).label)))}),$t("click",pe,()=>Mt(t(bt).key)),o(_e,ea)}),B(()=>ct(Qt,(yt(),d(()=>yt().label)))),o(Wt,Yt)}),r(xt),o(Ot,xt)},ee=Ot=>{var xt=Yr(),Wt=n(xt);{var le=yt=>{var Yt=ue("No events match your search.");o(yt,Yt)},me=yt=>{var Yt=ue("There are no upcoming events this month.");o(yt,Yt)};h(Wt,yt=>{a()?yt(le):yt(me,!1)})}r(xt),o(Ot,xt)};h(Gt,Ot=>{t(_t),d(()=>t(_t).length)?Ot(te):Ot(ee,!1)})}var kt=l(Gt,2);{var ae=Ot=>{var xt=Kr(),Wt=n(xt),le=n(Wt);r(Wt);var me=l(Wt,2);{var yt=At=>{var Qt=Qr();$t("click",Qt,q),o(At,Qt)},Yt=At=>{var Qt=qr(),Ee=n(Qt),_e=l(Ee,2);r(Qt),$t("click",Ee,Rt),$t("click",_e,Nt),o(At,Qt)};h(me,At=>{t(D)?At(yt):At(Yt,!1)})}r(xt),B(()=>ct(le,`Showing ${t(Z),d(()=>t(Z).length)??""} of ${t(T),d(()=>t(T).length)??""} future events`)),o(Ot,xt)};h(kt,Ot=>{(t(Bt)||t(D))&&Ot(ae)})}o(at,it)},Pt=at=>{var it=Zr(),Gt=n(it);{var te=kt=>{var ae=ue("No events match your search.");o(kt,ae)},ee=kt=>{var ae=ue("There are no upcoming events scheduled.");o(kt,ae)};h(Gt,kt=>{a()?kt(te):kt(ee,!1)})}r(it),o(at,it)};h(wt,at=>{m(),d(()=>m()?.length)?at(ie):at(Pt,!1)})}r(g),o(i,g)},et=i=>{var g=Gr(),$=n(g);Oe($,{}),r(g),o(i,g)};h(z,i=>{W()?i(gt):i(et,!1)})}o(c,vt),Te(),X()}export{En as A,Mn as E,ua as d,ma as s};
