import{d as l,w as d}from"./PIcvKOdQ.js";const r=void 0,m=void 0;function a(e=!1){const s=localStorage.getItem("authToken"),t={"x-auth-token":s?`Bearer ${s}`:"",Authorization:`Bearer ${m}`,apikey:m};return e&&(t["Content-Type"]="application/json"),t}const u=d([]),c=d([]),p=d(!1),h=d(!1),w=d(null),y=d(null),T=l(u,e=>{const s={};return e.forEach(t=>{const o=t.category||"Other";s[o]||(s[o]=[]),s[o].push(t)}),s}),k=l(u,e=>{const s=new Set(e.map(t=>t.category||"Other"));return Array.from(s).sort()}),P=l(c,e=>{const s={};return e.forEach(t=>{const o=t.organization||"Other";s[o]||(s[o]=[]),s[o].push(t)}),s});l(c,e=>{const s=new Set(e.map(t=>t.organization||"Other"));return Array.from(s).sort()});async function g(){p.set(!0),w.set(null);try{const e=await fetch(`${r}/functions/v1/admin-permissions`,{headers:a()});if(!e.ok)throw new Error(`Failed to fetch permissions: ${e.statusText}`);const s=await e.json();u.set(s.permissions||[])}catch(e){const s=e instanceof Error?e.message:"Unknown error";w.set(s),console.error("Error fetching permissions:",e)}finally{p.set(!1)}}async function $(){h.set(!0),y.set(null);try{const e=await fetch(`${r}/functions/v1/admin-roles`,{headers:a()});if(!e.ok)throw new Error(`Failed to fetch roles: ${e.statusText}`);const s=await e.json();c.set(s.roles||[])}catch(e){const s=e instanceof Error?e.message:"Unknown error";y.set(s),console.error("Error fetching roles:",e)}finally{h.set(!1)}}async function O(e){const s=await fetch(`${r}/functions/v1/admin-permissions`,{method:"POST",headers:a(!0),body:JSON.stringify(e)});if(!s.ok)throw new Error(`Failed to create permission: ${s.statusText}`);const o=(await s.json()).permission;return u.update(n=>[...n,o]),o}async function x(e,s){const t=await fetch(`${r}/functions/v1/admin-permissions/${e}`,{method:"PATCH",headers:a(!0),body:JSON.stringify(s)});if(!t.ok)throw new Error(`Failed to update permission: ${t.statusText}`);const n=(await t.json()).permission;return u.update(f=>f.map(i=>i.id===e?n:i)),n}async function v(e){const s=await fetch(`${r}/functions/v1/admin-permissions/${e}`,{method:"DELETE",headers:a()});if(!s.ok)throw new Error(`Failed to delete permission: ${s.statusText}`);u.update(t=>t.filter(o=>o.id!==e))}async function S(e){const s=await fetch(`${r}/functions/v1/admin-roles`,{method:"POST",headers:a(!0),body:JSON.stringify(e)});if(!s.ok)throw new Error(`Failed to create role: ${s.statusText}`);const o=(await s.json()).role;return c.update(n=>[...n,{...o,permissions:[]}]),o}async function b(e,s){const t=await fetch(`${r}/functions/v1/admin-roles/${e}`,{method:"PATCH",headers:a(!0),body:JSON.stringify(s)});if(!t.ok)throw new Error(`Failed to update role: ${t.statusText}`);const n=(await t.json()).role;return c.update(f=>f.map(i=>i.id===e?n:i)),n}async function j(e){const s=await fetch(`${r}/functions/v1/admin-roles/${e}`,{method:"DELETE",headers:a()});if(!s.ok)throw new Error(`Failed to delete role: ${s.statusText}`);c.update(t=>t.filter(o=>o.id!==e))}async function F(e,s){const t=await fetch(`${r}/functions/v1/admin-roles/${e}/permissions`,{method:"PUT",headers:a(!0),body:JSON.stringify({permission_ids:s})});if(!t.ok)throw new Error(`Failed to assign permissions: ${t.statusText}`);const n=(await t.json()).role;c.update(f=>f.map(i=>i.id===e?n:i))}async function R(){await Promise.all([g(),$()])}export{k as a,w as b,O as c,v as d,u as e,b as f,S as g,F as h,R as i,j,y as k,p as l,h as m,c as n,T as p,P as r,x as u};
