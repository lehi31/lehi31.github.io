import"./NZTpNUN0.js";import"./69_IOA4Y.js";import{d as Tt,o as Wt,g as Ut}from"./DHXte27T.js";import{p as St,ai as w,g as e,aj as It,f as Te,a as Mt,E as u,s as l,D as d,c as a,r as t,t as D,u as n,F as oe}from"./CPOcesE7.js";import{p as $t,b as g,i as p,a as Pt,e as me,s as M}from"./opPvMm1W.js";import{e as ge,i as vt}from"./DAwrR-3T.js";import{f as o,a as r,t as Ot,c as wt}from"./YsHTGu5k.js";import{s as z}from"./BKuzlv_Y.js";import{g as Ft,p as Ze,O as dt,P,f as ot,c as ct}from"./D8vOJh1X.js";import{i as Ct}from"./C2Q_9cr2.js";import{S as jt}from"./DnS9s6th.js";import{g as Qt,d as Zt}from"./CLmETmbn.js";import{A as zt,a as Bt,E as kt,c as Rt,b as Gt}from"./CMik6dU4.js";import{v as Ht,D as Lt}from"./q1CFdWdw.js";import{s as Dt}from"./CV1XDK29.js";var ea=o('<button class="btn btn-sm btn-outline-danger" type="button"><!></button>'),ta=o('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add event"><i class="bi bi-plus"></i></button>'),aa=o('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),ra=o('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),sa=o('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),na=o("<span> </span>"),ia=o('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),la=o('<ul class="list-group list-group-flush"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">This Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),oa=o('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),va=o('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),ca=o('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),da=o("<span> </span>"),ua=o('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),ga=o('<ul class="list-group list-group-flush border-top-0"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">Next Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),ma=o('<div class="event-actions svelte-19k62y7"><button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit event"><i class="bi bi-pencil-square"></i></button></div>'),fa=o('<div class="daily-event-row svelte-19k62y7"><div class="event-content svelte-19k62y7"><!></div> <!></div>'),_a=o('<li class="list-group-item py-3"><div class="d-flex flex-column flex-md-row gap-3"><div class="event-date-column d-flex flex-column align-items-start text-nowrap svelte-19k62y7"><strong> </strong> <small class="text-muted"> </small></div> <div class="d-flex flex-column gap-3 flex-grow-1"></div></div></li>'),pa=o("<span> </span>"),ba=o('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> events</div></li>'),ya=o('<ul class="list-group list-group-flush border-top-0"><li class="list-group-item fs-x-small bg-dark-subtle"><div class="d-flex justify-content-between align-items-center py-2"><span class="fw-bold">The Following Week</span> <span class="fw-lighter"> </span></div></li> <!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li></ul>'),xa=o('<div class="d-flex flex-column gap-4"><div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center gap-3 flex-wrap"><span>Events</span> <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end"><!> <!> <!></div></div></div> <!> <!> <!></div></div>'),ha=o('<div class="d-flex flex-column gap-4"><!></div>'),Ea=o("<!> <!>",1);function qa(ut,fe){St(fe,!1);const Ue=()=>g(st,"$currentUser",T),Oe=()=>g(ht,"$userOrganizations",T),A=()=>g(xe,"$currentUserHasPermission",T),_e=()=>g(Fe,"$currentUserIsRoot",T),We=()=>g(nt,"$currentUserIsAdmin",T),Ge=()=>g(rt,"$calendarEventsThisWeek",T),pe=()=>g(xt,"$calendarEventsNextWeek",T),et=()=>g(ne,"$calendarEventsNextNextWeek",T),tt=()=>g(pt,"$ready",T),se=()=>g(it,"$hasPastEvents",T),C=()=>g(j,"$pastEventsCount",T),Se=()=>g(be,"$searchQuery",T),G=()=>g(bt,"$categoryFilter",T),b=()=>g(yt,"$currentCategoryFilter",T),[T,gt]=Pt(),at=u();let mt=$t(fe,"showThisWeek",8,!0),ft=$t(fe,"showNextWeek",8,!0),_t=$t(fe,"showNextNextWeek",8,!0);const{stores:{ready:pt,categoryFilter:bt,currentCategoryFilter:yt,calendarEventsNextWeek:xt,calendarEventsThisWeek:rt,calendarEventsNextNextWeek:ne,calendarEvents:Ie,searchQuery:be},actions:{reload:ve,calendarEventsThisWeekLabel:Me,calendarEventsNextWeekLabel:Pe,calendarEventsNextNextWeekLabel:ye}}=Qt(),{stores:{currentUserHasPermission:xe,currentUser:st,currentUserIsAdmin:nt,currentUserIsRoot:Fe,userOrganizations:ht}}=Ft();let he=u(!1),ce=u(!1),Ee=u(),Ce=u(!1),je=u(!1),k=u(!1),ee=u(new Set);const Qe={title:"Event",description:"",location:"",event_type:"calendar_event",is_public:!0},W=Ht();let ze=u(""),Be=u({...Qe});const de=i=>{d(ze,"Event Item"),d(Be,{...i,category:i?.meta_data?.category})},Re=i=>{if(!i||!i.length)return[];const y=new Map;for(const s of i){if(!s.start_time)continue;const E=Ze(s.start_time);if(Number.isNaN(E.getTime()))continue;const O=ot(E,"yyyy-MM-dd");let X=y.get(O);X||(X={key:O,displayDay:ot(E,"EEE"),displayDate:ot(E,"MMM d"),events:[]},y.set(O,X)),X.events.push(s)}return Array.from(y.values()).sort((s,E)=>s.key<E.key?-1:s.key>E.key?1:0).map(s=>({...s,events:s.events.slice().sort((E,O)=>{const X=E.is_all_day?0:1,He=O.is_all_day?0:1;if(X!==He)return X-He;const lt=E.start_time?Ze(E.start_time).getTime():Number.MAX_SAFE_INTEGER,Et=O.start_time?Ze(O.start_time).getTime():Number.MAX_SAFE_INTEGER;return lt-Et})}))};let $e=u([]),ue=u([]),we=u([]),ke=u(!1);const it=Tt(Ie,i=>{if(!i||!i.length)return!1;const y=Dt().getTime();return i.some(s=>s.event_type==="calendar_event"&&s.start_time&&Ze(s.start_time).getTime()<y)}),j=Tt(Ie,i=>{if(!i||!i.length)return 0;const y=Dt().getTime();return i.filter(s=>s.event_type==="calendar_event"&&s.start_time&&Ze(s.start_time).getTime()<y).length}),U=i=>Rt(i,{currentUserId:e(Ee),isPrivileged:e(ce),canEditOwnOrgEvents:e(k),userOrganizations:e(ee)}),De=async()=>{if(!e(he)||!Ut(Fe)||!Ut(it))return;const i=Dt(),y=ot(i,"MMM d, yyyy");if(confirm(`Delete all events that occurred before ${y}?`)){d(ke,!0);try{const s=await Zt(i);await ve(),s.deleted>0&&console.info(`Deleted ${s.deleted} past events.`),s.skipped>0&&console.info(`Skipped ${s.skipped} recurring events with active future instances.`),s.deleted===0&&s.skipped===0&&console.info("No past events matched the delete criteria.")}catch(s){console.error("Failed to delete past events",s),alert("Failed to delete past events. Please try again.")}finally{d(ke,!1)}}};Wt(async()=>{await ve()}),w(()=>Ue(),()=>{d(Ee,Ue()?.id)}),w(()=>Oe(),()=>{d(ee,Oe())}),w(()=>e(Ee),()=>{d(je,!!e(Ee))}),w(()=>(e(ee),dt),()=>{d(Ce,e(ee).has(dt.Bishopric))}),w(()=>(A(),P),()=>{d(k,A()(P.EditOwnOrgEvents))}),w(()=>(_e(),We(),e(Ce),A(),P),()=>{d(ce,_e()||We()||e(Ce)||A()(P.EditAllEvents))}),w(()=>(e(ce),A(),e(k),e(je)),()=>{d(he,e(ce)||A()(P.CreateEvents)||e(k)||e(je))}),w(()=>(A(),P),()=>{d(at,A()(P.DeleteEvents))}),w(()=>Ge(),()=>{d($e,Re(Ge()))}),w(()=>pe(),()=>{d(ue,Re(pe()))}),w(()=>et(),()=>{d(we,Re(et()))}),It(),Ct();var Ae=Ea(),te=Te(Ae);Lt(te,{get title(){return e(ze)},get id(){return W},children:(i,y)=>{zt(i,{get eventItem(){return e(Be)},get drawerId(){return W},name:"event-item-form",get canDelete(){return e(at)}})},$$slots:{default:!0}});var ae=l(te,2);{var re=i=>{var y=xa(),s=a(y),E=a(s),O=a(E),X=l(a(O),2),He=a(X);Bt(He,{});var lt=l(He,2);{var Et=$=>{var _=ea(),F=a(_);{var J=Q=>{var Z=Ot("Deletingâ€¦");r(Q,Z)},Y=Q=>{var Z=Ot();D(()=>M(Z,`Delete Past Events (${C()??""})`)),r(Q,Z)};p(F,Q=>{e(ke)?Q(J):Q(Y,!1)})}t(_),D(()=>_.disabled=e(ke)),me("click",_,De),r($,_)};p(lt,$=>{_e()&&se()&&$(Et)})}var qt=l(lt,2);{var Kt=$=>{var _=ta();D(()=>{z(_,"data-bs-target",`#${W??""}`),z(_,"aria-controls",W)}),me("click",_,()=>de({...Qe,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),r($,_)};p(qt,$=>{e(he)&&$(Kt)})}t(X),t(O),t(E);var At=l(E,2);{var Vt=$=>{var _=la(),F=a(_),J=a(F),Y=l(a(J),2),Q=a(Y,!0);t(Y),t(J),t(F);var Z=l(F,2);{var Le=v=>{var x=wt(),S=Te(x);ge(S,1,()=>e($e),vt,(B,c)=>{var m=sa(),f=a(m),N=a(f),R=a(N),Ke=a(R,!0);t(R);var ie=l(R,2),Ve=a(ie,!0);t(ie),t(N);var le=l(N,2);ge(le,7,()=>(e(c),n(()=>e(c).events)),(I,h)=>`${I.id??"new"}-${I.start_time}-${h}`,(I,h)=>{var H=ra(),L=a(H),Xe=a(L);kt(Xe,{get item(){return e(h)},showDate:!1,get searchQuery(){return Se()}}),t(L);var Je=l(L,2);{var Ye=q=>{var K=aa(),V=a(K);t(K),D(()=>{z(V,"data-bs-target",`#${W??""}`),z(V,"aria-controls",W)}),me("click",V,()=>de(e(h))),r(q,K)};p(Je,q=>{e(h),n(()=>U(e(h)))&&q(Ye)})}t(H),r(I,H)}),t(le),t(f),t(m),D(()=>{M(Ke,(e(c),n(()=>e(c).displayDay))),M(Ve,(e(c),n(()=>e(c).displayDate)))}),r(B,m)}),r(v,x)},qe=v=>{var x=ia(),S=a(x),B=l(a(S));{var c=m=>{var f=na(),N=a(f,!0);t(f),D(()=>{ct(f,1,`ms-1 me-1 badge rounded-pill bg-color-${b(),n(()=>b().color_number)??""}`,"svelte-19k62y7"),M(N,(b(),n(()=>b().label)))}),r(m,f)};p(B,m=>{G(),b(),n(()=>G()&&b()?.label?.length)&&m(c)})}oe(),t(S),t(x),r(v,x)};p(Z,v=>{e($e),n(()=>e($e).length)?v(Le):v(qe,!1)})}oe(2),t(_),D(v=>M(Q,v),[()=>n(Me)]),r($,_)};p(At,$=>{mt()&&$(Vt)})}var Nt=l(At,2);{var Xt=$=>{var _=ga(),F=a(_),J=a(F),Y=l(a(J),2),Q=a(Y,!0);t(Y),t(J),t(F);var Z=l(F,2);{var Le=v=>{var x=wt(),S=Te(x);ge(S,1,()=>e(ue),vt,(B,c)=>{var m=ca(),f=a(m),N=a(f),R=a(N),Ke=a(R,!0);t(R);var ie=l(R,2),Ve=a(ie,!0);t(ie),t(N);var le=l(N,2);ge(le,7,()=>(e(c),n(()=>e(c).events)),(I,h)=>`${I.id??"new"}-${I.start_time}-${h}`,(I,h)=>{var H=va(),L=a(H),Xe=a(L);kt(Xe,{get item(){return e(h)},showDate:!1,get searchQuery(){return Se()}}),t(L);var Je=l(L,2);{var Ye=q=>{var K=oa(),V=a(K);t(K),D(()=>{z(V,"data-bs-target",`#${W??""}`),z(V,"aria-controls",W)}),me("click",V,()=>de(e(h))),r(q,K)};p(Je,q=>{e(h),n(()=>U(e(h)))&&q(Ye)})}t(H),r(I,H)}),t(le),t(f),t(m),D(()=>{M(Ke,(e(c),n(()=>e(c).displayDay))),M(Ve,(e(c),n(()=>e(c).displayDate)))}),r(B,m)}),r(v,x)},qe=v=>{var x=ua(),S=a(x),B=l(a(S));{var c=m=>{var f=da(),N=a(f,!0);t(f),D(()=>{ct(f,1,`ms-1 me-1 badge rounded-pill bg-color-${b(),n(()=>b().color_number)??""}`,"svelte-19k62y7"),M(N,(b(),n(()=>b().label)))}),r(m,f)};p(B,m=>{G(),b(),n(()=>G()&&b()?.label?.length)&&m(c)})}oe(),t(S),t(x),r(v,x)};p(Z,v=>{e(ue),n(()=>e(ue).length)?v(Le):v(qe,!1)})}oe(2),t(_),D(v=>M(Q,v),[()=>n(Pe)]),r($,_)};p(Nt,$=>{ft()&&$(Xt)})}var Jt=l(Nt,2);{var Yt=$=>{var _=ya(),F=a(_),J=a(F),Y=l(a(J),2),Q=a(Y,!0);t(Y),t(J),t(F);var Z=l(F,2);{var Le=v=>{var x=wt(),S=Te(x);ge(S,1,()=>e(we),vt,(B,c)=>{var m=_a(),f=a(m),N=a(f),R=a(N),Ke=a(R,!0);t(R);var ie=l(R,2),Ve=a(ie,!0);t(ie),t(N);var le=l(N,2);ge(le,7,()=>(e(c),n(()=>e(c).events)),(I,h)=>`${I.id??"new"}-${I.start_time}-${h}`,(I,h)=>{var H=fa(),L=a(H),Xe=a(L);kt(Xe,{get item(){return e(h)},showDate:!1,get searchQuery(){return Se()}}),t(L);var Je=l(L,2);{var Ye=q=>{var K=ma(),V=a(K);t(K),D(()=>{z(V,"data-bs-target",`#${W??""}`),z(V,"aria-controls",W)}),me("click",V,()=>de(e(h))),r(q,K)};p(Je,q=>{e(h),n(()=>U(e(h)))&&q(Ye)})}t(H),r(I,H)}),t(le),t(f),t(m),D(()=>{M(Ke,(e(c),n(()=>e(c).displayDay))),M(Ve,(e(c),n(()=>e(c).displayDate)))}),r(B,m)}),r(v,x)},qe=v=>{var x=ba(),S=a(x),B=l(a(S));{var c=m=>{var f=pa(),N=a(f,!0);t(f),D(()=>{ct(f,1,`ms-1 me-1 badge rounded-pill bg-color-${b(),n(()=>b().color_number)??""}`,"svelte-19k62y7"),M(N,(b(),n(()=>b().label)))}),r(m,f)};p(B,m=>{G(),b(),n(()=>G()&&b()?.label?.length)&&m(c)})}oe(),t(S),t(x),r(v,x)};p(Z,v=>{e(we),n(()=>e(we).length)?v(Le):v(qe,!1)})}oe(2),t(_),D(v=>M(Q,v),[()=>n(ye)]),r($,_)};p(Jt,$=>{_t()&&$(Yt)})}t(s),t(y),r(i,y)},Ne=i=>{var y=ha(),s=a(y);jt(s,{}),t(y),r(i,y)};p(ae,i=>{tt()?i(re):i(Ne,!1)})}r(ut,Ae),Mt(),gt()}var $a=o('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Add announcement"><i class="bi bi-plus"></i></button>'),wa=o('<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="offcanvas" aria-label="Edit announcement"><i class="bi bi-pencil-square"></i></button>'),ka=o('<li class="list-group-item"><div class="d-flex justify-content-between"><!> <div><!></div></div></li>'),Da=o('<!> <li class="list-group-item py-2"><a href="/announcements-and-events">More</a></li>',1),Aa=o("<span> </span>"),Na=o('<li class="list-group-item"><div class="d-flex small text-muted align-items-center justify-content-end fw-lighter">There are no <!> announcements</div></li>'),Ta=o('<div class="d-flex flex-column gap-4"><div class="card"><div class="card-header"><div class="d-flex justify-content-between align-items-center"><span>Announcements</span> <div class="d-flex align-items-center gap-2"><!> <!></div></div></div> <ul class="list-group list-group-flush"><!></ul></div></div>'),Ua=o("<!> <!>",1);function Ka(ut,fe){St(fe,!1);const Ue=()=>g(b,"$currentUser",C),Oe=()=>g(mt,"$userOrganizations",C),A=()=>g(T,"$currentUserHasPermission",C),_e=()=>g(at,"$currentUserIsRoot",C),We=()=>g(gt,"$currentUserIsAdmin",C),Ge=()=>g(ft,"$ready",C),pe=()=>g(bt,"$announcements",C),et=()=>g(yt,"$searchQuery",C),tt=()=>g(_t,"$categoryFilter",C),se=()=>g(pt,"$currentCategoryFilter",C),[C,Se]=Pt(),G=u(),{stores:{currentUser:b,currentUserHasPermission:T,currentUserIsAdmin:gt,currentUserIsRoot:at,userOrganizations:mt}}=Ft(),{stores:{ready:ft,categoryFilter:_t,currentCategoryFilter:pt,announcements:bt,searchQuery:yt},actions:{reload:xt}}=Qt(),rt={title:"Announcement",description:"",location:"",event_type:"announcement",is_public:!0},ne=Ht();let Ie=u(!1),be=u(!1),ve=u(),Me=u(!1),Pe=u(!1),ye=u(!1),xe=u(new Set),st=u(""),nt=u({...rt});const Fe=k=>{d(st,"Announcement Form"),d(nt,{...k,category:k?.meta_data?.category})},ht=k=>Rt(k,{currentUserId:e(ve),isPrivileged:e(be),canEditOwnOrgEvents:e(ye),userOrganizations:e(xe)});Wt(async()=>{await xt()}),w(()=>Ue(),()=>{d(ve,Ue()?.id)}),w(()=>Oe(),()=>{d(xe,Oe())}),w(()=>e(ve),()=>{d(Pe,!!e(ve))}),w(()=>(e(xe),dt),()=>{d(Me,e(xe).has(dt.Bishopric))}),w(()=>(A(),P),()=>{d(ye,A()(P.EditOwnOrgEvents))}),w(()=>(_e(),We(),e(Me),A(),P),()=>{d(be,_e()||We()||e(Me)||A()(P.EditAllEvents))}),w(()=>(e(be),A(),e(ye),e(Pe)),()=>{d(Ie,e(be)||A()(P.CreateEvents)||e(ye)||e(Pe))}),w(()=>(A(),P),()=>{d(G,A()(P.DeleteEvents))}),It(),Ct();var he=Ua(),ce=Te(he);Lt(ce,{get title(){return e(st)},get id(){return ne},children:(k,ee)=>{zt(k,{get eventItem(){return e(nt)},get drawerId(){return ne},name:"announcement-item-form",get canDelete(){return e(G)}})},$$slots:{default:!0}});var Ee=l(ce,2);{var Ce=k=>{var ee=Ta(),Qe=a(ee),W=a(Qe),ze=a(W),Be=l(a(ze),2),de=a(Be);Bt(de,{});var Re=l(de,2);{var $e=j=>{var U=$a();D(()=>{z(U,"data-bs-target",`#${ne??""}`),z(U,"aria-controls",ne)}),me("click",U,()=>Fe({...rt,event_type:"calendar_event",start_time:new Date().toISOString(),end_time:new Date().toISOString(),is_all_day:!0})),r(j,U)};p(Re,j=>{e(Ie)&&j($e)})}t(Be),t(ze),t(W);var ue=l(W,2),we=a(ue);{var ke=j=>{var U=Da(),De=Te(U);ge(De,1,pe,vt,(Ae,te)=>{var ae=ka(),re=a(ae),Ne=a(re);Gt(Ne,{get item(){return e(te)},get searchQuery(){return et()}});var i=l(Ne,2),y=a(i);{var s=E=>{var O=wa();D(()=>{z(O,"data-bs-target",`#${ne??""}`),z(O,"aria-controls",ne)}),me("click",O,()=>Fe(e(te))),r(E,O)};p(y,E=>{e(te),n(()=>ht(e(te)))&&E(s)})}t(i),t(re),t(ae),r(Ae,ae)}),oe(2),r(j,U)},it=j=>{var U=Na(),De=a(U),Ae=l(a(De));{var te=ae=>{var re=Aa(),Ne=a(re,!0);t(re),D(()=>{ct(re,1,`ms-1 me-1 badge rounded-pill bg-color-${se(),n(()=>se().color_number)??""}`),M(Ne,(se(),n(()=>se().label)))}),r(ae,re)};p(Ae,ae=>{tt(),se(),n(()=>tt()&&se()?.label?.length)&&ae(te)})}oe(),t(De),t(U),r(j,U)};p(we,j=>{pe(),n(()=>pe()?.length)?j(ke):j(it,!1)})}t(ue),t(Qe),t(ee),r(k,ee)},je=k=>{jt(k,{})};p(Ee,k=>{Ge()?k(Ce):k(je,!1)})}r(ut,he),Mt(),Se()}export{Ka as A,qa as E};
